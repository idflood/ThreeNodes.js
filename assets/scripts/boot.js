function Anim(e,t,i,n,r){this.startTime=0,this.endTime=0,this.time=0,this.propertyAnims=[],this.name=e,this.target=t,this.timeline=i,this.startAnimation=n,this.endAnimation=r,this.tracks=[],this.objectTrack={type:"object",id:e,name:e,target:t,propertyTracks:[]},this.objectTrack.name||(this.objectTrack.name="Object"+i.trackNameCounter++),this.timeline.tracks.push(this.objectTrack),this.tracks.push(this.objectTrack);for(var o in t){var s={type:"property",id:this.objectTrack.name+"."+o,name:o,propertyName:o,target:t,enabled:!0,parent:this.objectTrack,container:this,anims:[],keys:[]};this.objectTrack.propertyTracks.push(s),this.tracks.push(s)}this.timeline.anims_container.push(this)}function anim(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);var i,n,r;"string"==typeof e[0]&&(i=e.shift()),n="object"==typeof e[0]?e.shift():{},r="object"==typeof e[0]?e.shift():Timeline.getGlobalInstance();var o=new Anim(i,n,r);return o}var requirejs,require,define;!function(global){function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){if(e){var i;for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}}function eachReverse(e,t){if(e){var i;for(i=e.length-1;i>-1&&(!e[i]||!t(e[i],i,e));i-=1);}}function hasProp(e,t){return e.hasOwnProperty(t)}function eachProp(e,t){var i;for(i in e)if(e.hasOwnProperty(i)&&t(e[i],i))break}function mixin(e,t,i,n){return t&&eachProp(t,function(t,r){(i||!hasProp(e,r))&&(n&&"string"!=typeof t?(e[r]||(e[r]={}),mixin(e[r],t,i,n)):e[r]=t)}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeContextModuleFunc(e,t,i){return function(){var n,r=aps.call(arguments,0);return i&&isFunction(n=r[r.length-1])&&(n.__requireJsBuild=!0),r.push(t),e.apply(null,r)}}function addRequireMethods(e,t,i){each([["toUrl"],["undef"],["defined","requireDefined"],["specified","requireSpecified"]],function(n){var r=n[1]||n[0];e[n[0]]=t?makeContextModuleFunc(t[r],i):function(){var e=contexts[defContextName];return e[r].apply(e,arguments)}})}function makeError(e,t,i,n){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=n,i&&(r.originalError=i),r}function newContext(e){function t(e){var t,i;for(t=0;e[t];t+=1)if(i=e[t],"."===i)e.splice(t,1),t-=1;else if(".."===i){if(1===t&&(".."===e[2]||".."===e[0]))break;t>0&&(e.splice(t-1,2),t-=2)}}function i(e,i,n){var r,o,s,a,l,h,c,u,d=i&&i.split("/"),p=w.map,f=p&&p["*"];if(e&&"."===e.charAt(0)&&(i?(d=w.pkgs[i]?[i]:d.slice(0,d.length-1),e=d.concat(e.split("/")),t(e),o=w.pkgs[r=e[0]],e=e.join("/"),o&&e===r+"/"+o.main&&(e=r)):0===e.indexOf("./")&&(e=e.substring(2))),n&&(d||f)&&p)for(a=e.split("/"),l=a.length;l>0;l-=1){if(c=a.slice(0,l).join("/"),d)for(h=d.length;h>0;h-=1)if(s=p[d.slice(0,h).join("/")],s&&(s=s[c])){u=s;break}if(!u&&f&&f[c]&&(u=f[c]),u){a.splice(0,l,u),e=a.join("/");break}}return e}function n(e){isBrowser&&each(scripts(),function(t){return t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===E.contextName?(t.parentNode.removeChild(t),!0):void 0})}function r(e){var t=w.paths[e];return t&&isArray(t)&&t.length>1?(n(e),t.shift(),E.undef(e),E.require([e]),!0):void 0}function o(e,t,n,r){var o,s,a,l=e?e.indexOf("!"):-1,h=null,c=t?t.name:null,u=e,d=!0,p="";return e||(d=!1,e="_@r"+(k+=1)),-1!==l&&(h=e.substring(0,l),e=e.substring(l+1,e.length)),h&&(h=i(h,c,r),s=H[h]),e&&(h?p=s&&s.normalize?s.normalize(e,function(e){return i(e,c,r)}):i(e,c,r):(p=i(e,c,r),o=E.nameToUrl(e,null,t))),a=!h||s||n?"":"_unnormalized"+(A+=1),{prefix:h,name:p,parentMap:t,unnormalized:!!a,url:o,originalName:u,isDefine:d,id:(h?h+"!"+p:p)+a}}function s(e){var t=e.id,i=R[t];return i||(i=R[t]=new E.Module(e)),i}function a(e,t,i){var n=e.id,r=R[n];!hasProp(H,n)||r&&!r.defineEmitComplete?s(e).on(t,i):"defined"===t&&i(H[n])}function l(e,t){var i=e.requireModules,n=!1;t?t(e):(each(i,function(t){var i=R[t];i&&(i.error=e,i.events.error&&(n=!0,i.emit("error",e)))}),n||req.onError(e))}function h(){globalDefQueue.length&&(apsp.apply(C,[C.length-1,0].concat(globalDefQueue)),globalDefQueue=[])}function c(e,t,i){var n=e&&e.map,r=makeContextModuleFunc(i||E.require,n,t);return addRequireMethods(r,E,n),r.isBrowser=isBrowser,r}function u(e){delete R[e],each(P,function(t,i){return t.map.id===e?(P.splice(i,1),t.defined||(E.waitCount-=1),!0):void 0})}function d(e,t){var i,n=e.map.id,r=e.depMaps;if(e.inited)return t[n]?e:(t[n]=!0,each(r,function(e){var r=e.id,o=R[r];if(o)return o.inited&&o.enabled?i=d(o,mixin({},t)):(i=null,delete t[n],!0)}),i)}function p(e,t,i){var n=e.map.id,r=e.depMaps;if(e.inited&&e.map.isDefine)return t[n]?H[n]:(t[n]=e,each(r,function(r){var o,s=r.id,a=R[s];if(!x[s]&&a){if(!a.inited||!a.enabled)return i[n]=!0,void 0;o=p(a,t,i),i[s]||e.defineDepById(s,o)}}),e.check(!0),H[n])}function f(e){e.check()}function m(){var e,t,i,o,s=1e3*w.waitSeconds,a=s&&E.startTime+s<(new Date).getTime(),h=[],c=!1,u=!0;if(!_){if(_=!0,eachProp(R,function(i){if(e=i.map,t=e.id,i.enabled&&!i.error)if(!i.inited&&a)r(t)?(o=!0,c=!0):(h.push(t),n(t));else if(!i.inited&&i.fetched&&e.isDefine&&(c=!0,!e.prefix))return u=!1}),a&&h.length)return i=makeError("timeout","Load timeout for modules: "+h,null,h),i.contextName=E.contextName,l(i);u&&(each(P,function(e){if(!e.defined){var t=d(e,{}),i={};t&&(p(t,i,{}),eachProp(i,f))}}),eachProp(R,f)),a&&!o||!c||!isBrowser&&!isWebWorker||T||(T=setTimeout(function(){T=0,m()},50)),_=!1}}function g(e){s(o(e[0],null,!0)).init(e[1],e[2])}function v(e,t,i,n){e.detachEvent&&!isOpera?n&&e.detachEvent(n,t):e.removeEventListener(i,t,!1)}function y(e){var t=e.currentTarget||e.srcElement;return v(t,E.onScriptLoad,"load","onreadystatechange"),v(t,E.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}var _,b,E,x,T,w={waitSeconds:7,baseUrl:"./",paths:{},pkgs:{},shim:{}},R={},S={},C=[],H={},M={},k=1,A=1,P=[];return x={require:function(e){return c(e)},exports:function(e){return e.usingExports=!0,e.map.isDefine?e.exports=H[e.map.id]={}:void 0},module:function(e){return e.module={id:e.map.id,uri:e.map.url,config:function(){return w.config&&w.config[e.map.id]||{}},exports:H[e.map.id]}}},b=function(e){this.events=S[e.id]||{},this.map=e,this.shim=w.shim[e.id],this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0},b.prototype={init:function(e,t,i,n){n=n||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.depMaps.rjsSkipMap=e.rjsSkipMap,this.errback=i,this.inited=!0,this.ignore=n.ignore,n.enabled||this.enabled?this.enable():this.check())},defineDepById:function(e,t){var i;return each(this.depMaps,function(t,n){return t.id===e?(i=n,!0):void 0}),this.defineDep(i,t)},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,E.startTime=(new Date).getTime();var e=this.map;return this.shim?(c(this,!0)(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})),void 0):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;M[e]||(M[e]=!0,E.load(this.map.id,e))},check:function(e){if(this.enabled&&!this.enabling){var t,i,n=this.map.id,r=this.depExports,o=this.exports,s=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(s)){if(this.events.error)try{o=E.execCb(n,s,r,o)}catch(a){t=a}else o=E.execCb(n,s,r,o);if(this.map.isDefine&&(i=this.module,i&&void 0!==i.exports&&i.exports!==this.exports?o=i.exports:void 0===o&&this.usingExports&&(o=this.exports)),t)return t.requireMap=this.map,t.requireModules=[this.map.id],t.requireType="define",l(this.error=t)}else o=s;this.exports=o,this.map.isDefine&&!this.ignore&&(H[n]=o,req.onResourceLoad&&req.onResourceLoad(E,this.map,this.depMaps)),delete R[n],this.defined=!0,E.waitCount-=1,0===E.waitCount&&(P=[])}this.defining=!1,e||this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=o(e.prefix,null,!1,!0);a(n,"defined",bind(this,function(n){var r,h,d,p=this.map.name,f=this.map.parentMap?this.map.parentMap.name:null;return this.map.unnormalized?(n.normalize&&(p=n.normalize(p,function(e){return i(e,f,!0)})||""),h=o(e.prefix+"!"+p,this.map.parentMap,!1,!0),a(h,"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),d=R[h.id],d&&(this.events.error&&d.on("error",bind(this,function(e){this.emit("error",e)})),d.enable()),void 0):(r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})}),r.error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(R,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&u(e.map.id)}),l(e)}),r.fromText=function(e,t){var i=useInteractive;i&&(useInteractive=!1),s(o(e)),req.exec(t),i&&(useInteractive=!0),E.completeLoad(e)},n.load(e.name,c(e.parentMap,!0,function(e,t){return e.rjsSkipMap=!0,E.require(e,t)}),r,w),void 0)})),E.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){this.enabled=!0,this.waitPushed||(P.push(this),E.waitCount+=1,this.waitPushed=!0),this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,n,r;if("string"==typeof e){if(e=o(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.depMaps.rjsSkipMap),this.depMaps[t]=e,r=x[e.id])return this.depExports[t]=r(this),void 0;this.depCount+=1,a(e,"defined",bind(this,function(e){this.defineDep(t,e),this.check()})),this.errback&&a(e,"error",this.errback)}i=e.id,n=R[i],x[i]||!n||n.enabled||E.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=R[e.id];t&&!t.enabled&&E.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},E={config:w,contextName:e,registry:R,defined:H,urlFetched:M,waitCount:0,defQueue:C,Module:b,makeModuleMap:o,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=w.pkgs,i=w.shim,n=w.paths,r=w.map;mixin(w,e,!0),w.paths=mixin(n,e.paths,!0),e.map&&(w.map=mixin(r||{},e.map,!0,!0)),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),e.exports&&!e.exports.__buildReady&&(e.exports=E.makeShimExports(e.exports)),i[t]=e}),w.shim=i),e.packages&&(each(e.packages,function(e){var i;e="string"==typeof e?{name:e}:e,i=e.location,t[e.name]={name:e.name,location:i||e.name,main:(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}}),w.pkgs=t),eachProp(R,function(e,t){e.map=o(t)}),(e.deps||e.callback)&&E.require(e.deps||[],e.callback)},makeShimExports:function(e){var t;return"string"==typeof e?(t=function(){return getGlobal(e)},t.exports=e,t):function(){return e.apply(global,arguments)}},requireDefined:function(e,t){return hasProp(H,o(e,t,!1,!0).id)},requireSpecified:function(e,t){return e=o(e,t,!1,!0).id,hasProp(H,e)||hasProp(R,e)},require:function(t,i,n,r){var a,c,u,d,p;if("string"==typeof t)return isFunction(i)?l(makeError("requireargs","Invalid require call"),n):req.get?req.get(E,t,i):(a=t,r=i,u=o(a,r,!1,!0),c=u.id,hasProp(H,c)?H[c]:l(makeError("notloaded",'Module name "'+c+'" has not been loaded yet for context: '+e)));for(n&&!isFunction(n)&&(r=n,n=void 0),i&&!isFunction(i)&&(r=i,i=void 0),h();C.length;){if(p=C.shift(),null===p[0])return l(makeError("mismatch","Mismatched anonymous define() module: "+p[p.length-1]));g(p)}return d=s(o(null,r)),d.init(t,i,n,{enabled:!0}),m(),E.require},undef:function(e){var t=o(e,null,!0),i=R[e];delete H[e],delete M[t.url],delete S[e],i&&(i.events.defined&&(S[e]=i.events),u(e))},enable:function(e){var t=R[e.id];t&&s(e).enable()},completeLoad:function(e){var t,i,n,o=w.shim[e]||{},s=o.exports&&o.exports.exports;for(h();C.length;){if(i=C.shift(),null===i[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);g(i)}if(n=R[e],!t&&!H[e]&&n&&!n.inited){if(!(!w.enforceDefine||s&&getGlobal(s)))return r(e)?void 0:l(makeError("nodefine","No define call for "+e,null,[e]));g([e,o.deps||[],o.exports])}m()},toUrl:function(e,t){var i=e.lastIndexOf("."),n=null;return-1!==i&&(n=e.substring(i,e.length),e=e.substring(0,i)),E.nameToUrl(e,n,t)},nameToUrl:function(e,t,n){var r,o,s,a,l,h,c,u,d;if(e=i(e,n&&n.id,!0),req.jsExtRegExp.test(e))u=e+(t||"");else{for(r=w.paths,o=w.pkgs,l=e.split("/"),h=l.length;h>0;h-=1){if(c=l.slice(0,h).join("/"),s=o[c],d=r[c]){isArray(d)&&(d=d[0]),l.splice(0,h,d);break}if(s){a=e===s.name?s.location+"/"+s.main:s.location,l.splice(0,h,a);break}}u=l.join("/")+(t||".js"),u=("/"===u.charAt(0)||u.match(/^[\w\+\.\-]+:/)?"":w.baseUrl)+u}return w.urlArgs?u+((-1===u.indexOf("?")?"?":"&")+w.urlArgs):u},load:function(e,t){req.load(E,e,t)},execCb:function(e,t,i,n){return t.apply(n,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=y(e);E.completeLoad(t.id)}},onScriptError:function(e){var t=y(e);return r(t.id)?void 0:l(makeError("scripterror","Script error",e,[t.id]))}}}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){return"interactive"===e.readyState?interactiveScript=e:void 0}),interactiveScript)}var version="2.0.2",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,ostring=Object.prototype.toString,ap=Array.prototype,aps=ap.slice,apsp=ap.splice,isBrowser=!("undefined"==typeof window||!navigator||!document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1,req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath;if("undefined"==typeof define){if("undefined"!=typeof requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}"undefined"==typeof require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,n){var r,o,s=defContextName;return isArray(e)||"string"==typeof e||(o=e,isArray(t)?(e=t,t=i,i=n):e=[]),o&&o.context&&(s=o.context),r=contexts[s],r||(r=contexts[s]=req.s.newContext(s)),o&&r.configure(o),r.require(e,t,i)},req.config=function(e){return req(e)},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),addRequireMethods(req),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=function(e){throw e},req.load=function(e,t,i){var n,r=e&&e.config||{};return isBrowser?(n=r.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script"),n.type=r.scriptType||"text/javascript",n.charset="utf-8",n.setAttribute("data-requirecontext",e.contextName),n.setAttribute("data-requiremodule",t),!n.attachEvent||n.attachEvent.toString&&n.attachEvent.toString().indexOf("[native code")<0||isOpera?(n.addEventListener("load",e.onScriptLoad,!1),n.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,n.attachEvent("onreadystatechange",e.onScriptLoad)),n.src=i,currentlyAddingScript=n,baseElement?head.insertBefore(n,baseElement):head.appendChild(n),currentlyAddingScript=null,n):(isWebWorker&&(importScripts(i),e.completeLoad(t)),void 0)},isBrowser&&eachReverse(scripts(),function(e){return head||(head=e.parentNode),dataMain=e.getAttribute("data-main"),dataMain?(src=dataMain.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl||(cfg.baseUrl=subPath),dataMain=mainScript.replace(jsSuffixRegExp,""),cfg.deps=cfg.deps?cfg.deps.concat(dataMain):[dataMain],!0):void 0}),define=function(e,t,i){var n,r;"string"!=typeof e&&(i=t,t=e,e=null),isArray(t)||(i=t,t=[]),!t.length&&isFunction(i)&&i.length&&(i.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,i){t.push(i)}),t=(1===i.length?["require"]:["require","exports","module"]).concat(t)),useInteractive&&(n=currentlyAddingScript||getInteractiveScript(),n&&(e||(e=n.getAttribute("data-requiremodule")),r=contexts[n.getAttribute("data-requirecontext")])),(r?r.defQueue:globalDefQueue).push([e,t,i])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this),define("requireLib",function(){}),define("cs",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){var e=this,t=e._,i={},n=Array.prototype,r=Object.prototype,o=Function.prototype,s=Date.now||function(){return(new Date).getTime()},a=n.push,l=n.slice,h=n.concat,c=r.toString,u=r.hasOwnProperty,d=n.forEach,p=n.map,f=n.reduce,m=n.reduceRight,g=n.filter,v=n.every,y=n.some,_=n.indexOf,b=n.lastIndexOf,E=Array.isArray,x=Object.keys,T=o.bind,w=function(e){return e instanceof w?e:this instanceof w?(this._wrapped=e,void 0):new w(e)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):e._=w,w.VERSION="1.5.2";var R=w.each=w.forEach=function(e,t,n){if(null!=e)if(d&&e.forEach===d)e.forEach(t,n);else if(e.length===+e.length){for(var r=0,o=e.length;o>r;r++)if(t.call(n,e[r],r,e)===i)return}else for(var s=w.keys(e),r=0,o=s.length;o>r;r++)if(t.call(n,e[s[r]],s[r],e)===i)return};w.map=w.collect=function(e,t,i){var n=[];return null==e?n:p&&e.map===p?e.map(t,i):(R(e,function(e,r,o){n.push(t.call(i,e,r,o))}),n)};var S="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(e,t,i,n){var r=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return n&&(t=w.bind(t,n)),r?e.reduce(t,i):e.reduce(t);if(R(e,function(e,o,s){r?i=t.call(n,i,e,o,s):(i=e,r=!0)}),!r)throw new TypeError(S);return i},w.reduceRight=w.foldr=function(e,t,i,n){var r=arguments.length>2;if(null==e&&(e=[]),m&&e.reduceRight===m)return n&&(t=w.bind(t,n)),r?e.reduceRight(t,i):e.reduceRight(t);var o=e.length;if(o!==+o){var s=w.keys(e);o=s.length}if(R(e,function(a,l,h){l=s?s[--o]:--o,r?i=t.call(n,i,e[l],l,h):(i=e[l],r=!0)}),!r)throw new TypeError(S);return i},w.find=w.detect=function(e,t,i){var n;return C(e,function(e,r,o){return t.call(i,e,r,o)?(n=e,!0):void 0}),n},w.filter=w.select=function(e,t,i){var n=[];return null==e?n:g&&e.filter===g?e.filter(t,i):(R(e,function(e,r,o){t.call(i,e,r,o)&&n.push(e)}),n)},w.reject=function(e,t,i){return w.filter(e,function(e,n,r){return!t.call(i,e,n,r)},i)},w.every=w.all=function(e,t,n){t||(t=w.identity);var r=!0;return null==e?r:v&&e.every===v?e.every(t,n):(R(e,function(e,o,s){return(r=r&&t.call(n,e,o,s))?void 0:i}),!!r)};var C=w.some=w.any=function(e,t,n){t||(t=w.identity);var r=!1;return null==e?r:y&&e.some===y?e.some(t,n):(R(e,function(e,o,s){return r||(r=t.call(n,e,o,s))?i:void 0}),!!r)};w.contains=w.include=function(e,t){return null==e?!1:_&&e.indexOf===_?-1!=e.indexOf(t):C(e,function(e){return e===t})},w.invoke=function(e,t){var i=l.call(arguments,2),n=w.isFunction(t);return w.map(e,function(e){return(n?t:e[t]).apply(e,i)})},w.pluck=function(e,t){return w.map(e,function(e){return e[t]})},w.where=function(e,t,i){return w.isEmpty(t)?i?void 0:[]:w[i?"find":"filter"](e,function(e){for(var i in t)if(t[i]!==e[i])return!1;return!0})},w.findWhere=function(e,t){return w.where(e,t,!0)},w.max=function(e,t,i){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&w.isEmpty(e))return-1/0;var n={computed:-1/0,value:-1/0};return R(e,function(e,r,o){var s=t?t.call(i,e,r,o):e;s>n.computed&&(n={value:e,computed:s})}),n.value},w.min=function(e,t,i){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&w.isEmpty(e))return 1/0;var n={computed:1/0,value:1/0};return R(e,function(e,r,o){var s=t?t.call(i,e,r,o):e;s<n.computed&&(n={value:e,computed:s})}),n.value},w.shuffle=function(e){var t,i=0,n=[];return R(e,function(e){t=w.random(i++),n[i-1]=n[t],n[t]=e}),n},w.sample=function(e,t,i){return null==t||i?(e.length!==+e.length&&(e=w.values(e)),e[w.random(e.length-1)]):w.shuffle(e).slice(0,Math.max(0,t))};var H=function(e){return w.isFunction(e)?e:function(t){return t[e]}};w.sortBy=function(e,t,i){var n=null==t?w.identity:H(t);return w.pluck(w.map(e,function(e,t,r){return{value:e,index:t,criteria:n.call(i,e,t,r)}}).sort(function(e,t){var i=e.criteria,n=t.criteria;if(i!==n){if(i>n||void 0===i)return 1;if(n>i||void 0===n)return-1}return e.index-t.index}),"value")};var M=function(e){return function(t,i,n){var r={},o=null==i?w.identity:H(i);return R(t,function(i,s){var a=o.call(n,i,s,t);e(r,a,i)}),r}};w.groupBy=M(function(e,t,i){(w.has(e,t)?e[t]:e[t]=[]).push(i)}),w.indexBy=M(function(e,t,i){e[t]=i}),w.countBy=M(function(e,t){w.has(e,t)?e[t]++:e[t]=1}),w.sortedIndex=function(e,t,i,n){i=null==i?w.identity:H(i);for(var r=i.call(n,t),o=0,s=e.length;s>o;){var a=o+s>>>1;i.call(n,e[a])<r?o=a+1:s=a}return o},w.toArray=function(e){return e?w.isArray(e)?l.call(e):e.length===+e.length?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:e.length===+e.length?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,i){return null==e?void 0:null==t||i?e[0]:l.call(e,0,t)},w.initial=function(e,t,i){return l.call(e,0,e.length-(null==t||i?1:t))},w.last=function(e,t,i){return null==e?void 0:null==t||i?e[e.length-1]:l.call(e,Math.max(e.length-t,0))},w.rest=w.tail=w.drop=function(e,t,i){return l.call(e,null==t||i?1:t)},w.compact=function(e){return w.filter(e,w.identity)};var k=function(e,t,i){return t&&w.every(e,w.isArray)?h.apply(i,e):(R(e,function(e){w.isArray(e)||w.isArguments(e)?t?a.apply(i,e):k(e,t,i):i.push(e)}),i)};w.flatten=function(e,t){return k(e,t,[])},w.without=function(e){return w.difference(e,l.call(arguments,1))},w.uniq=w.unique=function(e,t,i,n){w.isFunction(t)&&(n=i,i=t,t=!1);var r=i?w.map(e,i,n):e,o=[],s=[];return R(r,function(i,n){(t?n&&s[s.length-1]===i:w.contains(s,i))||(s.push(i),o.push(e[n]))}),o},w.union=function(){return w.uniq(w.flatten(arguments,!0))},w.intersection=function(e){var t=l.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.indexOf(t,e)>=0})})},w.difference=function(e){var t=h.apply(n,l.call(arguments,1));return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){for(var e=w.max(w.pluck(arguments,"length").concat(0)),t=new Array(e),i=0;e>i;i++)t[i]=w.pluck(arguments,""+i);return t},w.object=function(e,t){if(null==e)return{};for(var i={},n=0,r=e.length;r>n;n++)t?i[e[n]]=t[n]:i[e[n][0]]=e[n][1];return i},w.indexOf=function(e,t,i){if(null==e)return-1;var n=0,r=e.length;if(i){if("number"!=typeof i)return n=w.sortedIndex(e,t),e[n]===t?n:-1;n=0>i?Math.max(0,r+i):i}if(_&&e.indexOf===_)return e.indexOf(t,i);for(;r>n;n++)if(e[n]===t)return n;return-1},w.lastIndexOf=function(e,t,i){if(null==e)return-1;var n=null!=i;if(b&&e.lastIndexOf===b)return n?e.lastIndexOf(t,i):e.lastIndexOf(t);for(var r=n?i:e.length;r--;)if(e[r]===t)return r;return-1},w.range=function(e,t,i){arguments.length<=1&&(t=e||0,e=0),i=arguments[2]||1;for(var n=Math.max(Math.ceil((t-e)/i),0),r=0,o=new Array(n);n>r;)o[r++]=e,e+=i;return o};var A=function(){};w.bind=function(e,t){var i,n;if(T&&e.bind===T)return T.apply(e,l.call(arguments,1));if(!w.isFunction(e))throw new TypeError;return i=l.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(l.call(arguments)));A.prototype=e.prototype;var r=new A;A.prototype=null;var o=e.apply(r,i.concat(l.call(arguments)));return Object(o)===o?o:r}},w.partial=function(e){var t=l.call(arguments,1);return function(){return e.apply(this,t.concat(l.call(arguments)))}},w.bindAll=function(e){var t=l.call(arguments,1);if(0===t.length)throw new Error("bindAll must be passed function names");return R(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var i={};return t||(t=w.identity),function(){var n=t.apply(this,arguments);return w.has(i,n)?i[n]:i[n]=e.apply(this,arguments)}},w.delay=function(e,t){var i=l.call(arguments,2);return setTimeout(function(){return e.apply(null,i)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(l.call(arguments,1)))},w.throttle=function(e,t,i){var n,r,o,a=null,l=0;i||(i={});var h=function(){l=i.leading===!1?0:s(),a=null,o=e.apply(n,r)};return function(){var c=s();l||i.leading!==!1||(l=c);var u=t-(c-l);return n=this,r=arguments,0>=u?(clearTimeout(a),a=null,l=c,o=e.apply(n,r)):a||i.trailing===!1||(a=setTimeout(h,u)),o}},w.debounce=function(e,t,i){var n,r,o,a,l;return function(){o=this,r=arguments,a=s();var h=function(){var c=s()-a;t>c?n=setTimeout(h,t-c):(n=null,i||(l=e.apply(o,r)))},c=i&&!n;return n||(n=setTimeout(h,t)),c&&(l=e.apply(o,r)),l}},w.once=function(e){var t,i=!1;return function(){return i?t:(i=!0,t=e.apply(this,arguments),e=null,t)}},w.wrap=function(e,t){return function(){var i=[e];return a.apply(i,arguments),t.apply(this,i)}},w.compose=function(){var e=arguments;return function(){for(var t=arguments,i=e.length-1;i>=0;i--)t=[e[i].apply(this,t)];return t[0]}},w.after=function(e,t){return function(){return--e<1?t.apply(this,arguments):void 0}},w.keys=x||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var i in e)w.has(e,i)&&t.push(i);return t},w.values=function(e){for(var t=w.keys(e),i=t.length,n=new Array(i),r=0;i>r;r++)n[r]=e[t[r]];return n},w.pairs=function(e){for(var t=w.keys(e),i=t.length,n=new Array(i),r=0;i>r;r++)n[r]=[t[r],e[t[r]]];return n},w.invert=function(e){for(var t={},i=w.keys(e),n=0,r=i.length;r>n;n++)t[e[i[n]]]=i[n];return t},w.functions=w.methods=function(e){var t=[];for(var i in e)w.isFunction(e[i])&&t.push(i);return t.sort()},w.extend=function(e){return R(l.call(arguments,1),function(t){if(t)for(var i in t)e[i]=t[i]}),e},w.pick=function(e){var t={},i=h.apply(n,l.call(arguments,1));return R(i,function(i){i in e&&(t[i]=e[i])}),t},w.omit=function(e){var t={},i=h.apply(n,l.call(arguments,1));for(var r in e)w.contains(i,r)||(t[r]=e[r]);return t},w.defaults=function(e){return R(l.call(arguments,1),function(t){if(t)for(var i in t)void 0===e[i]&&(e[i]=t[i])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e};var P=function(e,t,i,n){if(e===t)return 0!==e||1/e==1/t;if(null==e||null==t)return e===t;e instanceof w&&(e=e._wrapped),t instanceof w&&(t=t._wrapped);var r=c.call(e);if(r!=c.call(t))return!1;switch(r){case"[object String]":return e==String(t);case"[object Number]":return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case"[object Date]":case"[object Boolean]":return+e==+t;case"[object RegExp]":return e.source==t.source&&e.global==t.global&&e.multiline==t.multiline&&e.ignoreCase==t.ignoreCase}if("object"!=typeof e||"object"!=typeof t)return!1;for(var o=i.length;o--;)if(i[o]==e)return n[o]==t;var s=e.constructor,a=t.constructor;if(s!==a&&!(w.isFunction(s)&&s instanceof s&&w.isFunction(a)&&a instanceof a))return!1;i.push(e),n.push(t);var l=0,h=!0;if("[object Array]"==r){if(l=e.length,h=l==t.length)for(;l--&&(h=P(e[l],t[l],i,n)););}else{for(var u in e)if(w.has(e,u)&&(l++,!(h=w.has(t,u)&&P(e[u],t[u],i,n))))break;if(h){for(u in t)if(w.has(t,u)&&!l--)break;h=!l}}return i.pop(),n.pop(),h};w.isEqual=function(e,t){return P(e,t,[],[])},w.isEmpty=function(e){if(null==e)return!0;if(w.isArray(e)||w.isString(e))return 0===e.length;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!(!e||1!==e.nodeType)},w.isArray=E||function(e){return"[object Array]"==c.call(e)},w.isObject=function(e){return e===Object(e)},R(["Arguments","Function","String","Number","Date","RegExp"],function(e){w["is"+e]=function(t){return c.call(t)=="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return!(!e||!w.has(e,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(e){return"function"==typeof e}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!=+e},w.isBoolean=function(e){return e===!0||e===!1||"[object Boolean]"==c.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return u.call(e,t)},w.noConflict=function(){return e._=t,this},w.identity=function(e){return e},w.times=function(e,t,i){for(var n=Array(Math.max(0,e)),r=0;e>r;r++)n[r]=t.call(i,r);return n},w.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var F={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};F.unescape=w.invert(F.escape);var D={escape:new RegExp("["+w.keys(F.escape).join("")+"]","g"),unescape:new RegExp("("+w.keys(F.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(e){w[e]=function(t){return null==t?"":(""+t).replace(D[e],function(t){return F[e][t]})}}),w.result=function(e,t){if(null==e)return void 0;var i=e[t];return w.isFunction(i)?i.call(e):i},w.mixin=function(e){R(w.functions(e),function(t){var i=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return a.apply(e,arguments),O.call(this,i.apply(w,e))}})};var N=0;w.uniqueId=function(e){var t=++N+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var z=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},I=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(e,t,i){var n;i=w.defaults({},i,w.templateSettings);var r=new RegExp([(i.escape||z).source,(i.interpolate||z).source,(i.evaluate||z).source].join("|")+"|$","g"),o=0,s="__p+='";e.replace(r,function(t,i,n,r,a){return s+=e.slice(o,a).replace(I,function(e){return"\\"+L[e]}),i&&(s+="'+\n((__t=("+i+"))==null?'':_.escape(__t))+\n'"),n&&(s+="'+\n((__t=("+n+"))==null?'':__t)+\n'"),r&&(s+="';\n"+r+"\n__p+='"),o=a+t.length,t}),s+="';\n",i.variable||(s="with(obj||{}){\n"+s+"}\n"),s="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+s+"return __p;\n";try{n=new Function(i.variable||"obj","_",s)}catch(a){throw a.source=s,a}if(t)return n(t,w);var l=function(e){return n.call(this,e,w)};return l.source="function("+(i.variable||"obj")+"){\n"+s+"}",l},w.chain=function(e){return w(e).chain()};var O=function(e){return this._chain?w(e).chain():e};w.mixin(w),R(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];w.prototype[e]=function(){var i=this._wrapped;return t.apply(i,arguments),"shift"!=e&&"splice"!=e||0!==i.length||delete i[0],O.call(this,i)}}),R(["concat","join","slice"],function(e){var t=n[e];w.prototype[e]=function(){return O.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}.call(this),define("Underscore",function(e){return function(){var t;return t||e._}}(this)),function(e,t){function i(e){var t=e.length,i=ot.type(e);return ot.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===i||"function"!==i&&(0===t||"number"==typeof t&&t>0&&t-1 in e)}function n(e){var t=ft[e]={};return ot.each(e.match(at)||[],function(e,i){t[i]=!0}),t}function r(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=ot.expando+Math.random()}function o(e,i,n){var r;if(n===t&&1===e.nodeType)if(r="data-"+i.replace(yt,"-$1").toLowerCase(),n=e.getAttribute(r),"string"==typeof n){try{n="true"===n?!0:"false"===n?!1:"null"===n?null:+n+""===n?+n:vt.test(n)?JSON.parse(n):n}catch(o){}mt.set(e,i,n)
}else n=t;return n}function s(){return!0}function a(){return!1}function l(){try{return $.activeElement}catch(e){}}function h(e,t){for(;(e=e[t])&&1!==e.nodeType;);return e}function c(e,t,i){if(ot.isFunction(t))return ot.grep(e,function(e,n){return!!t.call(e,n,e)!==i});if(t.nodeType)return ot.grep(e,function(e){return e===t!==i});if("string"==typeof t){if(Ht.test(t))return ot.filter(t,e,i);t=ot.filter(t,e)}return ot.grep(e,function(e){return tt.call(t,e)>=0!==i})}function u(e,t){return ot.nodeName(e,"table")&&ot.nodeName(1===t.nodeType?t:t.firstChild,"tr")?e.getElementsByTagName("tbody")[0]||e.appendChild(e.ownerDocument.createElement("tbody")):e}function d(e){return e.type=(null!==e.getAttribute("type"))+"/"+e.type,e}function p(e){var t=Ot.exec(e.type);return t?e.type=t[1]:e.removeAttribute("type"),e}function f(e,t){for(var i=e.length,n=0;i>n;n++)gt.set(e[n],"globalEval",!t||gt.get(t[n],"globalEval"))}function m(e,t){var i,n,r,o,s,a,l,h;if(1===t.nodeType){if(gt.hasData(e)&&(o=gt.access(e),s=gt.set(t,o),h=o.events)){delete s.handle,s.events={};for(r in h)for(i=0,n=h[r].length;n>i;i++)ot.event.add(t,r,h[r][i])}mt.hasData(e)&&(a=mt.access(e),l=ot.extend({},a),mt.set(t,l))}}function g(e,i){var n=e.getElementsByTagName?e.getElementsByTagName(i||"*"):e.querySelectorAll?e.querySelectorAll(i||"*"):[];return i===t||i&&ot.nodeName(e,i)?ot.merge([e],n):n}function v(e,t){var i=t.nodeName.toLowerCase();"input"===i&&zt.test(e.type)?t.checked=e.checked:("input"===i||"textarea"===i)&&(t.defaultValue=e.defaultValue)}function y(e,t){if(t in e)return t;for(var i=t.charAt(0).toUpperCase()+t.slice(1),n=t,r=Zt.length;r--;)if(t=Zt[r]+i,t in e)return t;return n}function _(e,t){return e=t||e,"none"===ot.css(e,"display")||!ot.contains(e.ownerDocument,e)}function b(t){return e.getComputedStyle(t,null)}function E(e,t){for(var i,n,r,o=[],s=0,a=e.length;a>s;s++)n=e[s],n.style&&(o[s]=gt.get(n,"olddisplay"),i=n.style.display,t?(o[s]||"none"!==i||(n.style.display=""),""===n.style.display&&_(n)&&(o[s]=gt.access(n,"olddisplay",R(n.nodeName)))):o[s]||(r=_(n),(i&&"none"!==i||!r)&&gt.set(n,"olddisplay",r?i:ot.css(n,"display"))));for(s=0;a>s;s++)n=e[s],n.style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?o[s]||"":"none"));return e}function x(e,t,i){var n=Gt.exec(t);return n?Math.max(0,n[1]-(i||0))+(n[2]||"px"):t}function T(e,t,i,n,r){for(var o=i===(n?"border":"content")?4:"width"===t?1:0,s=0;4>o;o+=2)"margin"===i&&(s+=ot.css(e,i+Jt[o],!0,r)),n?("content"===i&&(s-=ot.css(e,"padding"+Jt[o],!0,r)),"margin"!==i&&(s-=ot.css(e,"border"+Jt[o]+"Width",!0,r))):(s+=ot.css(e,"padding"+Jt[o],!0,r),"padding"!==i&&(s+=ot.css(e,"border"+Jt[o]+"Width",!0,r)));return s}function w(e,t,i){var n=!0,r="width"===t?e.offsetWidth:e.offsetHeight,o=b(e),s=ot.support.boxSizing&&"border-box"===ot.css(e,"boxSizing",!1,o);if(0>=r||null==r){if(r=Ut(e,t,o),(0>r||null==r)&&(r=e.style[t]),qt.test(r))return r;n=s&&(ot.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+T(e,t,i||(s?"border":"content"),n,o)+"px"}function R(e){var t=$,i=Yt[e];return i||(i=S(e,t),"none"!==i&&i||(jt=(jt||ot("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(t.documentElement),t=(jt[0].contentWindow||jt[0].contentDocument).document,t.write("<!doctype html><html><body>"),t.close(),i=S(e,t),jt.detach()),Yt[e]=i),i}function S(e,t){var i=ot(t.createElement(e)).appendTo(t.body),n=ot.css(i[0],"display");return i.remove(),n}function C(e,t,i,n){var r;if(ot.isArray(t))ot.each(t,function(t,r){i||ti.test(e)?n(e,r):C(e+"["+("object"==typeof r?t:"")+"]",r,i,n)});else if(i||"object"!==ot.type(t))n(e,t);else for(r in t)C(e+"["+r+"]",t[r],i,n)}function H(e){return function(t,i){"string"!=typeof t&&(i=t,t="*");var n,r=0,o=t.toLowerCase().match(at)||[];if(ot.isFunction(i))for(;n=o[r++];)"+"===n[0]?(n=n.slice(1)||"*",(e[n]=e[n]||[]).unshift(i)):(e[n]=e[n]||[]).push(i)}}function M(e,t,i,n){function r(a){var l;return o[a]=!0,ot.each(e[a]||[],function(e,a){var h=a(t,i,n);return"string"!=typeof h||s||o[h]?s?!(l=h):void 0:(t.dataTypes.unshift(h),r(h),!1)}),l}var o={},s=e===yi;return r(t.dataTypes[0])||!o["*"]&&r("*")}function k(e,i){var n,r,o=ot.ajaxSettings.flatOptions||{};for(n in i)i[n]!==t&&((o[n]?e:r||(r={}))[n]=i[n]);return r&&ot.extend(!0,e,r),e}function A(e,i,n){for(var r,o,s,a,l=e.contents,h=e.dataTypes;"*"===h[0];)h.shift(),r===t&&(r=e.mimeType||i.getResponseHeader("Content-Type"));if(r)for(o in l)if(l[o]&&l[o].test(r)){h.unshift(o);break}if(h[0]in n)s=h[0];else{for(o in n){if(!h[0]||e.converters[o+" "+h[0]]){s=o;break}a||(a=o)}s=s||a}return s?(s!==h[0]&&h.unshift(s),n[s]):void 0}function P(e,t,i,n){var r,o,s,a,l,h={},c=e.dataTypes.slice();if(c[1])for(s in e.converters)h[s.toLowerCase()]=e.converters[s];for(o=c.shift();o;)if(e.responseFields[o]&&(i[e.responseFields[o]]=t),!l&&n&&e.dataFilter&&(t=e.dataFilter(t,e.dataType)),l=o,o=c.shift())if("*"===o)o=l;else if("*"!==l&&l!==o){if(s=h[l+" "+o]||h["* "+o],!s)for(r in h)if(a=r.split(" "),a[1]===o&&(s=h[l+" "+a[0]]||h["* "+a[0]])){s===!0?s=h[r]:h[r]!==!0&&(o=a[0],c.unshift(a[1]));break}if(s!==!0)if(s&&e["throws"])t=s(t);else try{t=s(t)}catch(u){return{state:"parsererror",error:s?u:"No conversion from "+l+" to "+o}}}return{state:"success",data:t}}function F(){return setTimeout(function(){Ci=t}),Ci=ot.now()}function D(e,t,i){for(var n,r=(Fi[t]||[]).concat(Fi["*"]),o=0,s=r.length;s>o;o++)if(n=r[o].call(i,t,e))return n}function N(e,t,i){var n,r,o=0,s=Pi.length,a=ot.Deferred().always(function(){delete l.elem}),l=function(){if(r)return!1;for(var t=Ci||F(),i=Math.max(0,h.startTime+h.duration-t),n=i/h.duration||0,o=1-n,s=0,l=h.tweens.length;l>s;s++)h.tweens[s].run(o);return a.notifyWith(e,[h,o,i]),1>o&&l?i:(a.resolveWith(e,[h]),!1)},h=a.promise({elem:e,props:ot.extend({},t),opts:ot.extend(!0,{specialEasing:{}},i),originalProperties:t,originalOptions:i,startTime:Ci||F(),duration:i.duration,tweens:[],createTween:function(t,i){var n=ot.Tween(e,h.opts,t,i,h.opts.specialEasing[t]||h.opts.easing);return h.tweens.push(n),n},stop:function(t){var i=0,n=t?h.tweens.length:0;if(r)return this;for(r=!0;n>i;i++)h.tweens[i].run(1);return t?a.resolveWith(e,[h,t]):a.rejectWith(e,[h,t]),this}}),c=h.props;for(z(c,h.opts.specialEasing);s>o;o++)if(n=Pi[o].call(h,e,c,h.opts))return n;return ot.map(c,D,h),ot.isFunction(h.opts.start)&&h.opts.start.call(e,h),ot.fx.timer(ot.extend(l,{elem:e,anim:h,queue:h.opts.queue})),h.progress(h.opts.progress).done(h.opts.done,h.opts.complete).fail(h.opts.fail).always(h.opts.always)}function z(e,t){var i,n,r,o,s;for(i in e)if(n=ot.camelCase(i),r=t[n],o=e[i],ot.isArray(o)&&(r=o[1],o=e[i]=o[0]),i!==n&&(e[n]=o,delete e[i]),s=ot.cssHooks[n],s&&"expand"in s){o=s.expand(o),delete e[n];for(i in o)i in e||(e[i]=o[i],t[i]=r)}else t[n]=r}function L(e,i,n){var r,o,s,a,l,h,c=this,u={},d=e.style,p=e.nodeType&&_(e),f=gt.get(e,"fxshow");n.queue||(l=ot._queueHooks(e,"fx"),null==l.unqueued&&(l.unqueued=0,h=l.empty.fire,l.empty.fire=function(){l.unqueued||h()}),l.unqueued++,c.always(function(){c.always(function(){l.unqueued--,ot.queue(e,"fx").length||l.empty.fire()})})),1===e.nodeType&&("height"in i||"width"in i)&&(n.overflow=[d.overflow,d.overflowX,d.overflowY],"inline"===ot.css(e,"display")&&"none"===ot.css(e,"float")&&(d.display="inline-block")),n.overflow&&(d.overflow="hidden",c.always(function(){d.overflow=n.overflow[0],d.overflowX=n.overflow[1],d.overflowY=n.overflow[2]}));for(r in i)if(o=i[r],Mi.exec(o)){if(delete i[r],s=s||"toggle"===o,o===(p?"hide":"show")){if("show"!==o||!f||f[r]===t)continue;p=!0}u[r]=f&&f[r]||ot.style(e,r)}if(!ot.isEmptyObject(u)){f?"hidden"in f&&(p=f.hidden):f=gt.access(e,"fxshow",{}),s&&(f.hidden=!p),p?ot(e).show():c.done(function(){ot(e).hide()}),c.done(function(){var t;gt.remove(e,"fxshow");for(t in u)ot.style(e,t,u[t])});for(r in u)a=D(p?f[r]:0,r,c),r in f||(f[r]=a.start,p&&(a.end=a.start,a.start="width"===r||"height"===r?1:0))}}function I(e,t,i,n,r){return new I.prototype.init(e,t,i,n,r)}function O(e,t){var i,n={height:e},r=0;for(t=t?1:0;4>r;r+=2-t)i=Jt[r],n["margin"+i]=n["padding"+i]=e;return t&&(n.opacity=n.width=e),n}function V(e){return ot.isWindow(e)?e:9===e.nodeType&&e.defaultView}var B,U,j=typeof t,W=e.location,$=e.document,G=$.documentElement,q=e.jQuery,X=e.$,Y={},K=[],Q="2.0.3",J=K.concat,Z=K.push,et=K.slice,tt=K.indexOf,it=Y.toString,nt=Y.hasOwnProperty,rt=Q.trim,ot=function(e,t){return new ot.fn.init(e,t,B)},st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,at=/\S+/g,lt=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ht=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,ct=/^-ms-/,ut=/-([\da-z])/gi,dt=function(e,t){return t.toUpperCase()},pt=function(){$.removeEventListener("DOMContentLoaded",pt,!1),e.removeEventListener("load",pt,!1),ot.ready()};ot.fn=ot.prototype={jquery:Q,constructor:ot,init:function(e,i,n){var r,o;if(!e)return this;if("string"==typeof e){if(r="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:lt.exec(e),!r||!r[1]&&i)return!i||i.jquery?(i||n).find(e):this.constructor(i).find(e);if(r[1]){if(i=i instanceof ot?i[0]:i,ot.merge(this,ot.parseHTML(r[1],i&&i.nodeType?i.ownerDocument||i:$,!0)),ht.test(r[1])&&ot.isPlainObject(i))for(r in i)ot.isFunction(this[r])?this[r](i[r]):this.attr(r,i[r]);return this}return o=$.getElementById(r[2]),o&&o.parentNode&&(this.length=1,this[0]=o),this.context=$,this.selector=e,this}return e.nodeType?(this.context=this[0]=e,this.length=1,this):ot.isFunction(e)?n.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),ot.makeArray(e,this))},selector:"",length:0,toArray:function(){return et.call(this)},get:function(e){return null==e?this.toArray():0>e?this[this.length+e]:this[e]},pushStack:function(e){var t=ot.merge(this.constructor(),e);return t.prevObject=this,t.context=this.context,t},each:function(e,t){return ot.each(this,e,t)},ready:function(e){return ot.ready.promise().done(e),this},slice:function(){return this.pushStack(et.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(e){var t=this.length,i=+e+(0>e?t:0);return this.pushStack(i>=0&&t>i?[this[i]]:[])},map:function(e){return this.pushStack(ot.map(this,function(t,i){return e.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:Z,sort:[].sort,splice:[].splice},ot.fn.init.prototype=ot.fn,ot.extend=ot.fn.extend=function(){var e,i,n,r,o,s,a=arguments[0]||{},l=1,h=arguments.length,c=!1;for("boolean"==typeof a&&(c=a,a=arguments[1]||{},l=2),"object"==typeof a||ot.isFunction(a)||(a={}),h===l&&(a=this,--l);h>l;l++)if(null!=(e=arguments[l]))for(i in e)n=a[i],r=e[i],a!==r&&(c&&r&&(ot.isPlainObject(r)||(o=ot.isArray(r)))?(o?(o=!1,s=n&&ot.isArray(n)?n:[]):s=n&&ot.isPlainObject(n)?n:{},a[i]=ot.extend(c,s,r)):r!==t&&(a[i]=r));return a},ot.extend({expando:"jQuery"+(Q+Math.random()).replace(/\D/g,""),noConflict:function(t){return e.$===ot&&(e.$=X),t&&e.jQuery===ot&&(e.jQuery=q),ot},isReady:!1,readyWait:1,holdReady:function(e){e?ot.readyWait++:ot.ready(!0)},ready:function(e){(e===!0?--ot.readyWait:ot.isReady)||(ot.isReady=!0,e!==!0&&--ot.readyWait>0||(U.resolveWith($,[ot]),ot.fn.trigger&&ot($).trigger("ready").off("ready")))},isFunction:function(e){return"function"===ot.type(e)},isArray:Array.isArray,isWindow:function(e){return null!=e&&e===e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):"object"==typeof e||"function"==typeof e?Y[it.call(e)]||"object":typeof e},isPlainObject:function(e){if("object"!==ot.type(e)||e.nodeType||ot.isWindow(e))return!1;try{if(e.constructor&&!nt.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(t){return!1}return!0},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,i){if(!e||"string"!=typeof e)return null;"boolean"==typeof t&&(i=t,t=!1),t=t||$;var n=ht.exec(e),r=!i&&[];return n?[t.createElement(n[1])]:(n=ot.buildFragment([e],t,r),r&&ot(r).remove(),ot.merge([],n.childNodes))},parseJSON:JSON.parse,parseXML:function(e){var i,n;if(!e||"string"!=typeof e)return null;try{n=new DOMParser,i=n.parseFromString(e,"text/xml")}catch(r){i=t}return(!i||i.getElementsByTagName("parsererror").length)&&ot.error("Invalid XML: "+e),i},noop:function(){},globalEval:function(e){var t,i=eval;e=ot.trim(e),e&&(1===e.indexOf("use strict")?(t=$.createElement("script"),t.text=e,$.head.appendChild(t).parentNode.removeChild(t)):i(e))},camelCase:function(e){return e.replace(ct,"ms-").replace(ut,dt)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,t,n){var r,o=0,s=e.length,a=i(e);if(n){if(a)for(;s>o&&(r=t.apply(e[o],n),r!==!1);o++);else for(o in e)if(r=t.apply(e[o],n),r===!1)break}else if(a)for(;s>o&&(r=t.call(e[o],o,e[o]),r!==!1);o++);else for(o in e)if(r=t.call(e[o],o,e[o]),r===!1)break;return e},trim:function(e){return null==e?"":rt.call(e)},makeArray:function(e,t){var n=t||[];return null!=e&&(i(Object(e))?ot.merge(n,"string"==typeof e?[e]:e):Z.call(n,e)),n},inArray:function(e,t,i){return null==t?-1:tt.call(t,e,i)},merge:function(e,i){var n=i.length,r=e.length,o=0;if("number"==typeof n)for(;n>o;o++)e[r++]=i[o];else for(;i[o]!==t;)e[r++]=i[o++];return e.length=r,e},grep:function(e,t,i){var n,r=[],o=0,s=e.length;for(i=!!i;s>o;o++)n=!!t(e[o],o),i!==n&&r.push(e[o]);return r},map:function(e,t,n){var r,o=0,s=e.length,a=i(e),l=[];if(a)for(;s>o;o++)r=t(e[o],o,n),null!=r&&(l[l.length]=r);else for(o in e)r=t(e[o],o,n),null!=r&&(l[l.length]=r);return J.apply([],l)},guid:1,proxy:function(e,i){var n,r,o;return"string"==typeof i&&(n=e[i],i=e,e=n),ot.isFunction(e)?(r=et.call(arguments,2),o=function(){return e.apply(i||this,r.concat(et.call(arguments)))},o.guid=e.guid=e.guid||ot.guid++,o):t},access:function(e,i,n,r,o,s,a){var l=0,h=e.length,c=null==n;if("object"===ot.type(n)){o=!0;for(l in n)ot.access(e,i,l,n[l],!0,s,a)}else if(r!==t&&(o=!0,ot.isFunction(r)||(a=!0),c&&(a?(i.call(e,r),i=null):(c=i,i=function(e,t,i){return c.call(ot(e),i)})),i))for(;h>l;l++)i(e[l],n,a?r:r.call(e[l],l,i(e[l],n)));return o?e:c?i.call(e):h?i(e[0],n):s},now:Date.now,swap:function(e,t,i,n){var r,o,s={};for(o in t)s[o]=e.style[o],e.style[o]=t[o];r=i.apply(e,n||[]);for(o in t)e.style[o]=s[o];return r}}),ot.ready.promise=function(t){return U||(U=ot.Deferred(),"complete"===$.readyState?setTimeout(ot.ready):($.addEventListener("DOMContentLoaded",pt,!1),e.addEventListener("load",pt,!1))),U.promise(t)},ot.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(e,t){Y["[object "+t+"]"]=t.toLowerCase()}),B=ot($),function(e,t){function i(e,t,i,n){var r,o,s,a,l,h,c,u,f,m;if((t?t.ownerDocument||t:V)!==P&&A(t),t=t||P,i=i||[],!e||"string"!=typeof e)return i;if(1!==(a=t.nodeType)&&9!==a)return[];if(D&&!n){if(r=_t.exec(e))if(s=r[1]){if(9===a){if(o=t.getElementById(s),!o||!o.parentNode)return i;if(o.id===s)return i.push(o),i}else if(t.ownerDocument&&(o=t.ownerDocument.getElementById(s))&&I(t,o)&&o.id===s)return i.push(o),i}else{if(r[2])return et.apply(i,t.getElementsByTagName(e)),i;if((s=r[3])&&T.getElementsByClassName&&t.getElementsByClassName)return et.apply(i,t.getElementsByClassName(s)),i}if(T.qsa&&(!N||!N.test(e))){if(u=c=O,f=t,m=9===a&&e,1===a&&"object"!==t.nodeName.toLowerCase()){for(h=d(e),(c=t.getAttribute("id"))?u=c.replace(xt,"\\$&"):t.setAttribute("id",u),u="[id='"+u+"'] ",l=h.length;l--;)h[l]=u+p(h[l]);f=pt.test(e)&&t.parentNode||t,m=h.join(",")}if(m)try{return et.apply(i,f.querySelectorAll(m)),i}catch(g){}finally{c||t.removeAttribute("id")}}}return E(e.replace(ct,"$1"),t,i,n)}function n(){function e(i,n){return t.push(i+=" ")>R.cacheLength&&delete e[t.shift()],e[i]=n}var t=[];return e}function r(e){return e[O]=!0,e}function o(e){var t=P.createElement("div");try{return!!e(t)}catch(i){return!1}finally{t.parentNode&&t.parentNode.removeChild(t),t=null}}function s(e,t){for(var i=e.split("|"),n=e.length;n--;)R.attrHandle[i[n]]=t}function a(e,t){var i=t&&e,n=i&&1===e.nodeType&&1===t.nodeType&&(~t.sourceIndex||Y)-(~e.sourceIndex||Y);if(n)return n;if(i)for(;i=i.nextSibling;)if(i===t)return-1;return e?1:-1}function l(e){return function(t){var i=t.nodeName.toLowerCase();return"input"===i&&t.type===e}}function h(e){return function(t){var i=t.nodeName.toLowerCase();return("input"===i||"button"===i)&&t.type===e}}function c(e){return r(function(t){return t=+t,r(function(i,n){for(var r,o=e([],i.length,t),s=o.length;s--;)i[r=o[s]]&&(i[r]=!(n[r]=i[r]))})})}function u(){}function d(e,t){var n,r,o,s,a,l,h,c=W[e+" "];if(c)return t?0:c.slice(0);for(a=e,l=[],h=R.preFilter;a;){(!n||(r=ut.exec(a)))&&(r&&(a=a.slice(r[0].length)||a),l.push(o=[])),n=!1,(r=dt.exec(a))&&(n=r.shift(),o.push({value:n,type:r[0].replace(ct," ")}),a=a.slice(n.length));for(s in R.filter)!(r=vt[s].exec(a))||h[s]&&!(r=h[s](r))||(n=r.shift(),o.push({value:n,type:s,matches:r}),a=a.slice(n.length));if(!n)break}return t?a.length:a?i.error(e):W(e,l).slice(0)}function p(e){for(var t=0,i=e.length,n="";i>t;t++)n+=e[t].value;return n}function f(e,t,i){var n=t.dir,r=i&&"parentNode"===n,o=U++;return t.first?function(t,i,o){for(;t=t[n];)if(1===t.nodeType||r)return e(t,i,o)}:function(t,i,s){var a,l,h,c=B+" "+o;if(s){for(;t=t[n];)if((1===t.nodeType||r)&&e(t,i,s))return!0}else for(;t=t[n];)if(1===t.nodeType||r)if(h=t[O]||(t[O]={}),(l=h[n])&&l[0]===c){if((a=l[1])===!0||a===w)return a===!0}else if(l=h[n]=[c],l[1]=e(t,i,s)||w,l[1]===!0)return!0}}function m(e){return e.length>1?function(t,i,n){for(var r=e.length;r--;)if(!e[r](t,i,n))return!1;return!0}:e[0]}function g(e,t,i,n,r){for(var o,s=[],a=0,l=e.length,h=null!=t;l>a;a++)(o=e[a])&&(!i||i(o,n,r))&&(s.push(o),h&&t.push(a));return s}function v(e,t,i,n,o,s){return n&&!n[O]&&(n=v(n)),o&&!o[O]&&(o=v(o,s)),r(function(r,s,a,l){var h,c,u,d=[],p=[],f=s.length,m=r||b(t||"*",a.nodeType?[a]:a,[]),v=!e||!r&&t?m:g(m,d,e,a,l),y=i?o||(r?e:f||n)?[]:s:v;if(i&&i(v,y,a,l),n)for(h=g(y,p),n(h,[],a,l),c=h.length;c--;)(u=h[c])&&(y[p[c]]=!(v[p[c]]=u));if(r){if(o||e){if(o){for(h=[],c=y.length;c--;)(u=y[c])&&h.push(v[c]=u);o(null,y=[],h,l)}for(c=y.length;c--;)(u=y[c])&&(h=o?it.call(r,u):d[c])>-1&&(r[h]=!(s[h]=u))}}else y=g(y===s?y.splice(f,y.length):y),o?o(null,s,y,l):et.apply(s,y)})}function y(e){for(var t,i,n,r=e.length,o=R.relative[e[0].type],s=o||R.relative[" "],a=o?1:0,l=f(function(e){return e===t},s,!0),h=f(function(e){return it.call(t,e)>-1},s,!0),c=[function(e,i,n){return!o&&(n||i!==M)||((t=i).nodeType?l(e,i,n):h(e,i,n))}];r>a;a++)if(i=R.relative[e[a].type])c=[f(m(c),i)];else{if(i=R.filter[e[a].type].apply(null,e[a].matches),i[O]){for(n=++a;r>n&&!R.relative[e[n].type];n++);return v(a>1&&m(c),a>1&&p(e.slice(0,a-1).concat({value:" "===e[a-2].type?"*":""})).replace(ct,"$1"),i,n>a&&y(e.slice(a,n)),r>n&&y(e=e.slice(n)),r>n&&p(e))}c.push(i)}return m(c)}function _(e,t){var n=0,o=t.length>0,s=e.length>0,a=function(r,a,l,h,c){var u,d,p,f=[],m=0,v="0",y=r&&[],_=null!=c,b=M,E=r||s&&R.find.TAG("*",c&&a.parentNode||a),x=B+=null==b?1:Math.random()||.1;for(_&&(M=a!==P&&a,w=n);null!=(u=E[v]);v++){if(s&&u){for(d=0;p=e[d++];)if(p(u,a,l)){h.push(u);break}_&&(B=x,w=++n)}o&&((u=!p&&u)&&m--,r&&y.push(u))}if(m+=v,o&&v!==m){for(d=0;p=t[d++];)p(y,f,a,l);if(r){if(m>0)for(;v--;)y[v]||f[v]||(f[v]=J.call(h));f=g(f)}et.apply(h,f),_&&!r&&f.length>0&&m+t.length>1&&i.uniqueSort(h)}return _&&(B=x,M=b),y};return o?r(a):a}function b(e,t,n){for(var r=0,o=t.length;o>r;r++)i(e,t[r],n);return n}function E(e,t,i,n){var r,o,s,a,l,h=d(e);if(!n&&1===h.length){if(o=h[0]=h[0].slice(0),o.length>2&&"ID"===(s=o[0]).type&&T.getById&&9===t.nodeType&&D&&R.relative[o[1].type]){if(t=(R.find.ID(s.matches[0].replace(Tt,wt),t)||[])[0],!t)return i;e=e.slice(o.shift().value.length)}for(r=vt.needsContext.test(e)?0:o.length;r--&&(s=o[r],!R.relative[a=s.type]);)if((l=R.find[a])&&(n=l(s.matches[0].replace(Tt,wt),pt.test(o[0].type)&&t.parentNode||t))){if(o.splice(r,1),e=n.length&&p(o),!e)return et.apply(i,n),i;break}}return H(e,h)(n,t,!D,i,pt.test(e)),i}var x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O="sizzle"+-new Date,V=e.document,B=0,U=0,j=n(),W=n(),$=n(),G=!1,q=function(e,t){return e===t?(G=!0,0):0},X=typeof t,Y=1<<31,K={}.hasOwnProperty,Q=[],J=Q.pop,Z=Q.push,et=Q.push,tt=Q.slice,it=Q.indexOf||function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]===e)return t;return-1},nt="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",rt="[\\x20\\t\\r\\n\\f]",st="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",at=st.replace("w","w#"),lt="\\["+rt+"*("+st+")"+rt+"*(?:([*^$|!~]?=)"+rt+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+at+")|)|)"+rt+"*\\]",ht=":("+st+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+lt.replace(3,8)+")*)|.*)\\)|)",ct=new RegExp("^"+rt+"+|((?:^|[^\\\\])(?:\\\\.)*)"+rt+"+$","g"),ut=new RegExp("^"+rt+"*,"+rt+"*"),dt=new RegExp("^"+rt+"*([>+~]|"+rt+")"+rt+"*"),pt=new RegExp(rt+"*[+~]"),ft=new RegExp("="+rt+"*([^\\]'\"]*)"+rt+"*\\]","g"),mt=new RegExp(ht),gt=new RegExp("^"+at+"$"),vt={ID:new RegExp("^#("+st+")"),CLASS:new RegExp("^\\.("+st+")"),TAG:new RegExp("^("+st.replace("w","w*")+")"),ATTR:new RegExp("^"+lt),PSEUDO:new RegExp("^"+ht),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+rt+"*(even|odd|(([+-]|)(\\d*)n|)"+rt+"*(?:([+-]|)"+rt+"*(\\d+)|))"+rt+"*\\)|)","i"),bool:new RegExp("^(?:"+nt+")$","i"),needsContext:new RegExp("^"+rt+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+rt+"*((?:-\\d)?\\d*)"+rt+"*\\)|)(?=[^-]|$)","i")},yt=/^[^{]+\{\s*\[native \w/,_t=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,bt=/^(?:input|select|textarea|button)$/i,Et=/^h\d$/i,xt=/'|\\/g,Tt=new RegExp("\\\\([\\da-f]{1,6}"+rt+"?|("+rt+")|.)","ig"),wt=function(e,t,i){var n="0x"+t-65536;return n!==n||i?t:0>n?String.fromCharCode(n+65536):String.fromCharCode(55296|n>>10,56320|1023&n)};try{et.apply(Q=tt.call(V.childNodes),V.childNodes),Q[V.childNodes.length].nodeType}catch(Rt){et={apply:Q.length?function(e,t){Z.apply(e,tt.call(t))}:function(e,t){for(var i=e.length,n=0;e[i++]=t[n++];);e.length=i-1}}}C=i.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?"HTML"!==t.nodeName:!1},T=i.support={},A=i.setDocument=function(e){var t=e?e.ownerDocument||e:V,i=t.defaultView;return t!==P&&9===t.nodeType&&t.documentElement?(P=t,F=t.documentElement,D=!C(t),i&&i.attachEvent&&i!==i.top&&i.attachEvent("onbeforeunload",function(){A()}),T.attributes=o(function(e){return e.className="i",!e.getAttribute("className")}),T.getElementsByTagName=o(function(e){return e.appendChild(t.createComment("")),!e.getElementsByTagName("*").length}),T.getElementsByClassName=o(function(e){return e.innerHTML="<div class='a'></div><div class='a i'></div>",e.firstChild.className="i",2===e.getElementsByClassName("i").length}),T.getById=o(function(e){return F.appendChild(e).id=O,!t.getElementsByName||!t.getElementsByName(O).length}),T.getById?(R.find.ID=function(e,t){if(typeof t.getElementById!==X&&D){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}},R.filter.ID=function(e){var t=e.replace(Tt,wt);return function(e){return e.getAttribute("id")===t}}):(delete R.find.ID,R.filter.ID=function(e){var t=e.replace(Tt,wt);return function(e){var i=typeof e.getAttributeNode!==X&&e.getAttributeNode("id");return i&&i.value===t}}),R.find.TAG=T.getElementsByTagName?function(e,t){return typeof t.getElementsByTagName!==X?t.getElementsByTagName(e):void 0}:function(e,t){var i,n=[],r=0,o=t.getElementsByTagName(e);if("*"===e){for(;i=o[r++];)1===i.nodeType&&n.push(i);return n}return o},R.find.CLASS=T.getElementsByClassName&&function(e,t){return typeof t.getElementsByClassName!==X&&D?t.getElementsByClassName(e):void 0},z=[],N=[],(T.qsa=yt.test(t.querySelectorAll))&&(o(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||N.push("\\["+rt+"*(?:value|"+nt+")"),e.querySelectorAll(":checked").length||N.push(":checked")}),o(function(e){var i=t.createElement("input");i.setAttribute("type","hidden"),e.appendChild(i).setAttribute("t",""),e.querySelectorAll("[t^='']").length&&N.push("[*^$]="+rt+"*(?:''|\"\")"),e.querySelectorAll(":enabled").length||N.push(":enabled",":disabled"),e.querySelectorAll("*,:x"),N.push(",.*:")})),(T.matchesSelector=yt.test(L=F.webkitMatchesSelector||F.mozMatchesSelector||F.oMatchesSelector||F.msMatchesSelector))&&o(function(e){T.disconnectedMatch=L.call(e,"div"),L.call(e,"[s!='']:x"),z.push("!=",ht)}),N=N.length&&new RegExp(N.join("|")),z=z.length&&new RegExp(z.join("|")),I=yt.test(F.contains)||F.compareDocumentPosition?function(e,t){var i=9===e.nodeType?e.documentElement:e,n=t&&t.parentNode;return e===n||!(!n||1!==n.nodeType||!(i.contains?i.contains(n):e.compareDocumentPosition&&16&e.compareDocumentPosition(n)))}:function(e,t){if(t)for(;t=t.parentNode;)if(t===e)return!0;return!1},q=F.compareDocumentPosition?function(e,i){if(e===i)return G=!0,0;var n=i.compareDocumentPosition&&e.compareDocumentPosition&&e.compareDocumentPosition(i);return n?1&n||!T.sortDetached&&i.compareDocumentPosition(e)===n?e===t||I(V,e)?-1:i===t||I(V,i)?1:k?it.call(k,e)-it.call(k,i):0:4&n?-1:1:e.compareDocumentPosition?-1:1}:function(e,i){var n,r=0,o=e.parentNode,s=i.parentNode,l=[e],h=[i];if(e===i)return G=!0,0;if(!o||!s)return e===t?-1:i===t?1:o?-1:s?1:k?it.call(k,e)-it.call(k,i):0;if(o===s)return a(e,i);for(n=e;n=n.parentNode;)l.unshift(n);for(n=i;n=n.parentNode;)h.unshift(n);for(;l[r]===h[r];)r++;return r?a(l[r],h[r]):l[r]===V?-1:h[r]===V?1:0},t):P},i.matches=function(e,t){return i(e,null,null,t)},i.matchesSelector=function(e,t){if((e.ownerDocument||e)!==P&&A(e),t=t.replace(ft,"='$1']"),!(!T.matchesSelector||!D||z&&z.test(t)||N&&N.test(t)))try{var n=L.call(e,t);if(n||T.disconnectedMatch||e.document&&11!==e.document.nodeType)return n}catch(r){}return i(t,P,null,[e]).length>0},i.contains=function(e,t){return(e.ownerDocument||e)!==P&&A(e),I(e,t)},i.attr=function(e,i){(e.ownerDocument||e)!==P&&A(e);var n=R.attrHandle[i.toLowerCase()],r=n&&K.call(R.attrHandle,i.toLowerCase())?n(e,i,!D):t;return r===t?T.attributes||!D?e.getAttribute(i):(r=e.getAttributeNode(i))&&r.specified?r.value:null:r},i.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},i.uniqueSort=function(e){var t,i=[],n=0,r=0;if(G=!T.detectDuplicates,k=!T.sortStable&&e.slice(0),e.sort(q),G){for(;t=e[r++];)t===e[r]&&(n=i.push(r));for(;n--;)e.splice(i[n],1)}return e},S=i.getText=function(e){var t,i="",n=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)i+=S(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[n];n++)i+=S(t);return i},R=i.selectors={cacheLength:50,createPseudo:r,match:vt,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Tt,wt),e[3]=(e[4]||e[5]||"").replace(Tt,wt),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1].slice(0,3)?(e[3]||i.error(e[0]),e[4]=+(e[4]?e[5]+(e[6]||1):2*("even"===e[3]||"odd"===e[3])),e[5]=+(e[7]+e[8]||"odd"===e[3])):e[3]&&i.error(e[0]),e},PSEUDO:function(e){var i,n=!e[5]&&e[2];return vt.CHILD.test(e[0])?null:(e[3]&&e[4]!==t?e[2]=e[4]:n&&mt.test(n)&&(i=d(n,!0))&&(i=n.indexOf(")",n.length-i)-n.length)&&(e[0]=e[0].slice(0,i),e[2]=n.slice(0,i)),e.slice(0,3))}},filter:{TAG:function(e){var t=e.replace(Tt,wt).toLowerCase();return"*"===e?function(){return!0}:function(e){return e.nodeName&&e.nodeName.toLowerCase()===t}},CLASS:function(e){var t=j[e+" "];return t||(t=new RegExp("(^|"+rt+")"+e+"("+rt+"|$)"))&&j(e,function(e){return t.test("string"==typeof e.className&&e.className||typeof e.getAttribute!==X&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r){var o=i.attr(r,e);return null==o?"!="===t:t?(o+="","="===t?o===n:"!="===t?o!==n:"^="===t?n&&0===o.indexOf(n):"*="===t?n&&o.indexOf(n)>-1:"$="===t?n&&o.slice(-n.length)===n:"~="===t?(" "+o+" ").indexOf(n)>-1:"|="===t?o===n||o.slice(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,i,n,r){var o="nth"!==e.slice(0,3),s="last"!==e.slice(-4),a="of-type"===t;return 1===n&&0===r?function(e){return!!e.parentNode}:function(t,i,l){var h,c,u,d,p,f,m=o!==s?"nextSibling":"previousSibling",g=t.parentNode,v=a&&t.nodeName.toLowerCase(),y=!l&&!a;if(g){if(o){for(;m;){for(u=t;u=u[m];)if(a?u.nodeName.toLowerCase()===v:1===u.nodeType)return!1;f=m="only"===e&&!f&&"nextSibling"}return!0}if(f=[s?g.firstChild:g.lastChild],s&&y){for(c=g[O]||(g[O]={}),h=c[e]||[],p=h[0]===B&&h[1],d=h[0]===B&&h[2],u=p&&g.childNodes[p];u=++p&&u&&u[m]||(d=p=0)||f.pop();)if(1===u.nodeType&&++d&&u===t){c[e]=[B,p,d];break}}else if(y&&(h=(t[O]||(t[O]={}))[e])&&h[0]===B)d=h[1];else for(;(u=++p&&u&&u[m]||(d=p=0)||f.pop())&&((a?u.nodeName.toLowerCase()!==v:1!==u.nodeType)||!++d||(y&&((u[O]||(u[O]={}))[e]=[B,d]),u!==t)););return d-=r,d===n||0===d%n&&d/n>=0}}},PSEUDO:function(e,t){var n,o=R.pseudos[e]||R.setFilters[e.toLowerCase()]||i.error("unsupported pseudo: "+e);return o[O]?o(t):o.length>1?(n=[e,e,"",t],R.setFilters.hasOwnProperty(e.toLowerCase())?r(function(e,i){for(var n,r=o(e,t),s=r.length;s--;)n=it.call(e,r[s]),e[n]=!(i[n]=r[s])}):function(e){return o(e,0,n)}):o}},pseudos:{not:r(function(e){var t=[],i=[],n=H(e.replace(ct,"$1"));return n[O]?r(function(e,t,i,r){for(var o,s=n(e,null,r,[]),a=e.length;a--;)(o=s[a])&&(e[a]=!(t[a]=o))}):function(e,r,o){return t[0]=e,n(t,null,o,i),!i.pop()}}),has:r(function(e){return function(t){return i(e,t).length>0}}),contains:r(function(e){return function(t){return(t.textContent||t.innerText||S(t)).indexOf(e)>-1}}),lang:r(function(e){return gt.test(e||"")||i.error("unsupported lang: "+e),e=e.replace(Tt,wt).toLowerCase(),function(t){var i;do if(i=D?t.lang:t.getAttribute("xml:lang")||t.getAttribute("lang"))return i=i.toLowerCase(),i===e||0===i.indexOf(e+"-");while((t=t.parentNode)&&1===t.nodeType);return!1}}),target:function(t){var i=e.location&&e.location.hash;return i&&i.slice(1)===t.id},root:function(e){return e===F},focus:function(e){return e===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},empty:function(e){for(e=e.firstChild;e;e=e.nextSibling)if(e.nodeName>"@"||3===e.nodeType||4===e.nodeType)return!1;return!0},parent:function(e){return!R.pseudos.empty(e)},header:function(e){return Et.test(e.nodeName)},input:function(e){return bt.test(e.nodeName)},button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},text:function(e){var t;return"input"===e.nodeName.toLowerCase()&&"text"===e.type&&(null==(t=e.getAttribute("type"))||t.toLowerCase()===e.type)},first:c(function(){return[0]}),last:c(function(e,t){return[t-1]}),eq:c(function(e,t,i){return[0>i?i+t:i]}),even:c(function(e,t){for(var i=0;t>i;i+=2)e.push(i);return e}),odd:c(function(e,t){for(var i=1;t>i;i+=2)e.push(i);return e}),lt:c(function(e,t,i){for(var n=0>i?i+t:i;--n>=0;)e.push(n);return e}),gt:c(function(e,t,i){for(var n=0>i?i+t:i;++n<t;)e.push(n);return e})}},R.pseudos.nth=R.pseudos.eq;for(x in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})R.pseudos[x]=l(x);for(x in{submit:!0,reset:!0})R.pseudos[x]=h(x);u.prototype=R.filters=R.pseudos,R.setFilters=new u,H=i.compile=function(e,t){var i,n=[],r=[],o=$[e+" "];if(!o){for(t||(t=d(e)),i=t.length;i--;)o=y(t[i]),o[O]?n.push(o):r.push(o);o=$(e,_(r,n))}return o},T.sortStable=O.split("").sort(q).join("")===O,T.detectDuplicates=G,A(),T.sortDetached=o(function(e){return 1&e.compareDocumentPosition(P.createElement("div"))}),o(function(e){return e.innerHTML="<a href='#'></a>","#"===e.firstChild.getAttribute("href")})||s("type|href|height|width",function(e,t,i){return i?void 0:e.getAttribute(t,"type"===t.toLowerCase()?1:2)
}),T.attributes&&o(function(e){return e.innerHTML="<input/>",e.firstChild.setAttribute("value",""),""===e.firstChild.getAttribute("value")})||s("value",function(e,t,i){return i||"input"!==e.nodeName.toLowerCase()?void 0:e.defaultValue}),o(function(e){return null==e.getAttribute("disabled")})||s(nt,function(e,t,i){var n;return i?void 0:(n=e.getAttributeNode(t))&&n.specified?n.value:e[t]===!0?t.toLowerCase():null}),ot.find=i,ot.expr=i.selectors,ot.expr[":"]=ot.expr.pseudos,ot.unique=i.uniqueSort,ot.text=i.getText,ot.isXMLDoc=i.isXML,ot.contains=i.contains}(e);var ft={};ot.Callbacks=function(e){e="string"==typeof e?ft[e]||n(e):ot.extend({},e);var i,r,o,s,a,l,h=[],c=!e.once&&[],u=function(t){for(i=e.memory&&t,r=!0,l=s||0,s=0,a=h.length,o=!0;h&&a>l;l++)if(h[l].apply(t[0],t[1])===!1&&e.stopOnFalse){i=!1;break}o=!1,h&&(c?c.length&&u(c.shift()):i?h=[]:d.disable())},d={add:function(){if(h){var t=h.length;!function n(t){ot.each(t,function(t,i){var r=ot.type(i);"function"===r?e.unique&&d.has(i)||h.push(i):i&&i.length&&"string"!==r&&n(i)})}(arguments),o?a=h.length:i&&(s=t,u(i))}return this},remove:function(){return h&&ot.each(arguments,function(e,t){for(var i;(i=ot.inArray(t,h,i))>-1;)h.splice(i,1),o&&(a>=i&&a--,l>=i&&l--)}),this},has:function(e){return e?ot.inArray(e,h)>-1:!(!h||!h.length)},empty:function(){return h=[],a=0,this},disable:function(){return h=c=i=t,this},disabled:function(){return!h},lock:function(){return c=t,i||d.disable(),this},locked:function(){return!c},fireWith:function(e,t){return!h||r&&!c||(t=t||[],t=[e,t.slice?t.slice():t],o?c.push(t):u(t)),this},fire:function(){return d.fireWith(this,arguments),this},fired:function(){return!!r}};return d},ot.extend({Deferred:function(e){var t=[["resolve","done",ot.Callbacks("once memory"),"resolved"],["reject","fail",ot.Callbacks("once memory"),"rejected"],["notify","progress",ot.Callbacks("memory")]],i="pending",n={state:function(){return i},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return ot.Deferred(function(i){ot.each(t,function(t,o){var s=o[0],a=ot.isFunction(e[t])&&e[t];r[o[1]](function(){var e=a&&a.apply(this,arguments);e&&ot.isFunction(e.promise)?e.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[s+"With"](this===n?i.promise():this,a?[e]:arguments)})}),e=null}).promise()},promise:function(e){return null!=e?ot.extend(e,n):n}},r={};return n.pipe=n.then,ot.each(t,function(e,o){var s=o[2],a=o[3];n[o[1]]=s.add,a&&s.add(function(){i=a},t[1^e][2].disable,t[2][2].lock),r[o[0]]=function(){return r[o[0]+"With"](this===r?n:this,arguments),this},r[o[0]+"With"]=s.fireWith}),n.promise(r),e&&e.call(r,r),r},when:function(e){var t,i,n,r=0,o=et.call(arguments),s=o.length,a=1!==s||e&&ot.isFunction(e.promise)?s:0,l=1===a?e:ot.Deferred(),h=function(e,i,n){return function(r){i[e]=this,n[e]=arguments.length>1?et.call(arguments):r,n===t?l.notifyWith(i,n):--a||l.resolveWith(i,n)}};if(s>1)for(t=new Array(s),i=new Array(s),n=new Array(s);s>r;r++)o[r]&&ot.isFunction(o[r].promise)?o[r].promise().done(h(r,n,o)).fail(l.reject).progress(h(r,i,t)):--a;return a||l.resolveWith(n,o),l.promise()}}),ot.support=function(t){var i=$.createElement("input"),n=$.createDocumentFragment(),r=$.createElement("div"),o=$.createElement("select"),s=o.appendChild($.createElement("option"));return i.type?(i.type="checkbox",t.checkOn=""!==i.value,t.optSelected=s.selected,t.reliableMarginRight=!0,t.boxSizingReliable=!0,t.pixelPosition=!1,i.checked=!0,t.noCloneChecked=i.cloneNode(!0).checked,o.disabled=!0,t.optDisabled=!s.disabled,i=$.createElement("input"),i.value="t",i.type="radio",t.radioValue="t"===i.value,i.setAttribute("checked","t"),i.setAttribute("name","t"),n.appendChild(i),t.checkClone=n.cloneNode(!0).cloneNode(!0).lastChild.checked,t.focusinBubbles="onfocusin"in e,r.style.backgroundClip="content-box",r.cloneNode(!0).style.backgroundClip="",t.clearCloneStyle="content-box"===r.style.backgroundClip,ot(function(){var i,n,o="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",s=$.getElementsByTagName("body")[0];s&&(i=$.createElement("div"),i.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",s.appendChild(i).appendChild(r),r.innerHTML="",r.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",ot.swap(s,null!=s.style.zoom?{zoom:1}:{},function(){t.boxSizing=4===r.offsetWidth}),e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(r,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(r,null)||{width:"4px"}).width,n=r.appendChild($.createElement("div")),n.style.cssText=r.style.cssText=o,n.style.marginRight=n.style.width="0",r.style.width="1px",t.reliableMarginRight=!parseFloat((e.getComputedStyle(n,null)||{}).marginRight)),s.removeChild(i))}),t):t}({});var mt,gt,vt=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,yt=/([A-Z])/g;r.uid=1,r.accepts=function(e){return e.nodeType?1===e.nodeType||9===e.nodeType:!0},r.prototype={key:function(e){if(!r.accepts(e))return 0;var t={},i=e[this.expando];if(!i){i=r.uid++;try{t[this.expando]={value:i},Object.defineProperties(e,t)}catch(n){t[this.expando]=i,ot.extend(e,t)}}return this.cache[i]||(this.cache[i]={}),i},set:function(e,t,i){var n,r=this.key(e),o=this.cache[r];if("string"==typeof t)o[t]=i;else if(ot.isEmptyObject(o))ot.extend(this.cache[r],t);else for(n in t)o[n]=t[n];return o},get:function(e,i){var n=this.cache[this.key(e)];return i===t?n:n[i]},access:function(e,i,n){var r;return i===t||i&&"string"==typeof i&&n===t?(r=this.get(e,i),r!==t?r:this.get(e,ot.camelCase(i))):(this.set(e,i,n),n!==t?n:i)},remove:function(e,i){var n,r,o,s=this.key(e),a=this.cache[s];if(i===t)this.cache[s]={};else{ot.isArray(i)?r=i.concat(i.map(ot.camelCase)):(o=ot.camelCase(i),i in a?r=[i,o]:(r=o,r=r in a?[r]:r.match(at)||[])),n=r.length;for(;n--;)delete a[r[n]]}},hasData:function(e){return!ot.isEmptyObject(this.cache[e[this.expando]]||{})},discard:function(e){e[this.expando]&&delete this.cache[e[this.expando]]}},mt=new r,gt=new r,ot.extend({acceptData:r.accepts,hasData:function(e){return mt.hasData(e)||gt.hasData(e)},data:function(e,t,i){return mt.access(e,t,i)},removeData:function(e,t){mt.remove(e,t)},_data:function(e,t,i){return gt.access(e,t,i)},_removeData:function(e,t){gt.remove(e,t)}}),ot.fn.extend({data:function(e,i){var n,r,s=this[0],a=0,l=null;if(e===t){if(this.length&&(l=mt.get(s),1===s.nodeType&&!gt.get(s,"hasDataAttrs"))){for(n=s.attributes;a<n.length;a++)r=n[a].name,0===r.indexOf("data-")&&(r=ot.camelCase(r.slice(5)),o(s,r,l[r]));gt.set(s,"hasDataAttrs",!0)}return l}return"object"==typeof e?this.each(function(){mt.set(this,e)}):ot.access(this,function(i){var n,r=ot.camelCase(e);if(s&&i===t){if(n=mt.get(s,e),n!==t)return n;if(n=mt.get(s,r),n!==t)return n;if(n=o(s,r,t),n!==t)return n}else this.each(function(){var n=mt.get(this,r);mt.set(this,r,i),-1!==e.indexOf("-")&&n!==t&&mt.set(this,e,i)})},null,i,arguments.length>1,null,!0)},removeData:function(e){return this.each(function(){mt.remove(this,e)})}}),ot.extend({queue:function(e,t,i){var n;return e?(t=(t||"fx")+"queue",n=gt.get(e,t),i&&(!n||ot.isArray(i)?n=gt.access(e,t,ot.makeArray(i)):n.push(i)),n||[]):void 0},dequeue:function(e,t){t=t||"fx";var i=ot.queue(e,t),n=i.length,r=i.shift(),o=ot._queueHooks(e,t),s=function(){ot.dequeue(e,t)};"inprogress"===r&&(r=i.shift(),n--),r&&("fx"===t&&i.unshift("inprogress"),delete o.stop,r.call(e,s,o)),!n&&o&&o.empty.fire()},_queueHooks:function(e,t){var i=t+"queueHooks";return gt.get(e,i)||gt.access(e,i,{empty:ot.Callbacks("once memory").add(function(){gt.remove(e,[t+"queue",i])})})}}),ot.fn.extend({queue:function(e,i){var n=2;return"string"!=typeof e&&(i=e,e="fx",n--),arguments.length<n?ot.queue(this[0],e):i===t?this:this.each(function(){var t=ot.queue(this,e,i);ot._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&ot.dequeue(this,e)})},dequeue:function(e){return this.each(function(){ot.dequeue(this,e)})},delay:function(e,t){return e=ot.fx?ot.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,i){var n=setTimeout(t,e);i.stop=function(){clearTimeout(n)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,i){var n,r=1,o=ot.Deferred(),s=this,a=this.length,l=function(){--r||o.resolveWith(s,[s])};for("string"!=typeof e&&(i=e,e=t),e=e||"fx";a--;)n=gt.get(s[a],e+"queueHooks"),n&&n.empty&&(r++,n.empty.add(l));return l(),o.promise(i)}});var _t,bt,Et=/[\t\r\n\f]/g,xt=/\r/g,Tt=/^(?:input|select|textarea|button)$/i;ot.fn.extend({attr:function(e,t){return ot.access(this,ot.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){ot.removeAttr(this,e)})},prop:function(e,t){return ot.access(this,ot.prop,e,t,arguments.length>1)},removeProp:function(e){return this.each(function(){delete this[ot.propFix[e]||e]})},addClass:function(e){var t,i,n,r,o,s=0,a=this.length,l="string"==typeof e&&e;if(ot.isFunction(e))return this.each(function(t){ot(this).addClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(at)||[];a>s;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Et," "):" ")){for(o=0;r=t[o++];)n.indexOf(" "+r+" ")<0&&(n+=r+" ");i.className=ot.trim(n)}return this},removeClass:function(e){var t,i,n,r,o,s=0,a=this.length,l=0===arguments.length||"string"==typeof e&&e;if(ot.isFunction(e))return this.each(function(t){ot(this).removeClass(e.call(this,t,this.className))});if(l)for(t=(e||"").match(at)||[];a>s;s++)if(i=this[s],n=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(Et," "):"")){for(o=0;r=t[o++];)for(;n.indexOf(" "+r+" ")>=0;)n=n.replace(" "+r+" "," ");i.className=e?ot.trim(n):""}return this},toggleClass:function(e,t){var i=typeof e;return"boolean"==typeof t&&"string"===i?t?this.addClass(e):this.removeClass(e):ot.isFunction(e)?this.each(function(i){ot(this).toggleClass(e.call(this,i,this.className,t),t)}):this.each(function(){if("string"===i)for(var t,n=0,r=ot(this),o=e.match(at)||[];t=o[n++];)r.hasClass(t)?r.removeClass(t):r.addClass(t);else(i===j||"boolean"===i)&&(this.className&&gt.set(this,"__className__",this.className),this.className=this.className||e===!1?"":gt.get(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",i=0,n=this.length;n>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(Et," ").indexOf(t)>=0)return!0;return!1},val:function(e){var i,n,r,o=this[0];{if(arguments.length)return r=ot.isFunction(e),this.each(function(n){var o;1===this.nodeType&&(o=r?e.call(this,n,ot(this).val()):e,null==o?o="":"number"==typeof o?o+="":ot.isArray(o)&&(o=ot.map(o,function(e){return null==e?"":e+""})),i=ot.valHooks[this.type]||ot.valHooks[this.nodeName.toLowerCase()],i&&"set"in i&&i.set(this,o,"value")!==t||(this.value=o))});if(o)return i=ot.valHooks[o.type]||ot.valHooks[o.nodeName.toLowerCase()],i&&"get"in i&&(n=i.get(o,"value"))!==t?n:(n=o.value,"string"==typeof n?n.replace(xt,""):null==n?"":n)}}}),ot.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,i,n=e.options,r=e.selectedIndex,o="select-one"===e.type||0>r,s=o?null:[],a=o?r+1:n.length,l=0>r?a:o?r:0;a>l;l++)if(i=n[l],!(!i.selected&&l!==r||(ot.support.optDisabled?i.disabled:null!==i.getAttribute("disabled"))||i.parentNode.disabled&&ot.nodeName(i.parentNode,"optgroup"))){if(t=ot(i).val(),o)return t;s.push(t)}return s},set:function(e,t){for(var i,n,r=e.options,o=ot.makeArray(t),s=r.length;s--;)n=r[s],(n.selected=ot.inArray(ot(n).val(),o)>=0)&&(i=!0);return i||(e.selectedIndex=-1),o}}},attr:function(e,i,n){var r,o,s=e.nodeType;if(e&&3!==s&&8!==s&&2!==s)return typeof e.getAttribute===j?ot.prop(e,i,n):(1===s&&ot.isXMLDoc(e)||(i=i.toLowerCase(),r=ot.attrHooks[i]||(ot.expr.match.bool.test(i)?bt:_t)),n===t?r&&"get"in r&&null!==(o=r.get(e,i))?o:(o=ot.find.attr(e,i),null==o?t:o):null!==n?r&&"set"in r&&(o=r.set(e,n,i))!==t?o:(e.setAttribute(i,n+""),n):(ot.removeAttr(e,i),void 0))},removeAttr:function(e,t){var i,n,r=0,o=t&&t.match(at);if(o&&1===e.nodeType)for(;i=o[r++];)n=ot.propFix[i]||i,ot.expr.match.bool.test(i)&&(e[n]=!1),e.removeAttribute(i)},attrHooks:{type:{set:function(e,t){if(!ot.support.radioValue&&"radio"===t&&ot.nodeName(e,"input")){var i=e.value;return e.setAttribute("type",t),i&&(e.value=i),t}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(e,i,n){var r,o,s,a=e.nodeType;if(e&&3!==a&&8!==a&&2!==a)return s=1!==a||!ot.isXMLDoc(e),s&&(i=ot.propFix[i]||i,o=ot.propHooks[i]),n!==t?o&&"set"in o&&(r=o.set(e,n,i))!==t?r:e[i]=n:o&&"get"in o&&null!==(r=o.get(e,i))?r:e[i]},propHooks:{tabIndex:{get:function(e){return e.hasAttribute("tabindex")||Tt.test(e.nodeName)||e.href?e.tabIndex:-1}}}}),bt={set:function(e,t,i){return t===!1?ot.removeAttr(e,i):e.setAttribute(i,i),i}},ot.each(ot.expr.match.bool.source.match(/\w+/g),function(e,i){var n=ot.expr.attrHandle[i]||ot.find.attr;ot.expr.attrHandle[i]=function(e,i,r){var o=ot.expr.attrHandle[i],s=r?t:(ot.expr.attrHandle[i]=t)!=n(e,i,r)?i.toLowerCase():null;return ot.expr.attrHandle[i]=o,s}}),ot.support.optSelected||(ot.propHooks.selected={get:function(e){var t=e.parentNode;return t&&t.parentNode&&t.parentNode.selectedIndex,null}}),ot.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){ot.propFix[this.toLowerCase()]=this}),ot.each(["radio","checkbox"],function(){ot.valHooks[this]={set:function(e,t){return ot.isArray(t)?e.checked=ot.inArray(ot(e).val(),t)>=0:void 0}},ot.support.checkOn||(ot.valHooks[this].get=function(e){return null===e.getAttribute("value")?"on":e.value})});var wt=/^key/,Rt=/^(?:mouse|contextmenu)|click/,St=/^(?:focusinfocus|focusoutblur)$/,Ct=/^([^.]*)(?:\.(.+)|)$/;ot.event={global:{},add:function(e,i,n,r,o){var s,a,l,h,c,u,d,p,f,m,g,v=gt.get(e);if(v){for(n.handler&&(s=n,n=s.handler,o=s.selector),n.guid||(n.guid=ot.guid++),(h=v.events)||(h=v.events={}),(a=v.handle)||(a=v.handle=function(e){return typeof ot===j||e&&ot.event.triggered===e.type?t:ot.event.dispatch.apply(a.elem,arguments)},a.elem=e),i=(i||"").match(at)||[""],c=i.length;c--;)l=Ct.exec(i[c])||[],f=g=l[1],m=(l[2]||"").split(".").sort(),f&&(d=ot.event.special[f]||{},f=(o?d.delegateType:d.bindType)||f,d=ot.event.special[f]||{},u=ot.extend({type:f,origType:g,data:r,handler:n,guid:n.guid,selector:o,needsContext:o&&ot.expr.match.needsContext.test(o),namespace:m.join(".")},s),(p=h[f])||(p=h[f]=[],p.delegateCount=0,d.setup&&d.setup.call(e,r,m,a)!==!1||e.addEventListener&&e.addEventListener(f,a,!1)),d.add&&(d.add.call(e,u),u.handler.guid||(u.handler.guid=n.guid)),o?p.splice(p.delegateCount++,0,u):p.push(u),ot.event.global[f]=!0);e=null}},remove:function(e,t,i,n,r){var o,s,a,l,h,c,u,d,p,f,m,g=gt.hasData(e)&&gt.get(e);if(g&&(l=g.events)){for(t=(t||"").match(at)||[""],h=t.length;h--;)if(a=Ct.exec(t[h])||[],p=m=a[1],f=(a[2]||"").split(".").sort(),p){for(u=ot.event.special[p]||{},p=(n?u.delegateType:u.bindType)||p,d=l[p]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),s=o=d.length;o--;)c=d[o],!r&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||n&&n!==c.selector&&("**"!==n||!c.selector)||(d.splice(o,1),c.selector&&d.delegateCount--,u.remove&&u.remove.call(e,c));s&&!d.length&&(u.teardown&&u.teardown.call(e,f,g.handle)!==!1||ot.removeEvent(e,p,g.handle),delete l[p])}else for(p in l)ot.event.remove(e,p+t[h],i,n,!0);ot.isEmptyObject(l)&&(delete g.handle,gt.remove(e,"events"))}},trigger:function(i,n,r,o){var s,a,l,h,c,u,d,p=[r||$],f=nt.call(i,"type")?i.type:i,m=nt.call(i,"namespace")?i.namespace.split("."):[];if(a=l=r=r||$,3!==r.nodeType&&8!==r.nodeType&&!St.test(f+ot.event.triggered)&&(f.indexOf(".")>=0&&(m=f.split("."),f=m.shift(),m.sort()),c=f.indexOf(":")<0&&"on"+f,i=i[ot.expando]?i:new ot.Event(f,"object"==typeof i&&i),i.isTrigger=o?2:3,i.namespace=m.join("."),i.namespace_re=i.namespace?new RegExp("(^|\\.)"+m.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,i.result=t,i.target||(i.target=r),n=null==n?[i]:ot.makeArray(n,[i]),d=ot.event.special[f]||{},o||!d.trigger||d.trigger.apply(r,n)!==!1)){if(!o&&!d.noBubble&&!ot.isWindow(r)){for(h=d.delegateType||f,St.test(h+f)||(a=a.parentNode);a;a=a.parentNode)p.push(a),l=a;l===(r.ownerDocument||$)&&p.push(l.defaultView||l.parentWindow||e)}for(s=0;(a=p[s++])&&!i.isPropagationStopped();)i.type=s>1?h:d.bindType||f,u=(gt.get(a,"events")||{})[i.type]&&gt.get(a,"handle"),u&&u.apply(a,n),u=c&&a[c],u&&ot.acceptData(a)&&u.apply&&u.apply(a,n)===!1&&i.preventDefault();return i.type=f,o||i.isDefaultPrevented()||d._default&&d._default.apply(p.pop(),n)!==!1||!ot.acceptData(r)||c&&ot.isFunction(r[f])&&!ot.isWindow(r)&&(l=r[c],l&&(r[c]=null),ot.event.triggered=f,r[f](),ot.event.triggered=t,l&&(r[c]=l)),i.result}},dispatch:function(e){e=ot.event.fix(e);var i,n,r,o,s,a=[],l=et.call(arguments),h=(gt.get(this,"events")||{})[e.type]||[],c=ot.event.special[e.type]||{};if(l[0]=e,e.delegateTarget=this,!c.preDispatch||c.preDispatch.call(this,e)!==!1){for(a=ot.event.handlers.call(this,e,h),i=0;(o=a[i++])&&!e.isPropagationStopped();)for(e.currentTarget=o.elem,n=0;(s=o.handlers[n++])&&!e.isImmediatePropagationStopped();)(!e.namespace_re||e.namespace_re.test(s.namespace))&&(e.handleObj=s,e.data=s.data,r=((ot.event.special[s.origType]||{}).handle||s.handler).apply(o.elem,l),r!==t&&(e.result=r)===!1&&(e.preventDefault(),e.stopPropagation()));return c.postDispatch&&c.postDispatch.call(this,e),e.result}},handlers:function(e,i){var n,r,o,s,a=[],l=i.delegateCount,h=e.target;if(l&&h.nodeType&&(!e.button||"click"!==e.type))for(;h!==this;h=h.parentNode||this)if(h.disabled!==!0||"click"!==e.type){for(r=[],n=0;l>n;n++)s=i[n],o=s.selector+" ",r[o]===t&&(r[o]=s.needsContext?ot(o,this).index(h)>=0:ot.find(o,this,null,[h]).length),r[o]&&r.push(s);r.length&&a.push({elem:h,handlers:r})}return l<i.length&&a.push({elem:this,handlers:i.slice(l)}),a},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,i){var n,r,o,s=i.button;return null==e.pageX&&null!=i.clientX&&(n=e.target.ownerDocument||$,r=n.documentElement,o=n.body,e.pageX=i.clientX+(r&&r.scrollLeft||o&&o.scrollLeft||0)-(r&&r.clientLeft||o&&o.clientLeft||0),e.pageY=i.clientY+(r&&r.scrollTop||o&&o.scrollTop||0)-(r&&r.clientTop||o&&o.clientTop||0)),e.which||s===t||(e.which=1&s?1:2&s?3:4&s?2:0),e}},fix:function(e){if(e[ot.expando])return e;var t,i,n,r=e.type,o=e,s=this.fixHooks[r];for(s||(this.fixHooks[r]=s=Rt.test(r)?this.mouseHooks:wt.test(r)?this.keyHooks:{}),n=s.props?this.props.concat(s.props):this.props,e=new ot.Event(o),t=n.length;t--;)i=n[t],e[i]=o[i];return e.target||(e.target=$),3===e.target.nodeType&&(e.target=e.target.parentNode),s.filter?s.filter(e,o):e},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==l()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===l()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&ot.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(e){return ot.nodeName(e.target,"a")}},beforeunload:{postDispatch:function(e){e.result!==t&&(e.originalEvent.returnValue=e.result)}}},simulate:function(e,t,i,n){var r=ot.extend(new ot.Event,i,{type:e,isSimulated:!0,originalEvent:{}});n?ot.event.trigger(r,null,t):ot.event.dispatch.call(t,r),r.isDefaultPrevented()&&i.preventDefault()}},ot.removeEvent=function(e,t,i){e.removeEventListener&&e.removeEventListener(t,i,!1)},ot.Event=function(e,t){return this instanceof ot.Event?(e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.getPreventDefault&&e.getPreventDefault()?s:a):this.type=e,t&&ot.extend(this,t),this.timeStamp=e&&e.timeStamp||ot.now(),this[ot.expando]=!0,void 0):new ot.Event(e,t)},ot.Event.prototype={isDefaultPrevented:a,isPropagationStopped:a,isImmediatePropagationStopped:a,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=s,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=s,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=s,this.stopPropagation()}},ot.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){ot.event.special[e]={delegateType:t,bindType:t,handle:function(e){var i,n=this,r=e.relatedTarget,o=e.handleObj;return(!r||r!==n&&!ot.contains(n,r))&&(e.type=o.origType,i=o.handler.apply(this,arguments),e.type=t),i}}}),ot.support.focusinBubbles||ot.each({focus:"focusin",blur:"focusout"},function(e,t){var i=0,n=function(e){ot.event.simulate(t,e.target,ot.event.fix(e),!0)};ot.event.special[t]={setup:function(){0===i++&&$.addEventListener(e,n,!0)},teardown:function(){0===--i&&$.removeEventListener(e,n,!0)}}}),ot.fn.extend({on:function(e,i,n,r,o){var s,l;if("object"==typeof e){"string"!=typeof i&&(n=n||i,i=t);for(l in e)this.on(l,i,n,e[l],o);return this}if(null==n&&null==r?(r=i,n=i=t):null==r&&("string"==typeof i?(r=n,n=t):(r=n,n=i,i=t)),r===!1)r=a;else if(!r)return this;return 1===o&&(s=r,r=function(e){return ot().off(e),s.apply(this,arguments)},r.guid=s.guid||(s.guid=ot.guid++)),this.each(function(){ot.event.add(this,e,r,n,i)})},one:function(e,t,i,n){return this.on(e,t,i,n,1)},off:function(e,i,n){var r,o;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,ot(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"==typeof e){for(o in e)this.off(o,i,e[o]);return this}return(i===!1||"function"==typeof i)&&(n=i,i=t),n===!1&&(n=a),this.each(function(){ot.event.remove(this,e,n,i)})},trigger:function(e,t){return this.each(function(){ot.event.trigger(e,t,this)})},triggerHandler:function(e,t){var i=this[0];return i?ot.event.trigger(e,t,i,!0):void 0}});var Ht=/^.[^:#\[\.,]*$/,Mt=/^(?:parents|prev(?:Until|All))/,kt=ot.expr.match.needsContext,At={children:!0,contents:!0,next:!0,prev:!0};ot.fn.extend({find:function(e){var t,i=[],n=this,r=n.length;if("string"!=typeof e)return this.pushStack(ot(e).filter(function(){for(t=0;r>t;t++)if(ot.contains(n[t],this))return!0}));for(t=0;r>t;t++)ot.find(e,n[t],i);return i=this.pushStack(r>1?ot.unique(i):i),i.selector=this.selector?this.selector+" "+e:e,i},has:function(e){var t=ot(e,this),i=t.length;return this.filter(function(){for(var e=0;i>e;e++)if(ot.contains(this,t[e]))return!0})},not:function(e){return this.pushStack(c(this,e||[],!0))},filter:function(e){return this.pushStack(c(this,e||[],!1))},is:function(e){return!!c(this,"string"==typeof e&&kt.test(e)?ot(e):e||[],!1).length},closest:function(e,t){for(var i,n=0,r=this.length,o=[],s=kt.test(e)||"string"!=typeof e?ot(e,t||this.context):0;r>n;n++)for(i=this[n];i&&i!==t;i=i.parentNode)if(i.nodeType<11&&(s?s.index(i)>-1:1===i.nodeType&&ot.find.matchesSelector(i,e))){i=o.push(i);break}return this.pushStack(o.length>1?ot.unique(o):o)},index:function(e){return e?"string"==typeof e?tt.call(ot(e),this[0]):tt.call(this,e.jquery?e[0]:e):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(e,t){var i="string"==typeof e?ot(e,t):ot.makeArray(e&&e.nodeType?[e]:e),n=ot.merge(this.get(),i);return this.pushStack(ot.unique(n))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),ot.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return ot.dir(e,"parentNode")},parentsUntil:function(e,t,i){return ot.dir(e,"parentNode",i)},next:function(e){return h(e,"nextSibling")},prev:function(e){return h(e,"previousSibling")},nextAll:function(e){return ot.dir(e,"nextSibling")},prevAll:function(e){return ot.dir(e,"previousSibling")},nextUntil:function(e,t,i){return ot.dir(e,"nextSibling",i)},prevUntil:function(e,t,i){return ot.dir(e,"previousSibling",i)},siblings:function(e){return ot.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return ot.sibling(e.firstChild)},contents:function(e){return e.contentDocument||ot.merge([],e.childNodes)}},function(e,t){ot.fn[e]=function(i,n){var r=ot.map(this,t,i);return"Until"!==e.slice(-5)&&(n=i),n&&"string"==typeof n&&(r=ot.filter(n,r)),this.length>1&&(At[e]||ot.unique(r),Mt.test(e)&&r.reverse()),this.pushStack(r)}}),ot.extend({filter:function(e,t,i){var n=t[0];return i&&(e=":not("+e+")"),1===t.length&&1===n.nodeType?ot.find.matchesSelector(n,e)?[n]:[]:ot.find.matches(e,ot.grep(t,function(e){return 1===e.nodeType}))},dir:function(e,i,n){for(var r=[],o=n!==t;(e=e[i])&&9!==e.nodeType;)if(1===e.nodeType){if(o&&ot(e).is(n))break;r.push(e)}return r},sibling:function(e,t){for(var i=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&i.push(e);return i}});var Pt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,Ft=/<([\w:]+)/,Dt=/<|&#?\w+;/,Nt=/<(?:script|style|link)/i,zt=/^(?:checkbox|radio)$/i,Lt=/checked\s*(?:[^=]|=\s*.checked.)/i,It=/^$|\/(?:java|ecma)script/i,Ot=/^true\/(.*)/,Vt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Bt={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Bt.optgroup=Bt.option,Bt.tbody=Bt.tfoot=Bt.colgroup=Bt.caption=Bt.thead,Bt.th=Bt.td,ot.fn.extend({text:function(e){return ot.access(this,function(e){return e===t?ot.text(this):this.empty().append((this[0]&&this[0].ownerDocument||$).createTextNode(e))},null,e,arguments.length)},append:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=u(this,e);t.appendChild(e)}})},prepend:function(){return this.domManip(arguments,function(e){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var t=u(this,e);t.insertBefore(e,t.firstChild)}})},before:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this)})},after:function(){return this.domManip(arguments,function(e){this.parentNode&&this.parentNode.insertBefore(e,this.nextSibling)})},remove:function(e,t){for(var i,n=e?ot.filter(e,this):this,r=0;null!=(i=n[r]);r++)t||1!==i.nodeType||ot.cleanData(g(i)),i.parentNode&&(t&&ot.contains(i.ownerDocument,i)&&f(g(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)1===e.nodeType&&(ot.cleanData(g(e,!1)),e.textContent="");return this},clone:function(e,t){return e=null==e?!1:e,t=null==t?e:t,this.map(function(){return ot.clone(this,e,t)})},html:function(e){return ot.access(this,function(e){var i=this[0]||{},n=0,r=this.length;if(e===t&&1===i.nodeType)return i.innerHTML;if("string"==typeof e&&!Nt.test(e)&&!Bt[(Ft.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(Pt,"<$1></$2>");try{for(;r>n;n++)i=this[n]||{},1===i.nodeType&&(ot.cleanData(g(i,!1)),i.innerHTML=e);i=0}catch(o){}}i&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(){var e=ot.map(this,function(e){return[e.nextSibling,e.parentNode]}),t=0;return this.domManip(arguments,function(i){var n=e[t++],r=e[t++];r&&(n&&n.parentNode!==r&&(n=this.nextSibling),ot(this).remove(),r.insertBefore(i,n))},!0),t?this:this.remove()},detach:function(e){return this.remove(e,!0)},domManip:function(e,t,i){e=J.apply([],e);var n,r,o,s,a,l,h=0,c=this.length,u=this,f=c-1,m=e[0],v=ot.isFunction(m);if(v||!(1>=c||"string"!=typeof m||ot.support.checkClone)&&Lt.test(m))return this.each(function(n){var r=u.eq(n);v&&(e[0]=m.call(this,n,r.html())),r.domManip(e,t,i)});if(c&&(n=ot.buildFragment(e,this[0].ownerDocument,!1,!i&&this),r=n.firstChild,1===n.childNodes.length&&(n=r),r)){for(o=ot.map(g(n,"script"),d),s=o.length;c>h;h++)a=n,h!==f&&(a=ot.clone(a,!0,!0),s&&ot.merge(o,g(a,"script"))),t.call(this[h],a,h);if(s)for(l=o[o.length-1].ownerDocument,ot.map(o,p),h=0;s>h;h++)a=o[h],It.test(a.type||"")&&!gt.access(a,"globalEval")&&ot.contains(l,a)&&(a.src?ot._evalUrl(a.src):ot.globalEval(a.textContent.replace(Vt,"")))}return this}}),ot.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){ot.fn[e]=function(e){for(var i,n=[],r=ot(e),o=r.length-1,s=0;o>=s;s++)i=s===o?this:this.clone(!0),ot(r[s])[t](i),Z.apply(n,i.get());return this.pushStack(n)}}),ot.extend({clone:function(e,t,i){var n,r,o,s,a=e.cloneNode(!0),l=ot.contains(e.ownerDocument,e);if(!(ot.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||ot.isXMLDoc(e)))for(s=g(a),o=g(e),n=0,r=o.length;r>n;n++)v(o[n],s[n]);if(t)if(i)for(o=o||g(e),s=s||g(a),n=0,r=o.length;r>n;n++)m(o[n],s[n]);else m(e,a);return s=g(a,"script"),s.length>0&&f(s,!l&&g(e,"script")),a},buildFragment:function(e,t,i,n){for(var r,o,s,a,l,h,c=0,u=e.length,d=t.createDocumentFragment(),p=[];u>c;c++)if(r=e[c],r||0===r)if("object"===ot.type(r))ot.merge(p,r.nodeType?[r]:r);else if(Dt.test(r)){for(o=o||d.appendChild(t.createElement("div")),s=(Ft.exec(r)||["",""])[1].toLowerCase(),a=Bt[s]||Bt._default,o.innerHTML=a[1]+r.replace(Pt,"<$1></$2>")+a[2],h=a[0];h--;)o=o.lastChild;ot.merge(p,o.childNodes),o=d.firstChild,o.textContent=""}else p.push(t.createTextNode(r));for(d.textContent="",c=0;r=p[c++];)if((!n||-1===ot.inArray(r,n))&&(l=ot.contains(r.ownerDocument,r),o=g(d.appendChild(r),"script"),l&&f(o),i))for(h=0;r=o[h++];)It.test(r.type||"")&&i.push(r);return d},cleanData:function(e){for(var i,n,o,s,a,l,h=ot.event.special,c=0;(n=e[c])!==t;c++){if(r.accepts(n)&&(a=n[gt.expando],a&&(i=gt.cache[a]))){if(o=Object.keys(i.events||{}),o.length)for(l=0;(s=o[l])!==t;l++)h[s]?ot.event.remove(n,s):ot.removeEvent(n,s,i.handle);gt.cache[a]&&delete gt.cache[a]}delete mt.cache[n[mt.expando]]}},_evalUrl:function(e){return ot.ajax({url:e,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),ot.fn.extend({wrapAll:function(e){var t;return ot.isFunction(e)?this.each(function(t){ot(this).wrapAll(e.call(this,t))}):(this[0]&&(t=ot(e,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstElementChild;)e=e.firstElementChild;return e}).append(this)),this)},wrapInner:function(e){return ot.isFunction(e)?this.each(function(t){ot(this).wrapInner(e.call(this,t))}):this.each(function(){var t=ot(this),i=t.contents();i.length?i.wrapAll(e):t.append(e)})},wrap:function(e){var t=ot.isFunction(e);return this.each(function(i){ot(this).wrapAll(t?e.call(this,i):e)})},unwrap:function(){return this.parent().each(function(){ot.nodeName(this,"body")||ot(this).replaceWith(this.childNodes)}).end()}});var Ut,jt,Wt=/^(none|table(?!-c[ea]).+)/,$t=/^margin/,Gt=new RegExp("^("+st+")(.*)$","i"),qt=new RegExp("^("+st+")(?!px)[a-z%]+$","i"),Xt=new RegExp("^([+-])=("+st+")","i"),Yt={BODY:"block"},Kt={position:"absolute",visibility:"hidden",display:"block"},Qt={letterSpacing:0,fontWeight:400},Jt=["Top","Right","Bottom","Left"],Zt=["Webkit","O","Moz","ms"];ot.fn.extend({css:function(e,i){return ot.access(this,function(e,i,n){var r,o,s={},a=0;if(ot.isArray(i)){for(r=b(e),o=i.length;o>a;a++)s[i[a]]=ot.css(e,i[a],!1,r);return s}return n!==t?ot.style(e,i,n):ot.css(e,i)},e,i,arguments.length>1)},show:function(){return E(this,!0)},hide:function(){return E(this)},toggle:function(e){return"boolean"==typeof e?e?this.show():this.hide():this.each(function(){_(this)?ot(this).show():ot(this).hide()})}}),ot.extend({cssHooks:{opacity:{get:function(e,t){if(t){var i=Ut(e,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(e,i,n,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var o,s,a,l=ot.camelCase(i),h=e.style;
return i=ot.cssProps[l]||(ot.cssProps[l]=y(h,l)),a=ot.cssHooks[i]||ot.cssHooks[l],n===t?a&&"get"in a&&(o=a.get(e,!1,r))!==t?o:h[i]:(s=typeof n,"string"===s&&(o=Xt.exec(n))&&(n=(o[1]+1)*o[2]+parseFloat(ot.css(e,i)),s="number"),null==n||"number"===s&&isNaN(n)||("number"!==s||ot.cssNumber[l]||(n+="px"),ot.support.clearCloneStyle||""!==n||0!==i.indexOf("background")||(h[i]="inherit"),a&&"set"in a&&(n=a.set(e,n,r))===t||(h[i]=n)),void 0)}},css:function(e,i,n,r){var o,s,a,l=ot.camelCase(i);return i=ot.cssProps[l]||(ot.cssProps[l]=y(e.style,l)),a=ot.cssHooks[i]||ot.cssHooks[l],a&&"get"in a&&(o=a.get(e,!0,n)),o===t&&(o=Ut(e,i,r)),"normal"===o&&i in Qt&&(o=Qt[i]),""===n||n?(s=parseFloat(o),n===!0||ot.isNumeric(s)?s||0:o):o}}),Ut=function(e,i,n){var r,o,s,a=n||b(e),l=a?a.getPropertyValue(i)||a[i]:t,h=e.style;return a&&(""!==l||ot.contains(e.ownerDocument,e)||(l=ot.style(e,i)),qt.test(l)&&$t.test(i)&&(r=h.width,o=h.minWidth,s=h.maxWidth,h.minWidth=h.maxWidth=h.width=l,l=a.width,h.width=r,h.minWidth=o,h.maxWidth=s)),l},ot.each(["height","width"],function(e,t){ot.cssHooks[t]={get:function(e,i,n){return i?0===e.offsetWidth&&Wt.test(ot.css(e,"display"))?ot.swap(e,Kt,function(){return w(e,t,n)}):w(e,t,n):void 0},set:function(e,i,n){var r=n&&b(e);return x(e,i,n?T(e,t,n,ot.support.boxSizing&&"border-box"===ot.css(e,"boxSizing",!1,r),r):0)}}}),ot(function(){ot.support.reliableMarginRight||(ot.cssHooks.marginRight={get:function(e,t){return t?ot.swap(e,{display:"inline-block"},Ut,[e,"marginRight"]):void 0}}),!ot.support.pixelPosition&&ot.fn.position&&ot.each(["top","left"],function(e,t){ot.cssHooks[t]={get:function(e,i){return i?(i=Ut(e,t),qt.test(i)?ot(e).position()[t]+"px":i):void 0}}})}),ot.expr&&ot.expr.filters&&(ot.expr.filters.hidden=function(e){return e.offsetWidth<=0&&e.offsetHeight<=0},ot.expr.filters.visible=function(e){return!ot.expr.filters.hidden(e)}),ot.each({margin:"",padding:"",border:"Width"},function(e,t){ot.cssHooks[e+t]={expand:function(i){for(var n=0,r={},o="string"==typeof i?i.split(" "):[i];4>n;n++)r[e+Jt[n]+t]=o[n]||o[n-2]||o[0];return r}},$t.test(e)||(ot.cssHooks[e+t].set=x)});var ei=/%20/g,ti=/\[\]$/,ii=/\r?\n/g,ni=/^(?:submit|button|image|reset|file)$/i,ri=/^(?:input|select|textarea|keygen)/i;ot.fn.extend({serialize:function(){return ot.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var e=ot.prop(this,"elements");return e?ot.makeArray(e):this}).filter(function(){var e=this.type;return this.name&&!ot(this).is(":disabled")&&ri.test(this.nodeName)&&!ni.test(e)&&(this.checked||!zt.test(e))}).map(function(e,t){var i=ot(this).val();return null==i?null:ot.isArray(i)?ot.map(i,function(e){return{name:t.name,value:e.replace(ii,"\r\n")}}):{name:t.name,value:i.replace(ii,"\r\n")}}).get()}}),ot.param=function(e,i){var n,r=[],o=function(e,t){t=ot.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(i===t&&(i=ot.ajaxSettings&&ot.ajaxSettings.traditional),ot.isArray(e)||e.jquery&&!ot.isPlainObject(e))ot.each(e,function(){o(this.name,this.value)});else for(n in e)C(n,e[n],i,o);return r.join("&").replace(ei,"+")},ot.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){ot.fn[t]=function(e,i){return arguments.length>0?this.on(t,null,e,i):this.trigger(t)}}),ot.fn.extend({hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)},bind:function(e,t,i){return this.on(e,null,t,i)},unbind:function(e,t){return this.off(e,null,t)},delegate:function(e,t,i,n){return this.on(t,e,i,n)},undelegate:function(e,t,i){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",i)}});var oi,si,ai=ot.now(),li=/\?/,hi=/#.*$/,ci=/([?&])_=[^&]*/,ui=/^(.*?):[ \t]*([^\r\n]*)$/gm,di=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,pi=/^(?:GET|HEAD)$/,fi=/^\/\//,mi=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,gi=ot.fn.load,vi={},yi={},_i="*/".concat("*");try{si=W.href}catch(bi){si=$.createElement("a"),si.href="",si=si.href}oi=mi.exec(si.toLowerCase())||[],ot.fn.load=function(e,i,n){if("string"!=typeof e&&gi)return gi.apply(this,arguments);var r,o,s,a=this,l=e.indexOf(" ");return l>=0&&(r=e.slice(l),e=e.slice(0,l)),ot.isFunction(i)?(n=i,i=t):i&&"object"==typeof i&&(o="POST"),a.length>0&&ot.ajax({url:e,type:o,dataType:"html",data:i}).done(function(e){s=arguments,a.html(r?ot("<div>").append(ot.parseHTML(e)).find(r):e)}).complete(n&&function(e,t){a.each(n,s||[e.responseText,t,e])}),this},ot.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(e,t){ot.fn[t]=function(e){return this.on(t,e)}}),ot.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:si,type:"GET",isLocal:di.test(oi[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_i,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":ot.parseJSON,"text xml":ot.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(e,t){return t?k(k(e,ot.ajaxSettings),t):k(ot.ajaxSettings,e)},ajaxPrefilter:H(vi),ajaxTransport:H(yi),ajax:function(e,i){function n(e,i,n,a){var h,u,y,_,E,T=i;2!==b&&(b=2,l&&clearTimeout(l),r=t,s=a||"",x.readyState=e>0?4:0,h=e>=200&&300>e||304===e,n&&(_=A(d,x,n)),_=P(d,_,x,h),h?(d.ifModified&&(E=x.getResponseHeader("Last-Modified"),E&&(ot.lastModified[o]=E),E=x.getResponseHeader("etag"),E&&(ot.etag[o]=E)),204===e||"HEAD"===d.type?T="nocontent":304===e?T="notmodified":(T=_.state,u=_.data,y=_.error,h=!y)):(y=T,(e||!T)&&(T="error",0>e&&(e=0))),x.status=e,x.statusText=(i||T)+"",h?m.resolveWith(p,[u,T,x]):m.rejectWith(p,[x,T,y]),x.statusCode(v),v=t,c&&f.trigger(h?"ajaxSuccess":"ajaxError",[x,d,h?u:y]),g.fireWith(p,[x,T]),c&&(f.trigger("ajaxComplete",[x,d]),--ot.active||ot.event.trigger("ajaxStop")))}"object"==typeof e&&(i=e,e=t),i=i||{};var r,o,s,a,l,h,c,u,d=ot.ajaxSetup({},i),p=d.context||d,f=d.context&&(p.nodeType||p.jquery)?ot(p):ot.event,m=ot.Deferred(),g=ot.Callbacks("once memory"),v=d.statusCode||{},y={},_={},b=0,E="canceled",x={readyState:0,getResponseHeader:function(e){var t;if(2===b){if(!a)for(a={};t=ui.exec(s);)a[t[1].toLowerCase()]=t[2];t=a[e.toLowerCase()]}return null==t?null:t},getAllResponseHeaders:function(){return 2===b?s:null},setRequestHeader:function(e,t){var i=e.toLowerCase();return b||(e=_[i]=_[i]||e,y[e]=t),this},overrideMimeType:function(e){return b||(d.mimeType=e),this},statusCode:function(e){var t;if(e)if(2>b)for(t in e)v[t]=[v[t],e[t]];else x.always(e[x.status]);return this},abort:function(e){var t=e||E;return r&&r.abort(t),n(0,t),this}};if(m.promise(x).complete=g.add,x.success=x.done,x.error=x.fail,d.url=((e||d.url||si)+"").replace(hi,"").replace(fi,oi[1]+"//"),d.type=i.method||i.type||d.method||d.type,d.dataTypes=ot.trim(d.dataType||"*").toLowerCase().match(at)||[""],null==d.crossDomain&&(h=mi.exec(d.url.toLowerCase()),d.crossDomain=!(!h||h[1]===oi[1]&&h[2]===oi[2]&&(h[3]||("http:"===h[1]?"80":"443"))===(oi[3]||("http:"===oi[1]?"80":"443")))),d.data&&d.processData&&"string"!=typeof d.data&&(d.data=ot.param(d.data,d.traditional)),M(vi,d,i,x),2===b)return x;c=d.global,c&&0===ot.active++&&ot.event.trigger("ajaxStart"),d.type=d.type.toUpperCase(),d.hasContent=!pi.test(d.type),o=d.url,d.hasContent||(d.data&&(o=d.url+=(li.test(o)?"&":"?")+d.data,delete d.data),d.cache===!1&&(d.url=ci.test(o)?o.replace(ci,"$1_="+ai++):o+(li.test(o)?"&":"?")+"_="+ai++)),d.ifModified&&(ot.lastModified[o]&&x.setRequestHeader("If-Modified-Since",ot.lastModified[o]),ot.etag[o]&&x.setRequestHeader("If-None-Match",ot.etag[o])),(d.data&&d.hasContent&&d.contentType!==!1||i.contentType)&&x.setRequestHeader("Content-Type",d.contentType),x.setRequestHeader("Accept",d.dataTypes[0]&&d.accepts[d.dataTypes[0]]?d.accepts[d.dataTypes[0]]+("*"!==d.dataTypes[0]?", "+_i+"; q=0.01":""):d.accepts["*"]);for(u in d.headers)x.setRequestHeader(u,d.headers[u]);if(d.beforeSend&&(d.beforeSend.call(p,x,d)===!1||2===b))return x.abort();E="abort";for(u in{success:1,error:1,complete:1})x[u](d[u]);if(r=M(yi,d,i,x)){x.readyState=1,c&&f.trigger("ajaxSend",[x,d]),d.async&&d.timeout>0&&(l=setTimeout(function(){x.abort("timeout")},d.timeout));try{b=1,r.send(y,n)}catch(T){if(!(2>b))throw T;n(-1,T)}}else n(-1,"No Transport");return x},getJSON:function(e,t,i){return ot.get(e,t,i,"json")},getScript:function(e,i){return ot.get(e,t,i,"script")}}),ot.each(["get","post"],function(e,i){ot[i]=function(e,n,r,o){return ot.isFunction(n)&&(o=o||r,r=n,n=t),ot.ajax({url:e,type:i,dataType:o,data:n,success:r})}}),ot.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(e){return ot.globalEval(e),e}}}),ot.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET")}),ot.ajaxTransport("script",function(e){if(e.crossDomain){var t,i;return{send:function(n,r){t=ot("<script>").prop({async:!0,charset:e.scriptCharset,src:e.url}).on("load error",i=function(e){t.remove(),i=null,e&&r("error"===e.type?404:200,e.type)}),$.head.appendChild(t[0])},abort:function(){i&&i()}}}});var Ei=[],xi=/(=)\?(?=&|$)|\?\?/;ot.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Ei.pop()||ot.expando+"_"+ai++;return this[e]=!0,e}}),ot.ajaxPrefilter("json jsonp",function(i,n,r){var o,s,a,l=i.jsonp!==!1&&(xi.test(i.url)?"url":"string"==typeof i.data&&!(i.contentType||"").indexOf("application/x-www-form-urlencoded")&&xi.test(i.data)&&"data");return l||"jsonp"===i.dataTypes[0]?(o=i.jsonpCallback=ot.isFunction(i.jsonpCallback)?i.jsonpCallback():i.jsonpCallback,l?i[l]=i[l].replace(xi,"$1"+o):i.jsonp!==!1&&(i.url+=(li.test(i.url)?"&":"?")+i.jsonp+"="+o),i.converters["script json"]=function(){return a||ot.error(o+" was not called"),a[0]},i.dataTypes[0]="json",s=e[o],e[o]=function(){a=arguments},r.always(function(){e[o]=s,i[o]&&(i.jsonpCallback=n.jsonpCallback,Ei.push(o)),a&&ot.isFunction(s)&&s(a[0]),a=s=t}),"script"):void 0}),ot.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var Ti=ot.ajaxSettings.xhr(),wi={0:200,1223:204},Ri=0,Si={};e.ActiveXObject&&ot(e).on("unload",function(){for(var e in Si)Si[e]();Si=t}),ot.support.cors=!!Ti&&"withCredentials"in Ti,ot.support.ajax=Ti=!!Ti,ot.ajaxTransport(function(e){var i;return ot.support.cors||Ti&&!e.crossDomain?{send:function(n,r){var o,s,a=e.xhr();if(a.open(e.type,e.url,e.async,e.username,e.password),e.xhrFields)for(o in e.xhrFields)a[o]=e.xhrFields[o];e.mimeType&&a.overrideMimeType&&a.overrideMimeType(e.mimeType),e.crossDomain||n["X-Requested-With"]||(n["X-Requested-With"]="XMLHttpRequest");for(o in n)a.setRequestHeader(o,n[o]);i=function(e){return function(){i&&(delete Si[s],i=a.onload=a.onerror=null,"abort"===e?a.abort():"error"===e?r(a.status||404,a.statusText):r(wi[a.status]||a.status,a.statusText,"string"==typeof a.responseText?{text:a.responseText}:t,a.getAllResponseHeaders()))}},a.onload=i(),a.onerror=i("error"),i=Si[s=Ri++]=i("abort"),a.send(e.hasContent&&e.data||null)},abort:function(){i&&i()}}:void 0});var Ci,Hi,Mi=/^(?:toggle|show|hide)$/,ki=new RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),Ai=/queueHooks$/,Pi=[L],Fi={"*":[function(e,t){var i=this.createTween(e,t),n=i.cur(),r=ki.exec(t),o=r&&r[3]||(ot.cssNumber[e]?"":"px"),s=(ot.cssNumber[e]||"px"!==o&&+n)&&ki.exec(ot.css(i.elem,e)),a=1,l=20;if(s&&s[3]!==o){o=o||s[3],r=r||[],s=+n||1;do a=a||".5",s/=a,ot.style(i.elem,e,s+o);while(a!==(a=i.cur()/n)&&1!==a&&--l)}return r&&(s=i.start=+s||+n||0,i.unit=o,i.end=r[1]?s+(r[1]+1)*r[2]:+r[2]),i}]};ot.Animation=ot.extend(N,{tweener:function(e,t){ot.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var i,n=0,r=e.length;r>n;n++)i=e[n],Fi[i]=Fi[i]||[],Fi[i].unshift(t)},prefilter:function(e,t){t?Pi.unshift(e):Pi.push(e)}}),ot.Tween=I,I.prototype={constructor:I,init:function(e,t,i,n,r,o){this.elem=e,this.prop=i,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=n,this.unit=o||(ot.cssNumber[i]?"":"px")},cur:function(){var e=I.propHooks[this.prop];return e&&e.get?e.get(this):I.propHooks._default.get(this)},run:function(e){var t,i=I.propHooks[this.prop];return this.pos=t=this.options.duration?ot.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):I.propHooks._default.set(this),this}},I.prototype.init.prototype=I.prototype,I.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=ot.css(e.elem,e.prop,""),t&&"auto"!==t?t:0):e.elem[e.prop]},set:function(e){ot.fx.step[e.prop]?ot.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[ot.cssProps[e.prop]]||ot.cssHooks[e.prop])?ot.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},I.propHooks.scrollTop=I.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},ot.each(["toggle","show","hide"],function(e,t){var i=ot.fn[t];ot.fn[t]=function(e,n,r){return null==e||"boolean"==typeof e?i.apply(this,arguments):this.animate(O(t,!0),e,n,r)}}),ot.fn.extend({fadeTo:function(e,t,i,n){return this.filter(_).css("opacity",0).show().end().animate({opacity:t},e,i,n)},animate:function(e,t,i,n){var r=ot.isEmptyObject(e),o=ot.speed(t,i,n),s=function(){var t=N(this,ot.extend({},e),o);(r||gt.get(this,"finish"))&&t.stop(!0)};return s.finish=s,r||o.queue===!1?this.each(s):this.queue(o.queue,s)},stop:function(e,i,n){var r=function(e){var t=e.stop;delete e.stop,t(n)};return"string"!=typeof e&&(n=i,i=e,e=t),i&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,i=null!=e&&e+"queueHooks",o=ot.timers,s=gt.get(this);if(i)s[i]&&s[i].stop&&r(s[i]);else for(i in s)s[i]&&s[i].stop&&Ai.test(i)&&r(s[i]);for(i=o.length;i--;)o[i].elem!==this||null!=e&&o[i].queue!==e||(o[i].anim.stop(n),t=!1,o.splice(i,1));(t||!n)&&ot.dequeue(this,e)})},finish:function(e){return e!==!1&&(e=e||"fx"),this.each(function(){var t,i=gt.get(this),n=i[e+"queue"],r=i[e+"queueHooks"],o=ot.timers,s=n?n.length:0;for(i.finish=!0,ot.queue(this,e,[]),r&&r.stop&&r.stop.call(this,!0),t=o.length;t--;)o[t].elem===this&&o[t].queue===e&&(o[t].anim.stop(!0),o.splice(t,1));for(t=0;s>t;t++)n[t]&&n[t].finish&&n[t].finish.call(this);delete i.finish})}}),ot.each({slideDown:O("show"),slideUp:O("hide"),slideToggle:O("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){ot.fn[e]=function(e,i,n){return this.animate(t,e,i,n)}}),ot.speed=function(e,t,i){var n=e&&"object"==typeof e?ot.extend({},e):{complete:i||!i&&t||ot.isFunction(e)&&e,duration:e,easing:i&&t||t&&!ot.isFunction(t)&&t};return n.duration=ot.fx.off?0:"number"==typeof n.duration?n.duration:n.duration in ot.fx.speeds?ot.fx.speeds[n.duration]:ot.fx.speeds._default,(null==n.queue||n.queue===!0)&&(n.queue="fx"),n.old=n.complete,n.complete=function(){ot.isFunction(n.old)&&n.old.call(this),n.queue&&ot.dequeue(this,n.queue)},n},ot.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},ot.timers=[],ot.fx=I.prototype.init,ot.fx.tick=function(){var e,i=ot.timers,n=0;for(Ci=ot.now();n<i.length;n++)e=i[n],e()||i[n]!==e||i.splice(n--,1);i.length||ot.fx.stop(),Ci=t},ot.fx.timer=function(e){e()&&ot.timers.push(e)&&ot.fx.start()},ot.fx.interval=13,ot.fx.start=function(){Hi||(Hi=setInterval(ot.fx.tick,ot.fx.interval))},ot.fx.stop=function(){clearInterval(Hi),Hi=null},ot.fx.speeds={slow:600,fast:200,_default:400},ot.fx.step={},ot.expr&&ot.expr.filters&&(ot.expr.filters.animated=function(e){return ot.grep(ot.timers,function(t){return e===t.elem}).length}),ot.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){ot.offset.setOffset(this,e,t)});var i,n,r=this[0],o={top:0,left:0},s=r&&r.ownerDocument;if(s)return i=s.documentElement,ot.contains(i,r)?(typeof r.getBoundingClientRect!==j&&(o=r.getBoundingClientRect()),n=V(s),{top:o.top+n.pageYOffset-i.clientTop,left:o.left+n.pageXOffset-i.clientLeft}):o},ot.offset={setOffset:function(e,t,i){var n,r,o,s,a,l,h,c=ot.css(e,"position"),u=ot(e),d={};"static"===c&&(e.style.position="relative"),a=u.offset(),o=ot.css(e,"top"),l=ot.css(e,"left"),h=("absolute"===c||"fixed"===c)&&(o+l).indexOf("auto")>-1,h?(n=u.position(),s=n.top,r=n.left):(s=parseFloat(o)||0,r=parseFloat(l)||0),ot.isFunction(t)&&(t=t.call(e,i,a)),null!=t.top&&(d.top=t.top-a.top+s),null!=t.left&&(d.left=t.left-a.left+r),"using"in t?t.using.call(e,d):u.css(d)}},ot.fn.extend({position:function(){if(this[0]){var e,t,i=this[0],n={top:0,left:0};return"fixed"===ot.css(i,"position")?t=i.getBoundingClientRect():(e=this.offsetParent(),t=this.offset(),ot.nodeName(e[0],"html")||(n=e.offset()),n.top+=ot.css(e[0],"borderTopWidth",!0),n.left+=ot.css(e[0],"borderLeftWidth",!0)),{top:t.top-n.top-ot.css(i,"marginTop",!0),left:t.left-n.left-ot.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||G;e&&!ot.nodeName(e,"html")&&"static"===ot.css(e,"position");)e=e.offsetParent;return e||G})}}),ot.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(i,n){var r="pageYOffset"===n;ot.fn[i]=function(o){return ot.access(this,function(i,o,s){var a=V(i);return s===t?a?a[n]:i[o]:(a?a.scrollTo(r?e.pageXOffset:s,r?s:e.pageYOffset):i[o]=s,void 0)},i,o,arguments.length,null)}}),ot.each({Height:"height",Width:"width"},function(e,i){ot.each({padding:"inner"+e,content:i,"":"outer"+e},function(n,r){ot.fn[r]=function(r,o){var s=arguments.length&&(n||"boolean"!=typeof r),a=n||(r===!0||o===!0?"margin":"border");return ot.access(this,function(i,n,r){var o;return ot.isWindow(i)?i.document.documentElement["client"+e]:9===i.nodeType?(o=i.documentElement,Math.max(i.body["scroll"+e],o["scroll"+e],i.body["offset"+e],o["offset"+e],o["client"+e])):r===t?ot.css(i,n,a):ot.style(i,n,r,a)},i,s?r:t,s,null)}})}),ot.fn.size=function(){return this.length},ot.fn.andSelf=ot.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=ot:"function"==typeof define&&define.amd&&define("jquery",[],function(){return ot}),"object"==typeof e&&"object"==typeof e.document&&(e.jQuery=e.$=ot)}(window),function(){var e,t=this,i=t.Backbone,n=Array.prototype.slice,r=Array.prototype.splice;e="undefined"!=typeof exports?exports:t.Backbone={},e.VERSION="0.9.2";var o=t._;o||"undefined"==typeof require||(o=require("underscore"));var s=t.jQuery||t.Zepto||t.ender;e.setDomLibrary=function(e){s=e},e.noConflict=function(){return t.Backbone=i,this},e.emulateHTTP=!1,e.emulateJSON=!1;var a=/\s+/,l=e.Events={on:function(e,t,i){var n,r,o,s,l;if(!t)return this;for(e=e.split(a),n=this._callbacks||(this._callbacks={});r=e.shift();)l=n[r],o=l?l.tail:{},o.next=s={},o.context=i,o.callback=t,n[r]={tail:s,next:l?l.next:o};return this},off:function(e,t,i){var n,r,s,l,h,c;if(r=this._callbacks){if(!(e||t||i))return delete this._callbacks,this;for(e=e?e.split(a):o.keys(r);n=e.shift();)if(s=r[n],delete r[n],s&&(t||i))for(l=s.tail;(s=s.next)!==l;)h=s.callback,c=s.context,(t&&h!==t||i&&c!==i)&&this.on(n,h,c);return this}},trigger:function(e){var t,i,r,o,s,l,h;if(!(r=this._callbacks))return this;for(l=r.all,e=e.split(a),h=n.call(arguments,1);t=e.shift();){if(i=r[t])for(o=i.tail;(i=i.next)!==o;)i.callback.apply(i.context||this,h);if(i=l)for(o=i.tail,s=[t].concat(h);(i=i.next)!==o;)i.callback.apply(i.context||this,s)}return this}};l.bind=l.on,l.unbind=l.off;var h=e.Model=function(e,t){var i;e||(e={}),t&&t.parse&&(e=this.parse(e)),(i=S(this,"defaults"))&&(e=o.extend({},i,e)),t&&t.collection&&(this.collection=t.collection),this.attributes={},this._escapedAttributes={},this.cid=o.uniqueId("c"),this.changed={},this._silent={},this._pending={},this.set(e,{silent:!0}),this.changed={},this._silent={},this._pending={},this._previousAttributes=o.clone(this.attributes),this.initialize.apply(this,arguments)};o.extend(h.prototype,l,{changed:null,_silent:null,_pending:null,idAttribute:"id",initialize:function(){},toJSON:function(){return o.clone(this.attributes)},get:function(e){return this.attributes[e]},escape:function(e){var t;if(t=this._escapedAttributes[e])return t;var i=this.get(e);return this._escapedAttributes[e]=o.escape(null==i?"":""+i)},has:function(e){return null!=this.get(e)},set:function(e,t,i){var n,r,s;if(o.isObject(e)||null==e?(n=e,i=t):(n={},n[e]=t),i||(i={}),!n)return this;if(n instanceof h&&(n=n.attributes),i.unset)for(r in n)n[r]=void 0;if(!this._validate(n,i))return!1;this.idAttribute in n&&(this.id=n[this.idAttribute]);var a=i.changes={},l=this.attributes,c=this._escapedAttributes,u=this._previousAttributes||{};for(r in n)s=n[r],(!o.isEqual(l[r],s)||i.unset&&o.has(l,r))&&(delete c[r],(i.silent?this._silent:a)[r]=!0),i.unset?delete l[r]:l[r]=s,o.isEqual(u[r],s)&&o.has(l,r)==o.has(u,r)?(delete this.changed[r],delete this._pending[r]):(this.changed[r]=s,i.silent||(this._pending[r]=!0));return i.silent||this.change(i),this},unset:function(e,t){return(t||(t={})).unset=!0,this.set(e,null,t)},clear:function(e){return(e||(e={})).unset=!0,this.set(o.clone(this.attributes),e)},fetch:function(t){t=t?o.clone(t):{};var i=this,n=t.success;return t.success=function(e,r,o){return i.set(i.parse(e,o),t)?(n&&n(i,e),void 0):!1},t.error=e.wrapError(t.error,i,t),(this.sync||e.sync).call(this,"read",this,t)},save:function(t,i,n){var r,s;if(o.isObject(t)||null==t?(r=t,n=i):(r={},r[t]=i),n=n?o.clone(n):{},n.wait){if(!this._validate(r,n))return!1;s=o.clone(this.attributes)}var a=o.extend({},n,{silent:!0});if(r&&!this.set(r,n.wait?a:n))return!1;var l=this,h=n.success;n.success=function(e,t,i){var s=l.parse(e,i);return n.wait&&(delete n.wait,s=o.extend(r||{},s)),l.set(s,n)?(h?h(l,e):l.trigger("sync",l,e,n),void 0):!1},n.error=e.wrapError(n.error,l,n);var c=this.isNew()?"create":"update",u=(this.sync||e.sync).call(this,c,this,n);return n.wait&&this.set(s,a),u},destroy:function(t){t=t?o.clone(t):{};var i=this,n=t.success,r=function(){i.trigger("destroy",i,i.collection,t)};if(this.isNew())return r(),!1;t.success=function(e){t.wait&&r(),n?n(i,e):i.trigger("sync",i,e,t)},t.error=e.wrapError(t.error,i,t);var s=(this.sync||e.sync).call(this,"delete",this,t);return t.wait||r(),s},url:function(){var e=S(this,"urlRoot")||S(this.collection,"url")||C();return this.isNew()?e:e+("/"==e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(e){e||(e={});var t=this._changing;this._changing=!0;for(var i in this._silent)this._pending[i]=!0;var n=o.extend({},e.changes,this._silent);this._silent={};for(var i in n)this.trigger("change:"+i,this,this.get(i),e);if(t)return this;for(;!o.isEmpty(this._pending);){this._pending={},this.trigger("change",this,e);for(var i in this.changed)this._pending[i]||this._silent[i]||delete this.changed[i];this._previousAttributes=o.clone(this.attributes)}return this._changing=!1,this},hasChanged:function(e){return arguments.length?o.has(this.changed,e):!o.isEmpty(this.changed)},changedAttributes:function(e){if(!e)return this.hasChanged()?o.clone(this.changed):!1;var t,i=!1,n=this._previousAttributes;for(var r in e)o.isEqual(n[r],t=e[r])||((i||(i={}))[r]=t);return i},previous:function(e){return arguments.length&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return o.clone(this._previousAttributes)},isValid:function(){return!this.validate(this.attributes)},_validate:function(e,t){if(t.silent||!this.validate)return!0;e=o.extend({},this.attributes,e);var i=this.validate(e,t);return i?(t&&t.error?t.error(this,i,t):this.trigger("error",this,i,t),!1):!0}});var c=e.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,{silent:!0,parse:t.parse})};o.extend(c.prototype,l,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},add:function(e,t){var i,n,s,a,l,h,c={},u={},d=[];for(t||(t={}),e=o.isArray(e)?e.slice():[e],i=0,s=e.length;s>i;i++){if(!(a=e[i]=this._prepareModel(e[i],t)))throw new Error("Can't add an invalid model to a collection");l=a.cid,h=a.id,c[l]||this._byCid[l]||null!=h&&(u[h]||this._byId[h])?d.push(i):c[l]=u[h]=a}for(i=d.length;i--;)e.splice(d[i],1);for(i=0,s=e.length;s>i;i++)(a=e[i]).on("all",this._onModelEvent,this),this._byCid[a.cid]=a,null!=a.id&&(this._byId[a.id]=a);if(this.length+=s,n=null!=t.at?t.at:this.models.length,r.apply(this.models,[n,0].concat(e)),this.comparator&&this.sort({silent:!0}),t.silent)return this;for(i=0,s=this.models.length;s>i;i++)c[(a=this.models[i]).cid]&&(t.index=i,a.trigger("add",a,this,t));return this},remove:function(e,t){var i,n,r,s;for(t||(t={}),e=o.isArray(e)?e.slice():[e],i=0,n=e.length;n>i;i++)s=this.getByCid(e[i])||this.get(e[i]),s&&(delete this._byId[s.id],delete this._byCid[s.cid],r=this.indexOf(s),this.models.splice(r,1),this.length--,t.silent||(t.index=r,s.trigger("remove",s,this,t)),this._removeReference(s));return this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,t),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,o.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},get:function(e){return null==e?void 0:this._byId[null!=e.id?e.id:e]},getByCid:function(e){return e&&this._byCid[e.cid||e]},at:function(e){return this.models[e]},where:function(e){return o.isEmpty(e)?[]:this.filter(function(t){for(var i in e)if(e[i]!==t.get(i))return!1;return!0})},sort:function(e){if(e||(e={}),!this.comparator)throw new Error("Cannot sort a set without a comparator");var t=o.bind(this.comparator,this);return 1==this.comparator.length?this.models=this.sortBy(t):this.models.sort(t),e.silent||this.trigger("reset",this,e),this},pluck:function(e){return o.map(this.models,function(t){return t.get(e)})},reset:function(e,t){e||(e=[]),t||(t={});for(var i=0,n=this.models.length;n>i;i++)this._removeReference(this.models[i]);return this._reset(),this.add(e,o.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},fetch:function(t){t=t?o.clone(t):{},void 0===t.parse&&(t.parse=!0);var i=this,n=t.success;return t.success=function(e,r,o){i[t.add?"add":"reset"](i.parse(e,o),t),n&&n(i,e)},t.error=e.wrapError(t.error,i,t),(this.sync||e.sync).call(this,"read",this,t)},create:function(e,t){var i=this;if(t=t?o.clone(t):{},e=this._prepareModel(e,t),!e)return!1;t.wait||i.add(e,t);var n=t.success;return t.success=function(r,o){t.wait&&i.add(r,t),n?n(r,o):r.trigger("sync",e,o,t)},e.save(null,t),e},parse:function(e){return e},chain:function(){return o(this.models).chain()},_reset:function(){this.length=0,this.models=[],this._byId={},this._byCid={}},_prepareModel:function(e,t){if(t||(t={}),e instanceof h)e.collection||(e.collection=this);else{var i=e;t.collection=this,e=new this.model(i,t),e._validate(e.attributes,t)||(e=!1)}return e},_removeReference:function(e){this==e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,i,n){("add"!=e&&"remove"!=e||i==this)&&("destroy"==e&&this.remove(t,n),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],this._byId[t.id]=t),this.trigger.apply(this,arguments))}});var u=["forEach","each","map","reduce","reduceRight","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","sortBy","sortedIndex","toArray","size","first","initial","rest","last","without","indexOf","shuffle","lastIndexOf","isEmpty","groupBy"];o.each(u,function(e){c.prototype[e]=function(){return o[e].apply(o,[this.models].concat(o.toArray(arguments)))}});var d=e.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},p=/:\w+/g,f=/\*\w+/g,m=/[-[\]{}()+?.,\\^$|#\s]/g;o.extend(d.prototype,l,{initialize:function(){},route:function(t,i,n){return e.history||(e.history=new g),o.isRegExp(t)||(t=this._routeToRegExp(t)),n||(n=this[i]),e.history.route(t,o.bind(function(r){var o=this._extractParameters(t,r);n&&n.apply(this,o),this.trigger.apply(this,["route:"+i].concat(o)),e.history.trigger("route",this,i,o)},this)),this},navigate:function(t,i){e.history.navigate(t,i)},_bindRoutes:function(){if(this.routes){var e=[];for(var t in this.routes)e.unshift([t,this.routes[t]]);for(var i=0,n=e.length;n>i;i++)this.route(e[i][0],e[i][1],this[e[i][1]])}},_routeToRegExp:function(e){return e=e.replace(m,"\\$&").replace(p,"([^/]+)").replace(f,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){return e.exec(t).slice(1)}});var g=e.History=function(){this.handlers=[],o.bindAll(this,"checkUrl")},v=/^[#\/]/,y=/msie [\w.]+/;g.started=!1,o.extend(g.prototype,l,{interval:50,getHash:function(e){var t=e?e.location:window.location,i=t.href.match(/#(.*)$/);return i?i[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||t){e=window.location.pathname;var i=window.location.search;i&&(e+=i)}else e=this.getHash();return e.indexOf(this.options.root)||(e=e.substr(this.options.root.length)),e.replace(v,"")},start:function(e){if(g.started)throw new Error("Backbone.history has already been started");g.started=!0,this.options=o.extend({},{root:"/"},this.options,e),this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&window.history&&window.history.pushState);var t=this.getFragment(),i=document.documentMode,n=y.exec(navigator.userAgent.toLowerCase())&&(!i||7>=i);n&&(this.iframe=s('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(t)),this._hasPushState?s(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!n?s(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=t;var r=window.location,a=r.pathname==this.options.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),window.location.replace(this.options.root+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&r.hash&&(this.fragment=this.getHash().replace(v,""),window.history.replaceState({},document.title,r.protocol+"//"+r.host+this.options.root+this.fragment)),this.options.silent?void 0:this.loadUrl())},stop:function(){s(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),g.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(){var e=this.getFragment();return e==this.fragment&&this.iframe&&(e=this.getFragment(this.getHash(this.iframe))),e==this.fragment?!1:(this.iframe&&this.navigate(e),this.loadUrl()||this.loadUrl(this.getHash()),void 0)},loadUrl:function(e){var t=this.fragment=this.getFragment(e),i=o.any(this.handlers,function(e){return e.route.test(t)?(e.callback(t),!0):void 0});return i},navigate:function(e,t){if(!g.started)return!1;t&&t!==!0||(t={trigger:t});var i=(e||"").replace(v,"");this.fragment!=i&&(this._hasPushState?(0!=i.indexOf(this.options.root)&&(i=this.options.root+i),this.fragment=i,window.history[t.replace?"replaceState":"pushState"]({},document.title,i)):this._wantsHashChange?(this.fragment=i,this._updateHash(window.location,i,t.replace),this.iframe&&i!=this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,i,t.replace))):window.location.assign(this.options.root+e),t.trigger&&this.loadUrl(e))
},_updateHash:function(e,t,i){i?e.replace(e.toString().replace(/(javascript:|#).*$/,"")+"#"+t):e.hash=t}});var _=e.View=function(e){this.cid=o.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},b=/^(\S+)\s*(.*)$/,E=["model","collection","el","id","attributes","className","tagName"];o.extend(_.prototype,l,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this},make:function(e,t,i){var n=document.createElement(e);return t&&s(n).attr(t),i&&s(n).html(i),n},setElement:function(e,t){return this.$el&&this.undelegateEvents(),this.$el=e instanceof s?e:s(e),this.el=this.$el[0],t!==!1&&this.delegateEvents(),this},delegateEvents:function(e){if(e||(e=S(this,"events"))){this.undelegateEvents();for(var t in e){var i=e[t];if(o.isFunction(i)||(i=this[e[t]]),!i)throw new Error('Method "'+e[t]+'" does not exist');var n=t.match(b),r=n[1],s=n[2];i=o.bind(i,this),r+=".delegateEvents"+this.cid,""===s?this.$el.bind(r,i):this.$el.delegate(s,r,i)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(e){this.options&&(e=o.extend({},this.options,e));for(var t=0,i=E.length;i>t;t++){var n=E[t];e[n]&&(this[n]=e[n])}this.options=e},_ensureElement:function(){if(this.el)this.setElement(this.el,!1);else{var e=S(this,"attributes")||{};this.id&&(e.id=this.id),this.className&&(e["class"]=this.className),this.setElement(this.make(this.tagName,e),!1)}}});var x=function(e,t){var i=R(this,e,t);return i.extend=this.extend,i};h.extend=c.extend=d.extend=_.extend=x;var T={create:"POST",update:"PUT","delete":"DELETE",read:"GET"};e.sync=function(t,i,n){var r=T[t];n||(n={});var a={type:r,dataType:"json"};return n.url||(a.url=S(i,"url")||C()),n.data||!i||"create"!=t&&"update"!=t||(a.contentType="application/json",a.data=JSON.stringify(i.toJSON())),e.emulateJSON&&(a.contentType="application/x-www-form-urlencoded",a.data=a.data?{model:a.data}:{}),e.emulateHTTP&&("PUT"===r||"DELETE"===r)&&(e.emulateJSON&&(a.data._method=r),a.type="POST",a.beforeSend=function(e){e.setRequestHeader("X-HTTP-Method-Override",r)}),"GET"===a.type||e.emulateJSON||(a.processData=!1),s.ajax(o.extend(a,n))},e.wrapError=function(e,t,i){return function(n,r){r=n===t?r:n,e?e(t,r,i):t.trigger("error",t,r,i)}};var w=function(){},R=function(e,t,i){var n;return n=t&&t.hasOwnProperty("constructor")?t.constructor:function(){e.apply(this,arguments)},o.extend(n,e),w.prototype=e.prototype,n.prototype=new w,t&&o.extend(n.prototype,t),i&&o.extend(n,i),n.prototype.constructor=n,n.__super__=e.prototype,n},S=function(e,t){return e&&e[t]?o.isFunction(e[t])?e[t]():e[t]:null},C=function(){throw new Error('A "url" property or function must be specified')}}.call(this),define("Backbone",["Underscore","jquery"],function(e){return function(){var t;return t||e.Backbone}}(this)),function(){define("cs!threenodes/utils/Utils",["require"],function(){var e;return e=function(){function e(){}return e.flatArraysAreEquals=function(e,t){var i,n,r,o;if(e.length!==t.length)return!1;for(i=r=0,o=e.length;o>r;i=++r)if(n=e[i],e[i]!==t[i])return!1;return!0},e}()})}.call(this),function(){define("cs!threenodes/utils/Indexer",["require"],function(){var e;return e=function(){function e(){this.uid=0}return e.prototype.getUID=function(e){return null==e&&(e=!0),e?this.uid+=1:this.uid},e.prototype.reset=function(){return this.uid=0},e}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/fields/models/Field",["require","Underscore","Backbone","cs!threenodes/utils/Indexer"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V,B,U,j,W,G;return R=t("Underscore"),o=t("Backbone"),p=t("cs!threenodes/utils/Indexer"),namespace("ThreeNodes",{NodeField:g=function(t){function n(){return this.onValueChanged=e(this.onValueChanged,this),this.removeConnections=e(this.removeConnections,this),this.unregisterConnection=e(this.unregisterConnection,this),this.addConnection=e(this.addConnection,this),this.computeValue=e(this.computeValue,this),this.renderConnections=e(this.renderConnections,this),this.toJSON=e(this.toJSON,this),this.isAnimationProperty=e(this.isAnimationProperty,this),this.getSliceCount=e(this.getSliceCount,this),this.isConnected=e(this.isConnected,this),this.isChanged=e(this.isChanged,this),this.getValue=e(this.getValue,this),this.setValue=e(this.setValue,this),this.remove=e(this.remove,this),this.initialize=e(this.initialize,this),this.load=e(this.load,this),this.set=e(this.set,this),this._validate=e(this._validate,this),this.sync=e(this.sync,this),S=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.STATIC_INDEXER=new p,n.prototype.defaults=function(){return{fid:-1,name:"fieldname",machine_name:"fieldname-nid",is_output:!1,value:0,"default":null}},n.prototype.sync=function(){},n.prototype._validate=function(){return!0},n.prototype.set=function(e,t,i){return null==i&&(i={}),"value"===e?(this.attributes[e]=t,this):n.__super__.set.apply(this,arguments)},n.prototype.load=function(e){var t;if(e||e===!1){if("object"!==$.type(e))this.setValue(e);else for(t in e)this.attributes.value[t]=e[t];return this}},n.prototype.initialize=function(e){var t,i;return i=this,this.node=e.node,this.subfield=e.subfield,t=e.indexer||ThreeNodes.NodeField.STATIC_INDEXER,this.changed=!0,this.connections=[],this.on_value_update_hooks={},this.set("machine_name",this.get("name")),this.subfield&&this.subfield.node&&this.set("machine_name",this.get("name")+"-"+this.subfield.node.get("nid")),-1===this.get("fid")?this.set("fid",t.getUID()):void 0},n.prototype.remove=function(){return delete this.on_value_update_hooks,delete this.node,delete this.connections,delete this.button,delete this.subfield,this.destroy()},n.prototype.setValue=function(e){var t,i,n,o,s,a,l,h,c,u;this.changed=!0,a=function(e){return e.dirty=!0,e.parent?a(e.parent):void 0},this.node&&a(this.node),s=this.attributes.value,o=this.onValueChanged(e),"array"===$.type(o)&&(l=R.filter(o,function(e){return null!==e}),o=this.constructor===r?l:0!==l.length?l:null),null===o&&(i=this.attributes["default"],null!==i&&void 0!==i&&(s=i),o=s),this.attributes.value=o,this.trigger("value_updated",o);for(n in this.on_value_update_hooks)this.on_value_update_hooks[n](o);if(this.attributes.is_output===!0)for(u=this.connections,h=0,c=u.length;c>h;h++)t=u[h],t.to_field.setValue(o);return!0},n.prototype.getValue=function(e){var t;return null==e&&(e=0),t=this.attributes.value,"array"!==$.type(t)?t:t[e%t.length]},n.prototype.isChanged=function(){var e;return e=this.changed,this.changed=!1,e},n.prototype.isConnected=function(){return this.connections.length>0},n.prototype.getSliceCount=function(){var e;return e=this.attributes.value,"array"!==jQuery.type(e)?1:e.length},n.prototype.isAnimationProperty=function(){return this.constructor===c||this.constructor===s?!0:!1},n.prototype.toJSON=function(){var e,t,i;return e={name:this.get("name")},this.subfield&&(e.nid=this.subfield.node.get("nid")),t=this.get("value"),i=jQuery.type(t),"object"!==i&&"array"!==i&&(e.val=t),"object"===i&&(t.constructor===THREE.Vector2||t.constructor===THREE.Vector3||t.constructor===THREE.Vector4||t.constructor===THREE.Color)&&(e.val=t),e},n.prototype.renderConnections=function(){var e,t,i,n;for(n=this.connections,t=0,i=n.length;i>t;t++)e=n[t],e.render();return!0},n.prototype.computeValue=function(e){return e},n.prototype.addConnection=function(e){return-1===this.connections.indexOf(e)&&(this.connections.push(e),this.get("is_output")===!0&&this.node.addOutConnection(e,this),this.node.disablePropertyAnim(this)),e},n.prototype.unregisterConnection=function(e){var t;return this.node.removeConnection(e),t=this.connections.indexOf(e),-1!==t&&this.connections.splice(t,1),0===this.connections.length?this.node.enablePropertyAnim(this):void 0},n.prototype.removeConnections=function(){var e;for(e=[];this.connections.length>0;)e.push(this.connections[0].remove());return e},n.prototype.onValueChanged=function(e){var t;return t=this,"array"===$.type(e)?R.map(e,function(e){return t.computeValue(e)}):this.computeValue(e)},n}(o.Model)}),namespace("ThreeNodes.fields",{Any:n=function(t){function n(){return this.onValueChanged=e(this.onValueChanged,this),this.computeValue=e(this.computeValue,this),C=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return e},n.prototype.onValueChanged=function(e){return e},n}(g),Array:r=function(t){function n(){return this.getValue=e(this.getValue,this),this.onValueChanged=e(this.onValueChanged,this),this.removeConnections=e(this.removeConnections,this),this.computeValue=e(this.computeValue,this),I=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return e&&e!==!1?"array"===$.type(e)?e:[e]:[]},n.prototype.removeConnections=function(){return n.__super__.removeConnections.apply(this,arguments),this.get("is_output")===!1?this.setValue([]):void 0},n.prototype.onValueChanged=function(e){return this.computeValue(e)},n.prototype.getValue=function(e){return null==e&&(e=0),this.get("value")},n}(g),Bool:s=function(t){function n(){return this.computeValue=e(this.computeValue,this),O=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){switch($.type(e)){case"boolean":return e;case"number":return 0!==e;case"string":return"1"===e}return null},n}(g),String:b=function(t){function n(){return this.computeValue=e(this.computeValue,this),V=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){switch($.type(e)){case"array":return e;case"number":return e.toString;case"string":return e}return null},n}(g),Float:c=function(t){function n(){return this.computeValue=e(this.computeValue,this),B=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){switch($.type(e)){case"number":case"string":return parseFloat(e);case"object":if(e.constructor===THREE.Vector2||e.constructor===THREE.Vector3)return e;break;case"boolean":return e===!0?1:0}return null},n}(g),Vector2:x=function(t){function n(){return this.computeValue=e(this.computeValue,this),U=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e.constructor===THREE.Vector2?e:null},n}(g),Vector3:T=function(t){function n(){return this.computeValue=e(this.computeValue,this),j=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e.constructor===THREE.Vector3?e:null},n}(g),Vector4:w=function(t){function n(){return this.computeValue=e(this.computeValue,this),W=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e.constructor===THREE.Vector4?e:null},n}(g),Quaternion:y=function(t){function n(){return this.computeValue=e(this.computeValue,this),G=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e.constructor===THREE.Quaternion?e:null},n}(g),Euler:h=function(t){function n(){return this.computeValue=e(this.computeValue,this),H=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e.constructor===THREE.Euler?e:null},n}(g),Color:l=function(t){function n(){return this.computeValue=e(this.computeValue,this),M=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){switch($.type(e)){case"number":return(new THREE.Color).setRGB(e,e,e);case"object":switch(e.constructor){case THREE.Color:return e;case THREE.Vector3:return(new THREE.Color).setRGB(e.x,e.y,e.z)}break;case"boolean":return e?new THREE.Color(16777215):new THREE.Color(0)}return null},n}(g),Object3D:v=function(t){function n(){return this.computeValue=e(this.computeValue,this),k=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e.constructor===THREE.Object3D||e instanceof THREE.Object3D)?e:null},n}(g),Scene:_=function(t){function n(){return this.computeValue=e(this.computeValue,this),A=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&e instanceof THREE.Scene?e:null},n}(g),Camera:a=function(t){function n(){return this.computeValue=e(this.computeValue,this),P=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e instanceof THREE.Camera||e instanceof THREE.PerspectiveCamera||e instanceof THREE.OrthographicCamera)?e:null},n}(g),Mesh:m=function(t){function n(){return this.computeValue=e(this.computeValue,this),F=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e.constructor===THREE.Mesh||e instanceof THREE.Mesh)?e:null},n}(g),Geometry:d=function(t){function n(){return this.computeValue=e(this.computeValue,this),D=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e.constructor===THREE.Geometry||e instanceof THREE.Geometry)?e:null},n}(g),Material:f=function(t){function n(){return this.computeValue=e(this.computeValue,this),N=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e.constructor===THREE.Material||e instanceof THREE.Material)?e:null},n}(g),Texture:E=function(t){function n(){return this.computeValue=e(this.computeValue,this),z=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"===$.type(e)&&(e.constructor===THREE.Texture||e instanceof THREE.Texture)?e:null},n}(g),Fog:u=function(t){function n(){return this.computeValue=e(this.computeValue,this),L=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.computeValue=function(e){return"object"!==$.type(e)||e.constructor!==THREE.Fog&&e.constructor!==THREE.FogExp2?null:e},n}(g)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/fields/collections/Fields",["require","Underscore","Backbone","cs!../models/Field"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!../models/Field"),r=function(t){function n(){return this.renderSidebar=e(this.renderSidebar,this),this.addFields=e(this.addFields,this),this.addField=e(this.addField,this),this.removeConnections=e(this.removeConnections,this),this.renderConnections=e(this.renderConnections,this),this.setFieldInputUnchanged=e(this.setFieldInputUnchanged,this),this.hasUnconnectedFields=e(this.hasUnconnectedFields,this),this.hasUnconnectedOutputs=e(this.hasUnconnectedOutputs,this),this.hasUnconnectedInputs=e(this.hasUnconnectedInputs,this),this.getDownstreamNodes=e(this.getDownstreamNodes,this),this.getUpstreamNodes=e(this.getUpstreamNodes,this),this.getMaxInputSliceCount=e(this.getMaxInputSliceCount,this),this.setField=e(this.setField,this),this.getField=e(this.getField,this),this.toJSON=e(this.toJSON,this),this.load=e(this.load,this),this.destroy=e(this.destroy,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e,t){return n.__super__.initialize.apply(this,arguments),this.node=t.node,this.indexer=t.indexer,this.inputs={},this.outputs={},this.special_elements={left:[],center:[],right:[]},this.addFields(this.node.getFields())},n.prototype.destroy=function(){for(this.removeConnections();this.models.length>0;)this.models[0].remove();return delete this.node,delete this.inputs,delete this.outputs,delete this.indexer,delete this.special_elements},n.prototype.load=function(e){var t,i,n,r,o;if(!e||!e["in"])return!1;for(o=e["in"],n=0,r=o.length;r>n;n++)t=o[n],i=t.nid?this.inputs[t.name+"-"+t.nid]:this.inputs[t.name],i&&i.load(t.val);return!0},n.prototype.toJSON=function(){var e;return e={"in":jQuery.map(this.inputs,function(e){return e.toJSON()}),out:jQuery.map(this.outputs,function(e){return e.toJSON()})}},n.prototype.getField=function(e,t){var i;return null==t&&(t=!1),i=t===!0?"outputs":"inputs",this[i][e]},n.prototype.setField=function(e,t){return this.outputs[e]?this.outputs[e].setValue(t):void 0},n.prototype.getMaxInputSliceCount=function(){var e,t,i,n,r;i=1,r=this.inputs;for(t in r)e=r[t],n=e.attributes.value,n&&"array"===$.type(n)&&n.length>i&&(i=n.length);return i-1},n.prototype.getUpstreamNodes=function(){var e,t,i,n,r,o,s,a;n=[],s=this.inputs;for(i in s)for(t=s[i],a=t.connections,r=0,o=a.length;o>r;r++)e=a[r],n[n.length]=e.from_field.node;return n},n.prototype.getDownstreamNodes=function(){var e,t,i,n,r,o,s,a,l,h;for(n=[],l=this.outputs,t=r=0,s=l.length;s>r;t=++r)for(i=l[t],t=this.inputs[i],h=t.connections,o=0,a=h.length;a>o;o++)e=h[o],n[n.length]=e.to_field.node;return n},n.prototype.hasUnconnectedInputs=function(){var e,t,i;i=this.inputs;for(t in i)if(e=i[t],0===e.connections.length)return!0;return!1},n.prototype.hasUnconnectedOutputs=function(){var e,t,i;i=this.outputs;for(t in i)if(e=i[t],0===e.connections.length)return!0;return!1},n.prototype.hasUnconnectedFields=function(){return hasUnconnectedInputs()||hasUnconnectedOutputs()},n.prototype.setFieldInputUnchanged=function(){var e,t,i,n,r,o;for(r=this.inputs,o=[],i=0,n=r.length;n>i;i++)t=r[i],e=this.inputs[t],o.push(e.changed=!1);return o},n.prototype.renderConnections=function(){return this.invoke("renderConnections")},n.prototype.removeConnections=function(){return this.invoke("removeConnections")},n.prototype.addField=function(e,t,i){var n,r,o,s,a;return null==i&&(i="inputs"),n=!1,s="inputs"!==i,"object"!==$.type(t)&&(t=this.getFieldValueObject(t)),r=new ThreeNodes.fields[t.type]({name:e,value:t.val,possibilities:t.values,node:this.node,is_output:s,"default":t["default"],subfield:t.subfield,indexer:this.indexer}),a=r.get("is_output")===!1?"inputs":"outputs",o=r.get("name"),r.subfield&&(o+="-"+r.subfield.node.get("nid")),this[a][o]=r,this.add(r),r},n.prototype.addFields=function(e){var t,i,n;for(t in e)for(i in e[t])n=e[t][i],this.addField(i,n,t);return this},n.prototype.renderSidebar=function(){return this.trigger("renderSidebar"),this},n.prototype.getFieldValueObject=function(e){var t,i;return t=function(){switch($.type(e)){case"number":return"Float";case"boolean":return"Bool";default:return"String"}}(),i={type:t,val:e}},n}(n.Collection)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/Node",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/fields/collections/Fields"],function(t){var n,r,o,s,a,l;return a=t("Underscore"),n=t("Backbone"),s=t("cs!threenodes/utils/Utils"),r=t("cs!threenodes/fields/collections/Fields"),o=function(t){function n(){return this.createAnimContainer=e(this.createAnimContainer,this),this.enablePropertyAnim=e(this.enablePropertyAnim,this),this.disablePropertyAnim=e(this.disablePropertyAnim,this),this.removeConnection=e(this.removeConnection,this),this.addOutConnection=e(this.addOutConnection,this),this.applyFieldsToVal=e(this.applyFieldsToVal,this),this.toJSON=e(this.toJSON,this),this.getAnimationData=e(this.getAnimationData,this),this.hasPropertyTrackAnim=e(this.hasPropertyTrackAnim,this),this.getDownstreamNodes=e(this.getDownstreamNodes,this),this.getUpstreamNodes=e(this.getUpstreamNodes,this),this.hasOutConnection=e(this.hasOutConnection,this),this.getFields=e(this.getFields,this),this.inputValueHasChanged=e(this.inputValueHasChanged,this),this.createCacheObject=e(this.createCacheObject,this),this.addCountInput=e(this.addCountInput,this),this.createConnection=e(this.createConnection,this),this.loadAnimation=e(this.loadAnimation,this),this.remove=e(this.remove,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.typename=e(this.typename,this),this.initialize=e(this.initialize,this),l=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="",n.group_name="",n.prototype.defaults={nid:-1,gid:-1,x:0,y:0,width:null,height:null,name:""},n.prototype.initialize=function(e){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!1,this.delays_output=!1,this.dirty=!0,this.is_animated=!1,this.out_connections=[],this.apptimeline=e.timeline,this.settings=e.settings,this.indexer=e.indexer,this.options=e,this.parent=e.parent,""===this.get("name")&&this.set("name",this.typename()),-1===this.get("nid")?this.set("nid",this.indexer.getUID()):this.indexer.uid=this.get("nid"),this.fields=new r(!1,{node:this,indexer:this.indexer}),this.onFieldsCreated(),this.fields.load(this.options.fields),this.anim=this.createAnimContainer(),this.options.anim!==!1&&this.loadAnimation(),this},n.prototype.typename=function(){return String(this.constructor.name)},n.prototype.onFieldsCreated=function(){},n.prototype.remove=function(){return this.anim&&this.anim.destroy(),this.fields&&this.fields.destroy(),delete this.fields,delete this.apptimeline,delete this.anim,delete this.options,delete this.settings,delete this.indexer,delete this.fully_inited,this.destroy()},n.prototype.loadAnimation=function(){var e,t,i,n,r,o,s;s=this.options.anim;for(i in s){for(e=s[i],n=this.anim.getPropertyTrack(i),r=0,o=e.length;o>r;r++)t=e[r],n.keys.push({time:t.time,value:t.value,easing:Timeline.stringToEasingFunction(t.easing),track:n});this.anim.timeline.rebuildTrackAnimsFromKeys(n)}return!0},n.prototype.createConnection=function(e,t){return this.trigger("createConnection",e,t)},n.prototype.addCountInput=function(){return this.fields.addFields({inputs:{count:1}})},n.prototype.createCacheObject=function(e){var t,i,n,r,o;for(i={},r=0,o=e.length;o>r;r++)n=e[r],t=this.fields.getField(n),i[n]=t?t.attributes.value:!1;return i},n.prototype.inputValueHasChanged=function(e,t){var i,n,r,o,s;for(null==t&&(t=this.material_cache),o=0,s=e.length;s>o;o++){if(n=e[o],i=this.fields.getField(n),!i)return!1;if(r=i.attributes.value,r!==t[n])return!0}return!1},n.prototype.getFields=function(){return{}},n.prototype.hasOutConnection=function(){return 0!==this.out_connections.length},n.prototype.getUpstreamNodes=function(){return this.fields.getUpstreamNodes()},n.prototype.getDownstreamNodes=function(){return this.fields.getDownstreamNodes()},n.prototype.hasPropertyTrackAnim=function(){var e,t,i,n;for(n=this.anim.objectTrack.propertyTracks,t=0,i=n.length;i>t;t++)if(e=n[t],e.anims.length>0)return!0;return!1},n.prototype.getAnimationData=function(){var e,t,i,n,r,o,s,a,l,h;if(!this.anim||!this.anim.objectTrack||!this.anim.objectTrack.propertyTracks||this.hasPropertyTrackAnim()===!1)return!1;if(this.anim!==!1)for(n={},l=this.anim.objectTrack.propertyTracks,r=0,s=l.length;s>r;r++)for(i=l[r],n[i.propertyName]=[],h=i.keys,o=0,a=h.length;a>o;o++)e=h[o],t={time:e.time,value:e.value,easing:Timeline.easingFunctionToString(e.easing)},n[i.propertyName].push(t);return n},n.prototype.toJSON=function(){var e;return e={nid:this.get("nid"),name:this.get("name"),type:this.typename(),anim:this.getAnimationData(),x:this.get("x"),y:this.get("y"),width:this.get("width"),height:this.get("height"),fields:this.fields.toJSON()}},n.prototype.applyFieldsToVal=function(e,t,i,n){var r,o,s,a;null==i&&(i=[]),a=[];for(r in e)s=e[r],o=s.get("name"),-1===i.indexOf(o)?a.push(t[o]=this.fields.getField(o).getValue(n)):a.push(void 0);return a},n.prototype.addOutConnection=function(e){return-1===this.out_connections.indexOf(e)&&this.out_connections.push(e),e},n.prototype.removeConnection=function(e){var t;return t=this.out_connections.indexOf(e),-1!==t&&this.out_connections.splice(t,1),e},n.prototype.disablePropertyAnim=function(e){return this.anim&&e.get("is_output")===!1?this.anim.disableProperty(e.get("name")):void 0},n.prototype.enablePropertyAnim=function(e){return e.get("is_output")!==!0&&this.anim?e.isAnimationProperty()?this.anim.enableProperty(e.get("name")):void 0:!1},n.prototype.createAnimContainer=function(){var e,t,i;i=anim("nid-"+this.get("nid"),this.fields.inputs);for(e in this.fields.inputs)t=this.fields.inputs[e],t.isAnimationProperty()===!1&&this.disablePropertyAnim(t);return i},n}(n.Model)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/NodeNumberSimple",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/fields/collections/Fields","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h;return l=t("Underscore"),n=t("Backbone"),a=t("cs!threenodes/utils/Utils"),r=t("cs!threenodes/fields/collections/Fields"),o=t("cs!threenodes/nodes/models/Node"),s=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),h=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{"in":{type:"Float",val:0}},outputs:{out:{type:"Float",val:0}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return this.v_in=this.fields.getField("in"),this.v_out=this.fields.getField("out",!0)},n.prototype.process_val=function(e){return e},n.prototype.remove=function(){return delete this.v_in,delete this.v_out,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r;for(n=[],t=this.fields.getMaxInputSliceCount(),e=r=0;t>=0?t>=r:r>=t;e=t>=0?++r:--r)switch(i=this.v_in.getValue(e),$.type(i)){case"number":n[e]=this.process_val(i,e);break;case"object":switch(i.constructor){case THREE.Vector2:n[e].x=this.process_val(i.x,e),n[e].y=this.process_val(i.y,e);break;case THREE.Vector3:n[e].x=this.process_val(i.x,e),n[e].y=this.process_val(i.y,e),n[e].z=this.process_val(i.z,e)}}return this.v_out.setValue(n),!0},n}(o)})}.call(this),define("text",["module"],function(e){var t,i,n=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,o=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,s="undefined"!=typeof location&&location.href,a=s&&location.protocol&&location.protocol.replace(/\:/,""),l=s&&location.hostname,h=s&&(location.port||void 0),c=[],u=e.config();return t={version:"2.0.0",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(o);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")},createXhr:function(){var e,t,i;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t++){i=n[t];try{e=new ActiveXObject(i)}catch(r){}if(e){n=[i];break}}return e},parseName:function(e){var t=!1,i=e.indexOf("."),n=e.substring(0,i),r=e.substring(i+1,e.length);return i=r.indexOf("!"),-1!==i&&(t=r.substring(i+1,r.length),t="strip"===t,r=r.substring(0,i)),{moduleName:n,ext:r,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,i,n,r){var o,s,a,l=t.xdRegExp.exec(e);return l?(o=l[2],s=l[3],s=s.split(":"),a=s[1],s=s[0],!(o&&o!==i||s&&s!==n||(a||s)&&a!==r)):!0},finishLoad:function(e,i,n,r){n=i?t.strip(n):n,u.isBuild&&(c[e]=n),r(n)},load:function(e,i,n,r){if(r.isBuild&&!r.inlineText)return n(),void 0;u.isBuild=r.isBuild;var o=t.parseName(e),c=o.moduleName+"."+o.ext,d=i.toUrl(c),p=u.useXhr||t.useXhr;!s||p(d,a,l,h)?t.get(d,function(i){t.finishLoad(e,o.strip,i,n)},function(e){n.error&&n.error(e)}):i([c],function(e){t.finishLoad(o.moduleName+"."+o.ext,o.strip,e,n)})},write:function(e,i,n){if(c.hasOwnProperty(i)){var r=t.jsEscape(c[i]);n.asModule(e+"!"+i,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,i,n,r,o){var s=t.parseName(i),a=s.moduleName+"."+s.ext,l=n.toUrl(s.moduleName+"."+s.ext)+".js";t.load(a,n,function(){var i=function(e){return r(l,e)};i.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,a,i,o)},o)}},"undefined"!=typeof process&&process.versions&&process.versions.node?(i=require.nodeRequire("fs"),t.get=function(e,t){var n=i.readFileSync(e,"utf8");0===n.indexOf("")&&(n=n.substring(1)),t(n)}):t.createXhr()?t.get=function(e,i,n){var r=t.createXhr();r.open("GET",e,!0),u.onXhr&&u.onXhr(r,e),r.onreadystatechange=function(){var t,o;4===r.readyState&&(t=r.status,t>399&&600>t?(o=new Error(e+" HTTP status: "+t),o.xhr=r,n(o)):i(r.responseText))},r.send(null)}:"undefined"!=typeof Packages&&(t.get=function(e,t){var i,n,r="utf-8",o=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),a=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(o),r)),l="";try{for(i=new java.lang.StringBuffer,n=a.readLine(),n&&n.length()&&65279===n.charAt(0)&&(n=n.substring(1)),i.append(n);null!==(n=a.readLine());)i.append(s),i.append(n);l=String(i.toString())}finally{a.close()}t(l)}),t}),define("text!threenodes/nodes/templates/node.tmpl.html",[],function(){return"<div class='head'><span><%= get(\"name\") %></span></div>\n<div class='options'>\n  <div class='inputs'></div>\n  <div class='center'></div>\n  <div class='outputs'></div>\n</div>\n"}),define("text!threenodes/nodes/templates/node_context_menu.tmpl.html",[],function(){return'<ul id="node-context-menu" class="context-menu">\n  <li><a href="#remove_node">Remove node</a></li>\n</ul>'}),define("text!templates/app_ui.tmpl.html",[],function(){return"<div id='container-wrapper' class=\"ui-layout-center\">\n  <div id='container'>\n    <div id='graph'></div>\n  </div>\n  <div id=\"breadcrumb\"></div>\n</div>\n<div id='sidebar' class=\"ui-layout-west\">\n  <ul class=\"ui-layout-north\">\n    <li><a href='#tab-new'>New</a></li>\n    <li><a href='#tab-attribute'>Attributes</a></li>\n    <li><a href='#tab-list'>List</a></li>\n  </ul>\n  <div class=\"container ui-layout-center\">\n    <div id='tab-attribute'></div>\n    <div id='tab-new'>\n      <input id='node_filter' name='search-node' placeholder='Search' type='input' />\n    </div>\n    <div id='tab-list'></div>\n  </div>\n</div>\n<div id=\"library\" class=\"ui-layout-east\"></div>\n<div id=\"timeline\" class=\"ui-layout-south\"></div>\n<input id='main_file_input_open' multiple='false' type='file' />\n"}),define("text!templates/field_sidebar_container.tmpl.html",[],function(){return"<div data-fid=\"<%= fid %>\" class='field-wrapper'>\n  <h3><%= name %></h3>\n</div>\n"}),define("text!templates/field_textfield.tmpl.html",[],function(){return"<div class='input-container'>\n  <input type='text' class='field-<%= type %>' />\n</div>\n"}),function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define("draggable-number",[],t):e.DraggableNumber=t()}(this,function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};return DraggableNumber=function(e,t){this._options=void 0!==t?t:{},this._input=e,this._span=document.createElement("span"),this._isDragging=!1,this._lastMousePosition={x:0,y:0},this._value=0,this._dragThreshold=this._setOption("dragThreshold",10),this._min=this._setOption("min",-1/0),this._max=this._setOption("max",1/0),this._inputDisplayStyle="",this._spanDisplayStyle="",this._init()
},DraggableNumber.MODIFIER_NONE=0,DraggableNumber.MODIFIER_LARGE=1,DraggableNumber.MODIFIER_SMALL=2,DraggableNumber.prototype={constructor:DraggableNumber,_init:function(){this._value=parseFloat(this._input.value,10),this._addSpan(),this._inputDisplayStyle=this._input.style.display,this._spanDisplayStyle=this._span.style.display,this._input.style.display="none",this._onMouseUp=e(this._onMouseUp,this),this._onMouseMove=e(this._onMouseMove,this),this._onMouseDown=e(this._onMouseDown,this),this._onInputBlur=e(this._onInputBlur,this),this._onInputKeyDown=e(this._onInputKeyDown,this),this._onInputChange=e(this._onInputChange,this),this._span.addEventListener("mousedown",this._onMouseDown,!1),this._input.addEventListener("blur",this._onInputBlur,!1),this._input.addEventListener("keypress",this._onInputKeyDown,!1),this._input.onchange=this._onInputChange},set:function(e){e=this._constraintValue(e),this._value=e,this._input.value=this._value,this._span.innerHTML=this._value},get:function(){return this._value},setMin:function(e){this._min=e,this.set(this._value)},setMax:function(e){this._max=e,this.set(this._value)},destroy:function(){this._span.removeEventListener("mousedown",this._onMouseDown,!1),this._input.removeEventListener("blur",this._onInputBlur,!1),this._input.removeEventListener("keypress",this._onInputKeyDown,!1),document.removeEventListener("mouseup",this._onMouseUp,!1),document.removeEventListener("mousemove",this._onMouseMove,!1),this._span.parentNode&&this._span.parentNode.removeChild(this._span),delete this._input,delete this._span,delete this._inputDisplayStyle,delete this._spanDisplayStyle},_setOption:function(e,t){return void 0!==this._options[e]?this._options[e]:this._input.hasAttribute("data-"+e)?parseFloat(this._input.getAttribute("data-"+e),10):t},_preventSelection:function(e){var t="none";e===!1&&(t="all"),document.body.style["-moz-user-select"]=t,document.body.style["-webkit-user-select"]=t,document.body.style["-ms-user-select"]=t,document.body.style["user-select"]=t},_addSpan:function(){var e=this._input.parentNode;e.insertBefore(this._span,this._input),this._span.innerHTML=this.get(),this._span.style.cursor="col-resize"},_showInput:function(){this._input.style.display=this._inputDisplayStyle,this._span.style.display="none",this._input.focus()},_showSpan:function(){this._input.style.display="none",this._span.style.display=this._spanDisplayStyle},_onInputBlur:function(){this._onInputChange(),this._showSpan()},_onInputChange:function(){this.set(parseFloat(this._input.value,10))},_onInputKeyDown:function(e){var t=13;e.charCode==t&&this._input.blur()},_onMouseDown:function(e){this._preventSelection(!0),this._isDragging=!1,this._lastMousePosition={x:e.clientX,y:e.clientY},document.addEventListener("mouseup",this._onMouseUp,!1),document.addEventListener("mousemove",this._onMouseMove,!1)},_onMouseUp:function(){this._preventSelection(!1),this._isDragging===!1&&this._showInput(),this._isDragging=!1,document.removeEventListener("mouseup",this._onMouseUp,!1),document.removeEventListener("mousemove",this._onMouseMove,!1)},_hasMovedEnough:function(e,t){return Math.abs(e.x-t.x)>=this._dragThreshold||Math.abs(e.y-t.y)>=this._dragThreshold?!0:!1},_onMouseMove:function(e){var t={x:e.clientX,y:e.clientY};if(this._hasMovedEnough(t,this._lastMousePosition)&&(this._isDragging=!0),this._isDragging!==!1){var i=DraggableNumber.MODIFIER_NONE;e.shiftKey?i=DraggableNumber.MODIFIER_LARGE:e.ctrlKey&&(i=DraggableNumber.MODIFIER_SMALL);var n=this._getLargestDelta(t,this._lastMousePosition),r=this._getNumberOffset(n,i),o=this.get()+r;this.set(o),"changeCallback"in this._options&&this._options.changeCallback(o),this._lastMousePosition=t}},_getNumberOffset:function(e,t){var i=1;return t==DraggableNumber.MODIFIER_SMALL?i*=.1:t==DraggableNumber.MODIFIER_LARGE&&(i*=10),0>e&&(i*=-1),i},_getLargestDelta:function(e,t){var i={x:e.x-t.x,y:e.y-t.y};return Math.abs(i.x)>Math.abs(i.y)?i.x:-1*i.y},_constraintValue:function(e){return e=Math.min(e,this._max),e=Math.max(e,this._min)}},DraggableNumber}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/SidebarTextfield",["require","Underscore","Backbone","text!templates/field_textfield.tmpl.html","draggable-number"],function(t){var n,r,o,s,a,l;return s=t("Underscore"),n=t("Backbone"),l=t("text!templates/field_textfield.tmpl.html"),r=t("draggable-number"),o=function(t){function n(){return this.addTextfieldSlider=e(this.addTextfieldSlider,this),this.linkTextfieldToSubval=e(this.linkTextfieldToSubval,this),this.linkTextfieldToVal=e(this.linkTextfieldToVal,this),this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.slider=!1,this.render()},n.prototype.render=function(){return this.container=$(s.template(l,this.options)),this.$el.append(this.container),this.$input=$("input",this.container),this},n.prototype.linkTextfieldToVal=function(e){var t,i=this;return null==e&&(e="float"),this.$input.val(this.model.getValue()),"float"===this.options.type&&this.slider===!1&&(this.slider=this.addTextfieldSlider()),t=function(e){return i.slider?i.slider.set(e):void 0},this.model.on("value_updated",t),this.$input.val(this.model.getValue()),this.slider&&(this.slider._options.changeCallback=function(e){return i.model.setValue(e)}),this.$input.keypress(function(t){return 13===t.which?("float"===e?i.model.setValue(parseFloat(i.$input.val())):i.model.setValue(i.$input.val()),i.$input.blur()):void 0}),this},n.prototype.linkTextfieldToSubval=function(e,t){var i,n=this;return null==t&&(t="float"),this.$input.val(this.model.getValue()[e]),"float"===this.options.type&&(this.slider=this.addTextfieldSlider()),this.model.on_value_update_hooks["update_sidebar_textfield_"+e]=function(t){return n.$input.val(t[e])},i=function(){var i;return i=n.$input.val(),"float"===t&&(i=parseFloat(i)),"array"===$.type(n.model.attributes.value)?n.model.attributes.value[0][e]=i:n.model.attributes.value[e]=i},this.slider._options.changeCallback=function(){return i()},this.$input.change(function(){return i()}),this.$input.keypress(function(e){return 13===e.which?(i(),n.$input.blur()):void 0}),this},n.prototype.addTextfieldSlider=function(){var e;return e=new r(this.$input.get(0))},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/BaseField",["require","Underscore","Backbone","text!templates/field_sidebar_container.tmpl.html","cs!threenodes/views/sidebar/SidebarTextfield"],function(t){var n,r,o,s,a,l;return s=t("Underscore"),n=t("Backbone"),l=t("text!templates/field_sidebar_container.tmpl.html"),o=t("cs!threenodes/views/sidebar/SidebarTextfield"),r=function(t){function n(){return this.createSidebarFieldTitle=e(this.createSidebarFieldTitle,this),this.createSubvalTextinput=e(this.createSubvalTextinput,this),this.createTextfield=e(this.createTextfield,this),this.createSidebarContainer=e(this.createSidebarContainer,this),this.render=e(this.render,this),this.on_value_updated=e(this.on_value_updated,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.model.on("value_updated",this.on_value_updated),this.render()},n.prototype.on_value_updated=function(){return this},n.prototype.render=function(){return this},n.prototype.createSidebarContainer=function(e){var t;return null==e&&(e=this.model.get("name")),t={fid:this.model.get("fid"),model:this,name:e},this.container=$(s.template(l,t)),this.$el.append(this.container),this.container},n.prototype.createTextfield=function(e,t,i){var n;return null==t&&(t="float"),null==i&&(i=!0),n=new o({model:this.model,el:e,type:t,link_to_val:i})},n.prototype.createSubvalTextinput=function(e,t){var i,n;return null==t&&(t="float"),i=this.createSidebarContainer(e),n=this.createTextfield(i,t,!1),n.linkTextfieldToSubval(e,t),!1},n.prototype.createSidebarFieldTitle=function(e){return null==e&&(e=this.model.get("name")),this.$el.append("<h3>"+e+"</h3>"),this.$el},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/BoolField",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{BoolField:o=function(t){function n(){return this.render=e(this.render,this),this.on_value_updated=e(this.on_value_updated,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.on_value_updated=function(){return this.model.getValue()===!0?this.$checkbox.attr("checked","checked"):this.$checkbox.removeAttr("checked")},n.prototype.render=function(){var e,t,i,n=this;return console.log("check.."),t=this.createSidebarContainer(),i="side-field-checkbox-"+this.model.get("fid"),e=$("<div><input type='checkbox' id='"+i+"'/></div>").appendTo(t),this.$checkbox=$("input",e),this.model.getValue()===!0&&this.$checkbox.attr("checked","checked"),this.$checkbox.change(function(){return n.$checkbox.is(":checked")?n.model.setValue(!0):n.model.setValue(!1)}),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/StringField",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{StringField:o=function(t){function n(){return this.create_sidebar_input=e(this.create_sidebar_input,this),this.create_sidebar_select=e(this.create_sidebar_select,this),this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){var e;return e=this.createSidebarContainer(),this.model.attributes.possibilities?this.create_sidebar_select(e):this.create_sidebar_input(e),!0},n.prototype.create_sidebar_select=function(e){var t,i,n,r,o=this;r=this,n="<div><select>";for(i in this.model.get("possibilities"))t=this.model.get("possibilities")[i],n+=t===this.val?"<option value='"+t+"' selected='selected'>"+i+"</option>":"<option value='"+t+"'>"+i+"</option>";return n+="</select></div>",e.append(n),$("select",e).change(function(){return o.model.setValue($("select",e).val())}),!0},n.prototype.create_sidebar_input=function(e){return this.textfield=this.createTextfield(e,"string"),this.textfield.linkTextfieldToVal("string")},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/FloatField",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{FloatField:o=function(t){function n(){return this.create_sidebar_input=e(this.create_sidebar_input,this),this.create_sidebar_select=e(this.create_sidebar_select,this),this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){var e;return e=this.createSidebarContainer(),this.model.attributes.possibilities?this.create_sidebar_select(e):this.create_sidebar_input(e),!0},n.prototype.create_sidebar_select=function(e){var t,i,n,r,o=this;r=this,n="<div><select>";for(i in this.model.get("possibilities"))t=this.model.get("possibilities")[i],n+=t===this.val?"<option value='"+t+"' selected='selected'>"+i+"</option>":"<option value='"+t+"'>"+i+"</option>";return n+="</select></div>",e.append(n),$("select",e).change(function(){return o.model.setValue($("select",e).val())}),!0},n.prototype.create_sidebar_input=function(e){return this.textfield=this.createTextfield(e),this.textfield.linkTextfieldToVal()},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/Vector2Field",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{Vector2Field:o=function(t){function n(){return this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){return this.createSidebarFieldTitle(),this.createSubvalTextinput("x"),this.createSubvalTextinput("y"),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/Vector3Field",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{Vector3Field:o=function(t){function n(){return this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){return this.createSidebarFieldTitle(),this.createSubvalTextinput("x"),this.createSubvalTextinput("y"),this.createSubvalTextinput("z"),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/Vector4Field",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{Vector4Field:o=function(t){function n(){return this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){return this.createSidebarFieldTitle(),this.createSubvalTextinput("x"),this.createSubvalTextinput("y"),this.createSubvalTextinput("z"),this.createSubvalTextinput("w"),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/QuaternionField",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{QuaternionField:o=function(t){function n(){return this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){return this.createSidebarFieldTitle(),this.createSubvalTextinput("x"),this.createSubvalTextinput("y"),this.createSubvalTextinput("z"),this.createSubvalTextinput("w"),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/fields/EulerField",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BaseField"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/fields/BaseField"),namespace("ThreeNodes.views.fields",{EulerField:o=function(t){function n(){return this.render=e(this.render,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.render=function(){return this.createSidebarFieldTitle(),this.createSubvalTextinput("x"),this.createSubvalTextinput("y"),this.createSubvalTextinput("z"),this.createSubvalTextinput("order","string"),this},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/NodeSidebarView",["require","Underscore","Backbone","cs!threenodes/views/sidebar/fields/BoolField","cs!threenodes/views/sidebar/fields/StringField","cs!threenodes/views/sidebar/fields/FloatField","cs!threenodes/views/sidebar/fields/Vector2Field","cs!threenodes/views/sidebar/fields/Vector3Field","cs!threenodes/views/sidebar/fields/Vector4Field","cs!threenodes/views/sidebar/fields/QuaternionField","cs!threenodes/views/sidebar/fields/EulerField"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!threenodes/views/sidebar/fields/BoolField"),t("cs!threenodes/views/sidebar/fields/StringField"),t("cs!threenodes/views/sidebar/fields/FloatField"),t("cs!threenodes/views/sidebar/fields/Vector2Field"),t("cs!threenodes/views/sidebar/fields/Vector3Field"),t("cs!threenodes/views/sidebar/fields/Vector4Field"),t("cs!threenodes/views/sidebar/fields/QuaternionField"),t("cs!threenodes/views/sidebar/fields/EulerField"),r=function(t){function n(){return this.render=e(this.render,this),this.displayFields=e(this.displayFields,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.render()},n.prototype.displayFields=function(e){var t,i,n,r,o;o=[];for(t in e)i=e[t],r=function(){switch(i.constructor){case ThreeNodes.fields.Bool:return ThreeNodes.views.fields.BoolField;case ThreeNodes.fields.String:return ThreeNodes.views.fields.StringField;case ThreeNodes.fields.Float:return ThreeNodes.views.fields.FloatField;case ThreeNodes.fields.Vector2:return ThreeNodes.views.fields.Vector2Field;case ThreeNodes.fields.Vector3:return ThreeNodes.views.fields.Vector3Field;case ThreeNodes.fields.Vector4:return ThreeNodes.views.fields.Vector4Field;case ThreeNodes.fields.Quaternion:return ThreeNodes.views.fields.QuaternionField;case ThreeNodes.fields.Euler:return ThreeNodes.views.fields.EulerField;default:return!1}}(),r!==!1?(n=new r({model:i}),o.push(this.$el.append(n.el))):o.push(void 0);return o},n.prototype.render=function(){var e,t;return this.$el.html("<h2>"+this.model.get("name")+"</h2>"),this.displayFields(this.model.fields.inputs),this.model.custom_fields&&this.displayFields(this.model.custom_fields.inputs),this.model.onCodeUpdate&&(t=this,this.$el.append("<h2>Add custom fields</h2>"),e=$('<form class="dynamic-fields__form"></form>'),e.append('<input type="text" name="key" placeholder="key" />'),e.append('<input type="text" name="type" placeholder="type" />'),e.append('<input type="submit" value="Add input field" />'),this.$el.append(e),e.on("submit",function(e){var i,n,r,o;return e.preventDefault(),i=$(this),n=$(this).find('[name="key"]'),r="Any",o=$.trim(n.val()),""!==o?(t.model.addCustomField(o,"Any","inputs"),n.val(""),t.render()):void 0})),this},n}(n.View)})}.call(this),function(e,t){function i(t,i){var r,o,s,a=t.nodeName.toLowerCase();return"area"===a?(r=t.parentNode,o=r.name,t.href&&o&&"map"===r.nodeName.toLowerCase()?(s=e("img[usemap=#"+o+"]")[0],!!s&&n(s)):!1):(/input|select|textarea|button|object/.test(a)?!t.disabled:"a"===a?t.href||i:i)&&n(t)}function n(t){return e.expr.filters.visible(t)&&!e(t).parents().addBack().filter(function(){return"hidden"===e.css(this,"visibility")}).length}var r=0,o=/^ui-id-\d+$/;e.ui=e.ui||{},e.extend(e.ui,{version:"1.10.3",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({focus:function(t){return function(i,n){return"number"==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),n&&n.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),scrollParent:function(){var t;return t=e.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test(e.css(this,"position"))&&/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test(e.css(this,"overflow")+e.css(this,"overflow-y")+e.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!t.length?e(document):t},zIndex:function(i){if(i!==t)return this.css("zIndex",i);if(this.length)for(var n,r,o=e(this[0]);o.length&&o[0]!==document;){if(n=o.css("position"),("absolute"===n||"relative"===n||"fixed"===n)&&(r=parseInt(o.css("zIndex"),10),!isNaN(r)&&0!==r))return r;o=o.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++r)})},removeUniqueId:function(){return this.each(function(){o.test(this.id)&&e(this).removeAttr("id")})}}),e.extend(e.expr[":"],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,n){return!!e.data(t,n[3])},focusable:function(t){return i(t,!isNaN(e.attr(t,"tabindex")))},tabbable:function(t){var n=e.attr(t,"tabindex"),r=isNaN(n);return(r||n>=0)&&i(t,!r)}}),e("<a>").outerWidth(1).jquery||e.each(["Width","Height"],function(i,n){function r(t,i,n,r){return e.each(o,function(){i-=parseFloat(e.css(t,"padding"+this))||0,n&&(i-=parseFloat(e.css(t,"border"+this+"Width"))||0),r&&(i-=parseFloat(e.css(t,"margin"+this))||0)}),i}var o="Width"===n?["Left","Right"]:["Top","Bottom"],s=n.toLowerCase(),a={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn["inner"+n]=function(i){return i===t?a["inner"+n].call(this):this.each(function(){e(this).css(s,r(this,i)+"px")})},e.fn["outer"+n]=function(t,i){return"number"!=typeof t?a["outer"+n].call(this,t):this.each(function(){e(this).css(s,r(this,t,!0,i)+"px")})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e("<a>").data("a-b","a").removeData("a-b").data("a-b")&&(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.support.selectstart="onselectstart"in document.createElement("div"),e.fn.extend({disableSelection:function(){return this.bind((e.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(e){e.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),e.extend(e.ui,{plugin:{add:function(t,i,n){var r,o=e.ui[t].prototype;for(r in n)o.plugins[r]=o.plugins[r]||[],o.plugins[r].push([i,n[r]])},call:function(e,t,i){var n,r=e.plugins[t];if(r&&e.element[0].parentNode&&11!==e.element[0].parentNode.nodeType)for(n=0;n<r.length;n++)e.options[r[n][0]]&&r[n][1].apply(e.element,i)}},hasScroll:function(t,i){if("hidden"===e(t).css("overflow"))return!1;var n=i&&"left"===i?"scrollLeft":"scrollTop",r=!1;return t[n]>0?!0:(t[n]=1,r=t[n]>0,t[n]=0,r)}})}(jQuery),function(e,t){var i=0,n=Array.prototype.slice,r=e.cleanData;e.cleanData=function(t){for(var i,n=0;null!=(i=t[n]);n++)try{e(i).triggerHandler("remove")}catch(o){}r(t)},e.widget=function(t,i,n){var r,o,s,a,l={},h=t.split(".")[0];t=t.split(".")[1],r=h+"-"+t,n||(n=i,i=e.Widget),e.expr[":"][r.toLowerCase()]=function(t){return!!e.data(t,r)},e[h]=e[h]||{},o=e[h][t],s=e[h][t]=function(e,t){return this._createWidget?(arguments.length&&this._createWidget(e,t),void 0):new s(e,t)},e.extend(s,o,{version:n.version,_proto:e.extend({},n),_childConstructors:[]}),a=new i,a.options=e.widget.extend({},a.options),e.each(n,function(t,n){return e.isFunction(n)?(l[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},r=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,o=this._superApply;return this._super=e,this._superApply=r,t=n.apply(this,arguments),this._super=i,this._superApply=o,t}}(),void 0):(l[t]=n,void 0)}),s.prototype=e.widget.extend(a,{widgetEventPrefix:o?a.widgetEventPrefix:t},l,{constructor:s,namespace:h,widgetName:t,widgetFullName:r}),o?(e.each(o._childConstructors,function(t,i){var n=i.prototype;e.widget(n.namespace+"."+n.widgetName,s,i._proto)}),delete o._childConstructors):i._childConstructors.push(s),e.widget.bridge(t,s)},e.widget.extend=function(i){for(var r,o,s=n.call(arguments,1),a=0,l=s.length;l>a;a++)for(r in s[a])o=s[a][r],s[a].hasOwnProperty(r)&&o!==t&&(i[r]=e.isPlainObject(o)?e.isPlainObject(i[r])?e.widget.extend({},i[r],o):e.widget.extend({},o):o);return i},e.widget.bridge=function(i,r){var o=r.prototype.widgetFullName||i;e.fn[i]=function(s){var a="string"==typeof s,l=n.call(arguments,1),h=this;return s=!a&&l.length?e.widget.extend.apply(null,[s].concat(l)):s,a?this.each(function(){var n,r=e.data(this,o);return r?e.isFunction(r[s])&&"_"!==s.charAt(0)?(n=r[s].apply(r,l),n!==r&&n!==t?(h=n&&n.jquery?h.pushStack(n.get()):n,!1):void 0):e.error("no such method '"+s+"' for "+i+" widget instance"):e.error("cannot call methods on "+i+" prior to initialization; "+"attempted to call method '"+s+"'")}):this.each(function(){var t=e.data(this,o);t?t.option(s||{})._init():e.data(this,o,new r(s,this))}),h}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(t,n){n=e(n||this.defaultElement||this)[0],this.element=e(n),this.uuid=i++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this.bindings=e(),this.hoverable=e(),this.focusable=e(),n!==this&&(e.data(n,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===n&&this.destroy()}}),this.document=e(n.style?n.ownerDocument:n.document||n),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled "+"ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:e.noop,widget:function(){return this.element},option:function(i,n){var r,o,s,a=i;if(0===arguments.length)return e.widget.extend({},this.options);if("string"==typeof i)if(a={},r=i.split("."),i=r.shift(),r.length){for(o=a[i]=e.widget.extend({},this.options[i]),s=0;s<r.length-1;s++)o[r[s]]=o[r[s]]||{},o=o[r[s]];if(i=r.pop(),n===t)return o[i]===t?null:o[i];o[i]=n}else{if(n===t)return this.options[i]===t?null:this.options[i];a[i]=n}return this._setOptions(a),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,"disabled"===e&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!t).attr("aria-disabled",t),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(t,i,n){var r,o=this;"boolean"!=typeof t&&(n=i,i=t,t=!1),n?(i=r=e(i),this.bindings=this.bindings.add(i)):(n=i,i=this.element,r=this.widget()),e.each(n,function(n,s){function a(){return t||o.options.disabled!==!0&&!e(this).hasClass("ui-state-disabled")?("string"==typeof s?o[s]:s).apply(o,arguments):void 0}"string"!=typeof s&&(a.guid=s.guid=s.guid||a.guid||e.guid++);var l=n.match(/^(\w+)\s*(.*)$/),h=l[1]+o.eventNamespace,c=l[2];c?r.delegate(c,h,a):i.bind(h,a)})},_off:function(e,t){t=(t||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,e.unbind(t).undelegate(t)},_delay:function(e,t){function i(){return("string"==typeof e?n[e]:e).apply(n,arguments)}var n=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass("ui-state-hover")},mouseleave:function(t){e(t.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass("ui-state-focus")},focusout:function(t){e(t.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(t,i,n){var r,o,s=this.options[t];if(n=n||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],o=i.originalEvent)for(r in o)r in i||(i[r]=o[r]);return this.element.trigger(i,n),!(e.isFunction(s)&&s.apply(this.element[0],[i].concat(n))===!1||i.isDefaultPrevented())}},e.each({show:"fadeIn",hide:"fadeOut"},function(t,i){e.Widget.prototype["_"+t]=function(n,r,o){"string"==typeof r&&(r={effect:r});var s,a=r?r===!0||"number"==typeof r?i:r.effect||i:t;r=r||{},"number"==typeof r&&(r={duration:r}),s=!e.isEmptyObject(r),r.complete=o,r.delay&&n.delay(r.delay),s&&e.effects&&e.effects.effect[a]?n[t](r):a!==t&&n[a]?n[a](r.duration,r.easing,o):n.queue(function(i){e(this)[t](),o&&o.call(n[0]),i()})}})}(jQuery),function(e){var t=!1;e(document).mouseup(function(){t=!1}),e.widget("ui.mouse",{version:"1.10.3",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind("mousedown."+this.widgetName,function(e){return t._mouseDown(e)}).bind("click."+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+".preventClickEvent")?(e.removeData(i.target,t.widgetName+".preventClickEvent"),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)
},_mouseDown:function(i){if(!t){this._mouseStarted&&this._mouseUp(i),this._mouseDownEvent=i;var n=this,r=1===i.which,o="string"==typeof this.options.cancel&&i.target.nodeName?e(i.target).closest(this.options.cancel).length:!1;return r&&!o&&this._mouseCapture(i)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){n.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(i)&&this._mouseDelayMet(i)&&(this._mouseStarted=this._mouseStart(i)!==!1,!this._mouseStarted)?(i.preventDefault(),!0):(!0===e.data(i.target,this.widgetName+".preventClickEvent")&&e.removeData(i.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(e){return n._mouseMove(e)},this._mouseUpDelegate=function(e){return n._mouseUp(e)},e(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),i.preventDefault(),t=!0,!0)):!0}},_mouseMove:function(t){return e.ui.ie&&(!document.documentMode||document.documentMode<9)&&!t.button?this._mouseUp(t):this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&&this._mouseDelayMet(t)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return e(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&&e.data(t.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(t)),!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))>=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}})}(jQuery),function(e){e.widget("ui.draggable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){"original"!==this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(t){var i=this.options;return this.helper||i.disabled||e(t.target).closest(".ui-resizable-handle").length>0?!1:(this.handle=this._getHandle(t),this.handle?(e(i.iframeFix===!0?"iframe":i.iframeFix).each(function(){e("<div class='ui-draggable-iframeFix' style='background: #fff;'></div>").css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css(e(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),e.ui.ddmanager&&(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offsetParent=this.helper.offsetParent(),this.offsetParentCssPosition=this.offsetParent.css("position"),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},this.offset.scroll=!1,e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&&this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger("start",t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&&!i.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this._mouseDrag(t,!0),e.ui.ddmanager&&e.ui.ddmanager.dragStart(this,t),!0)},_mouseDrag:function(t,i){if("fixed"===this.offsetParentCssPosition&&(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),!i){var n=this._uiHash();if(this._trigger("drag",t,n)===!1)return this._mouseUp({}),!1;this.position=n.position}return this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,n=!1;return e.ui.ddmanager&&!this.options.dropBehaviour&&(n=e.ui.ddmanager.drop(this,t)),this.dropped&&(n=this.dropped,this.dropped=!1),"original"!==this.options.helper||e.contains(this.element[0].ownerDocument,this.element[0])?("invalid"===this.options.revert&&!n||"valid"===this.options.revert&&n||this.options.revert===!0||e.isFunction(this.options.revert)&&this.options.revert.call(this.element,n)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger("stop",t)!==!1&&i._clear()}):this._trigger("stop",t)!==!1&&this._clear(),!1):!1},_mouseUp:function(t){return e("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),e.ui.ddmanager&&e.ui.ddmanager.dragStop(this,t),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t])):"clone"===i.helper?this.element.clone().removeAttr("id"):this.element;return n.parents("body").length||n.appendTo("parent"===i.appendTo?this.element[0].parentNode:i.appendTo),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css("position"))||n.css("position","absolute"),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.element.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;return r.containment?"window"===r.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):"document"===r.containment?(this.containment=[0,0,e(document).width()-this.helperProportions.width-this.margins.left,(e(document).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):r.containment.constructor===Array?(this.containment=r.containment,void 0):("parent"===r.containment&&(r.containment=this.helper[0].parentNode),i=e(r.containment),n=i[0],n&&(t="hidden"!==i.css("overflow"),this.containment=[(parseInt(i.css("borderLeftWidth"),10)||0)+(parseInt(i.css("paddingLeft"),10)||0),(parseInt(i.css("borderTopWidth"),10)||0)+(parseInt(i.css("paddingTop"),10)||0),(t?Math.max(n.scrollWidth,n.offsetWidth):n.offsetWidth)-(parseInt(i.css("borderRightWidth"),10)||0)-(parseInt(i.css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(n.scrollHeight,n.offsetHeight):n.offsetHeight)-(parseInt(i.css("borderBottomWidth"),10)||0)-(parseInt(i.css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=i),void 0):(this.containment=null,void 0)},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent;return this.offset.scroll||(this.offset.scroll={top:r.scrollTop(),left:r.scrollLeft()}),{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top)*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)*n}},_generatePosition:function(t){var i,n,r,o,s=this.options,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=t.pageX,h=t.pageY;return this.offset.scroll||(this.offset.scroll={top:a.scrollTop(),left:a.scrollLeft()}),this.originalPosition&&(this.containment&&(this.relative_container?(n=this.relative_container.offset(),i=[this.containment[0]+n.left,this.containment[1]+n.top,this.containment[2]+n.left,this.containment[3]+n.top]):i=this.containment,t.pageX-this.offset.click.left<i[0]&&(l=i[0]+this.offset.click.left),t.pageY-this.offset.click.top<i[1]&&(h=i[1]+this.offset.click.top),t.pageX-this.offset.click.left>i[2]&&(l=i[2]+this.offset.click.left),t.pageY-this.offset.click.top>i[3]&&(h=i[3]+this.offset.click.top)),s.grid&&(r=s.grid[1]?this.originalPageY+Math.round((h-this.originalPageY)/s.grid[1])*s.grid[1]:this.originalPageY,h=i?r-this.offset.click.top>=i[1]||r-this.offset.click.top>i[3]?r:r-this.offset.click.top>=i[1]?r-s.grid[1]:r+s.grid[1]:r,o=s.grid[0]?this.originalPageX+Math.round((l-this.originalPageX)/s.grid[0])*s.grid[0]:this.originalPageX,l=i?o-this.offset.click.left>=i[0]||o-this.offset.click.left>i[2]?o:o-this.offset.click.left>=i[0]?o-s.grid[0]:o+s.grid[0]:o)),{top:h-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():this.offset.scroll.top),left:l-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():this.offset.scroll.left)}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(t,i,n){return n=n||this._uiHash(),e.ui.plugin.call(this,t,[i,n]),"drag"===t&&(this.positionAbs=this._convertPositionTo("absolute")),e.Widget.prototype._trigger.call(this,t,i,n)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add("draggable","connectToSortable",{start:function(t,i){var n=e(this).data("ui-draggable"),r=n.options,o=e.extend({},i,{item:n.element});n.sortables=[],e(r.connectToSortable).each(function(){var i=e.data(this,"ui-sortable");i&&!i.options.disabled&&(n.sortables.push({instance:i,shouldRevert:i.options.revert}),i.refreshPositions(),i._trigger("activate",t,o))})},stop:function(t,i){var n=e(this).data("ui-draggable"),r=e.extend({},i,{item:n.element});e.each(n.sortables,function(){this.instance.isOver?(this.instance.isOver=0,n.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=this.shouldRevert),this.instance._mouseStop(t),this.instance.options.helper=this.instance.options._helper,"original"===n.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",t,r))})},drag:function(t,i){var n=e(this).data("ui-draggable"),r=this;e.each(n.sortables,function(){var o=!1,s=this;this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(o=!0,e.each(n.sortables,function(){return this.instance.positionAbs=n.positionAbs,this.instance.helperProportions=n.helperProportions,this.instance.offset.click=n.offset.click,this!==s&&this.instance._intersectsWith(this.instance.containerCache)&&e.contains(s.instance.element[0],this.instance.element[0])&&(o=!1),o})),o?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=e(r).clone().removeAttr("id").appendTo(this.instance.element).data("ui-sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return i.helper[0]},t.target=this.instance.currentItem[0],this.instance._mouseCapture(t,!0),this.instance._mouseStart(t,!0,!0),this.instance.offset.click.top=n.offset.click.top,this.instance.offset.click.left=n.offset.click.left,this.instance.offset.parent.left-=n.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=n.offset.parent.top-this.instance.offset.parent.top,n._trigger("toSortable",t),n.dropped=this.instance.element,n.currentItem=n.element,this.instance.fromOutside=n),this.instance.currentItem&&this.instance._mouseDrag(t)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",t,this.instance._uiHash(this.instance)),this.instance._mouseStop(t,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),n._trigger("fromSortable",t),n.dropped=!1)})}}),e.ui.plugin.add("draggable","cursor",{start:function(){var t=e("body"),i=e(this).data("ui-draggable").options;t.css("cursor")&&(i._cursor=t.css("cursor")),t.css("cursor",i.cursor)},stop:function(){var t=e(this).data("ui-draggable").options;t._cursor&&e("body").css("cursor",t._cursor)}}),e.ui.plugin.add("draggable","opacity",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("opacity")&&(r._opacity=n.css("opacity")),n.css("opacity",r.opacity)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._opacity&&e(i.helper).css("opacity",n._opacity)}}),e.ui.plugin.add("draggable","scroll",{start:function(){var t=e(this).data("ui-draggable");t.scrollParent[0]!==document&&"HTML"!==t.scrollParent[0].tagName&&(t.overflowOffset=t.scrollParent.offset())},drag:function(t){var i=e(this).data("ui-draggable"),n=i.options,r=!1;i.scrollParent[0]!==document&&"HTML"!==i.scrollParent[0].tagName?(n.axis&&"x"===n.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-t.pageY<n.scrollSensitivity?i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop+n.scrollSpeed:t.pageY-i.overflowOffset.top<n.scrollSensitivity&&(i.scrollParent[0].scrollTop=r=i.scrollParent[0].scrollTop-n.scrollSpeed)),n.axis&&"y"===n.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-t.pageX<n.scrollSensitivity?i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft+n.scrollSpeed:t.pageX-i.overflowOffset.left<n.scrollSensitivity&&(i.scrollParent[0].scrollLeft=r=i.scrollParent[0].scrollLeft-n.scrollSpeed))):(n.axis&&"x"===n.axis||(t.pageY-e(document).scrollTop()<n.scrollSensitivity?r=e(document).scrollTop(e(document).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<n.scrollSensitivity&&(r=e(document).scrollTop(e(document).scrollTop()+n.scrollSpeed))),n.axis&&"y"===n.axis||(t.pageX-e(document).scrollLeft()<n.scrollSensitivity?r=e(document).scrollLeft(e(document).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<n.scrollSensitivity&&(r=e(document).scrollLeft(e(document).scrollLeft()+n.scrollSpeed)))),r!==!1&&e.ui.ddmanager&&!n.dropBehaviour&&e.ui.ddmanager.prepareOffsets(i,t)}}),e.ui.plugin.add("draggable","snap",{start:function(){var t=e(this).data("ui-draggable"),i=t.options;t.snapElements=[],e(i.snap.constructor!==String?i.snap.items||":data(ui-draggable)":i.snap).each(function(){var i=e(this),n=i.offset();this!==t.element[0]&&t.snapElements.push({item:this,width:i.outerWidth(),height:i.outerHeight(),top:n.top,left:n.left})})},drag:function(t,i){var n,r,o,s,a,l,h,c,u,d,p=e(this).data("ui-draggable"),f=p.options,m=f.snapTolerance,g=i.offset.left,v=g+p.helperProportions.width,y=i.offset.top,_=y+p.helperProportions.height;for(u=p.snapElements.length-1;u>=0;u--)a=p.snapElements[u].left,l=a+p.snapElements[u].width,h=p.snapElements[u].top,c=h+p.snapElements[u].height,a-m>v||g>l+m||h-m>_||y>c+m||!e.contains(p.snapElements[u].item.ownerDocument,p.snapElements[u].item)?(p.snapElements[u].snapping&&p.options.snap.release&&p.options.snap.release.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=!1):("inner"!==f.snapMode&&(n=Math.abs(h-_)<=m,r=Math.abs(c-y)<=m,o=Math.abs(a-v)<=m,s=Math.abs(l-g)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:h-p.helperProportions.height,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:c,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a-p.helperProportions.width}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l}).left-p.margins.left)),d=n||r||o||s,"outer"!==f.snapMode&&(n=Math.abs(h-y)<=m,r=Math.abs(c-_)<=m,o=Math.abs(a-g)<=m,s=Math.abs(l-v)<=m,n&&(i.position.top=p._convertPositionTo("relative",{top:h,left:0}).top-p.margins.top),r&&(i.position.top=p._convertPositionTo("relative",{top:c-p.helperProportions.height,left:0}).top-p.margins.top),o&&(i.position.left=p._convertPositionTo("relative",{top:0,left:a}).left-p.margins.left),s&&(i.position.left=p._convertPositionTo("relative",{top:0,left:l-p.helperProportions.width}).left-p.margins.left)),!p.snapElements[u].snapping&&(n||r||o||s||d)&&p.options.snap.snap&&p.options.snap.snap.call(p.element,t,e.extend(p._uiHash(),{snapItem:p.snapElements[u].item})),p.snapElements[u].snapping=n||r||o||s||d)}}),e.ui.plugin.add("draggable","stack",{start:function(){var t,i=this.data("ui-draggable").options,n=e.makeArray(e(i.stack)).sort(function(t,i){return(parseInt(e(t).css("zIndex"),10)||0)-(parseInt(e(i).css("zIndex"),10)||0)});n.length&&(t=parseInt(e(n[0]).css("zIndex"),10)||0,e(n).each(function(i){e(this).css("zIndex",t+i)}),this.css("zIndex",t+n.length))}}),e.ui.plugin.add("draggable","zIndex",{start:function(t,i){var n=e(i.helper),r=e(this).data("ui-draggable").options;n.css("zIndex")&&(r._zIndex=n.css("zIndex")),n.css("zIndex",r.zIndex)},stop:function(t,i){var n=e(this).data("ui-draggable").options;n._zIndex&&e(i.helper).css("zIndex",n._zIndex)}})}(jQuery),function(e){function t(e,t,i){return e>t&&t+i>e}e.widget("ui.droppable",{version:"1.10.3",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect",activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t=this.options,i=t.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(i)?i:function(e){return e.is(i)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},e.ui.ddmanager.droppables[t.scope]=e.ui.ddmanager.droppables[t.scope]||[],e.ui.ddmanager.droppables[t.scope].push(this),t.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var t=0,i=e.ui.ddmanager.droppables[this.options.scope];t<i.length;t++)i[t]===this&&i.splice(t,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(t,i){"accept"===t&&(this.accept=e.isFunction(i)?i:function(e){return e.is(i)}),e.Widget.prototype._setOption.apply(this,arguments)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),i&&this._trigger("activate",t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),i&&this._trigger("deactivate",t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&&(i.currentItem||i.element)[0]!==this.element[0]&&this.accept.call(this.element[0],i.currentItem||i.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",t,this.ui(i)))},_drop:function(t,i){var n=i||e.ui.ddmanager.current,r=!1;return n&&(n.currentItem||n.element)[0]!==this.element[0]?(this.element.find(":data(ui-droppable)").not(".ui-draggable-dragging").each(function(){var t=e.data(this,"ui-droppable");return t.options.greedy&&!t.options.disabled&&t.options.scope===n.options.scope&&t.accept.call(t.element[0],n.currentItem||n.element)&&e.ui.intersect(n,e.extend(t,{offset:t.element.offset()}),t.options.tolerance)?(r=!0,!1):void 0}),r?!1:this.accept.call(this.element[0],n.currentItem||n.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",t,this.ui(n)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(e,i,n){if(!i.offset)return!1;var r,o,s=(e.positionAbs||e.position.absolute).left,a=s+e.helperProportions.width,l=(e.positionAbs||e.position.absolute).top,h=l+e.helperProportions.height,c=i.offset.left,u=c+i.proportions.width,d=i.offset.top,p=d+i.proportions.height;switch(n){case"fit":return s>=c&&u>=a&&l>=d&&p>=h;case"intersect":return c<s+e.helperProportions.width/2&&a-e.helperProportions.width/2<u&&d<l+e.helperProportions.height/2&&h-e.helperProportions.height/2<p;case"pointer":return r=(e.positionAbs||e.position.absolute).left+(e.clickOffset||e.offset.click).left,o=(e.positionAbs||e.position.absolute).top+(e.clickOffset||e.offset.click).top,t(o,d,i.proportions.height)&&t(r,c,i.proportions.width);case"touch":return(l>=d&&p>=l||h>=d&&p>=h||d>l&&h>p)&&(s>=c&&u>=s||a>=c&&u>=a||c>s&&a>u);default:return!1}},e.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,i){var n,r,o=e.ui.ddmanager.droppables[t.options.scope]||[],s=i?i.type:null,a=(t.currentItem||t.element).find(":data(ui-droppable)").addBack();e:for(n=0;n<o.length;n++)if(!(o[n].options.disabled||t&&!o[n].accept.call(o[n].element[0],t.currentItem||t.element))){for(r=0;r<a.length;r++)if(a[r]===o[n].element[0]){o[n].proportions.height=0;continue e}o[n].visible="none"!==o[n].element.css("display"),o[n].visible&&("mousedown"===s&&o[n]._activate.call(o[n],i),o[n].offset=o[n].element.offset(),o[n].proportions={width:o[n].element[0].offsetWidth,height:o[n].element[0].offsetHeight})}},drop:function(t,i){var n=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&&(!this.options.disabled&&this.visible&&e.ui.intersect(t,this,this.options.tolerance)&&(n=this._drop.call(this,i)||n),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],t.currentItem||t.element)&&(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),n},dragStart:function(t,i){t.element.parentsUntil("body").bind("scroll.droppable",function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&&e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var n,r,o,s=e.ui.intersect(t,this,this.options.tolerance),a=!s&&this.isover?"isout":s&&!this.isover?"isover":null;a&&(this.options.greedy&&(r=this.options.scope,o=this.element.parents(":data(ui-droppable)").filter(function(){return e.data(this,"ui-droppable").options.scope===r}),o.length&&(n=e.data(o[0],"ui-droppable"),n.greedyChild="isover"===a)),n&&"isover"===a&&(n.isover=!1,n.isout=!0,n._out.call(n,i)),this[a]=!0,this["isout"===a?"isover":"isout"]=!1,this["isover"===a?"_over":"_out"].call(this,i),n&&"isout"===a&&(n.isout=!1,n.isover=!0,n._over.call(n,i)))}})},dragStop:function(t,i){t.element.parentsUntil("body").unbind("scroll.droppable"),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}}}(jQuery),function(e){function t(e){return parseInt(e,10)||0}function i(e){return!isNaN(parseInt(e,10))}e.widget("ui.resizable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"resize",options:{alsoResize:!1,animate:!1,animateDuration:"slow",animateEasing:"swing",aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:"e,s,se",helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_create:function(){var t,i,n,r,o,s=this,a=this.options;if(this.element.addClass("ui-resizable"),e.extend(this,{_aspectRatio:!!a.aspectRatio,aspectRatio:a.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:a.helper||a.ghost||a.animate?a.helper||"ui-resizable-helper":null}),this.element[0].nodeName.match(/canvas|textarea|input|select|button|img/i)&&(this.element.wrap(e("<div class='ui-wrapper' style='overflow: hidden;'></div>").css({position:this.element.css("position"),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css("top"),left:this.element.css("left")})),this.element=this.element.parent().data("ui-resizable",this.element.data("ui-resizable")),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css("marginLeft"),marginTop:this.originalElement.css("marginTop"),marginRight:this.originalElement.css("marginRight"),marginBottom:this.originalElement.css("marginBottom")}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css("resize"),this.originalElement.css("resize","none"),this._proportionallyResizeElements.push(this.originalElement.css({position:"static",zoom:1,display:"block"})),this.originalElement.css({margin:this.originalElement.css("margin")}),this._proportionallyResize()),this.handles=a.handles||(e(".ui-resizable-handle",this.element).length?{n:".ui-resizable-n",e:".ui-resizable-e",s:".ui-resizable-s",w:".ui-resizable-w",se:".ui-resizable-se",sw:".ui-resizable-sw",ne:".ui-resizable-ne",nw:".ui-resizable-nw"}:"e,s,se"),this.handles.constructor===String)for("all"===this.handles&&(this.handles="n,e,s,w,se,sw,ne,nw"),t=this.handles.split(","),this.handles={},i=0;i<t.length;i++)n=e.trim(t[i]),o="ui-resizable-"+n,r=e("<div class='ui-resizable-handle "+o+"'></div>"),r.css({zIndex:a.zIndex}),"se"===n&&r.addClass("ui-icon ui-icon-gripsmall-diagonal-se"),this.handles[n]=".ui-resizable-"+n,this.element.append(r);this._renderAxis=function(t){var i,n,r,o;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String&&(this.handles[i]=e(this.handles[i],this.element).show()),this.elementIsWrapper&&this.originalElement[0].nodeName.match(/textarea|input|select|button/i)&&(n=e(this.handles[i],this.element),o=/sw|ne|nw|se|n|s/.test(i)?n.outerHeight():n.outerWidth(),r=["padding",/ne|nw|n/.test(i)?"Top":/se|sw|s/.test(i)?"Bottom":/^e$/.test(i)?"Right":"Left"].join(""),t.css(r,o),this._proportionallyResize()),e(this.handles[i]).length},this._renderAxis(this.element),this._handles=e(".ui-resizable-handle",this.element).disableSelection(),this._handles.mouseover(function(){s.resizing||(this.className&&(r=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),s.axis=r&&r[1]?r[1]:"se")}),a.autoHide&&(this._handles.hide(),e(this.element).addClass("ui-resizable-autohide").mouseenter(function(){a.disabled||(e(this).removeClass("ui-resizable-autohide"),s._handles.show())}).mouseleave(function(){a.disabled||s.resizing||(e(this).addClass("ui-resizable-autohide"),s._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass("ui-resizable ui-resizable-disabled ui-resizable-resizing").removeData("resizable").removeData("ui-resizable").unbind(".resizable").find(".ui-resizable-handle").remove()};return this.elementIsWrapper&&(i(this.element),t=this.element,this.originalElement.css({position:t.css("position"),width:t.outerWidth(),height:t.outerHeight(),top:t.css("top"),left:t.css("left")}).insertAfter(t),t.remove()),this.originalElement.css("resize",this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,n,r=!1;for(i in this.handles)n=e(this.handles[i])[0],(n===t.target||e.contains(n,t.target))&&(r=!0);return!this.options.disabled&&r},_mouseStart:function(i){var n,r,o,s=this.options,a=this.element.position(),l=this.element;return this.resizing=!0,/absolute/.test(l.css("position"))?l.css({position:"absolute",top:l.css("top"),left:l.css("left")}):l.is(".ui-draggable")&&l.css({position:"absolute",top:a.top,left:a.left}),this._renderProxy(),n=t(this.helper.css("left")),r=t(this.helper.css("top")),s.containment&&(n+=e(s.containment).scrollLeft()||0,r+=e(s.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:n,top:r},this.size=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalSize=this._helper?{width:l.outerWidth(),height:l.outerHeight()}:{width:l.width(),height:l.height()},this.originalPosition={left:n,top:r},this.sizeDiff={width:l.outerWidth()-l.width(),height:l.outerHeight()-l.height()},this.originalMousePosition={left:i.pageX,top:i.pageY},this.aspectRatio="number"==typeof s.aspectRatio?s.aspectRatio:this.originalSize.width/this.originalSize.height||1,o=e(".ui-resizable-"+this.axis).css("cursor"),e("body").css("cursor","auto"===o?this.axis+"-resize":o),l.addClass("ui-resizable-resizing"),this._propagate("start",i),!0},_mouseDrag:function(t){var i,n=this.helper,r={},o=this.originalMousePosition,s=this.axis,a=this.position.top,l=this.position.left,h=this.size.width,c=this.size.height,u=t.pageX-o.left||0,d=t.pageY-o.top||0,p=this._change[s];return p?(i=p.apply(this,[t,u,d]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&&(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate("resize",t),this.position.top!==a&&(r.top=this.position.top+"px"),this.position.left!==l&&(r.left=this.position.left+"px"),this.size.width!==h&&(r.width=this.size.width+"px"),this.size.height!==c&&(r.height=this.size.height+"px"),n.css(r),!this._helper&&this._proportionallyResizeElements.length&&this._proportionallyResize(),e.isEmptyObject(r)||this._trigger("resize",t,this.ui()),!1):!1
},_mouseStop:function(t){this.resizing=!1;var i,n,r,o,s,a,l,h=this.options,c=this;return this._helper&&(i=this._proportionallyResizeElements,n=i.length&&/textarea/i.test(i[0].nodeName),r=n&&e.ui.hasScroll(i[0],"left")?0:c.sizeDiff.height,o=n?0:c.sizeDiff.width,s={width:c.helper.width()-o,height:c.helper.height()-r},a=parseInt(c.element.css("left"),10)+(c.position.left-c.originalPosition.left)||null,l=parseInt(c.element.css("top"),10)+(c.position.top-c.originalPosition.top)||null,h.animate||this.element.css(e.extend(s,{top:l,left:a})),c.helper.height(c.size.height),c.helper.width(c.size.width),this._helper&&!h.animate&&this._proportionallyResize()),e("body").css("cursor","auto"),this.element.removeClass("ui-resizable-resizing"),this._propagate("stop",t),this._helper&&this.helper.remove(),!1},_updateVirtualBoundaries:function(e){var t,n,r,o,s,a=this.options;s={minWidth:i(a.minWidth)?a.minWidth:0,maxWidth:i(a.maxWidth)?a.maxWidth:1/0,minHeight:i(a.minHeight)?a.minHeight:0,maxHeight:i(a.maxHeight)?a.maxHeight:1/0},(this._aspectRatio||e)&&(t=s.minHeight*this.aspectRatio,r=s.minWidth/this.aspectRatio,n=s.maxHeight*this.aspectRatio,o=s.maxWidth/this.aspectRatio,t>s.minWidth&&(s.minWidth=t),r>s.minHeight&&(s.minHeight=r),n<s.maxWidth&&(s.maxWidth=n),o<s.maxHeight&&(s.maxHeight=o)),this._vBoundaries=s},_updateCache:function(e){this.offset=this.helper.offset(),i(e.left)&&(this.position.left=e.left),i(e.top)&&(this.position.top=e.top),i(e.height)&&(this.size.height=e.height),i(e.width)&&(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,n=this.size,r=this.axis;return i(e.height)?e.width=e.height*this.aspectRatio:i(e.width)&&(e.height=e.width/this.aspectRatio),"sw"===r&&(e.left=t.left+(n.width-e.width),e.top=null),"nw"===r&&(e.top=t.top+(n.height-e.height),e.left=t.left+(n.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,n=this.axis,r=i(e.width)&&t.maxWidth&&t.maxWidth<e.width,o=i(e.height)&&t.maxHeight&&t.maxHeight<e.height,s=i(e.width)&&t.minWidth&&t.minWidth>e.width,a=i(e.height)&&t.minHeight&&t.minHeight>e.height,l=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,c=/sw|nw|w/.test(n),u=/nw|ne|n/.test(n);return s&&(e.width=t.minWidth),a&&(e.height=t.minHeight),r&&(e.width=t.maxWidth),o&&(e.height=t.maxHeight),s&&c&&(e.left=l-t.minWidth),r&&c&&(e.left=l-t.maxWidth),a&&u&&(e.top=h-t.minHeight),o&&u&&(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_proportionallyResize:function(){if(this._proportionallyResizeElements.length){var e,t,i,n,r,o=this.helper||this.element;for(e=0;e<this._proportionallyResizeElements.length;e++){if(r=this._proportionallyResizeElements[e],!this.borderDif)for(this.borderDif=[],i=[r.css("borderTopWidth"),r.css("borderRightWidth"),r.css("borderBottomWidth"),r.css("borderLeftWidth")],n=[r.css("paddingTop"),r.css("paddingRight"),r.css("paddingBottom"),r.css("paddingLeft")],t=0;t<i.length;t++)this.borderDif[t]=(parseInt(i[t],10)||0)+(parseInt(n[t],10)||0);r.css({height:o.height()-this.borderDif[0]-this.borderDif[2]||0,width:o.width()-this.borderDif[1]-this.borderDif[3]||0})}}},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e("<div style='overflow:hidden;'></div>"),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:"absolute",left:this.elementOffset.left+"px",top:this.elementOffset.top+"px",zIndex:++i.zIndex}),this.helper.appendTo("body").disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,n=this.originalPosition;return{left:n.left+t,width:i.width-t}},n:function(e,t,i){var n=this.originalSize,r=this.originalPosition;return{top:r.top+i,height:n.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},sw:function(t,i,n){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,n]))},ne:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,n]))},nw:function(t,i,n){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,n]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),"resize"!==t&&this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add("resizable","animate",{stop:function(t){var i=e(this).data("ui-resizable"),n=i.options,r=i._proportionallyResizeElements,o=r.length&&/textarea/i.test(r[0].nodeName),s=o&&e.ui.hasScroll(r[0],"left")?0:i.sizeDiff.height,a=o?0:i.sizeDiff.width,l={width:i.size.width-a,height:i.size.height-s},h=parseInt(i.element.css("left"),10)+(i.position.left-i.originalPosition.left)||null,c=parseInt(i.element.css("top"),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(l,c&&h?{top:c,left:h}:{}),{duration:n.animateDuration,easing:n.animateEasing,step:function(){var n={width:parseInt(i.element.css("width"),10),height:parseInt(i.element.css("height"),10),top:parseInt(i.element.css("top"),10),left:parseInt(i.element.css("left"),10)};r&&r.length&&e(r[0]).css({width:n.width,height:n.height}),i._updateCache(n),i._propagate("resize",t)}})}}),e.ui.plugin.add("resizable","containment",{start:function(){var i,n,r,o,s,a,l,h=e(this).data("ui-resizable"),c=h.options,u=h.element,d=c.containment,p=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;p&&(h.containerElement=e(p),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(i=e(p),n=[],e(["Top","Right","Left","Bottom"]).each(function(e,r){n[e]=t(i.css("padding"+r))}),h.containerOffset=i.offset(),h.containerPosition=i.position(),h.containerSize={height:i.innerHeight()-n[3],width:i.innerWidth()-n[1]},r=h.containerOffset,o=h.containerSize.height,s=h.containerSize.width,a=e.ui.hasScroll(p,"left")?p.scrollWidth:s,l=e.ui.hasScroll(p)?p.scrollHeight:o,h.parentData={element:p,left:r.left,top:r.top,width:a,height:l}))},resize:function(t){var i,n,r,o,s=e(this).data("ui-resizable"),a=s.options,l=s.containerOffset,h=s.position,c=s._aspectRatio||t.shiftKey,u={top:0,left:0},d=s.containerElement;d[0]!==document&&/static/.test(d.css("position"))&&(u=l),h.left<(s._helper?l.left:0)&&(s.size.width=s.size.width+(s._helper?s.position.left-l.left:s.position.left-u.left),c&&(s.size.height=s.size.width/s.aspectRatio),s.position.left=a.helper?l.left:0),h.top<(s._helper?l.top:0)&&(s.size.height=s.size.height+(s._helper?s.position.top-l.top:s.position.top),c&&(s.size.width=s.size.height*s.aspectRatio),s.position.top=s._helper?l.top:0),s.offset.left=s.parentData.left+s.position.left,s.offset.top=s.parentData.top+s.position.top,i=Math.abs((s._helper?s.offset.left-u.left:s.offset.left-u.left)+s.sizeDiff.width),n=Math.abs((s._helper?s.offset.top-u.top:s.offset.top-l.top)+s.sizeDiff.height),r=s.containerElement.get(0)===s.element.parent().get(0),o=/relative|absolute/.test(s.containerElement.css("position")),r&&o&&(i-=s.parentData.left),i+s.size.width>=s.parentData.width&&(s.size.width=s.parentData.width-i,c&&(s.size.height=s.size.width/s.aspectRatio)),n+s.size.height>=s.parentData.height&&(s.size.height=s.parentData.height-n,c&&(s.size.width=s.size.height*s.aspectRatio))},stop:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.containerOffset,r=t.containerPosition,o=t.containerElement,s=e(t.helper),a=s.offset(),l=s.outerWidth()-t.sizeDiff.width,h=s.outerHeight()-t.sizeDiff.height;t._helper&&!i.animate&&/relative/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:h}),t._helper&&!i.animate&&/static/.test(o.css("position"))&&e(this).css({left:a.left-r.left-n.left,width:l,height:h})}}),e.ui.plugin.add("resizable","alsoResize",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=function(t){e(t).each(function(){var t=e(this);t.data("ui-resizable-alsoresize",{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css("left"),10),top:parseInt(t.css("top"),10)})})};"object"!=typeof i.alsoResize||i.alsoResize.parentNode?n(i.alsoResize):i.alsoResize.length?(i.alsoResize=i.alsoResize[0],n(i.alsoResize)):e.each(i.alsoResize,function(e){n(e)})},resize:function(t,i){var n=e(this).data("ui-resizable"),r=n.options,o=n.originalSize,s=n.originalPosition,a={height:n.size.height-o.height||0,width:n.size.width-o.width||0,top:n.position.top-s.top||0,left:n.position.left-s.left||0},l=function(t,n){e(t).each(function(){var t=e(this),r=e(this).data("ui-resizable-alsoresize"),o={},s=n&&n.length?n:t.parents(i.originalElement[0]).length?["width","height"]:["width","height","top","left"];e.each(s,function(e,t){var i=(r[t]||0)+(a[t]||0);i&&i>=0&&(o[t]=i||null)}),t.css(o)})};"object"!=typeof r.alsoResize||r.alsoResize.nodeType?l(r.alsoResize):e.each(r.alsoResize,function(e,t){l(e,t)})},stop:function(){e(this).removeData("resizable-alsoresize")}}),e.ui.plugin.add("resizable","ghost",{start:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:"block",position:"relative",height:n.height,width:n.width,margin:0,left:0,top:0}).addClass("ui-resizable-ghost").addClass("string"==typeof i.ghost?i.ghost:""),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).data("ui-resizable");t.ghost&&t.ghost.css({position:"relative",height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).data("ui-resizable");t.ghost&&t.helper&&t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add("resizable","grid",{resize:function(){var t=e(this).data("ui-resizable"),i=t.options,n=t.size,r=t.originalSize,o=t.originalPosition,s=t.axis,a="number"==typeof i.grid?[i.grid,i.grid]:i.grid,l=a[0]||1,h=a[1]||1,c=Math.round((n.width-r.width)/l)*l,u=Math.round((n.height-r.height)/h)*h,d=r.width+c,p=r.height+u,f=i.maxWidth&&i.maxWidth<d,m=i.maxHeight&&i.maxHeight<p,g=i.minWidth&&i.minWidth>d,v=i.minHeight&&i.minHeight>p;i.grid=a,g&&(d+=l),v&&(p+=h),f&&(d-=l),m&&(p-=h),/^(se|s|e)$/.test(s)?(t.size.width=d,t.size.height=p):/^(ne)$/.test(s)?(t.size.width=d,t.size.height=p,t.position.top=o.top-u):/^(sw)$/.test(s)?(t.size.width=d,t.size.height=p,t.position.left=o.left-c):(t.size.width=d,t.size.height=p,t.position.top=o.top-u,t.position.left=o.left-c)}})}(jQuery),function(e){e.widget("ui.selectable",e.ui.mouse,{version:"1.10.3",options:{appendTo:"body",autoRefresh:!0,distance:0,filter:"*",tolerance:"touch",selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass("ui-selectable"),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass("ui-selectee"),t.each(function(){var t=e(this),i=t.offset();e.data(this,"selectable-item",{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass("ui-selected"),selecting:t.hasClass("ui-selecting"),unselecting:t.hasClass("ui-unselecting")})})},this.refresh(),this.selectees=t.addClass("ui-selectee"),this._mouseInit(),this.helper=e("<div class='ui-selectable-helper'></div>")},_destroy:function(){this.selectees.removeClass("ui-selectee").removeData("selectable-item"),this.element.removeClass("ui-selectable ui-selectable-disabled"),this._mouseDestroy()},_mouseStart:function(t){var i=this,n=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(n.filter,this.element[0]),this._trigger("start",t),e(n.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),n.autoRefresh&&this.refresh(),this.selectees.filter(".ui-selected").each(function(){var n=e.data(this,"selectable-item");n.startselected=!0,t.metaKey||t.ctrlKey||(n.$element.removeClass("ui-selected"),n.selected=!1,n.$element.addClass("ui-unselecting"),n.unselecting=!0,i._trigger("unselecting",t,{unselecting:n.element}))}),e(t.target).parents().addBack().each(function(){var n,r=e.data(this,"selectable-item");return r?(n=!t.metaKey&&!t.ctrlKey||!r.$element.hasClass("ui-selected"),r.$element.removeClass(n?"ui-unselecting":"ui-selected").addClass(n?"ui-selecting":"ui-unselecting"),r.unselecting=!n,r.selecting=n,r.selected=n,n?i._trigger("selecting",t,{selecting:r.element}):i._trigger("unselecting",t,{unselecting:r.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,n=this,r=this.options,o=this.opos[0],s=this.opos[1],a=t.pageX,l=t.pageY;return o>a&&(i=a,a=o,o=i),s>l&&(i=l,l=s,s=i),this.helper.css({left:o,top:s,width:a-o,height:l-s}),this.selectees.each(function(){var i=e.data(this,"selectable-item"),h=!1;i&&i.element!==n.element[0]&&("touch"===r.tolerance?h=!(i.left>a||i.right<o||i.top>l||i.bottom<s):"fit"===r.tolerance&&(h=i.left>o&&i.right<a&&i.top>s&&i.bottom<l),h?(i.selected&&(i.$element.removeClass("ui-selected"),i.selected=!1),i.unselecting&&(i.$element.removeClass("ui-unselecting"),i.unselecting=!1),i.selecting||(i.$element.addClass("ui-selecting"),i.selecting=!0,n._trigger("selecting",t,{selecting:i.element}))):(i.selecting&&((t.metaKey||t.ctrlKey)&&i.startselected?(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.$element.addClass("ui-selected"),i.selected=!0):(i.$element.removeClass("ui-selecting"),i.selecting=!1,i.startselected&&(i.$element.addClass("ui-unselecting"),i.unselecting=!0),n._trigger("unselecting",t,{unselecting:i.element}))),i.selected&&(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass("ui-selected"),i.selected=!1,i.$element.addClass("ui-unselecting"),i.unselecting=!0,n._trigger("unselecting",t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(".ui-unselecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-unselecting"),n.unselecting=!1,n.startselected=!1,i._trigger("unselected",t,{unselected:n.element})}),e(".ui-selecting",this.element[0]).each(function(){var n=e.data(this,"selectable-item");n.$element.removeClass("ui-selecting").addClass("ui-selected"),n.selecting=!1,n.selected=!0,n.startselected=!0,i._trigger("selected",t,{selected:n.element})}),this._trigger("stop",t),this.helper.remove(),!1}})}(jQuery),function(e){function t(e,t,i){return e>t&&t+i>e}function i(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))}e.widget("ui.sortable",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_create:function(){var e=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===e.axis||i(this.items[0].item):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var e=this.items.length-1;e>=0;e--)this.items[e].item.removeData(this.widgetName+"-item");return this},_setOption:function(t,i){"disabled"===t?(this.options[t]=i,this.widget().toggleClass("ui-sortable-disabled",!!i)):e.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(t,i){var n=null,r=!1,o=this;return this.reverting?!1:this.options.disabled||"static"===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,o.widgetName+"-item")===o?(n=e(this),!1):void 0}),e.data(t.target,o.widgetName+"-item")===o&&(n=e(t.target)),n?!this.options.handle||i||(e(this.options.handle,n).find("*").addBack().each(function(){this===t.target&&(r=!0)}),r)?(this.currentItem=n,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,n){var r,o,s=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,s.cursorAt&&this._adjustOffsetFromHelper(s.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),s.containment&&this._setContainment(),s.cursor&&"auto"!==s.cursor&&(o=this.document.find("body"),this.storedCursor=o.css("cursor"),o.css("cursor",s.cursor),this.storedStylesheet=e("<style>*{ cursor: "+s.cursor+" !important; }</style>").appendTo(o)),s.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",s.opacity)),s.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",s.zIndex)),this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!n)for(r=this.containers.length-1;r>=0;r--)this.containers[r]._trigger("activate",t,this._uiHash(this));return e.ui.ddmanager&&(e.ui.ddmanager.current=this),e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,n,r,o,s=this.options,a=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&&(this.scrollParent[0]!==document&&"HTML"!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY<s.scrollSensitivity?this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop+s.scrollSpeed:t.pageY-this.overflowOffset.top<s.scrollSensitivity&&(this.scrollParent[0].scrollTop=a=this.scrollParent[0].scrollTop-s.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX<s.scrollSensitivity?this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft+s.scrollSpeed:t.pageX-this.overflowOffset.left<s.scrollSensitivity&&(this.scrollParent[0].scrollLeft=a=this.scrollParent[0].scrollLeft-s.scrollSpeed)):(t.pageY-e(document).scrollTop()<s.scrollSensitivity?a=e(document).scrollTop(e(document).scrollTop()-s.scrollSpeed):e(window).height()-(t.pageY-e(document).scrollTop())<s.scrollSensitivity&&(a=e(document).scrollTop(e(document).scrollTop()+s.scrollSpeed)),t.pageX-e(document).scrollLeft()<s.scrollSensitivity?a=e(document).scrollLeft(e(document).scrollLeft()-s.scrollSpeed):e(window).width()-(t.pageX-e(document).scrollLeft())<s.scrollSensitivity&&(a=e(document).scrollLeft(e(document).scrollLeft()+s.scrollSpeed))),a!==!1&&e.ui.ddmanager&&!s.dropBehaviour&&e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"===this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"===this.options.axis||(this.helper[0].style.top=this.position.top+"px"),i=this.items.length-1;i>=0;i--)if(n=this.items[i],r=n.item[0],o=this._intersectsWithPointer(n),o&&n.instance===this.currentContainer&&r!==this.currentItem[0]&&this.placeholder[1===o?"next":"prev"]()[0]!==r&&!e.contains(this.placeholder[0],r)&&("semi-dynamic"===this.options.type?!e.contains(this.element[0],r):!0)){if(this.direction=1===o?"down":"up","pointer"!==this.options.tolerance&&!this._intersectsWithSides(n))break;this._rearrange(t,n),this._trigger("change",t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&&e.ui.ddmanager.drag(this,t),this._trigger("sort",t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&&!this.options.dropBehaviour&&e.ui.ddmanager.drop(this,t),this.options.revert){var n=this,r=this.placeholder.offset(),o=this.options.axis,s={};o&&"x"!==o||(s.left=r.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollLeft)),o&&"y"!==o||(s.top=r.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===document.body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(s,parseInt(this.options.revert,10)||500,function(){n._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"===this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var t=this.containers.length-1;t>=0;t--)this.containers[t]._trigger("deactivate",null,this._uiHash(this)),this.containers[t].containerCache.over&&(this.containers[t]._trigger("out",null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!==this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||"id")||"").match(t.expression||/(.+)[\-=_](.+)/);i&&n.push((t.key||i[1]+"[]")+"="+(t.key&&t.expression?i[1]:i[2]))}),!n.length&&t.key&&n.push(t.key+"="),n.join("&")},toArray:function(t){var i=this._getItemsAsjQuery(t&&t.connected),n=[];return t=t||{},i.each(function(){n.push(e(t.item||this).attr(t.attribute||"id")||"")}),n},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,n=this.positionAbs.top,r=n+this.helperProportions.height,o=e.left,s=o+e.width,a=e.top,l=a+e.height,h=this.offset.click.top,c=this.offset.click.left,u="x"===this.options.axis||n+h>a&&l>n+h,d="y"===this.options.axis||t+c>o&&s>t+c,p=u&&d;return"pointer"===this.options.tolerance||this.options.forcePointerForContainers||"pointer"!==this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>e[this.floating?"width":"height"]?p:o<t+this.helperProportions.width/2&&i-this.helperProportions.width/2<s&&a<n+this.helperProportions.height/2&&r-this.helperProportions.height/2<l},_intersectsWithPointer:function(e){var i="x"===this.options.axis||t(this.positionAbs.top+this.offset.click.top,e.top,e.height),n="y"===this.options.axis||t(this.positionAbs.left+this.offset.click.left,e.left,e.width),r=i&&n,o=this._getDragVerticalDirection(),s=this._getDragHorizontalDirection();return r?this.floating?s&&"right"===s||"down"===o?2:1:o&&("down"===o?2:1):!1},_intersectsWithSides:function(e){var i=t(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),n=t(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),r=this._getDragVerticalDirection(),o=this._getDragHorizontalDirection();return this.floating&&o?"right"===o&&n||"left"===o&&!n:r&&("down"===r&&i||"up"===r&&!i)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&&(e>0?"down":"up")},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&&(e>0?"right":"left")},refresh:function(e){return this._refreshItems(e),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){var i,n,r,o,s=[],a=[],l=this._connectWith();if(l&&t)for(i=l.length-1;i>=0;i--)for(r=e(l[i]),n=r.length-1;n>=0;n--)o=e.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&a.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),o]);for(a.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]),i=a.length-1;i>=0;i--)a[i][0].each(function(){s.push(this)});return e(s)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=e.grep(this.items,function(e){for(var i=0;i<t.length;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,n,r,o,s,a,l,h,c=this.items,u=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],d=this._connectWith();if(d&&this.ready)for(i=d.length-1;i>=0;i--)for(r=e(d[i]),n=r.length-1;n>=0;n--)o=e.data(r[n],this.widgetFullName),o&&o!==this&&!o.options.disabled&&(u.push([e.isFunction(o.options.items)?o.options.items.call(o.element[0],t,{item:this.currentItem}):e(o.options.items,o.element),o]),this.containers.push(o));for(i=u.length-1;i>=0;i--)for(s=u[i][1],a=u[i][0],n=0,h=a.length;h>n;n++)l=e(a[n]),l.data(this.widgetName+"-item",s),c.push({item:l,instance:s,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());var i,n,r,o;for(i=this.items.length-1;i>=0;i--)n=this.items[i],n.instance!==this.currentContainer&&this.currentContainer&&n.item[0]!==this.currentItem[0]||(r=this.options.toleranceElement?e(this.options.toleranceElement,n.item):n.item,t||(n.width=r.outerWidth(),n.height=r.outerHeight()),o=r.offset(),n.left=o.left,n.top=o.top);if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i>=0;i--)o=this.containers[i].element.offset(),this.containers[i].containerCache.left=o.left,this.containers[i].containerCache.top=o.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,n=t.options;n.placeholder&&n.placeholder.constructor!==String||(i=n.placeholder,n.placeholder={element:function(){var n=t.currentItem[0].nodeName.toLowerCase(),r=e("<"+n+">",t.document[0]).addClass(i||t.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper");return"tr"===n?t.currentItem.children().each(function(){e("<td>&#160;</td>",t.document[0]).attr("colspan",e(this).attr("colspan")||1).appendTo(r)}):"img"===n&&r.attr("src",t.currentItem.attr("src")),i||r.css("visibility","hidden"),r},update:function(e,r){(!i||n.forcePlaceholderSize)&&(r.height()||r.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css("paddingTop")||0,10)-parseInt(t.currentItem.css("paddingBottom")||0,10)),r.width()||r.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css("paddingLeft")||0,10)-parseInt(t.currentItem.css("paddingRight")||0,10)))}}),t.placeholder=e(n.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),n.placeholder.update(t,t.placeholder)},_contactContainers:function(n){var r,o,s,a,l,h,c,u,d,p,f=null,m=null;for(r=this.containers.length-1;r>=0;r--)if(!e.contains(this.currentItem[0],this.containers[r].element[0]))if(this._intersectsWith(this.containers[r].containerCache)){if(f&&e.contains(this.containers[r].element[0],f.element[0]))continue;f=this.containers[r],m=r}else this.containers[r].containerCache.over&&(this.containers[r]._trigger("out",n,this._uiHash(this)),this.containers[r].containerCache.over=0);if(f)if(1===this.containers.length)this.containers[m].containerCache.over||(this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1);else{for(s=1e4,a=null,p=f.floating||i(this.currentItem),l=p?"left":"top",h=p?"width":"height",c=this.positionAbs[l]+this.offset.click[l],o=this.items.length-1;o>=0;o--)e.contains(this.containers[m].element[0],this.items[o].item[0])&&this.items[o].item[0]!==this.currentItem[0]&&(!p||t(this.positionAbs.top+this.offset.click.top,this.items[o].top,this.items[o].height))&&(u=this.items[o].item.offset()[l],d=!1,Math.abs(u-c)>Math.abs(u+this.items[o][h]-c)&&(d=!0,u+=this.items[o][h]),Math.abs(u-c)<s&&(s=Math.abs(u-c),a=this.items[o],this.direction=d?"up":"down"));if(!a&&!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[m])return;a?this._rearrange(n,a,null,!0):this._rearrange(n,null,this.containers[m].element,!0),this._trigger("change",n,this._uiHash()),this.containers[m]._trigger("change",n,this._uiHash(this)),this.currentContainer=this.containers[m],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[m]._trigger("over",n,this._uiHash(this)),this.containers[m].containerCache.over=1}},_createHelper:function(t){var i=this.options,n=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):"clone"===i.helper?this.currentItem.clone():this.currentItem;return n.parents("body").length||e("parent"!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(n[0]),n[0]===this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(!n[0].style.width||i.forceHelperSize)&&n.width(this.currentItem.width()),(!n[0].style.height||i.forceHelperSize)&&n.height(this.currentItem.height()),n},_adjustOffsetFromHelper:function(t){"string"==typeof t&&(t=t.split(" ")),e.isArray(t)&&(t={left:+t[0],top:+t[1]||0}),"left"in t&&(this.offset.click.left=t.left+this.margins.left),"right"in t&&(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),"top"in t&&(this.offset.click.top=t.top+this.margins.top),"bottom"in t&&(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return"absolute"===this.cssPosition&&this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])&&(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===document.body||this.offsetParent[0].tagName&&"html"===this.offsetParent[0].tagName.toLowerCase()&&e.ui.ie)&&(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:t.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}
}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,n,r=this.options;"parent"===r.containment&&(r.containment=this.helper[0].parentNode),("document"===r.containment||"window"===r.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,e("document"===r.containment?document:window).width()-this.helperProportions.width-this.margins.left,(e("document"===r.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(r.containment)||(t=e(r.containment)[0],i=e(r.containment).offset(),n="hidden"!==e(t).css("overflow"),this.containment=[i.left+(parseInt(e(t).css("borderLeftWidth"),10)||0)+(parseInt(e(t).css("paddingLeft"),10)||0)-this.margins.left,i.top+(parseInt(e(t).css("borderTopWidth"),10)||0)+(parseInt(e(t).css("paddingTop"),10)||0)-this.margins.top,i.left+(n?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css("borderLeftWidth"),10)||0)-(parseInt(e(t).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,i.top+(n?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css("borderTopWidth"),10)||0)-(parseInt(e(t).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var n="absolute"===t?1:-1,r="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,o=/(html|body)/i.test(r[0].tagName);return{top:i.top+this.offset.relative.top*n+this.offset.parent.top*n-("fixed"===this.cssPosition?-this.scrollParent.scrollTop():o?0:r.scrollTop())*n,left:i.left+this.offset.relative.left*n+this.offset.parent.left*n-("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():o?0:r.scrollLeft())*n}},_generatePosition:function(t){var i,n,r=this.options,o=t.pageX,s=t.pageY,a="absolute"!==this.cssPosition||this.scrollParent[0]!==document&&e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,l=/(html|body)/i.test(a[0].tagName);return"relative"!==this.cssPosition||this.scrollParent[0]!==document&&this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&&(this.containment&&(t.pageX-this.offset.click.left<this.containment[0]&&(o=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top<this.containment[1]&&(s=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left>this.containment[2]&&(o=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top>this.containment[3]&&(s=this.containment[3]+this.offset.click.top)),r.grid&&(i=this.originalPageY+Math.round((s-this.originalPageY)/r.grid[1])*r.grid[1],s=this.containment?i-this.offset.click.top>=this.containment[1]&&i-this.offset.click.top<=this.containment[3]?i:i-this.offset.click.top>=this.containment[1]?i-r.grid[1]:i+r.grid[1]:i,n=this.originalPageX+Math.round((o-this.originalPageX)/r.grid[0])*r.grid[0],o=this.containment?n-this.offset.click.left>=this.containment[0]&&n-this.offset.click.left<=this.containment[2]?n:n-this.offset.click.left>=this.containment[0]?n-r.grid[0]:n+r.grid[0]:n)),{top:s-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"===this.cssPosition?-this.scrollParent.scrollTop():l?0:a.scrollTop()),left:o-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"===this.cssPosition?-this.scrollParent.scrollLeft():l?0:a.scrollLeft())}},_rearrange:function(e,t,i,n){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],"down"===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var r=this.counter;this._delay(function(){r===this.counter&&this.refreshPositions(!n)})},_clear:function(e,t){this.reverting=!1;var i,n=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(i in this._storedCSS)("auto"===this._storedCSS[i]||"static"===this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();for(this.fromOutside&&!t&&n.push(function(e){this._trigger("receive",e,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev===this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger("update",e,this._uiHash())}),this!==this.currentContainer&&(t||(n.push(function(e){this._trigger("remove",e,this._uiHash())}),n.push(function(e){return function(t){e._trigger("receive",t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger("update",t,this._uiHash(this))}}.call(this,this.currentContainer)))),i=this.containers.length-1;i>=0;i--)t||n.push(function(e){return function(t){e._trigger("deactivate",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(n.push(function(e){return function(t){e._trigger("out",t,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this.storedCursor&&(this.document.find("body").css("cursor",this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"===this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!t){for(this._trigger("beforeStop",e,this._uiHash()),i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!1}if(t||this._trigger("beforeStop",e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!==this.currentItem[0]&&this.helper.remove(),this.helper=null,!t){for(i=0;i<n.length;i++)n[i].call(this,e);this._trigger("stop",e,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}})}(jQuery),function(e,t){var i="ui-effects-";e.effects={effect:{}},function(e,t){function i(e,t,i){var n=u[t.type]||{};return null==e?i||!t.def?null:t.def:(e=n.floor?~~e:parseFloat(e),isNaN(e)?t.def:n.mod?(e+n.mod)%n.mod:0>e?0:n.max<e?n.max:e)}function n(t){var i=h(),n=i._rgba=[];return t=t.toLowerCase(),f(l,function(e,r){var o,s=r.re.exec(t),a=s&&r.parse(s),l=r.space||"rgba";return a?(o=i[l](a),i[c[l].cache]=o[c[l].cache],n=i._rgba=o._rgba,!1):void 0}),n.length?("0,0,0,0"===n.join()&&e.extend(n,o.transparent),i):o[t]}function r(e,t,i){return i=(i+1)%1,1>6*i?e+6*(t-e)*i:1>2*i?t:2>3*i?e+6*(t-e)*(2/3-i):e}var o,s="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor",a=/^([\-+])=\s*(\d+\.?\d*)/,l=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:"hsla",parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],h=e.Color=function(t,i,n,r){return new e.Color.fn.parse(t,i,n,r)},c={rgba:{props:{red:{idx:0,type:"byte"},green:{idx:1,type:"byte"},blue:{idx:2,type:"byte"}}},hsla:{props:{hue:{idx:0,type:"degrees"},saturation:{idx:1,type:"percent"},lightness:{idx:2,type:"percent"}}}},u={"byte":{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},d=h.support={},p=e("<p>")[0],f=e.each;p.style.cssText="background-color:rgba(1,1,1,.5)",d.rgba=p.style.backgroundColor.indexOf("rgba")>-1,f(c,function(e,t){t.cache="_"+e,t.props.alpha={idx:3,type:"percent",def:1}}),h.fn=e.extend(h.prototype,{parse:function(r,s,a,l){if(r===t)return this._rgba=[null,null,null,null],this;(r.jquery||r.nodeType)&&(r=e(r).css(s),s=t);var u=this,d=e.type(r),p=this._rgba=[];return s!==t&&(r=[r,s,a,l],d="array"),"string"===d?this.parse(n(r)||o._default):"array"===d?(f(c.rgba.props,function(e,t){p[t.idx]=i(r[t.idx],t)}),this):"object"===d?(r instanceof h?f(c,function(e,t){r[t.cache]&&(u[t.cache]=r[t.cache].slice())}):f(c,function(t,n){var o=n.cache;f(n.props,function(e,t){if(!u[o]&&n.to){if("alpha"===e||null==r[e])return;u[o]=n.to(u._rgba)}u[o][t.idx]=i(r[e],t,!0)}),u[o]&&e.inArray(null,u[o].slice(0,3))<0&&(u[o][3]=1,n.from&&(u._rgba=n.from(u[o])))}),this):void 0},is:function(e){var t=h(e),i=!0,n=this;return f(c,function(e,r){var o,s=t[r.cache];return s&&(o=n[r.cache]||r.to&&r.to(n._rgba)||[],f(r.props,function(e,t){return null!=s[t.idx]?i=s[t.idx]===o[t.idx]:void 0})),i}),i},_space:function(){var e=[],t=this;return f(c,function(i,n){t[n.cache]&&e.push(i)}),e.pop()},transition:function(e,t){var n=h(e),r=n._space(),o=c[r],s=0===this.alpha()?h("transparent"):this,a=s[o.cache]||o.to(s._rgba),l=a.slice();return n=n[o.cache],f(o.props,function(e,r){var o=r.idx,s=a[o],h=n[o],c=u[r.type]||{};null!==h&&(null===s?l[o]=h:(c.mod&&(h-s>c.mod/2?s+=c.mod:s-h>c.mod/2&&(s-=c.mod)),l[o]=i((h-s)*t+s,r)))}),this[r](l)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),n=i.pop(),r=h(t)._rgba;return h(e.map(i,function(e,t){return(1-n)*r[t]+n*e}))},toRgbaString:function(){var t="rgba(",i=e.map(this._rgba,function(e,t){return null==e?t>2?1:0:e});return 1===i[3]&&(i.pop(),t="rgb("),t+i.join()+")"},toHslaString:function(){var t="hsla(",i=e.map(this.hsla(),function(e,t){return null==e&&(e=t>2?1:0),t&&3>t&&(e=Math.round(100*e)+"%"),e});return 1===i[3]&&(i.pop(),t="hsl("),t+i.join()+")"},toHexString:function(t){var i=this._rgba.slice(),n=i.pop();return t&&i.push(~~(255*n)),"#"+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?"0"+e:e}).join("")},toString:function(){return 0===this._rgba[3]?"transparent":this.toRgbaString()}}),h.fn.parse.prototype=h.fn,c.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,n=e[0]/255,r=e[1]/255,o=e[2]/255,s=e[3],a=Math.max(n,r,o),l=Math.min(n,r,o),h=a-l,c=a+l,u=.5*c;return t=l===a?0:n===a?60*(r-o)/h+360:r===a?60*(o-n)/h+120:60*(n-r)/h+240,i=0===h?0:.5>=u?h/c:h/(2-c),[Math.round(t)%360,i,u,null==s?1:s]},c.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],n=e[2],o=e[3],s=.5>=n?n*(1+i):n+i-n*i,a=2*n-s;return[Math.round(255*r(a,s,t+1/3)),Math.round(255*r(a,s,t)),Math.round(255*r(a,s,t-1/3)),o]},f(c,function(n,r){var o=r.props,s=r.cache,l=r.to,c=r.from;h.fn[n]=function(n){if(l&&!this[s]&&(this[s]=l(this._rgba)),n===t)return this[s].slice();var r,a=e.type(n),u="array"===a||"object"===a?n:arguments,d=this[s].slice();return f(o,function(e,t){var n=u["object"===a?e:t.idx];null==n&&(n=d[t.idx]),d[t.idx]=i(n,t)}),c?(r=h(c(d)),r[s]=d,r):h(d)},f(o,function(t,i){h.fn[t]||(h.fn[t]=function(r){var o,s=e.type(r),l="alpha"===t?this._hsla?"hsla":"rgba":n,h=this[l](),c=h[i.idx];return"undefined"===s?c:("function"===s&&(r=r.call(this,c),s=e.type(r)),null==r&&i.empty?this:("string"===s&&(o=a.exec(r),o&&(r=c+parseFloat(o[2])*("+"===o[1]?1:-1))),h[i.idx]=r,this[l](h)))})})}),h.hook=function(t){var i=t.split(" ");f(i,function(t,i){e.cssHooks[i]={set:function(t,r){var o,s,a="";if("transparent"!==r&&("string"!==e.type(r)||(o=n(r)))){if(r=h(o||r),!d.rgba&&1!==r._rgba[3]){for(s="backgroundColor"===i?t.parentNode:t;(""===a||"transparent"===a)&&s&&s.style;)try{a=e.css(s,"backgroundColor"),s=s.parentNode}catch(l){}r=r.blend(a&&"transparent"!==a?a:"_default")}r=r.toRgbaString()}try{t.style[i]=r}catch(l){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=h(t.elem,i),t.end=h(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},h.hook(s),e.cssHooks.borderColor={expand:function(e){var t={};return f(["Top","Right","Bottom","Left"],function(i,n){t["border"+n+"Color"]=e}),t}},o=e.Color.names={aqua:"#00ffff",black:"#000000",blue:"#0000ff",fuchsia:"#ff00ff",gray:"#808080",green:"#008000",lime:"#00ff00",maroon:"#800000",navy:"#000080",olive:"#808000",purple:"#800080",red:"#ff0000",silver:"#c0c0c0",teal:"#008080",white:"#ffffff",yellow:"#ffff00",transparent:[null,null,null,0],_default:"#ffffff"}}(jQuery),function(){function i(t){var i,n,r=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,o={};if(r&&r.length&&r[0]&&r[r[0]])for(n=r.length;n--;)i=r[n],"string"==typeof r[i]&&(o[e.camelCase(i)]=r[i]);else for(i in r)"string"==typeof r[i]&&(o[i]=r[i]);return o}function n(t,i){var n,r,s={};for(n in i)r=i[n],t[n]!==r&&(o[n]||(e.fx.step[n]||!isNaN(parseFloat(r)))&&(s[n]=r));return s}var r=["add","remove","toggle"],o={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each(["borderLeftStyle","borderRightStyle","borderBottomStyle","borderTopStyle"],function(t,i){e.fx.step[i]=function(e){("none"!==e.end&&!e.setAttr||1===e.pos&&!e.setAttr)&&(jQuery.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(t,o,s,a){var l=e.speed(o,s,a);return this.queue(function(){var o,s=e(this),a=s.attr("class")||"",h=l.children?s.find("*").addBack():s;h=h.map(function(){var t=e(this);return{el:t,start:i(this)}}),o=function(){e.each(r,function(e,i){t[i]&&s[i+"Class"](t[i])})},o(),h=h.map(function(){return this.end=i(this.el[0]),this.diff=n(this.start,this.end),this}),s.attr("class",a),h=h.map(function(){var t=this,i=e.Deferred(),n=e.extend({},l,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,n),i.promise()}),e.when.apply(e,h.get()).done(function(){o(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,"")})}),l.complete.call(s[0])})})},e.fn.extend({addClass:function(t){return function(i,n,r,o){return n?e.effects.animateClass.call(this,{add:i},n,r,o):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,n,r,o){return arguments.length>1?e.effects.animateClass.call(this,{remove:i},n,r,o):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(i){return function(n,r,o,s,a){return"boolean"==typeof r||r===t?o?e.effects.animateClass.call(this,r?{add:n}:{remove:n},o,s,a):i.apply(this,arguments):e.effects.animateClass.call(this,{toggle:n},r,o,s)}}(e.fn.toggleClass),switchClass:function(t,i,n,r,o){return e.effects.animateClass.call(this,{add:i,remove:t},n,r,o)}})}(),function(){function n(t,i,n,r){return e.isPlainObject(t)&&(i=t,t=t.effect),t={effect:t},null==i&&(i={}),e.isFunction(i)&&(r=i,n=null,i={}),("number"==typeof i||e.fx.speeds[i])&&(r=n,n=i,i={}),e.isFunction(n)&&(r=n,n=null),i&&e.extend(t,i),n=n||i.duration,t.duration=e.fx.off?0:"number"==typeof n?n:n in e.fx.speeds?e.fx.speeds[n]:e.fx.speeds._default,t.complete=r||i.complete,t}function r(t){return!t||"number"==typeof t||e.fx.speeds[t]?!0:"string"!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:"object"!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:"1.10.3",save:function(e,t){for(var n=0;n<t.length;n++)null!==t[n]&&e.data(i+t[n],e[0].style[t[n]])},restore:function(e,n){var r,o;for(o=0;o<n.length;o++)null!==n[o]&&(r=e.data(i+n[o]),r===t&&(r=""),e.css(n[o],r))},setMode:function(e,t){return"toggle"===t&&(t=e.is(":hidden")?"show":"hide"),t},getBaseline:function(e,t){var i,n;switch(e[0]){case"top":i=0;break;case"middle":i=.5;break;case"bottom":i=1;break;default:i=e[0]/t.height}switch(e[1]){case"left":n=0;break;case"center":n=.5;break;case"right":n=1;break;default:n=e[1]/t.width}return{x:n,y:i}},createWrapper:function(t){if(t.parent().is(".ui-effects-wrapper"))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),"float":t.css("float")},n=e("<div></div>").addClass("ui-effects-wrapper").css({fontSize:"100%",background:"transparent",border:"none",margin:0,padding:0}),r={width:t.width(),height:t.height()},o=document.activeElement;try{o.id}catch(s){o=document.body}return t.wrap(n),(t[0]===o||e.contains(t[0],o))&&e(o).focus(),n=t.parent(),"static"===t.css("position")?(n.css({position:"relative"}),t.css({position:"relative"})):(e.extend(i,{position:t.css("position"),zIndex:t.css("z-index")}),e.each(["top","left","bottom","right"],function(e,n){i[n]=t.css(n),isNaN(parseInt(i[n],10))&&(i[n]="auto")}),t.css({position:"relative",top:0,left:0,right:"auto",bottom:"auto"})),t.css(r),n.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(".ui-effects-wrapper")&&(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&&e(i).focus()),t},setTransition:function(t,i,n,r){return r=r||{},e.each(i,function(e,i){var o=t.cssUnit(i);o[0]>0&&(r[i]=o[0]*n+o[1])}),r}}),e.fn.extend({effect:function(){function t(t){function n(){e.isFunction(o)&&o.call(r[0]),e.isFunction(t)&&t()}var r=e(this),o=i.complete,a=i.mode;(r.is(":hidden")?"hide"===a:"show"===a)?(r[a](),n()):s.call(r[0],i,n)}var i=n.apply(this,arguments),r=i.mode,o=i.queue,s=e.effects.effect[i.effect];return e.fx.off||!s?r?this[r](i.duration,i.complete):this.each(function(){i.complete&&i.complete.call(this)}):o===!1?this.each(t):this.queue(o||"fx",t)},show:function(e){return function(t){if(r(t))return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="show",this.effect.call(this,i)}}(e.fn.show),hide:function(e){return function(t){if(r(t))return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="hide",this.effect.call(this,i)}}(e.fn.hide),toggle:function(e){return function(t){if(r(t)||"boolean"==typeof t)return e.apply(this,arguments);var i=n.apply(this,arguments);return i.mode="toggle",this.effect.call(this,i)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),n=[];return e.each(["em","px","%","pt"],function(e,t){i.indexOf(t)>0&&(n=[parseFloat(i),t])}),n}})}(),function(){var t={};e.each(["Quad","Cubic","Quart","Quint","Expo"],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;e<((t=Math.pow(2,--i))-1)/11;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing["easeIn"+t]=i,e.easing["easeOut"+t]=function(e){return 1-i(1-e)},e.easing["easeInOut"+t]=function(e){return.5>e?i(2*e)/2:1-i(-2*e+2)/2}})}()}(jQuery),function(e){var t=0,i={},n={};i.height=i.paddingTop=i.paddingBottom=i.borderTopWidth=i.borderBottomWidth="hide",n.height=n.paddingTop=n.paddingBottom=n.borderTopWidth=n.borderBottomWidth="show",e.widget("ui.accordion",{version:"1.10.3",options:{active:0,animate:{},collapsible:!1,event:"click",header:"> li > :first-child,> :not(li):even",heightStyle:"auto",icons:{activeHeader:"ui-icon-triangle-1-s",header:"ui-icon-triangle-1-e"},activate:null,beforeActivate:null},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass("ui-accordion ui-widget ui-helper-reset").attr("role","tablist"),t.collapsible||t.active!==!1&&null!=t.active||(t.active=0),this._processPanels(),t.active<0&&(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e(),content:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&&(e("<span>").addClass("ui-accordion-header-icon ui-icon "+t.header).prependTo(this.headers),this.active.children(".ui-accordion-header-icon").removeClass(t.header).addClass(t.activeHeader),this.headers.addClass("ui-accordion-icons"))},_destroyIcons:function(){this.headers.removeClass("ui-accordion-icons").children(".ui-accordion-header-icon").remove()},_destroy:function(){var e;this.element.removeClass("ui-accordion ui-widget ui-helper-reset").removeAttr("role"),this.headers.removeClass("ui-accordion-header ui-accordion-header-active ui-helper-reset ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top").removeAttr("role").removeAttr("aria-selected").removeAttr("aria-controls").removeAttr("tabIndex").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),this._destroyIcons(),e=this.headers.next().css("display","").removeAttr("role").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-labelledby").removeClass("ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled").each(function(){/^ui-accordion/.test(this.id)&&this.removeAttribute("id")}),"content"!==this.options.heightStyle&&e.css("height","")},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):("event"===e&&(this.options.event&&this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),"collapsible"!==e||t||this.options.active!==!1||this._activate(0),"icons"===e&&(this._destroyIcons(),t&&this._createIcons()),"disabled"===e&&this.headers.add(this.headers.next()).toggleClass("ui-state-disabled",!!t),void 0)},_keydown:function(t){if(!t.altKey&&!t.ctrlKey){var i=e.ui.keyCode,n=this.headers.length,r=this.headers.index(t.target),o=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:o=this.headers[(r+1)%n];break;case i.LEFT:case i.UP:o=this.headers[(r-1+n)%n];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:o=this.headers[0];break;case i.END:o=this.headers[n-1]}o&&(e(t.target).attr("tabIndex",-1),e(o).attr("tabIndex",0),o.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&&t.ctrlKey&&e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&&t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&&!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(".ui-state-disabled").length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){this.headers=this.element.find(this.options.header).addClass("ui-accordion-header ui-helper-reset ui-state-default ui-corner-all"),this.headers.next().addClass("ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom").filter(":not(.ui-accordion-content-active)").hide()},_refresh:function(){var i,n=this.options,r=n.heightStyle,o=this.element.parent(),s=this.accordionId="ui-accordion-"+(this.element.attr("id")||++t);this.active=this._findActive(n.active).addClass("ui-accordion-header-active ui-state-active ui-corner-top").removeClass("ui-corner-all"),this.active.next().addClass("ui-accordion-content-active").show(),this.headers.attr("role","tab").each(function(t){var i=e(this),n=i.attr("id"),r=i.next(),o=r.attr("id");n||(n=s+"-header-"+t,i.attr("id",n)),o||(o=s+"-panel-"+t,r.attr("id",o)),i.attr("aria-controls",o),r.attr("aria-labelledby",n)}).next().attr("role","tabpanel"),this.headers.not(this.active).attr({"aria-selected":"false",tabIndex:-1}).next().attr({"aria-expanded":"false","aria-hidden":"true"}).hide(),this.active.length?this.active.attr({"aria-selected":"true",tabIndex:0}).next().attr({"aria-expanded":"true","aria-hidden":"false"}):this.headers.eq(0).attr("tabIndex",0),this._createIcons(),this._setupEvents(n.event),"fill"===r?(i=o.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");"absolute"!==n&&"fixed"!==n&&(i-=t.outerHeight(!0))}),this.headers.each(function(){i-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===r&&(i=0,this.headers.next().each(function(){i=Math.max(i,e(this).css("height","").height())}).height(i))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&&(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return"number"==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:"_keydown"};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:"_panelKeyDown"}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,n=this.active,r=e(t.currentTarget),o=r[0]===n[0],s=o&&i.collapsible,a=s?e():r.next(),l=n.next(),h={oldHeader:n,oldPanel:l,newHeader:s?e():r,newPanel:a};t.preventDefault(),o&&!i.collapsible||this._trigger("beforeActivate",t,h)===!1||(i.active=s?!1:this.headers.index(r),this.active=o?e():r,this._toggle(h),n.removeClass("ui-accordion-header-active ui-state-active"),i.icons&&n.children(".ui-accordion-header-icon").removeClass(i.icons.activeHeader).addClass(i.icons.header),o||(r.removeClass("ui-corner-all").addClass("ui-accordion-header-active ui-state-active ui-corner-top"),i.icons&&r.children(".ui-accordion-header-icon").removeClass(i.icons.header).addClass(i.icons.activeHeader),r.next().addClass("ui-accordion-content-active")))},_toggle:function(t){var i=t.newPanel,n=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=n,this.options.animate?this._animate(i,n,t):(n.hide(),i.show(),this._toggleComplete(t)),n.attr({"aria-expanded":"false","aria-hidden":"true"}),n.prev().attr("aria-selected","false"),i.length&&n.length?n.prev().attr("tabIndex",-1):i.length&&this.headers.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),i.attr({"aria-expanded":"true","aria-hidden":"false"}).prev().attr({"aria-selected":"true",tabIndex:0})},_animate:function(e,t,r){var o,s,a,l=this,h=0,c=e.length&&(!t.length||e.index()<t.index()),u=this.options.animate||{},d=c&&u.down||u,p=function(){l._toggleComplete(r)};return"number"==typeof d&&(a=d),"string"==typeof d&&(s=d),s=s||d.easing||u.easing,a=a||d.duration||u.duration,t.length?e.length?(o=e.show().outerHeight(),t.animate(i,{duration:a,easing:s,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(n,{duration:a,easing:s,complete:p,step:function(e,i){i.now=Math.round(e),"height"!==i.prop?h+=i.now:"content"!==l.options.heightStyle&&(i.now=Math.round(o-t.outerHeight()-h),h=0)}}),void 0):t.animate(i,a,s,p):e.animate(n,a,s,p)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass("ui-accordion-content-active").prev().removeClass("ui-corner-top").addClass("ui-corner-all"),t.length&&(t.parent()[0].className=t.parent()[0].className),this._trigger("activate",null,e)}})}(jQuery),function(e){var t=0;e.widget("ui.autocomplete",{version:"1.10.3",defaultElement:"<input>",options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var t,i,n,r=this.element[0].nodeName.toLowerCase(),o="textarea"===r,s="input"===r;this.isMultiLine=o?!0:s?!1:this.element.prop("isContentEditable"),this.valueMethod=this.element[o||s?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(r){if(this.element.prop("readOnly"))return t=!0,n=!0,i=!0,void 0;t=!1,n=!1,i=!1;var o=e.ui.keyCode;switch(r.keyCode){case o.PAGE_UP:t=!0,this._move("previousPage",r);break;case o.PAGE_DOWN:t=!0,this._move("nextPage",r);break;case o.UP:t=!0,this._keyEvent("previous",r);break;case o.DOWN:t=!0,this._keyEvent("next",r);break;case o.ENTER:case o.NUMPAD_ENTER:this.menu.active&&(t=!0,r.preventDefault(),this.menu.select(r));break;case o.TAB:this.menu.active&&this.menu.select(r);break;case o.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(r),r.preventDefault());break;default:i=!0,this._searchTimeout(r)}},keypress:function(n){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(":visible"))&&n.preventDefault(),void 0;if(!i){var r=e.ui.keyCode;switch(n.keyCode){case r.PAGE_UP:this._move("previousPage",n);break;case r.PAGE_DOWN:this._move("nextPage",n);break;case r.UP:this._keyEvent("previous",n);break;case r.DOWN:this._keyEvent("next",n)}}},input:function(e){return n?(n=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e("<ul>").addClass("ui-autocomplete ui-front").appendTo(this._appendTo()).menu({role:null}).hide().data("ui-menu"),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(".ui-menu-item").length||this._delay(function(){var t=this;this.document.one("mousedown",function(n){n.target===t.element[0]||n.target===i||e.contains(i,n.target)||t.close()})})},menufocus:function(t,i){if(this.isNewMenu&&(this.isNewMenu=!1,t.originalEvent&&/^mouse/.test(t.originalEvent.type)))return this.menu.blur(),this.document.one("mousemove",function(){e(t.target).trigger(t.originalEvent)}),void 0;var n=i.item.data("ui-autocomplete-item");!1!==this._trigger("focus",t,{item:n})?t.originalEvent&&/^key/.test(t.originalEvent.type)&&this._value(n.value):this.liveRegion.text(n.value)},menuselect:function(e,t){var i=t.item.data("ui-autocomplete-item"),n=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n,this.selectedItem=i})),!1!==this._trigger("select",e,{item:i})&&this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertBefore(this.element),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),"source"===e&&this._initSource(),"appendTo"===e&&this.menu.element.appendTo(this._appendTo()),"disabled"===e&&t&&this.xhr&&this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&&(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t||(t=this.element.closest(".ui-front")),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,n=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,n){n(e.ui.autocomplete.filter(t,i.term))}):"string"==typeof this.options.source?(i=this.options.source,this.source=function(t,r){n.xhr&&n.xhr.abort(),n.xhr=e.ajax({url:i,data:t,dataType:"json",success:function(e){r(e)
},error:function(){r([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length<this.options.minLength?this.close(t):this._trigger("search",t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var e=this,i=++t;return function(n){i===t&&e.__response(n),e.pending--,e.pending||e.element.removeClass("ui-autocomplete-loading")}},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?(this._suggest(e),this._trigger("open")):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",e))},_change:function(e){this.previous!==this._value()&&this._trigger("change",e,{item:this.selectedItem})},_normalize:function(t){return t.length&&t[0].label&&t[0].value?t:e.map(t,function(t){return"string"==typeof t?{label:t,value:t}:e.extend({label:t.label||t.value,value:t.value||t.label},t)})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var n=this;e.each(i,function(e,i){n._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data("ui-autocomplete-item",t)},_renderItem:function(t,i){return e("<li>").append(e("<a>").text(i.label)).appendTo(t)},_move:function(e,t){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(e)||this.menu.isLastItem()&&/^next/.test(e)?(this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(t,i){var n=new RegExp(e.ui.autocomplete.escapeRegex(i),"i");return e.grep(t,function(e){return n.test(e.label||e.value||e)})}}),e.widget("ui.autocomplete",e.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(e){return e+(e>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(e){var t;this._superApply(arguments),this.options.disabled||this.cancelSearch||(t=e&&e.length?this.options.messages.results(e.length):this.options.messages.noResults,this.liveRegion.text(t))}})}(jQuery),function(e){var t,i,n,r,o="ui-button ui-widget ui-state-default ui-corner-all",s="ui-state-hover ui-state-active ",a="ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only",l=function(){var t=e(this);setTimeout(function(){t.find(":ui-button").button("refresh")},1)},h=function(t){var i=t.name,n=t.form,r=e([]);return i&&(i=i.replace(/'/g,"\\'"),r=n?e(n).find("[name='"+i+"']"):e("[name='"+i+"']",t.ownerDocument).filter(function(){return!this.form})),r};e.widget("ui.button",{version:"1.10.3",defaultElement:"<button>",options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest("form").unbind("reset"+this.eventNamespace).bind("reset"+this.eventNamespace,l),"boolean"!=typeof this.options.disabled?this.options.disabled=!!this.element.prop("disabled"):this.element.prop("disabled",this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr("title");var s=this,a=this.options,c="checkbox"===this.type||"radio"===this.type,u=c?"":"ui-state-active",d="ui-state-focus";null===a.label&&(a.label="input"===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(o).attr("role","button").bind("mouseenter"+this.eventNamespace,function(){a.disabled||this===t&&e(this).addClass("ui-state-active")}).bind("mouseleave"+this.eventNamespace,function(){a.disabled||e(this).removeClass(u)}).bind("click"+this.eventNamespace,function(e){a.disabled&&(e.preventDefault(),e.stopImmediatePropagation())}),this.element.bind("focus"+this.eventNamespace,function(){s.buttonElement.addClass(d)}).bind("blur"+this.eventNamespace,function(){s.buttonElement.removeClass(d)}),c&&(this.element.bind("change"+this.eventNamespace,function(){r||s.refresh()}),this.buttonElement.bind("mousedown"+this.eventNamespace,function(e){a.disabled||(r=!1,i=e.pageX,n=e.pageY)}).bind("mouseup"+this.eventNamespace,function(e){a.disabled||(i!==e.pageX||n!==e.pageY)&&(r=!0)})),"checkbox"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){return a.disabled||r?!1:void 0}):"radio"===this.type?this.buttonElement.bind("click"+this.eventNamespace,function(){if(a.disabled||r)return!1;e(this).addClass("ui-state-active"),s.buttonElement.attr("aria-pressed","true");var t=s.element[0];h(t).not(t).map(function(){return e(this).button("widget")[0]}).removeClass("ui-state-active").attr("aria-pressed","false")}):(this.buttonElement.bind("mousedown"+this.eventNamespace,function(){return a.disabled?!1:(e(this).addClass("ui-state-active"),t=this,s.document.one("mouseup",function(){t=null}),void 0)}).bind("mouseup"+this.eventNamespace,function(){return a.disabled?!1:(e(this).removeClass("ui-state-active"),void 0)}).bind("keydown"+this.eventNamespace,function(t){return a.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&&e(this).addClass("ui-state-active"),void 0)}).bind("keyup"+this.eventNamespace+" blur"+this.eventNamespace,function(){e(this).removeClass("ui-state-active")}),this.buttonElement.is("a")&&this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&&e(this).click()})),this._setOption("disabled",a.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is("[type=checkbox]")?"checkbox":this.element.is("[type=radio]")?"radio":this.element.is("input")?"input":"button","checkbox"===this.type||"radio"===this.type?(e=this.element.parents().last(),t="label[for='"+this.element.attr("id")+"']",this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass("ui-helper-hidden-accessible"),i=this.element.is(":checked"),i&&this.buttonElement.addClass("ui-state-active"),this.buttonElement.prop("aria-pressed",i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass("ui-helper-hidden-accessible"),this.buttonElement.removeClass(o+" "+s+" "+a).removeAttr("role").removeAttr("aria-pressed").html(this.buttonElement.find(".ui-button-text").html()),this.hasTitle||this.buttonElement.removeAttr("title")},_setOption:function(e,t){return this._super(e,t),"disabled"===e?(t?this.element.prop("disabled",!0):this.element.prop("disabled",!1),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is("input, button")?this.element.is(":disabled"):this.element.hasClass("ui-button-disabled");t!==this.options.disabled&&this._setOption("disabled",t),"radio"===this.type?h(this.element[0]).each(function(){e(this).is(":checked")?e(this).button("widget").addClass("ui-state-active").attr("aria-pressed","true"):e(this).button("widget").removeClass("ui-state-active").attr("aria-pressed","false")}):"checkbox"===this.type&&(this.element.is(":checked")?this.buttonElement.addClass("ui-state-active").attr("aria-pressed","true"):this.buttonElement.removeClass("ui-state-active").attr("aria-pressed","false"))},_resetButton:function(){if("input"===this.type)return this.options.label&&this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(a),i=e("<span></span>",this.document[0]).addClass("ui-button-text").html(this.options.label).appendTo(t.empty()).text(),n=this.options.icons,r=n.primary&&n.secondary,o=[];n.primary||n.secondary?(this.options.text&&o.push("ui-button-text-icon"+(r?"s":n.primary?"-primary":"-secondary")),n.primary&&t.prepend("<span class='ui-button-icon-primary ui-icon "+n.primary+"'></span>"),n.secondary&&t.append("<span class='ui-button-icon-secondary ui-icon "+n.secondary+"'></span>"),this.options.text||(o.push(r?"ui-button-icons-only":"ui-button-icon-only"),this.hasTitle||t.attr("title",e.trim(i)))):o.push("ui-button-text-only"),t.addClass(o.join(" "))}}),e.widget("ui.buttonset",{version:"1.10.3",options:{items:"button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)"},_create:function(){this.element.addClass("ui-buttonset")},_init:function(){this.refresh()},_setOption:function(e,t){"disabled"===e&&this.buttons.button("option",e,t),this._super(e,t)},refresh:function(){var t="rtl"===this.element.css("direction");this.buttons=this.element.find(this.options.items).filter(":ui-button").button("refresh").end().not(":ui-button").button().end().map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-all ui-corner-left ui-corner-right").filter(":first").addClass(t?"ui-corner-right":"ui-corner-left").end().filter(":last").addClass(t?"ui-corner-left":"ui-corner-right").end().end()},_destroy:function(){this.element.removeClass("ui-buttonset"),this.buttons.map(function(){return e(this).button("widget")[0]}).removeClass("ui-corner-left ui-corner-right").end().button("destroy")}})}(jQuery),function(e,t){function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.dpDiv=n(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function n(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.delegate(i,"mouseout",function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")}).delegate(i,"mouseover",function(){e.datepicker._isDisabledDatepicker(o.inline?t.parent()[0]:o.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))})}function r(t,i){e.extend(t,i);for(var n in i)null==i[n]&&(t[n]=i[n]);return t}e.extend(e.ui,{datepicker:{version:"1.10.3"}});var o,s="datepicker";e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var n,r,o;n=t.nodeName.toLowerCase(),r="div"===n||"span"===n,t.id||(this.uuid+=1,t.id="dp"+this.uuid),o=this._newInst(e(t),r),o.settings=e.extend({},i||{}),"input"===n?this._connectDatepicker(t,o):r&&this._inlineDatepicker(t,o)},_newInst:function(t,i){var r=t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1");return{id:r,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?n(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var n=e(t);i.append=e([]),i.trigger=e([]),n.hasClass(this.markerClassName)||(this._attachments(n,i),n.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,s,i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var n,r,o,s=this._get(i,"appendText"),a=this._get(i,"isRTL");i.append&&i.append.remove(),s&&(i.append=e("<span class='"+this._appendClass+"'>"+s+"</span>"),t[a?"before":"after"](i.append)),t.unbind("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),n=this._get(i,"showOn"),("focus"===n||"both"===n)&&t.focus(this._showDatepicker),("button"===n||"both"===n)&&(r=this._get(i,"buttonText"),o=this._get(i,"buttonImage"),i.trigger=e(this._get(i,"buttonImageOnly")?e("<img/>").addClass(this._triggerClass).attr({src:o,alt:r,title:r}):e("<button type='button'></button>").addClass(this._triggerClass).html(o?e("<img/>").attr({src:o,alt:r,title:r}):r)),t[a?"before":"after"](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,n,r,o=new Date(2009,11,20),s=this._get(e,"dateFormat");s.match(/[DM]/)&&(t=function(e){for(i=0,n=0,r=0;r<e.length;r++)e[r].length>i&&(i=e[r].length,n=r);return n},o.setMonth(t(this._get(e,s.match(/MM/)?"monthNames":"monthNamesShort"))),o.setDate(t(this._get(e,s.match(/DD/)?"dayNames":"dayNamesShort"))+20-o.getDay())),e.input.attr("size",this._formatDate(e,o).length)}},_inlineDatepicker:function(t,i){var n=e(t);n.hasClass(this.markerClassName)||(n.addClass(this.markerClassName).append(i.dpDiv),e.data(t,s,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,n,o,a){var l,h,c,u,d,p=this._dialogInst;return p||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.keydown(this._doKeyDown),e("body").append(this._dialogInput),p=this._dialogInst=this._newInst(this._dialogInput,!1),p.settings={},e.data(this._dialogInput[0],s,p)),r(p.settings,o||{}),i=i&&i.constructor===Date?this._formatDate(p,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,c=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,c/2-150+d]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),p.settings.onSelect=n,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],s,p),this},_destroyDatepicker:function(t){var i,n=e(t),r=e.data(t,s);n.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),e.removeData(t,s),"input"===i?(r.append.remove(),r.trigger.remove(),n.removeClass(this.markerClassName).unbind("focus",this._showDatepicker).unbind("keydown",this._doKeyDown).unbind("keypress",this._doKeyPress).unbind("keyup",this._doKeyUp)):("div"===i||"span"===i)&&n.removeClass(this.markerClassName).empty())},_enableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,s);r.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!1,o.trigger.filter("button").each(function(){this.disabled=!1}).end().filter("img").css({opacity:"1.0",cursor:""})):("div"===i||"span"===i)&&(n=r.children("."+this._inlineClass),n.children().removeClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,n,r=e(t),o=e.data(t,s);r.hasClass(this.markerClassName)&&(i=t.nodeName.toLowerCase(),"input"===i?(t.disabled=!0,o.trigger.filter("button").each(function(){this.disabled=!0}).end().filter("img").css({opacity:"0.5",cursor:"default"})):("div"===i||"span"===i)&&(n=r.children("."+this._inlineClass),n.children().addClass("ui-state-disabled"),n.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,s)}catch(i){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(i,n,o){var s,a,l,h,c=this._getInst(i);return 2===arguments.length&&"string"==typeof n?"defaults"===n?e.extend({},e.datepicker._defaults):c?"all"===n?e.extend({},c.settings):this._get(c,n):null:(s=n||{},"string"==typeof n&&(s={},s[n]=o),c&&(this._curInst===c&&this._hideDatepicker(),a=this._getDateDatepicker(i,!0),l=this._getMinMaxDate(c,"min"),h=this._getMinMaxDate(c,"max"),r(c.settings,s),null!==l&&s.dateFormat!==t&&s.minDate===t&&(c.settings.minDate=this._formatDate(c,l)),null!==h&&s.dateFormat!==t&&s.maxDate===t&&(c.settings.maxDate=this._formatDate(c,h)),"disabled"in s&&(s.disabled?this._disableDatepicker(i):this._enableDatepicker(i)),this._attachments(e(i),c),this._autoSize(c),this._setDate(c,a),this._updateAlternate(c),this._updateDatepicker(c)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,n,r,o=e.datepicker._getInst(t.target),s=!0,a=o.dpDiv.is(".ui-datepicker-rtl");if(o._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),s=!1;break;case 13:return r=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",o.dpDiv),r[0]&&e.datepicker._selectDay(t.target,o.selectedMonth,o.selectedYear,r[0]),i=e.datepicker._get(o,"onSelect"),i?(n=e.datepicker._formatDate(o),i.apply(o.input?o.input[0]:null,[n,o])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),s=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),s=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?1:-1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(o,"stepBigMonths"):-e.datepicker._get(o,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),s=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,a?-1:1,"D"),s=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(o,"stepBigMonths"):+e.datepicker._get(o,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),s=t.ctrlKey||t.metaKey;break;default:s=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):s=!1;s&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,n,r=e.datepicker._getInst(t.target);return e.datepicker._get(r,"constrainInput")?(i=e.datepicker._possibleChars(e.datepicker._get(r,"dateFormat")),n=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||" ">n||!i||i.indexOf(n)>-1):void 0},_doKeyUp:function(t){var i,n=e.datepicker._getInst(t.target);if(n.input.val()!==n.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(n,"dateFormat"),n.input?n.input.val():null,e.datepicker._getFormatConfig(n)),i&&(e.datepicker._setDateFromField(n),e.datepicker._updateAlternate(n),e.datepicker._updateDatepicker(n))}catch(r){}return!0},_showDatepicker:function(t){if(t=t.target||t,"input"!==t.nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&&e.datepicker._lastInput!==t){var i,n,o,s,a,l,h;i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,"beforeShow"),o=n?n.apply(t,[t,i]):{},o!==!1&&(r(i.settings,o),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),s=!1,e(t).parents().each(function(){return s|="fixed"===e(this).css("position"),!s}),a={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),a=e.datepicker._checkOffset(i,a,s),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":s?"fixed":"absolute",display:"none",left:a.left+"px",top:a.top+"px"}),i.inline||(l=e.datepicker._get(i,"showAnim"),h=e.datepicker._get(i,"duration"),i.dpDiv.zIndex(e(t).zIndex()+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,"showOptions"),h):i.dpDiv[l||"show"](l?h:null),e.datepicker._shouldFocusInput(i)&&i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,o=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t),t.dpDiv.find("."+this._dayOverClass+" a").mouseover();var i,n=this._getNumberOfMonths(t),r=n[1],s=17;t.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),r>1&&t.dpDiv.addClass("ui-datepicker-multi-"+r).css("width",s*r+"em"),t.dpDiv[(1!==n[0]||1!==n[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),t.dpDiv[(this._get(t,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),t===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(t)&&t.input.focus(),t.yearshtml&&(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&&t.yearshtml&&t.dpDiv.find("select.ui-datepicker-year:first").replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,n){var r=t.dpDiv.outerWidth(),o=t.dpDiv.outerHeight(),s=t.input?t.input.outerWidth():0,a=t.input?t.input.outerHeight():0,l=document.documentElement.clientWidth+(n?0:e(document).scrollLeft()),h=document.documentElement.clientHeight+(n?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?r-s:0,i.left-=n&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=n&&i.top===t.input.offset().top+a?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+r>l&&l>r?Math.abs(i.left+r-l):0),i.top-=Math.min(i.top,i.top+o>h&&h>o?Math.abs(o+a):0),i},_findPos:function(t){for(var i,n=this._getInst(t),r=this._get(n,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[r?"previousSibling":"nextSibling"];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,n,r,o,a=this._curInst;!a||t&&a!==e.data(t,s)||this._datepickerShowing&&(i=this._get(a,"showAnim"),n=this._get(a,"duration"),r=function(){e.datepicker._tidyDialog(a)},e.effects&&(e.effects.effect[i]||e.effects[i])?a.dpDiv.hide(i,e.datepicker._get(a,"showOptions"),n,r):a.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?n:null,r),i||r(),this._datepickerShowing=!1,o=this._get(a,"onClose"),o&&o.apply(a.input?a.input[0]:null,[a.input?a.input.val():"",a]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),n=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&&0===i.parents("#"+e.datepicker._mainDivId).length&&!i.hasClass(e.datepicker.markerClassName)&&!i.closest("."+e.datepicker._triggerClass).length&&e.datepicker._datepickerShowing&&(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&&e.datepicker._curInst!==n)&&e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,n){var r=e(t),o=this._getInst(r[0]);this._isDisabledDatepicker(r[0])||(this._adjustInstDate(o,i+("M"===n?this._get(o,"showCurrentAtPos"):0),n),this._updateDatepicker(o))},_gotoToday:function(t){var i,n=e(t),r=this._getInst(n[0]);this._get(r,"gotoCurrent")&&r.currentDay?(r.selectedDay=r.currentDay,r.drawMonth=r.selectedMonth=r.currentMonth,r.drawYear=r.selectedYear=r.currentYear):(i=new Date,r.selectedDay=i.getDate(),r.drawMonth=r.selectedMonth=i.getMonth(),r.drawYear=r.selectedYear=i.getFullYear()),this._notifyChange(r),this._adjustDate(n)},_selectMonthYear:function(t,i,n){var r=e(t),o=this._getInst(r[0]);o["selected"+("M"===n?"Month":"Year")]=o["draw"+("M"===n?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(o),this._adjustDate(r)},_selectDay:function(t,i,n,r){var o,s=e(t);e(r).hasClass(this._unselectableClass)||this._isDisabledDatepicker(s[0])||(o=this._getInst(s[0]),o.selectedDay=o.currentDay=e("a",r).html(),o.selectedMonth=o.currentMonth=i,o.selectedYear=o.currentYear=n,this._selectDate(t,this._formatDate(o,o.currentDay,o.currentMonth,o.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var n,r=e(t),o=this._getInst(r[0]);i=null!=i?i:this._formatDate(o),o.input&&o.input.val(i),this._updateAlternate(o),n=this._get(o,"onSelect"),n?n.apply(o.input?o.input[0]:null,[i,o]):o.input&&o.input.trigger("change"),o.inline?this._updateDatepicker(o):(this._hideDatepicker(),this._lastInput=o.input[0],"object"!=typeof o.input[0]&&o.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,n,r,o=this._get(t,"altField");o&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),n=this._getDate(t),r=this.formatDate(i,n,this._getFormatConfig(t)),e(o).each(function(){e(this).val(r)}))},noWeekends:function(e){var t=e.getDay();return[t>0&&6>t,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,n){if(null==t||null==i)throw"Invalid arguments";if(i="object"==typeof i?i.toString():i+"",""===i)return null;var r,o,s,a,l=0,h=(n?n.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof h?h:(new Date).getFullYear()%100+parseInt(h,10),u=(n?n.dayNamesShort:null)||this._defaults.dayNamesShort,d=(n?n.dayNames:null)||this._defaults.dayNames,p=(n?n.monthNamesShort:null)||this._defaults.monthNamesShort,f=(n?n.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,_=!1,b=function(e){var i=r+1<t.length&&t.charAt(r+1)===e;return i&&r++,i},E=function(e){var t=b(e),n="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,r=new RegExp("^\\d{1,"+n+"}"),o=i.substring(l).match(r);if(!o)throw"Missing number at position "+l;return l+=o[0].length,parseInt(o[0],10)},x=function(t,n,r){var o=-1,s=e.map(b(t)?r:n,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(s,function(e,t){var n=t[1];return i.substr(l,n.length).toLowerCase()===n.toLowerCase()?(o=t[0],l+=n.length,!1):void 0}),-1!==o)return o+1;throw"Unknown name at position "+l},T=function(){if(i.charAt(l)!==t.charAt(r))throw"Unexpected literal at position "+l;l++};for(r=0;r<t.length;r++)if(_)"'"!==t.charAt(r)||b("'")?T():_=!1;else switch(t.charAt(r)){case"d":v=E("d");break;case"D":x("D",u,d);break;case"o":y=E("o");break;case"m":g=E("m");break;case"M":g=x("M",p,f);break;case"y":m=E("y");break;case"@":a=new Date(E("@")),m=a.getFullYear(),g=a.getMonth()+1,v=a.getDate();break;case"!":a=new Date((E("!")-this._ticksTo1970)/1e4),m=a.getFullYear(),g=a.getMonth()+1,v=a.getDate();break;case"'":b("'")?T():_=!0;break;default:T()}if(l<i.length&&(s=i.substr(l),!/^\s+/.test(s)))throw"Extra/unparsed characters found in date: "+s;if(-1===m?m=(new Date).getFullYear():100>m&&(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(c>=m?0:-100)),y>-1)for(g=1,v=y;;){if(o=this._getDaysInMonth(m,g-1),o>=v)break;g++,v-=o}if(a=this._daylightSavingAdjust(new Date(m,g-1,v)),a.getFullYear()!==m||a.getMonth()+1!==g||a.getDate()!==v)throw"Invalid date";return a},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return"";var n,r=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,o=(i?i.dayNames:null)||this._defaults.dayNames,s=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,a=(i?i.monthNames:null)||this._defaults.monthNames,l=function(t){var i=n+1<e.length&&e.charAt(n+1)===t;return i&&n++,i},h=function(e,t,i){var n=""+t;if(l(e))for(;n.length<i;)n="0"+n;return n},c=function(e,t,i,n){return l(e)?n[t]:i[t]},u="",d=!1;if(t)for(n=0;n<e.length;n++)if(d)"'"!==e.charAt(n)||l("'")?u+=e.charAt(n):d=!1;
else switch(e.charAt(n)){case"d":u+=h("d",t.getDate(),2);break;case"D":u+=c("D",t.getDay(),r,o);break;case"o":u+=h("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=h("m",t.getMonth()+1,2);break;case"M":u+=c("M",t.getMonth(),s,a);break;case"y":u+=l("y")?t.getFullYear():(t.getYear()%100<10?"0":"")+t.getYear()%100;break;case"@":u+=t.getTime();break;case"!":u+=1e4*t.getTime()+this._ticksTo1970;break;case"'":l("'")?u+="'":d=!0;break;default:u+=e.charAt(n)}return u},_possibleChars:function(e){var t,i="",n=!1,r=function(i){var n=t+1<e.length&&e.charAt(t+1)===i;return n&&t++,n};for(t=0;t<e.length;t++)if(n)"'"!==e.charAt(t)||r("'")?i+=e.charAt(t):n=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":r("'")?i+="'":n=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,i){return e.settings[i]!==t?e.settings[i]:this._defaults[i]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),n=e.lastVal=e.input?e.input.val():null,r=this._getDefaultDate(e),o=r,s=this._getFormatConfig(e);try{o=this.parseDate(i,n,s)||r}catch(a){n=t?"":n}e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),e.currentDay=n?o.getDate():0,e.currentMonth=n?o.getMonth():0,e.currentYear=n?o.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,n){var r=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},o=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(n){}for(var r=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,o=r.getFullYear(),s=r.getMonth(),a=r.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,h=l.exec(i);h;){switch(h[2]||"d"){case"d":case"D":a+=parseInt(h[1],10);break;case"w":case"W":a+=7*parseInt(h[1],10);break;case"m":case"M":s+=parseInt(h[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s));break;case"y":case"Y":o+=parseInt(h[1],10),a=Math.min(a,e.datepicker._getDaysInMonth(o,s))}h=l.exec(i)}return new Date(o,s,a)},s=null==i||""===i?n:"string"==typeof i?o(i):"number"==typeof i?isNaN(i)?n:r(i):new Date(i.getTime());return s=s&&"Invalid Date"===s.toString()?n:s,s&&(s.setHours(0),s.setMinutes(0),s.setSeconds(0),s.setMilliseconds(0)),this._daylightSavingAdjust(s)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var n=!t,r=e.selectedMonth,o=e.selectedYear,s=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=s.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=s.getMonth(),e.drawYear=e.selectedYear=e.currentYear=s.getFullYear(),r===e.selectedMonth&&o===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(n?"":this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),n="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map(function(){var t={prev:function(){e.datepicker._adjustDate(n,-i,"M")},next:function(){e.datepicker._adjustDate(n,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(n)},selectDay:function(){return e.datepicker._selectDay(n,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(n,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(n,this,"Y"),!1}};e(this).bind(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])})},_generateHTML:function(e){var t,i,n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V=new Date,B=this._daylightSavingAdjust(new Date(V.getFullYear(),V.getMonth(),V.getDate())),U=this._get(e,"isRTL"),j=this._get(e,"showButtonPanel"),W=this._get(e,"hideIfNoPrevNext"),$=this._get(e,"navigationAsDateFormat"),G=this._getNumberOfMonths(e),q=this._get(e,"showCurrentAtPos"),X=this._get(e,"stepMonths"),Y=1!==G[0]||1!==G[1],K=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),Q=this._getMinMaxDate(e,"min"),J=this._getMinMaxDate(e,"max"),Z=e.drawMonth-q,et=e.drawYear;if(0>Z&&(Z+=12,et--),J)for(t=this._daylightSavingAdjust(new Date(J.getFullYear(),J.getMonth()-G[0]*G[1]+1,J.getDate())),t=Q&&Q>t?Q:t;this._daylightSavingAdjust(new Date(et,Z,1))>t;)Z--,0>Z&&(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,"prevText"),i=$?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-X,1)),this._getFormatConfig(e)):i,n=this._canAdjustMonth(e,-1,et,Z)?"<a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>":W?"":"<a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='"+i+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"e":"w")+"'>"+i+"</span></a>",r=this._get(e,"nextText"),r=$?this.formatDate(r,this._daylightSavingAdjust(new Date(et,Z+X,1)),this._getFormatConfig(e)):r,o=this._canAdjustMonth(e,1,et,Z)?"<a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+r+"</span></a>":W?"":"<a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='"+r+"'><span class='ui-icon ui-icon-circle-triangle-"+(U?"w":"e")+"'>"+r+"</span></a>",s=this._get(e,"currentText"),a=this._get(e,"gotoCurrent")&&e.currentDay?K:B,s=$?this.formatDate(s,a,this._getFormatConfig(e)):s,l=e.inline?"":"<button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'>"+this._get(e,"closeText")+"</button>",h=j?"<div class='ui-datepicker-buttonpane ui-widget-content'>"+(U?l:"")+(this._isInRange(e,a)?"<button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'>"+s+"</button>":"")+(U?"":l)+"</div>":"",c=parseInt(this._get(e,"firstDay"),10),c=isNaN(c)?0:c,u=this._get(e,"showWeek"),d=this._get(e,"dayNames"),p=this._get(e,"dayNamesMin"),f=this._get(e,"monthNames"),m=this._get(e,"monthNamesShort"),g=this._get(e,"beforeShowDay"),v=this._get(e,"showOtherMonths"),y=this._get(e,"selectOtherMonths"),_=this._getDefaultDate(e),b="",x=0;x<G[0];x++){for(T="",this.maxRows=4,w=0;w<G[1];w++){if(R=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=" ui-corner-all",C="",Y){if(C+="<div class='ui-datepicker-group",G[1]>1)switch(w){case 0:C+=" ui-datepicker-group-first",S=" ui-corner-"+(U?"right":"left");break;case G[1]-1:C+=" ui-datepicker-group-last",S=" ui-corner-"+(U?"left":"right");break;default:C+=" ui-datepicker-group-middle",S=""}C+="'>"}for(C+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+S+"'>"+(/all|left/.test(S)&&0===x?U?o:n:"")+(/all|right/.test(S)&&0===x?U?n:o:"")+this._generateMonthYearHeader(e,Z,et,Q,J,x>0||w>0,f,m)+"</div><table class='ui-datepicker-calendar'><thead>"+"<tr>",H=u?"<th class='ui-datepicker-week-col'>"+this._get(e,"weekHeader")+"</th>":"",E=0;7>E;E++)M=(E+c)%7,H+="<th"+((E+c+6)%7>=5?" class='ui-datepicker-week-end'":"")+">"+"<span title='"+d[M]+"'>"+p[M]+"</span></th>";for(C+=H+"</tr></thead><tbody>",k=this._getDaysInMonth(et,Z),et===e.selectedYear&&Z===e.selectedMonth&&(e.selectedDay=Math.min(e.selectedDay,k)),A=(this._getFirstDayOfMonth(et,Z)-c+7)%7,P=Math.ceil((A+k)/7),F=Y?this.maxRows>P?this.maxRows:P:P,this.maxRows=F,D=this._daylightSavingAdjust(new Date(et,Z,1-A)),N=0;F>N;N++){for(C+="<tr>",z=u?"<td class='ui-datepicker-week-col'>"+this._get(e,"calculateWeek")(D)+"</td>":"",E=0;7>E;E++)L=g?g.apply(e.input?e.input[0]:null,[D]):[!0,""],I=D.getMonth()!==Z,O=I&&!y||!L[0]||Q&&Q>D||J&&D>J,z+="<td class='"+((E+c+6)%7>=5?" ui-datepicker-week-end":"")+(I?" ui-datepicker-other-month":"")+(D.getTime()===R.getTime()&&Z===e.selectedMonth&&e._keyEvent||_.getTime()===D.getTime()&&_.getTime()===R.getTime()?" "+this._dayOverClass:"")+(O?" "+this._unselectableClass+" ui-state-disabled":"")+(I&&!v?"":" "+L[1]+(D.getTime()===K.getTime()?" "+this._currentClass:"")+(D.getTime()===B.getTime()?" ui-datepicker-today":""))+"'"+(I&&!v||!L[2]?"":" title='"+L[2].replace(/'/g,"&#39;")+"'")+(O?"":" data-handler='selectDay' data-event='click' data-month='"+D.getMonth()+"' data-year='"+D.getFullYear()+"'")+">"+(I&&!v?"&#xa0;":O?"<span class='ui-state-default'>"+D.getDate()+"</span>":"<a class='ui-state-default"+(D.getTime()===B.getTime()?" ui-state-highlight":"")+(D.getTime()===K.getTime()?" ui-state-active":"")+(I?" ui-priority-secondary":"")+"' href='#'>"+D.getDate()+"</a>")+"</td>",D.setDate(D.getDate()+1),D=this._daylightSavingAdjust(D);C+=z+"</tr>"}Z++,Z>11&&(Z=0,et++),C+="</tbody></table>"+(Y?"</div>"+(G[0]>0&&w===G[1]-1?"<div class='ui-datepicker-row-break'></div>":""):""),T+=C}b+=T}return b+=h,e._keyEvent=!1,b},_generateMonthYearHeader:function(e,t,i,n,r,o,s,a){var l,h,c,u,d,p,f,m,g=this._get(e,"changeMonth"),v=this._get(e,"changeYear"),y=this._get(e,"showMonthAfterYear"),_="<div class='ui-datepicker-title'>",b="";if(o||!g)b+="<span class='ui-datepicker-month'>"+s[t]+"</span>";else{for(l=n&&n.getFullYear()===i,h=r&&r.getFullYear()===i,b+="<select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'>",c=0;12>c;c++)(!l||c>=n.getMonth())&&(!h||c<=r.getMonth())&&(b+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+a[c]+"</option>");b+="</select>"}if(y||(_+=b+(!o&&g&&v?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",o||!v)_+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(e,"yearRange").split(":"),d=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?d+parseInt(e,10):parseInt(e,10);return isNaN(t)?d:t},f=p(u[0]),m=Math.max(f,p(u[1]||"")),f=n?Math.max(f,n.getFullYear()):f,m=r?Math.min(m,r.getFullYear()):m,e.yearshtml+="<select class='ui-datepicker-year' data-handler='selectYear' data-event='change'>";m>=f;f++)e.yearshtml+="<option value='"+f+"'"+(f===i?" selected='selected'":"")+">"+f+"</option>";e.yearshtml+="</select>",_+=e.yearshtml,e.yearshtml=null}return _+=this._get(e,"yearSuffix"),y&&(_+=(!o&&g&&v?"":"&#xa0;")+b),_+="</div>"},_adjustInstDate:function(e,t,i){var n=e.drawYear+("Y"===i?t:0),r=e.drawMonth+("M"===i?t:0),o=Math.min(e.selectedDay,this._getDaysInMonth(n,r))+("D"===i?t:0),s=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(n,r,o)));e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),("M"===i||"Y"===i)&&this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),n=this._getMinMaxDate(e,"max"),r=i&&i>t?i:t;return n&&r>n?n:r},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,n){var r=this._getNumberOfMonths(e),o=this._daylightSavingAdjust(new Date(i,n+(0>t?t:r[0]*r[1]),1));return 0>t&&o.setDate(this._getDaysInMonth(o.getFullYear(),o.getMonth())),this._isInRange(e,o)},_isInRange:function(e,t){var i,n,r=this._getMinMaxDate(e,"min"),o=this._getMinMaxDate(e,"max"),s=null,a=null,l=this._get(e,"yearRange");return l&&(i=l.split(":"),n=(new Date).getFullYear(),s=parseInt(i[0],10),a=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(s+=n),i[1].match(/[+\-].*/)&&(a+=n)),(!r||t.getTime()>=r.getTime())&&(!o||t.getTime()<=o.getTime())&&(!s||t.getFullYear()>=s)&&(!a||t.getFullYear()<=a)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,n){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var r=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(n,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),r,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.10.3"}(jQuery),function(e){var t={buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},i={maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0};e.widget("ui.dialog",{version:"1.10.3",options:{appendTo:"body",autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:"close",dialogClass:"",draggable:!0,hide:null,height:"auto",maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:"center",at:"center",of:window,collision:"fit",using:function(t){var i=e(this).css(t).offset().top;0>i&&e(this).css("top",t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr("title"),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr("title").addClass("ui-dialog-content ui-widget-content").appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&&e.fn.draggable&&this._makeDraggable(),this.options.resizable&&e.fn.resizable&&this._makeResizable(),this._isOpen=!1},_init:function(){this.options.autoOpen&&this.open()},_appendTo:function(){var t=this.options.appendTo;return t&&(t.jquery||t.nodeType)?e(t):this.document.find(t||"body").eq(0)},_destroy:function(){var e,t=this.originalPosition;this._destroyOverlay(),this.element.removeUniqueId().removeClass("ui-dialog-content ui-widget-content").css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&&this.element.attr("title",this.originalTitle),e=t.parent.children().eq(t.index),e.length&&e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i=this;this._isOpen&&this._trigger("beforeClose",t)!==!1&&(this._isOpen=!1,this._destroyOverlay(),this.opener.filter(":focusable").focus().length||e(this.document[0].activeElement).blur(),this._hide(this.uiDialog,this.options.hide,function(){i._trigger("close",t)}))},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(e,t){var i=!!this.uiDialog.nextAll(":visible").insertBefore(this.uiDialog).length;return i&&!t&&this._trigger("focus",e),i},open:function(){var t=this;return this._isOpen?(this._moveToTop()&&this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger("focus")}),this._trigger("open"),void 0)},_focusTabbable:function(){var e=this.element.find("[autofocus]");e.length||(e=this.element.find(":tabbable")),e.length||(e=this.uiDialogButtonPane.find(":tabbable")),e.length||(e=this.uiDialogTitlebarClose.filter(":tabbable")),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e("<div>").addClass("ui-dialog ui-widget ui-widget-content ui-corner-all ui-front "+this.options.dialogClass).hide().attr({tabIndex:-1,role:"dialog"}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&&!t.isDefaultPrevented()&&t.keyCode&&t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;if(t.keyCode===e.ui.keyCode.TAB){var i=this.uiDialog.find(":tabbable"),n=i.filter(":first"),r=i.filter(":last");t.target!==r[0]&&t.target!==this.uiDialog[0]||t.shiftKey?t.target!==n[0]&&t.target!==this.uiDialog[0]||!t.shiftKey||(r.focus(1),t.preventDefault()):(n.focus(1),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&&this._focusTabbable()}}),this.element.find("[aria-describedby]").length||this.uiDialog.attr({"aria-describedby":this.element.uniqueId().attr("id")})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e("<div>").addClass("ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix").prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(".ui-dialog-titlebar-close")||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e("<button></button>").button({label:this.options.closeText,icons:{primary:"ui-icon-closethick"},text:!1}).addClass("ui-dialog-titlebar-close").appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e("<span>").uniqueId().addClass("ui-dialog-title").prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({"aria-labelledby":t.attr("id")})},_title:function(e){this.options.title||e.html("&#160;"),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e("<div>").addClass("ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"),this.uiButtonSet=e("<div>").addClass("ui-dialog-buttonset").appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&&!i.length?(this.uiDialog.removeClass("ui-dialog-buttons"),void 0):(e.each(i,function(i,n){var r,o;n=e.isFunction(n)?{click:n,text:i}:n,n=e.extend({type:"button"},n),r=n.click,n.click=function(){r.apply(t.element[0],arguments)},o={icons:n.icons,text:n.showText},delete n.icons,delete n.showText,e("<button></button>",n).button(o).appendTo(t.uiButtonSet)}),this.uiDialog.addClass("ui-dialog-buttons"),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,n=this.options;this.uiDialog.draggable({cancel:".ui-dialog-content, .ui-dialog-titlebar-close",handle:".ui-dialog-titlebar",containment:"document",start:function(n,r){e(this).addClass("ui-dialog-dragging"),i._blockFrames(),i._trigger("dragStart",n,t(r))},drag:function(e,n){i._trigger("drag",e,t(n))},stop:function(r,o){n.position=[o.position.left-i.document.scrollLeft(),o.position.top-i.document.scrollTop()],e(this).removeClass("ui-dialog-dragging"),i._unblockFrames(),i._trigger("dragStop",r,t(o))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,n=this.options,r=n.resizable,o=this.uiDialog.css("position"),s="string"==typeof r?r:"n,e,s,w,se,sw,ne,nw";this.uiDialog.resizable({cancel:".ui-dialog-content",containment:"document",alsoResize:this.element,maxWidth:n.maxWidth,maxHeight:n.maxHeight,minWidth:n.minWidth,minHeight:this._minHeight(),handles:s,start:function(n,r){e(this).addClass("ui-dialog-resizing"),i._blockFrames(),i._trigger("resizeStart",n,t(r))},resize:function(e,n){i._trigger("resize",e,t(n))},stop:function(r,o){n.height=e(this).height(),n.width=e(this).width(),e(this).removeClass("ui-dialog-resizing"),i._unblockFrames(),i._trigger("resizeStop",r,t(o))}}).css("position",o)},_minHeight:function(){var e=this.options;return"auto"===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(":visible");e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(n){var r=this,o=!1,s={};e.each(n,function(e,n){r._setOption(e,n),e in t&&(o=!0),e in i&&(s[e]=n)}),o&&(this._size(),this._position()),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option",s)},_setOption:function(e,t){var i,n,r=this.uiDialog;"dialogClass"===e&&r.removeClass(this.options.dialogClass).addClass(t),"disabled"!==e&&(this._super(e,t),"appendTo"===e&&this.uiDialog.appendTo(this._appendTo()),"buttons"===e&&this._createButtons(),"closeText"===e&&this.uiDialogTitlebarClose.button({label:""+t}),"draggable"===e&&(i=r.is(":data(ui-draggable)"),i&&!t&&r.draggable("destroy"),!i&&t&&this._makeDraggable()),"position"===e&&this._position(),"resizable"===e&&(n=r.is(":data(ui-resizable)"),n&&!t&&r.resizable("destroy"),n&&"string"==typeof t&&r.resizable("option","handles",t),n||t===!1||this._makeResizable()),"title"===e&&this._title(this.uiDialogTitlebar.find(".ui-dialog-title")))},_size:function(){var e,t,i,n=this.options;this.element.show().css({width:"auto",minHeight:0,maxHeight:"none",height:0}),n.minWidth>n.width&&(n.width=n.minWidth),e=this.uiDialog.css({height:"auto",width:n.width}).outerHeight(),t=Math.max(0,n.minHeight-e),i="number"==typeof n.maxHeight?Math.max(0,n.maxHeight-e):"none","auto"===n.height?this.element.css({minHeight:t,maxHeight:i,height:"auto"}):this.element.height(Math.max(0,n.height-e)),this.uiDialog.is(":data(ui-resizable)")&&this.uiDialog.resizable("option","minHeight",this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find("iframe").map(function(){var t=e(this);return e("<div>").css({position:"absolute",width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&&(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(".ui-dialog").length?!0:!!e(t.target).closest(".ui-datepicker").length},_createOverlay:function(){if(this.options.modal){var t=this,i=this.widgetFullName;e.ui.dialog.overlayInstances||this._delay(function(){e.ui.dialog.overlayInstances&&this.document.bind("focusin.dialog",function(n){t._allowInteraction(n)||(n.preventDefault(),e(".ui-dialog:visible:last .ui-dialog-content").data(i)._focusTabbable())})}),this.overlay=e("<div>").addClass("ui-widget-overlay ui-front").appendTo(this._appendTo()),this._on(this.overlay,{mousedown:"_keepFocus"}),e.ui.dialog.overlayInstances++}},_destroyOverlay:function(){this.options.modal&&this.overlay&&(e.ui.dialog.overlayInstances--,e.ui.dialog.overlayInstances||this.document.unbind("focusin.dialog"),this.overlay.remove(),this.overlay=null)}}),e.ui.dialog.overlayInstances=0,e.uiBackCompat!==!1&&e.widget("ui.dialog",e.ui.dialog,{_position:function(){var t,i=this.options.position,n=[],r=[0,0];i?(("string"==typeof i||"object"==typeof i&&"0"in i)&&(n=i.split?i.split(" "):[i[0],i[1]],1===n.length&&(n[1]=n[0]),e.each(["left","top"],function(e,t){+n[e]===n[e]&&(r[e]=n[e],n[e]=t)}),i={my:n[0]+(r[0]<0?r[0]:"+"+r[0])+" "+n[1]+(r[1]<0?r[1]:"+"+r[1]),at:n.join(" ")}),i=e.extend({},e.ui.dialog.prototype.options.position,i)):i=e.ui.dialog.prototype.options.position,t=this.uiDialog.is(":visible"),t||this.uiDialog.show(),this.uiDialog.position(i),t||this.uiDialog.hide()}})}(jQuery),function(e){var t=/up|down|vertical/,i=/up|left|vertical|horizontal/;e.effects.effect.blind=function(n,r){var o,s,a,l=e(this),h=["position","top","bottom","left","right","height","width"],c=e.effects.setMode(l,n.mode||"hide"),u=n.direction||"up",d=t.test(u),p=d?"height":"width",f=d?"top":"left",m=i.test(u),g={},v="show"===c;l.parent().is(".ui-effects-wrapper")?e.effects.save(l.parent(),h):e.effects.save(l,h),l.show(),o=e.effects.createWrapper(l).css({overflow:"hidden"}),s=o[p](),a=parseFloat(o.css(f))||0,g[p]=v?s:0,m||(l.css(d?"bottom":"right",0).css(d?"top":"left","auto").css({position:"absolute"}),g[f]=v?a:s+a),v&&(o.css(p,0),m||o.css(f,a+s)),o.animate(g,{duration:n.duration,easing:n.easing,queue:!1,complete:function(){"hide"===c&&l.hide(),e.effects.restore(l,h),e.effects.removeWrapper(l),r()}})}}(jQuery),function(e){e.effects.effect.bounce=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"effect"),h="hide"===l,c="show"===l,u=t.direction||"up",d=t.distance,p=t.times||5,f=2*p+(c||h?1:0),m=t.duration/f,g=t.easing,v="up"===u||"down"===u?"top":"left",y="up"===u||"left"===u,_=s.queue(),b=_.length;for((c||h)&&a.push("opacity"),e.effects.save(s,a),s.show(),e.effects.createWrapper(s),d||(d=s["top"===v?"outerHeight":"outerWidth"]()/3),c&&(o={opacity:1},o[v]=0,s.css("opacity",0).css(v,y?2*-d:2*d).animate(o,m,g)),h&&(d/=Math.pow(2,p-1)),o={},o[v]=0,n=0;p>n;n++)r={},r[v]=(y?"-=":"+=")+d,s.animate(r,m,g).animate(o,m,g),d=h?2*d:d/2;h&&(r={opacity:0},r[v]=(y?"-=":"+=")+d,s.animate(r,m,g)),s.queue(function(){h&&s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}),b>1&&_.splice.apply(_,[1,0].concat(_.splice(b,f+1))),s.dequeue()}}(jQuery),function(e){e.effects.effect.clip=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","height","width"],l=e.effects.setMode(s,t.mode||"hide"),h="show"===l,c=t.direction||"vertical",u="vertical"===c,d=u?"height":"width",p=u?"top":"left",f={};e.effects.save(s,a),s.show(),n=e.effects.createWrapper(s).css({overflow:"hidden"}),r="IMG"===s[0].tagName?n:s,o=r[d](),h&&(r.css(d,0),r.css(p,o/2)),f[d]=h?o:0,f[p]=h?0:o/2,r.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){h||s.hide(),e.effects.restore(s,a),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e){e.effects.effect.drop=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","opacity","height","width"],s=e.effects.setMode(r,t.mode||"hide"),a="show"===s,l=t.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l?"pos":"neg",u={opacity:a?1:0};e.effects.save(r,o),r.show(),e.effects.createWrapper(r),n=t.distance||r["top"===h?"outerHeight":"outerWidth"](!0)/2,a&&r.css("opacity",0).css(h,"pos"===c?-n:n),u[h]=(a?"pos"===c?"+=":"-=":"pos"===c?"-=":"+=")+n,r.animate(u,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}})}}(jQuery),function(e){e.effects.effect.explode=function(t,i){function n(){_.push(this),_.length===u*d&&r()}function r(){p.css({visibility:"visible"}),e(_).remove(),m||p.hide(),i()}var o,s,a,l,h,c,u=t.pieces?Math.round(Math.sqrt(t.pieces)):3,d=u,p=e(this),f=e.effects.setMode(p,t.mode||"hide"),m="show"===f,g=p.show().css("visibility","hidden").offset(),v=Math.ceil(p.outerWidth()/d),y=Math.ceil(p.outerHeight()/u),_=[];for(o=0;u>o;o++)for(l=g.top+o*y,c=o-(u-1)/2,s=0;d>s;s++)a=g.left+s*v,h=s-(d-1)/2,p.clone().appendTo("body").wrap("<div></div>").css({position:"absolute",visibility:"visible",left:-s*v,top:-o*y}).parent().addClass("ui-effects-explode").css({position:"absolute",overflow:"hidden",width:v,height:y,left:a+(m?h*v:0),top:l+(m?c*y:0),opacity:m?0:1}).animate({left:a+(m?0:h*v),top:l+(m?0:c*y),opacity:m?1:0},t.duration||500,t.easing,n)}}(jQuery),function(e){e.effects.effect.fade=function(t,i){var n=e(this),r=e.effects.setMode(n,t.mode||"toggle");n.animate({opacity:r},{queue:!1,duration:t.duration,easing:t.easing,complete:i})}}(jQuery),function(e){e.effects.effect.fold=function(t,i){var n,r,o=e(this),s=["position","top","bottom","left","right","height","width"],a=e.effects.setMode(o,t.mode||"hide"),l="show"===a,h="hide"===a,c=t.size||15,u=/([0-9]+)%/.exec(c),d=!!t.horizFirst,p=l!==d,f=p?["width","height"]:["height","width"],m=t.duration/2,g={},v={};e.effects.save(o,s),o.show(),n=e.effects.createWrapper(o).css({overflow:"hidden"}),r=p?[n.width(),n.height()]:[n.height(),n.width()],u&&(c=parseInt(u[1],10)/100*r[h?0:1]),l&&n.css(d?{height:0,width:c}:{height:c,width:0}),g[f[0]]=l?r[0]:c,v[f[1]]=l?r[1]:0,n.animate(g,m,t.easing).animate(v,m,t.easing,function(){h&&o.hide(),e.effects.restore(o,s),e.effects.removeWrapper(o),i()})}}(jQuery),function(e){e.effects.effect.highlight=function(t,i){var n=e(this),r=["backgroundImage","backgroundColor","opacity"],o=e.effects.setMode(n,t.mode||"show"),s={backgroundColor:n.css("backgroundColor")};"hide"===o&&(s.opacity=0),e.effects.save(n,r),n.show().css({backgroundImage:"none",backgroundColor:t.color||"#ffff99"}).animate(s,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===o&&n.hide(),e.effects.restore(n,r),i()}})}}(jQuery),function(e){e.effects.effect.pulsate=function(t,i){var n,r=e(this),o=e.effects.setMode(r,t.mode||"show"),s="show"===o,a="hide"===o,l=s||"hide"===o,h=2*(t.times||5)+(l?1:0),c=t.duration/h,u=0,d=r.queue(),p=d.length;for((s||!r.is(":visible"))&&(r.css("opacity",0).show(),u=1),n=1;h>n;n++)r.animate({opacity:u},c,t.easing),u=1-u;r.animate({opacity:u},c,t.easing),r.queue(function(){a&&r.hide(),i()}),p>1&&d.splice.apply(d,[1,0].concat(d.splice(p,h+1))),r.dequeue()}}(jQuery),function(e){e.effects.effect.puff=function(t,i){var n=e(this),r=e.effects.setMode(n,t.mode||"hide"),o="hide"===r,s=parseInt(t.percent,10)||150,a=s/100,l={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()};e.extend(t,{effect:"scale",queue:!1,fade:!0,mode:r,complete:i,percent:o?s:100,from:o?l:{height:l.height*a,width:l.width*a,outerHeight:l.outerHeight*a,outerWidth:l.outerWidth*a}}),n.effect(t)},e.effects.effect.scale=function(t,i){var n=e(this),r=e.extend(!0,{},t),o=e.effects.setMode(n,t.mode||"effect"),s=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:"hide"===o?0:100),a=t.direction||"both",l=t.origin,h={height:n.height(),width:n.width(),outerHeight:n.outerHeight(),outerWidth:n.outerWidth()},c={y:"horizontal"!==a?s/100:1,x:"vertical"!==a?s/100:1};r.effect="size",r.queue=!1,r.complete=i,"effect"!==o&&(r.origin=l||["middle","center"],r.restore=!0),r.from=t.from||("show"===o?{height:0,width:0,outerHeight:0,outerWidth:0}:h),r.to={height:h.height*c.y,width:h.width*c.x,outerHeight:h.outerHeight*c.y,outerWidth:h.outerWidth*c.x},r.fade&&("show"===o&&(r.from.opacity=0,r.to.opacity=1),"hide"===o&&(r.from.opacity=1,r.to.opacity=0)),n.effect(r)},e.effects.effect.size=function(t,i){var n,r,o,s=e(this),a=["position","top","bottom","left","right","width","height","overflow","opacity"],l=["position","top","bottom","left","right","overflow","opacity"],h=["width","height","overflow"],c=["fontSize"],u=["borderTopWidth","borderBottomWidth","paddingTop","paddingBottom"],d=["borderLeftWidth","borderRightWidth","paddingLeft","paddingRight"],p=e.effects.setMode(s,t.mode||"effect"),f=t.restore||"effect"!==p,m=t.scale||"both",g=t.origin||["middle","center"],v=s.css("position"),y=f?a:l,_={height:0,width:0,outerHeight:0,outerWidth:0};
"show"===p&&s.show(),n={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},"toggle"===t.mode&&"show"===p?(s.from=t.to||_,s.to=t.from||n):(s.from=t.from||("show"===p?_:n),s.to=t.to||("hide"===p?_:n)),o={from:{y:s.from.height/n.height,x:s.from.width/n.width},to:{y:s.to.height/n.height,x:s.to.width/n.width}},("box"===m||"both"===m)&&(o.from.y!==o.to.y&&(y=y.concat(u),s.from=e.effects.setTransition(s,u,o.from.y,s.from),s.to=e.effects.setTransition(s,u,o.to.y,s.to)),o.from.x!==o.to.x&&(y=y.concat(d),s.from=e.effects.setTransition(s,d,o.from.x,s.from),s.to=e.effects.setTransition(s,d,o.to.x,s.to))),("content"===m||"both"===m)&&o.from.y!==o.to.y&&(y=y.concat(c).concat(h),s.from=e.effects.setTransition(s,c,o.from.y,s.from),s.to=e.effects.setTransition(s,c,o.to.y,s.to)),e.effects.save(s,y),s.show(),e.effects.createWrapper(s),s.css("overflow","hidden").css(s.from),g&&(r=e.effects.getBaseline(g,n),s.from.top=(n.outerHeight-s.outerHeight())*r.y,s.from.left=(n.outerWidth-s.outerWidth())*r.x,s.to.top=(n.outerHeight-s.to.outerHeight)*r.y,s.to.left=(n.outerWidth-s.to.outerWidth)*r.x),s.css(s.from),("content"===m||"both"===m)&&(u=u.concat(["marginTop","marginBottom"]).concat(c),d=d.concat(["marginLeft","marginRight"]),h=a.concat(u).concat(d),s.find("*[width]").each(function(){var i=e(this),n={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};f&&e.effects.save(i,h),i.from={height:n.height*o.from.y,width:n.width*o.from.x,outerHeight:n.outerHeight*o.from.y,outerWidth:n.outerWidth*o.from.x},i.to={height:n.height*o.to.y,width:n.width*o.to.x,outerHeight:n.height*o.to.y,outerWidth:n.width*o.to.x},o.from.y!==o.to.y&&(i.from=e.effects.setTransition(i,u,o.from.y,i.from),i.to=e.effects.setTransition(i,u,o.to.y,i.to)),o.from.x!==o.to.x&&(i.from=e.effects.setTransition(i,d,o.from.x,i.from),i.to=e.effects.setTransition(i,d,o.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&&e.effects.restore(i,h)})})),s.animate(s.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===s.to.opacity&&s.css("opacity",s.from.opacity),"hide"===p&&s.hide(),e.effects.restore(s,y),f||("static"===v?s.css({position:"relative",top:s.to.top,left:s.to.left}):e.each(["top","left"],function(e,t){s.css(t,function(t,i){var n=parseInt(i,10),r=e?s.to.left:s.to.top;return"auto"===i?r+"px":n+r+"px"})})),e.effects.removeWrapper(s),i()}})}}(jQuery),function(e){e.effects.effect.shake=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","height","width"],s=e.effects.setMode(r,t.mode||"effect"),a=t.direction||"left",l=t.distance||20,h=t.times||3,c=2*h+1,u=Math.round(t.duration/c),d="up"===a||"down"===a?"top":"left",p="up"===a||"left"===a,f={},m={},g={},v=r.queue(),y=v.length;for(e.effects.save(r,o),r.show(),e.effects.createWrapper(r),f[d]=(p?"-=":"+=")+l,m[d]=(p?"+=":"-=")+2*l,g[d]=(p?"-=":"+=")+2*l,r.animate(f,u,t.easing),n=1;h>n;n++)r.animate(m,u,t.easing).animate(g,u,t.easing);r.animate(m,u,t.easing).animate(f,u/2,t.easing).queue(function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}),y>1&&v.splice.apply(v,[1,0].concat(v.splice(y,c+1))),r.dequeue()}}(jQuery),function(e){e.effects.effect.slide=function(t,i){var n,r=e(this),o=["position","top","bottom","left","right","width","height"],s=e.effects.setMode(r,t.mode||"show"),a="show"===s,l=t.direction||"left",h="up"===l||"down"===l?"top":"left",c="up"===l||"left"===l,u={};e.effects.save(r,o),r.show(),n=t.distance||r["top"===h?"outerHeight":"outerWidth"](!0),e.effects.createWrapper(r).css({overflow:"hidden"}),a&&r.css(h,c?isNaN(n)?"-"+n:-n:n),u[h]=(a?c?"+=":"-=":c?"-=":"+=")+n,r.animate(u,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){"hide"===s&&r.hide(),e.effects.restore(r,o),e.effects.removeWrapper(r),i()}})}}(jQuery),function(e){e.effects.effect.transfer=function(t,i){var n=e(this),r=e(t.to),o="fixed"===r.css("position"),s=e("body"),a=o?s.scrollTop():0,l=o?s.scrollLeft():0,h=r.offset(),c={top:h.top-a,left:h.left-l,height:r.innerHeight(),width:r.innerWidth()},u=n.offset(),d=e("<div class='ui-effects-transfer'></div>").appendTo(document.body).addClass(t.className).css({top:u.top-a,left:u.left-l,height:n.innerHeight(),width:n.innerWidth(),position:o?"fixed":"absolute"}).animate(c,t.duration,t.easing,function(){d.remove(),i()})}}(jQuery),function(e){e.widget("ui.menu",{version:"1.10.3",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,e.proxy(function(e){this.options.disabled&&e.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(e){e.preventDefault()},"click .ui-state-disabled > a":function(e){e.preventDefault()},"click .ui-menu-item:has(a)":function(t){var i=e(t.target).closest(".ui-menu-item");!this.mouseHandled&&i.not(".ui-state-disabled").length&&(this.mouseHandled=!0,this.select(t),i.has(".ui-menu").length?this.expand(t):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(t){var i=e(t.currentTarget);i.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(t,i)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(e,t){var i=this.active||this.element.children(".ui-menu-item").eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(t){e(t.target).closest(".ui-menu").length||this.collapseAll(t),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").addBack().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var t=e(this);t.data("ui-menu-submenu-carat")&&t.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(t){function i(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var n,r,o,s,a,l=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move("first","first",t);break;case e.ui.keyCode.END:this._move("last","last",t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:l=!1,r=this.previousFilter||"",o=String.fromCharCode(t.keyCode),s=!1,clearTimeout(this.filterTimer),o===r?s=!0:o=r+o,a=new RegExp("^"+i(o),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())}),n=s&&-1!==n.index(this.active.next())?this.active.nextAll(".ui-menu-item"):n,n.length||(o=String.fromCharCode(t.keyCode),a=new RegExp("^"+i(o),"i"),n=this.activeMenu.children(".ui-menu-item").filter(function(){return a.test(e(this).children("a").text())})),n.length?(this.focus(t,n),n.length>1?(this.previousFilter=o,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}l&&t.preventDefault()},_activate:function(e){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(e):this.select(e))},refresh:function(){var t,i=this.options.icons.submenu,n=this.element.find(this.options.menus);n.filter(":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"}).each(function(){var t=e(this),n=t.prev("a"),r=e("<span>").addClass("ui-menu-icon ui-icon "+i).data("ui-menu-submenu-carat",!0);n.attr("aria-haspopup","true").prepend(r),t.attr("aria-labelledby",n.attr("id"))}),t=n.add(this.element),t.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),t.children(":not(.ui-menu-item)").each(function(){var t=e(this);/[^\-\u2014\u2013\s]/.test(t.text())||t.addClass("ui-widget-content ui-menu-divider")}),t.children(".ui-state-disabled").attr("aria-disabled","true"),this.active&&!e.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},_setOption:function(e,t){"icons"===e&&this.element.find(".ui-menu-icon").removeClass(this.options.icons.submenu).addClass(t.submenu),this._super(e,t)},focus:function(e,t){var i,n;this.blur(e,e&&"focus"===e.type),this._scrollIntoView(t),this.active=t.first(),n=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",n.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),e&&"keydown"===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(".ui-menu"),i.length&&/^mouse/.test(e.type)&&this._startOpening(i),this.activeMenu=t.parent(),this._trigger("focus",e,{item:t})},_scrollIntoView:function(t){var i,n,r,o,s,a;this._hasScroll()&&(i=parseFloat(e.css(this.activeMenu[0],"borderTopWidth"))||0,n=parseFloat(e.css(this.activeMenu[0],"paddingTop"))||0,r=t.offset().top-this.activeMenu.offset().top-i-n,o=this.activeMenu.scrollTop(),s=this.activeMenu.height(),a=t.height(),0>r?this.activeMenu.scrollTop(o+r):r+a>s&&this.activeMenu.scrollTop(o+r-s+a))},blur:function(e,t){t||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),"true"===e.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(t.parents(".ui-menu")).hide().attr("aria-hidden","true"),t.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var n=i?this.element:e(t&&t.target).closest(this.element.find(".ui-menu"));n.length||(n=this.element),this._close(n),this.blur(t),this.activeMenu=n},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(e){var t=this.active&&this.active.parent().closest(".ui-menu-item",this.element);t&&t.length&&(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();t&&t.length&&(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move("next","first",e)},previous:function(e){this._move("prev","last",e)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(e,t,i){var n;this.active&&(n="first"===e||"last"===e?this.active["first"===e?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[e+"All"](".ui-menu-item").eq(0)),n&&n.length&&this.active||(n=this.activeMenu.children(".ui-menu-item")[t]()),this.focus(i,n)},nextPage:function(t){var i,n,r;return this.active?(this.isLastItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n-r<0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,n,r;return this.active?(this.isFirstItem()||(this._hasScroll()?(n=this.active.offset().top,r=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return i=e(this),i.offset().top-n+r>0}),this.focus(t,i)):this.focus(t,this.activeMenu.children(".ui-menu-item").first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(t){this.active=this.active||e(t.target).closest(".ui-menu-item");var i={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(t,!0),this._trigger("select",t,i)}})}(jQuery),function(e,t){function i(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function n(t,i){return parseInt(e.css(t,i),10)||0}function r(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var o,s=Math.max,a=Math.abs,l=Math.round,h=/left|center|right/,c=/top|center|bottom/,u=/[\+\-]\d+(\.[\d]+)?%?/,d=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(o!==t)return o;var i,n,r=e("<div style='display:block;width:50px;height:50px;overflow:hidden;'><div style='height:100px;width:auto;'></div></div>"),s=r.children()[0];return e("body").append(r),i=s.offsetWidth,r.css("overflow","scroll"),n=s.offsetWidth,i===n&&(n=r[0].clientWidth),r.remove(),o=i-n},getScrollInfo:function(t){var i=t.isWindow?"":t.element.css("overflow-x"),n=t.isWindow?"":t.element.css("overflow-y"),r="scroll"===i||"auto"===i&&t.width<t.element[0].scrollWidth,o="scroll"===n||"auto"===n&&t.height<t.element[0].scrollHeight;return{width:o?e.position.scrollbarWidth():0,height:r?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),n=e.isWindow(i[0]);return{element:i,isWindow:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:n?i.width():i.outerWidth(),height:n?i.height():i.outerHeight()}}},e.fn.position=function(t){if(!t||!t.of)return f.apply(this,arguments);t=e.extend({},t);var o,p,m,g,v,y,_=e(t.of),b=e.position.getWithinInfo(t.within),E=e.position.getScrollInfo(b),x=(t.collision||"flip").split(" "),T={};return y=r(_),_[0].preventDefault&&(t.at="left top"),p=y.width,m=y.height,g=y.offset,v=e.extend({},g),e.each(["my","at"],function(){var e,i,n=(t[this]||"").split(" ");1===n.length&&(n=h.test(n[0])?n.concat(["center"]):c.test(n[0])?["center"].concat(n):["center","center"]),n[0]=h.test(n[0])?n[0]:"center",n[1]=c.test(n[1])?n[1]:"center",e=u.exec(n[0]),i=u.exec(n[1]),T[this]=[e?e[0]:0,i?i[0]:0],t[this]=[d.exec(n[0])[0],d.exec(n[1])[0]]}),1===x.length&&(x[1]=x[0]),"right"===t.at[0]?v.left+=p:"center"===t.at[0]&&(v.left+=p/2),"bottom"===t.at[1]?v.top+=m:"center"===t.at[1]&&(v.top+=m/2),o=i(T.at,p,m),v.left+=o[0],v.top+=o[1],this.each(function(){var r,h,c=e(this),u=c.outerWidth(),d=c.outerHeight(),f=n(this,"marginLeft"),y=n(this,"marginTop"),w=u+f+n(this,"marginRight")+E.width,R=d+y+n(this,"marginBottom")+E.height,S=e.extend({},v),C=i(T.my,c.outerWidth(),c.outerHeight());"right"===t.my[0]?S.left-=u:"center"===t.my[0]&&(S.left-=u/2),"bottom"===t.my[1]?S.top-=d:"center"===t.my[1]&&(S.top-=d/2),S.left+=C[0],S.top+=C[1],e.support.offsetFractions||(S.left=l(S.left),S.top=l(S.top)),r={marginLeft:f,marginTop:y},e.each(["left","top"],function(i,n){e.ui.position[x[i]]&&e.ui.position[x[i]][n](S,{targetWidth:p,targetHeight:m,elemWidth:u,elemHeight:d,collisionPosition:r,collisionWidth:w,collisionHeight:R,offset:[o[0]+C[0],o[1]+C[1]],my:t.my,at:t.at,within:b,elem:c})}),t.using&&(h=function(e){var i=g.left-S.left,n=i+p-u,r=g.top-S.top,o=r+m-d,l={target:{element:_,left:g.left,top:g.top,width:p,height:m},element:{element:c,left:S.left,top:S.top,width:u,height:d},horizontal:0>n?"left":i>0?"right":"center",vertical:0>o?"top":r>0?"bottom":"middle"};u>p&&a(i+n)<p&&(l.horizontal="center"),d>m&&a(r+o)<m&&(l.vertical="middle"),l.important=s(a(i),a(n))>s(a(r),a(o))?"horizontal":"vertical",t.using.call(this,e,l)}),c.offset(e.extend(S,{using:h}))})},e.ui.position={fit:{left:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollLeft:n.offset.left,o=n.width,a=e.left-t.collisionPosition.marginLeft,l=r-a,h=a+t.collisionWidth-o-r;t.collisionWidth>o?l>0&&0>=h?(i=e.left+l+t.collisionWidth-o-r,e.left+=l-i):e.left=h>0&&0>=l?r:l>h?r+o-t.collisionWidth:r:l>0?e.left+=l:h>0?e.left-=h:e.left=s(e.left-a,e.left)},top:function(e,t){var i,n=t.within,r=n.isWindow?n.scrollTop:n.offset.top,o=t.within.height,a=e.top-t.collisionPosition.marginTop,l=r-a,h=a+t.collisionHeight-o-r;t.collisionHeight>o?l>0&&0>=h?(i=e.top+l+t.collisionHeight-o-r,e.top+=l-i):e.top=h>0&&0>=l?r:l>h?r+o-t.collisionHeight:r:l>0?e.top+=l:h>0?e.top-=h:e.top=s(e.top-a,e.top)}},flip:{left:function(e,t){var i,n,r=t.within,o=r.offset.left+r.scrollLeft,s=r.width,l=r.isWindow?r.scrollLeft:r.offset.left,h=e.left-t.collisionPosition.marginLeft,c=h-l,u=h+t.collisionWidth-s-l,d="left"===t.my[0]?-t.elemWidth:"right"===t.my[0]?t.elemWidth:0,p="left"===t.at[0]?t.targetWidth:"right"===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0>c?(i=e.left+d+p+f+t.collisionWidth-s-o,(0>i||i<a(c))&&(e.left+=d+p+f)):u>0&&(n=e.left-t.collisionPosition.marginLeft+d+p+f-l,(n>0||a(n)<u)&&(e.left+=d+p+f))},top:function(e,t){var i,n,r=t.within,o=r.offset.top+r.scrollTop,s=r.height,l=r.isWindow?r.scrollTop:r.offset.top,h=e.top-t.collisionPosition.marginTop,c=h-l,u=h+t.collisionHeight-s-l,d="top"===t.my[1],p=d?-t.elemHeight:"bottom"===t.my[1]?t.elemHeight:0,f="top"===t.at[1]?t.targetHeight:"bottom"===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0>c?(n=e.top+p+f+m+t.collisionHeight-s-o,e.top+p+f+m>c&&(0>n||n<a(c))&&(e.top+=p+f+m)):u>0&&(i=e.top-t.collisionPosition.marginTop+p+f+m-l,e.top+p+f+m>u&&(i>0||a(i)<u)&&(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,n,r,o,s=document.getElementsByTagName("body")[0],a=document.createElement("div");t=document.createElement(s?"div":"body"),n={visibility:"hidden",width:0,height:0,border:0,margin:0,background:"none"},s&&e.extend(n,{position:"absolute",left:"-1000px",top:"-1000px"});for(o in n)t.style[o]=n[o];t.appendChild(a),i=s||document.documentElement,i.insertBefore(t,i.firstChild),a.style.cssText="position: absolute; left: 10.7432222px;",r=e(a).offset().left,e.support.offsetFractions=r>10&&11>r,t.innerHTML="",i.removeChild(t)}()}(jQuery),function(e,t){e.widget("ui.progressbar",{version:"1.10.3",options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").attr({role:"progressbar","aria-valuemin":this.min}),this.valueDiv=e("<div class='ui-progressbar-value ui-widget-header ui-corner-left'></div>").appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass("ui-progressbar ui-widget ui-widget-content ui-corner-all").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.valueDiv.remove()},value:function(e){return e===t?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return e===t&&(e=this.options.value),this.indeterminate=e===!1,"number"!=typeof e&&(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){"max"===e&&(t=Math.max(this.min,t)),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t>this.min).toggleClass("ui-corner-right",t===this.options.max).width(i.toFixed(0)+"%"),this.element.toggleClass("ui-progressbar-indeterminate",this.indeterminate),this.indeterminate?(this.element.removeAttr("aria-valuenow"),this.overlayDiv||(this.overlayDiv=e("<div class='ui-progressbar-overlay'></div>").appendTo(this.valueDiv))):(this.element.attr({"aria-valuemax":this.options.max,"aria-valuenow":t}),this.overlayDiv&&(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&&(this.oldValue=t,this._trigger("change")),t===this.options.max&&this._trigger("complete")}})}(jQuery),function(e){var t=5;e.widget("ui.slider",e.ui.mouse,{version:"1.10.3",widgetEventPrefix:"slide",options:{animate:!1,distance:0,max:100,min:0,orientation:"horizontal",range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this.element.addClass("ui-slider ui-slider-"+this.orientation+" ui-widget"+" ui-widget-content"+" ui-corner-all"),this._refresh(),this._setOption("disabled",this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,n=this.options,r=this.element.find(".ui-slider-handle").addClass("ui-state-default ui-corner-all"),o="<a class='ui-slider-handle ui-state-default ui-corner-all' href='#'></a>",s=[];for(i=n.values&&n.values.length||1,r.length>i&&(r.slice(i).remove(),r=r.slice(0,i)),t=r.length;i>t;t++)s.push(o);this.handles=r.add(e(s.join("")).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data("ui-slider-handle-index",t)})},_createRange:function(){var t=this.options,i="";t.range?(t.range===!0&&(t.values?t.values.length&&2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&&(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&&this.range.length?this.range.removeClass("ui-slider-range-min ui-slider-range-max").css({left:"",bottom:""}):(this.range=e("<div></div>").appendTo(this.element),i="ui-slider-range ui-widget-header ui-corner-all"),this.range.addClass(i+("min"===t.range||"max"===t.range?" ui-slider-range-"+t.range:""))):this.range=e([])},_setupEvents:function(){var e=this.handles.add(this.range).filter("a");this._off(e),this._on(e,this._handleEvents),this._hoverable(e),this._focusable(e)},_destroy:function(){this.handles.remove(),this.range.remove(),this.element.removeClass("ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all"),this._mouseDestroy()},_mouseCapture:function(t){var i,n,r,o,s,a,l,h,c=this,u=this.options;return u.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},n=this._normValueFromMouse(i),r=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(n-c.values(t));(r>i||r===i&&(t===c._lastChangedValue||c.values(t)===u.min))&&(r=i,o=e(this),s=t)}),a=this._start(t,s),a===!1?!1:(this._mouseSliding=!0,this._handleIndex=s,o.addClass("ui-state-active").focus(),l=o.offset(),h=!e(t.target).parents().addBack().is(".ui-slider-handle"),this._clickOffset=h?{left:0,top:0}:{left:t.pageX-l.left-o.width()/2,top:t.pageY-l.top-o.height()/2-(parseInt(o.css("borderTopWidth"),10)||0)-(parseInt(o.css("borderBottomWidth"),10)||0)+(parseInt(o.css("marginTop"),10)||0)},this.handles.hasClass("ui-state-hover")||this._slide(t,s,n),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass("ui-state-active"),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation="vertical"===this.options.orientation?"vertical":"horizontal"},_normValueFromMouse:function(e){var t,i,n,r,o;return"horizontal"===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),n=i/t,n>1&&(n=1),0>n&&(n=0),"vertical"===this.orientation&&(n=1-n),r=this._valueMax()-this._valueMin(),o=this._valueMin()+n*r,this._trimAlignValue(o)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("start",e,i)},_slide:function(e,t,i){var n,r,o;this.options.values&&this.options.values.length?(n=this.values(t?0:1),2===this.options.values.length&&this.options.range===!0&&(0===t&&i>n||1===t&&n>i)&&(i=n),i!==this.values(t)&&(r=this.values(),r[t]=i,o=this._trigger("slide",e,{handle:this.handles[t],value:i,values:r}),n=this.values(t?0:1),o!==!1&&this.values(t,i,!0))):i!==this.value()&&(o=this._trigger("slide",e,{handle:this.handles[t],value:i}),o!==!1&&this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._trigger("stop",e,i)},_change:function(e,t){if(!this._keySliding&&!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&&this.options.values.length&&(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger("change",e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var n,r,o;if(arguments.length>1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&&this.options.values.length?this._values(t):this.value();for(n=this.options.values,r=arguments[0],o=0;o<n.length;o+=1)n[o]=this._trimAlignValue(r[o]),this._change(null,o);this._refreshValue()},_setOption:function(t,i){var n,r=0;switch("range"===t&&this.options.range===!0&&("min"===i?(this.options.value=this._values(0),this.options.values=null):"max"===i&&(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&&(r=this.options.values.length),e.Widget.prototype._setOption.apply(this,arguments),t){case"orientation":this._detectOrientation(),this.element.removeClass("ui-slider-horizontal ui-slider-vertical").addClass("ui-slider-"+this.orientation),this._refreshValue();break;case"value":this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case"values":for(this._animateOff=!0,this._refreshValue(),n=0;r>n;n+=1)this._change(null,n);this._animateOff=!1;break;case"min":case"max":this._animateOff=!0,this._refreshValue(),this._animateOff=!1;break;case"range":this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,n;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&&this.options.values.length){for(i=this.options.values.slice(),n=0;n<i.length;n+=1)i[n]=this._trimAlignValue(i[n]);return i}return[]},_trimAlignValue:function(e){if(e<=this._valueMin())return this._valueMin();if(e>=this._valueMax())return this._valueMax();var t=this.options.step>0?this.options.step:1,i=(e-this._valueMin())%t,n=e-i;return 2*Math.abs(i)>=t&&(n+=i>0?t:-t),parseFloat(n.toFixed(5))},_valueMin:function(){return this.options.min},_valueMax:function(){return this.options.max},_refreshValue:function(){var t,i,n,r,o,s=this.options.range,a=this.options,l=this,h=this._animateOff?!1:a.animate,c={};this.options.values&&this.options.values.length?this.handles.each(function(n){i=100*((l.values(n)-l._valueMin())/(l._valueMax()-l._valueMin())),c["horizontal"===l.orientation?"left":"bottom"]=i+"%",e(this).stop(1,1)[h?"animate":"css"](c,a.animate),l.options.range===!0&&("horizontal"===l.orientation?(0===n&&l.range.stop(1,1)[h?"animate":"css"]({left:i+"%"},a.animate),1===n&&l.range[h?"animate":"css"]({width:i-t+"%"},{queue:!1,duration:a.animate})):(0===n&&l.range.stop(1,1)[h?"animate":"css"]({bottom:i+"%"},a.animate),1===n&&l.range[h?"animate":"css"]({height:i-t+"%"},{queue:!1,duration:a.animate}))),t=i}):(n=this.value(),r=this._valueMin(),o=this._valueMax(),i=o!==r?100*((n-r)/(o-r)):0,c["horizontal"===this.orientation?"left":"bottom"]=i+"%",this.handle.stop(1,1)[h?"animate":"css"](c,a.animate),"min"===s&&"horizontal"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({width:i+"%"},a.animate),"max"===s&&"horizontal"===this.orientation&&this.range[h?"animate":"css"]({width:100-i+"%"},{queue:!1,duration:a.animate}),"min"===s&&"vertical"===this.orientation&&this.range.stop(1,1)[h?"animate":"css"]({height:i+"%"},a.animate),"max"===s&&"vertical"===this.orientation&&this.range[h?"animate":"css"]({height:100-i+"%"},{queue:!1,duration:a.animate}))},_handleEvents:{keydown:function(i){var n,r,o,s,a=e(i.target).data("ui-slider-handle-index");switch(i.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(i.preventDefault(),!this._keySliding&&(this._keySliding=!0,e(i.target).addClass("ui-state-active"),n=this._start(i,a),n===!1))return}switch(s=this.options.step,r=o=this.options.values&&this.options.values.length?this.values(a):this.value(),i.keyCode){case e.ui.keyCode.HOME:o=this._valueMin();break;case e.ui.keyCode.END:o=this._valueMax();break;case e.ui.keyCode.PAGE_UP:o=this._trimAlignValue(r+(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.PAGE_DOWN:o=this._trimAlignValue(r-(this._valueMax()-this._valueMin())/t);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(r===this._valueMax())return;o=this._trimAlignValue(r+s);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(r===this._valueMin())return;o=this._trimAlignValue(r-s)}this._slide(i,a,o)},click:function(e){e.preventDefault()},keyup:function(t){var i=e(t.target).data("ui-slider-handle-index");this._keySliding&&(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass("ui-state-active"))}}})}(jQuery),function(e){function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")
}}e.widget("ui.spinner",{version:"1.10.3",defaultElement:"<input>",widgetEventPrefix:"spin",options:{culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t={},i=this.element;return e.each(["min","max","step"],function(e,n){var r=i.attr(n);void 0!==r&&r.length&&(t[n]=r)}),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&&!this._start(e))return!1;this._spin((t>0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&&this._stop(e)},100),e.preventDefault()}},"mousedown .ui-spinner-button":function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=n,this._delay(function(){this.previous=n}))}var n;n=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){return e(t.currentTarget).hasClass("ui-state-active")?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t),void 0):void 0},"mouseleave .ui-spinner-button":"_stop"},_draw:function(){var e=this.uiSpinner=this.element.addClass("ui-spinner-input").attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr("role","spinbutton"),this.buttons=e.find(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all"),this.buttons.height()>Math.ceil(.5*e.height())&&e.height()>0&&e.height(e.height()),this.options.disabled&&this.disable()},_keydown:function(t){var i=this.options,n=e.ui.keyCode;switch(t.keyCode){case n.UP:return this._repeat(null,1,t),!0;case n.DOWN:return this._repeat(null,-1,t),!0;case n.PAGE_UP:return this._repeat(null,i.page,t),!0;case n.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return"<span class='ui-spinner ui-widget ui-widget-content ui-corner-all'></span>"},_buttonHtml:function(){return"<a class='ui-spinner-button ui-spinner-up ui-corner-tr'><span class='ui-icon "+this.options.icons.up+"'>&#9650;</span>"+"</a>"+"<a class='ui-spinner-button ui-spinner-down ui-corner-br'>"+"<span class='ui-icon "+this.options.icons.down+"'>&#9660;</span>"+"</a>"},_start:function(e){return this.spinning||this._trigger("start",e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&this._trigger("spin",t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,n=this.options;return t=null!==n.min?n.min:0,i=e-t,i=Math.round(i/n.step)*n.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==n.max&&e>n.max?n.max:null!==n.min&&e<n.min?n.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){if("culture"===e||"numberFormat"===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}("max"===e||"min"===e||"step"===e)&&"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(this.buttons.first().find(".ui-icon").removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(".ui-icon").removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),"disabled"===e&&(t?(this.element.prop("disabled",!0),this.buttons.button("disable")):(this.element.prop("disabled",!1),this.buttons.button("enable")))},_setOptions:t(function(e){this._super(e),this._value(this.element.val())}),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},_value:function(e,t){var i;""!==e&&(i=this._parse(e),null!==i&&(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass("ui-spinner-input").prop("disabled",!1).removeAttr("autocomplete").removeAttr("role").removeAttr("aria-valuemin").removeAttr("aria-valuemax").removeAttr("aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:t(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(t(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}})}(jQuery),function(e,t){function i(){return++r}function n(e){return e.hash.length>1&&decodeURIComponent(e.href.replace(o,""))===decodeURIComponent(location.href.replace(o,""))}var r=0,o=/#.*$/;e.widget("ui.tabs",{version:"1.10.3",delay:300,options:{active:null,collapsible:!1,event:"click",heightStyle:"content",hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass("ui-tabs ui-widget ui-widget-content ui-corner-all").toggleClass("ui-tabs-collapsible",i.collapsible).delegate(".ui-tabs-nav > li","mousedown"+this.eventNamespace,function(t){e(this).is(".ui-state-disabled")&&t.preventDefault()}).delegate(".ui-tabs-anchor","focus"+this.eventNamespace,function(){e(this).closest("li").is(".ui-state-disabled")&&this.blur()}),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&&(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(".ui-state-disabled"),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&&this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&&this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,n=location.hash.substring(1);return null===t&&(n&&this.tabs.each(function(i,r){return e(r).attr("aria-controls")===n?(t=i,!1):void 0}),null===t&&(t=this.tabs.index(this.tabs.filter(".ui-tabs-active"))),(null===t||-1===t)&&(t=this.tabs.length?0:!1)),t!==!1&&(t=this.tabs.index(this.tabs.eq(t)),-1===t&&(t=i?!1:0)),!i&&t===!1&&this.anchors.length&&(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest("li"),n=this.tabs.index(i),r=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:n++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:r=!1,n--;break;case e.ui.keyCode.END:n=this.anchors.length-1;break;case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(n),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(n===this.options.active?!1:n),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),n=this._focusNextTab(n,r),t.ctrlKey||(i.attr("aria-selected","false"),this.tabs.eq(n).attr("aria-selected","true"),this.activating=this._delay(function(){this.option("active",n)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&&t.keyCode===e.ui.keyCode.UP&&(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&&t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&&t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function n(){return t>r&&(t=0),0>t&&(t=r),t}for(var r=this.tabs.length-1;-1!==e.inArray(n(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return"active"===e?(this._activate(t),void 0):"disabled"===e?(this._setupDisabled(t),void 0):(this._super(e,t),"collapsible"===e&&(this.element.toggleClass("ui-tabs-collapsible",t),t||this.options.active!==!1||this._activate(0)),"event"===e&&this._setupEvents(t),"heightStyle"===e&&this._setupHeightStyle(t),void 0)},_tabId:function(e){return e.attr("aria-controls")||"ui-tabs-"+i()},_sanitizeSelector:function(e){return e?e.replace(/[!"$%&'()*+,.\/:;<=>?@\[\]\^`{|}~]/g,"\\$&"):""},refresh:function(){var t=this.options,i=this.tablist.children(":has(a[href])");t.disabled=e.map(i.filter(".ui-state-disabled"),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&&this.anchors.length?this.active.length&&!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({"aria-selected":"false",tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({"aria-expanded":"false","aria-hidden":"true"}),this.active.length?(this.active.addClass("ui-tabs-active ui-state-active").attr({"aria-selected":"true",tabIndex:0}),this._getPanelForTab(this.active).show().attr({"aria-expanded":"true","aria-hidden":"false"})):this.tabs.eq(0).attr("tabIndex",0)},_processTabs:function(){var t=this;this.tablist=this._getList().addClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").attr("role","tablist"),this.tabs=this.tablist.find("> li:has(a[href])").addClass("ui-state-default ui-corner-top").attr({role:"tab",tabIndex:-1}),this.anchors=this.tabs.map(function(){return e("a",this)[0]}).addClass("ui-tabs-anchor").attr({role:"presentation",tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,r){var o,s,a,l=e(r).uniqueId().attr("id"),h=e(r).closest("li"),c=h.attr("aria-controls");n(r)?(o=r.hash,s=t.element.find(t._sanitizeSelector(o))):(a=t._tabId(h),o="#"+a,s=t.element.find(o),s.length||(s=t._createPanel(a),s.insertAfter(t.panels[i-1]||t.tablist)),s.attr("aria-live","polite")),s.length&&(t.panels=t.panels.add(s)),c&&h.data("ui-tabs-aria-controls",c),h.attr({"aria-controls":o.substring(1),"aria-labelledby":l}),s.attr("aria-labelledby",l)}),this.panels.addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").attr("role","tabpanel")},_getList:function(){return this.element.find("ol,ul").eq(0)},_createPanel:function(t){return e("<div>").attr("id",t).addClass("ui-tabs-panel ui-widget-content ui-corner-bottom").data("ui-tabs-destroy",!0)},_setupDisabled:function(t){e.isArray(t)&&(t.length?t.length===this.anchors.length&&(t=!0):t=!1);for(var i,n=0;i=this.tabs[n];n++)t===!0||-1!==e.inArray(n,t)?e(i).addClass("ui-state-disabled").attr("aria-disabled","true"):e(i).removeClass("ui-state-disabled").removeAttr("aria-disabled");this.options.disabled=t},_setupEvents:function(t){var i={click:function(e){e.preventDefault()}};t&&e.each(t.split(" "),function(e,t){i[t]="_eventHandler"}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(this.anchors,i),this._on(this.tabs,{keydown:"_tabKeydown"}),this._on(this.panels,{keydown:"_panelKeydown"}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,n=this.element.parent();"fill"===t?(i=n.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(":visible").each(function(){var t=e(this),n=t.css("position");"absolute"!==n&&"fixed"!==n&&(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css("overflow","auto")):"auto"===t&&(i=0,this.panels.each(function(){i=Math.max(i,e(this).height("").height())}).height(i))},_eventHandler:function(t){var i=this.options,n=this.active,r=e(t.currentTarget),o=r.closest("li"),s=o[0]===n[0],a=s&&i.collapsible,l=a?e():this._getPanelForTab(o),h=n.length?this._getPanelForTab(n):e(),c={oldTab:n,oldPanel:h,newTab:a?e():o,newPanel:l};t.preventDefault(),o.hasClass("ui-state-disabled")||o.hasClass("ui-tabs-loading")||this.running||s&&!i.collapsible||this._trigger("beforeActivate",t,c)===!1||(i.active=a?!1:this.tabs.index(o),this.active=s?e():o,this.xhr&&this.xhr.abort(),h.length||l.length||e.error("jQuery UI Tabs: Mismatching fragment identifier."),l.length&&this.load(this.tabs.index(o),t),this._toggle(t,c))},_toggle:function(t,i){function n(){o.running=!1,o._trigger("activate",t,i)}function r(){i.newTab.closest("li").addClass("ui-tabs-active ui-state-active"),s.length&&o.options.show?o._show(s,o.options.show,n):(s.show(),n())}var o=this,s=i.newPanel,a=i.oldPanel;this.running=!0,a.length&&this.options.hide?this._hide(a,this.options.hide,function(){i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),r()}):(i.oldTab.closest("li").removeClass("ui-tabs-active ui-state-active"),a.hide(),r()),a.attr({"aria-expanded":"false","aria-hidden":"true"}),i.oldTab.attr("aria-selected","false"),s.length&&a.length?i.oldTab.attr("tabIndex",-1):s.length&&this.tabs.filter(function(){return 0===e(this).attr("tabIndex")}).attr("tabIndex",-1),s.attr({"aria-expanded":"true","aria-hidden":"false"}),i.newTab.attr({"aria-selected":"true",tabIndex:0})},_activate:function(t){var i,n=this._findActive(t);n[0]!==this.active[0]&&(n.length||(n=this.active),i=n.find(".ui-tabs-anchor")[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return"string"==typeof e&&(e=this.anchors.index(this.anchors.filter("[href$='"+e+"']"))),e},_destroy:function(){this.xhr&&this.xhr.abort(),this.element.removeClass("ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible"),this.tablist.removeClass("ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all").removeAttr("role"),this.anchors.removeClass("ui-tabs-anchor").removeAttr("role").removeAttr("tabIndex").removeUniqueId(),this.tabs.add(this.panels).each(function(){e.data(this,"ui-tabs-destroy")?e(this).remove():e(this).removeClass("ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel").removeAttr("tabIndex").removeAttr("aria-live").removeAttr("aria-busy").removeAttr("aria-selected").removeAttr("aria-labelledby").removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("role")}),this.tabs.each(function(){var t=e(this),i=t.data("ui-tabs-aria-controls");i?t.attr("aria-controls",i).removeData("ui-tabs-aria-controls"):t.removeAttr("aria-controls")}),this.panels.show(),"content"!==this.options.heightStyle&&this.panels.css("height","")},enable:function(i){var n=this.options.disabled;n!==!1&&(i===t?n=!1:(i=this._getIndex(i),n=e.isArray(n)?e.map(n,function(e){return e!==i?e:null}):e.map(this.tabs,function(e,t){return t!==i?t:null})),this._setupDisabled(n))},disable:function(i){var n=this.options.disabled;if(n!==!0){if(i===t)n=!0;else{if(i=this._getIndex(i),-1!==e.inArray(i,n))return;n=e.isArray(n)?e.merge([i],n).sort():[i]}this._setupDisabled(n)}},load:function(t,i){t=this._getIndex(t);var r=this,o=this.tabs.eq(t),s=o.find(".ui-tabs-anchor"),a=this._getPanelForTab(o),l={tab:o,panel:a};n(s[0])||(this.xhr=e.ajax(this._ajaxSettings(s,i,l)),this.xhr&&"canceled"!==this.xhr.statusText&&(o.addClass("ui-tabs-loading"),a.attr("aria-busy","true"),this.xhr.success(function(e){setTimeout(function(){a.html(e),r._trigger("load",i,l)},1)}).complete(function(e,t){setTimeout(function(){"abort"===t&&r.panels.stop(!1,!0),o.removeClass("ui-tabs-loading"),a.removeAttr("aria-busy"),e===r.xhr&&delete r.xhr},1)})))},_ajaxSettings:function(t,i,n){var r=this;return{url:t.attr("href"),beforeSend:function(t,o){return r._trigger("beforeLoad",i,e.extend({jqXHR:t,ajaxSettings:o},n))}}},_getPanelForTab:function(t){var i=e(t).attr("aria-controls");return this.element.find(this._sanitizeSelector("#"+i))}})}(jQuery),function(e){function t(t,i){var n=(t.attr("aria-describedby")||"").split(/\s+/);n.push(i),t.data("ui-tooltip-id",i).attr("aria-describedby",e.trim(n.join(" ")))}function i(t){var i=t.data("ui-tooltip-id"),n=(t.attr("aria-describedby")||"").split(/\s+/),r=e.inArray(i,n);-1!==r&&n.splice(r,1),t.removeData("ui-tooltip-id"),n=e.trim(n.join(" ")),n?t.attr("aria-describedby",n):t.removeAttr("aria-describedby")}var n=0;e.widget("ui.tooltip",{version:"1.10.3",options:{content:function(){var t=e(this).attr("title")||"";return e("<a>").text(t).html()},hide:!0,items:"[title]:not([disabled])",position:{my:"left top+15",at:"left bottom",collision:"flipfit flip"},show:!0,tooltipClass:null,track:!1,close:null,open:null},_create:function(){this._on({mouseover:"open",focusin:"open"}),this.tooltips={},this.parents={},this.options.disabled&&this._disable()},_setOption:function(t,i){var n=this;return"disabled"===t?(this[i?"_disable":"_enable"](),this.options[t]=i,void 0):(this._super(t,i),"content"===t&&e.each(this.tooltips,function(e,t){n._updateContent(t)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur");r.target=r.currentTarget=n[0],t.close(r,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is("[title]")&&t.data("ui-tooltip-title",t.attr("title")).attr("title","")})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data("ui-tooltip-title")&&t.attr("title",t.data("ui-tooltip-title"))})},open:function(t){var i=this,n=e(t?t.target:this.element).closest(this.options.items);n.length&&!n.data("ui-tooltip-id")&&(n.attr("title")&&n.data("ui-tooltip-title",n.attr("title")),n.data("ui-tooltip-open",!0),t&&"mouseover"===t.type&&n.parents().each(function(){var t,n=e(this);n.data("ui-tooltip-open")&&(t=e.Event("blur"),t.target=t.currentTarget=this,i.close(t,!0)),n.attr("title")&&(n.uniqueId(),i.parents[this.id]={element:this,title:n.attr("title")},n.attr("title",""))}),this._updateContent(n,t))},_updateContent:function(e,t){var i,n=this.options.content,r=this,o=t?t.type:null;return"string"==typeof n?this._open(t,e,n):(i=n.call(e[0],function(i){e.data("ui-tooltip-open")&&r._delay(function(){t&&(t.type=o),this._open(t,e,i)})}),i&&this._open(t,e,i),void 0)},_open:function(i,n,r){function o(e){h.of=e,s.is(":hidden")||s.position(h)}var s,a,l,h=e.extend({},this.options.position);if(r){if(s=this._find(n),s.length)return s.find(".ui-tooltip-content").html(r),void 0;n.is("[title]")&&(i&&"mouseover"===i.type?n.attr("title",""):n.removeAttr("title")),s=this._tooltip(n),t(n,s.attr("id")),s.find(".ui-tooltip-content").html(r),this.options.track&&i&&/^mouse/.test(i.type)?(this._on(this.document,{mousemove:o}),o(i)):s.position(e.extend({of:n},this.options.position)),s.hide(),this._show(s,this.options.show),this.options.show&&this.options.show.delay&&(l=this.delayedShow=setInterval(function(){s.is(":visible")&&(o(h.of),clearInterval(l))},e.fx.interval)),this._trigger("open",i,{tooltip:s}),a={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var i=e.Event(t);i.currentTarget=n[0],this.close(i,!0)}},remove:function(){this._removeTooltip(s)}},i&&"mouseover"!==i.type||(a.mouseleave="close"),i&&"focusin"!==i.type||(a.focusout="close"),this._on(!0,n,a)}},close:function(t){var n=this,r=e(t?t.currentTarget:this.element),o=this._find(r);this.closing||(clearInterval(this.delayedShow),r.data("ui-tooltip-title")&&r.attr("title",r.data("ui-tooltip-title")),i(r),o.stop(!0),this._hide(o,this.options.hide,function(){n._removeTooltip(e(this))}),r.removeData("ui-tooltip-open"),this._off(r,"mouseleave focusout keyup"),r[0]!==this.element[0]&&this._off(r,"remove"),this._off(this.document,"mousemove"),t&&"mouseleave"===t.type&&e.each(this.parents,function(t,i){e(i.element).attr("title",i.title),delete n.parents[t]}),this.closing=!0,this._trigger("close",t,{tooltip:o}),this.closing=!1)},_tooltip:function(t){var i="ui-tooltip-"+n++,r=e("<div>").attr({id:i,role:"tooltip"}).addClass("ui-tooltip ui-widget ui-corner-all ui-widget-content "+(this.options.tooltipClass||""));return e("<div>").addClass("ui-tooltip-content").appendTo(r),r.appendTo(this.document[0].body),this.tooltips[i]=t,r},_find:function(t){var i=t.data("ui-tooltip-id");return i?e("#"+i):e()},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr("id")]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,n){var r=e.Event("blur");r.target=r.currentTarget=n[0],t.close(r,!0),e("#"+i).remove(),n.data("ui-tooltip-title")&&(n.attr("title",n.data("ui-tooltip-title")),n.removeData("ui-tooltip-title"))})}})}(jQuery),define("jquery.ui",["jquery"],function(e){return function(){var t;return t||e.jquery}}(this)),function(){var e,t,i,n,r,o,s,a,l,h,c,u=Object.prototype.hasOwnProperty,d=function(e,t){function i(){this.constructor=e}for(var n in t)u.call(t,n)&&(e[n]=t[n]);return i.prototype=t.prototype,e.prototype=new i,e.__super__=t.prototype,e};this.Tree={},e=this.jQuery,h=function(e,t){var i,n,r;if(e.indexOf)return e.indexOf(t);for(i=0,r=e.length;r>i;i++)if(n=e[i],n===t)return i;return-1},this.Tree.indexOf=h,o={},o.escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,o.meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},o.quote=function(e){return o.escapable.lastIndex=0,o.escapable.test(e)?'"'+e.replace(o.escapable,function(e){var t;return t=o.meta[e],type("string"===t)?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'},o.str=function(e,t){var i,n,r,s,a,l;switch(a=t[e],a&&"object"==typeof a&&"function"===a.toJSON&&(a=a.toJSON(e)),typeof a){case"string":return o.quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(r=[],"[object Array]"===Object.prototype.toString.apply(a)){for(i=0,l=a.length;l>i;i++)s=a[i],r[i]=o.str(i,a)||"null";return 0===r.length?"[]":"["+r.join(",")+"]"}for(n in a)Object.prototype.hasOwnProperty.call(a,n)&&(s=o.str(n,a),s&&r.push(o.quote(n)+":"+s));return 0===r.length?"{}":"{"+r.join(",")+"}"}},c=function(e){return o.str("",{"":e})},this.Tree.toJson=c,l={getName:function(e){return e===l.BEFORE?"before":e===l.AFTER?"after":e===l.INSIDE?"inside":"none"}},l.BEFORE=1,l.AFTER=2,l.INSIDE=3,l.NONE=4,this.Tree.Position=l,s=function(){function t(e){this.init(e)}return t.prototype.init=function(e){return this.name=e,this.children=[],this.parent=null},t.prototype.initFromData=function(i){var n,r,o=this;return r=function(t){return e.each(t,function(e,t){return"children"===e?n(t):"label"===e?o.name=t:o[e]=t,!0})},n=function(e){var i,n,r,s,a;for(a=[],r=0,s=e.length;s>r;r++)i=e[r],n=new t,n.initFromData(i),a.push(o.addChild(n));return a},r(i)},t.prototype.loadFromData=function(i){var n,r,o,s,a;for(this.children=[],a=[],o=0,s=i.length;s>o;o++)r=i[o],n=new t(r.label),e.each(r,function(e,t){return"label"!==e&&(n[e]=t),!0}),this.addChild(n),r.children?a.push(n.loadFromData(r.children)):a.push(void 0);return a},t.prototype.addChild=function(e){return this.children.push(e),e.parent=this},t.prototype.addChildAtPosition=function(e,t){return this.children.splice(t,0,e),e.parent=this},t.prototype.removeChild=function(e){return this.children.splice(this.getChildIndex(e),1)},t.prototype.getChildIndex=function(t){return e.inArray(t,this.children)},t.prototype.hasChildren=function(){return 0!==this.children.length},t.prototype.iterate=function(e){var t,i=this;return t=function(t){var n,r,o,s,a,l;for(a=i.children,l=[],o=0,s=a.length;s>o;o++)n=a[o],r=e(n,t),i.hasChildren()&&r?l.push(n.iterate(e,t+1)):l.push(void 0);return l},t(0)},t.prototype.moveNode=function(e,t,i){return e.parent.removeChild(e),i===l.AFTER?t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)+1):i===l.BEFORE?t.parent.addChildAtPosition(e,t.parent.getChildIndex(t)):i===l.INSIDE?t.addChildAtPosition(e,0):void 0},t.prototype.getData=function(){var e;return e=function(t){var i,n,r,o,s,a,l;for(i=[],a=0,l=t.length;l>a;a++){r=t[a],o={};for(n in r)s=r[n],"parent"!==n&&"children"!==n&&"element"!==n&&Object.prototype.hasOwnProperty.call(r,n)&&(o[n]=s);r.hasChildren()&&(o.children=e(r.children)),i.push(o)}return i},e(this.children)},t}(),this.Tree.Tree=s,e.widget("ui.tree",e.ui.mouse,{widgetEventPrefix:"tree",options:{autoOpen:!1,saveState:!1,dragAndDrop:!1,selectable:!1,onCanSelectNode:null,onSetStateFromStorage:null,onGetStateFromStorage:null,onCreateLi:null,onIsMoveHandle:null,onCanMove:null,onCanMoveTo:null},_create:function(){var t;return this.tree=new s,this.tree.loadFromData(this.options.data),this.selected_node=null,this._openNodes(),this._createDomElements(this.tree),this.selected_node&&(t=this._getNodeElementForNode(this.selected_node),t&&t.select()),this.element.click(e.proxy(this._click,this)),this.element.bind("contextmenu",e.proxy(this._contextmenu,this)),this._mouseInit(),this.hovered_area=null,this.$ghost=null,this.hit_areas=[]},destroy:function(){return this.element.empty(),this.element.unbind(),this.tree=null,this._mouseDestroy(),e.Widget.prototype.destroy.call(this)},getTree:function(){return this.tree},toJson:function(){return c(this.tree.getData())},addNode:function(e){var t;return t=new s,t.initFromData(e),this.getTree().addChild(t),this.element.empty(),this._createDomElements(this.getTree())},toggle:function(e,t){return e.hasChildren()&&new n(e).toggle(t),this.options.saveState?this._saveState():void 0},selectNode:function(e){return this.options.selectable&&(this.selected_node&&this._getNodeElementForNode(this.selected_node).deselect(),this._getNodeElementForNode(e).select(),this.selected_node=e,this.options.saveState)?this._saveState():void 0},getSelectedNode:function(){return this.selected_node||!1},_getState:function(){var e,t;return e=[],this.tree.iterate(function(t){return t.is_open&&t.id&&t.hasChildren()&&e.push(t.id),!0}),t="",this.selected_node&&(t=this.selected_node.id),c({open_nodes:e,selected_node:t})},_setState:function(t){var i,n,r,o=this;return i=e.parseJSON(t),n=i.open_nodes,r=i.selected_node,this.tree.iterate(function(e){return e.id&&e.hasChildren()&&h(n,e.id)>=0&&(e.is_open=!0),r&&e.id===r&&(o.selected_node=e),!0})},_saveState:function(){return this.options.onSetStateFromStorage?this.options.onSetStateFromStorage(this._getState()):e.cookie?e.cookie(this._getCookieName(),this._getState(),{path:"/"}):void 0},_restoreState:function(){var t;return t=this.options.onGetStateFromStorage?this.options.onGetStateFromStorage():e.cookie?e.cookie(this._getCookieName(),{path:"/"}):null,t?(this._setState(t),!0):!1},_getCookieName:function(){return"string"==typeof this.options.saveState?this.options.saveState:"tree"},_createDomElements:function(t){var i,n,r,o,s,a=this;return o=function(t){var i;return i=t?"":' class="tree"',e("<ul"+i+"></ul>")},n=function(e){var t;return t=e.hasChildren()?i(e):r(e),a.options.onCreateLi&&a.options.onCreateLi(e,t),t},r=function(t){return e('<li><div><span class="title">'+t.name+"</span></div></li>")},i=function(t){var i,n,r,o;return r=function(){var e;return e=["toggler"],t.is_open||e.push("closed"),e.join(" ")},o=function(){var e;return e=["folder"],t.is_open||e.push("closed"),e.join(" ")},i=r(),n=o(),e('<li class="'+n+'"><div><a class="'+i+'">&raquo;</a><span class="title">'+t.name+"</span></div></li>")},s=function(e,t,i,r){var a,l,h,c,u,d;for(l=o(i,r),e.append(l),d=[],c=0,u=t.length;u>c;c++)h=t[c],a=n(h),l.append(a),h.element=a[0],a.data("node",h),h.hasChildren()?d.push(s(a,h.children,i+1,h.is_open)):d.push(void 0);return d},s(this.element,t.children,0,!0)},_click:function(t){var i,n,r,o;if(!t.ctrlKey)if(i=e(t.target),i.is(".toggler")){if(o=this._getNodeElement(i),o&&o.node.hasChildren())return o.toggle(),this.options.saveState&&this._saveState(),t.preventDefault(),t.stopPropagation()}else if((i.is("div")||i.is("span"))&&(r=this._getNode(i),r&&(!this.options.onCanSelectNode||this.options.onCanSelectNode(r))))return this.selectNode(r),n=jQuery.Event("tree.click"),n.node=r,this.element.trigger(n)},_contextmenu:function(t){var i,n,r;return i=e(t.target).closest("ul.tree div"),i.length&&(r=this._getNode(i))?(t.preventDefault(),t.stopPropagation(),n=jQuery.Event("tree.contextmenu"),n.node=r,n.click_event=t,this.element.trigger(n),!1):void 0},_getNode:function(e){var t;return t=e.closest("li"),0===t.length?null:t.data("node")},_getNodeElement:function(e){var t;return t=this._getNode(e),t?this._getNodeElementForNode(t):null},_getNodeElementForNode:function(e){return e.hasChildren()?new n(e):new a(e)},_mouseCapture:function(t){var i,n;if(this.options.dragAndDrop)return i=e(t.target),this.options.onIsMoveHandle&&!this.options.onIsMoveHandle(i)?null:(n=this._getNodeElement(e(t.target)),n&&this.options.onCanMove&&(this.options.onCanMove(n.node)||(n=null)),this.current_item=n,null!==this.current_item)},_mouseStart:function(e){var t,n,r;if(this.options.dragAndDrop)return this._refreshHitAreas(),r=this._getOffsetFromEvent(e),t=r[0],n=r[1],this.drag_element=new i(this.current_item.node,t,n,this.element),this.current_item.$element.addClass("moving"),!0},_getOffsetFromEvent:function(t){var i;return i=e(t.target).offset(),[t.pageX-i.left,t.pageY-i.top]},_mouseDrag:function(e){var t,i;if(this.options.dragAndDrop)return this.drag_element.move(e.pageX,e.pageY),t=this.findHoveredArea(e.pageX,e.pageY),t&&this.options.onCanMoveTo&&(i=l.getName(t.position),this.options.onCanMoveTo(this.current_item.node,t.node,i)||(t=null)),t?this.hovered_area!==t&&(this.hovered_area=t,this._updateDropHint()):(this._removeDropHint(),this._removeHover(),this._stopOpenFolderTimer()),!0},_updateDropHint:function(){var e,t;return this._stopOpenFolderTimer(),this.hovered_area?(e=this.hovered_area.node,e.hasChildren()&&!e.is_open&&this.hovered_area.position===l.INSIDE&&this._startOpenFolderTimer(e),this._removeDropHint(),t=this._getNodeElementForNode(this.hovered_area.node),this.previous_ghost=t.addDropHint(this.hovered_area.position)):void 0
},_mouseStop:function(){return this.options.dragAndDrop?(this._moveItem(),this._clear(),this._removeHover(),this._removeDropHint(),this._removeHitAreas(),this.current_item.$element.removeClass("moving"),!1):void 0},_mouseMove:function(t){return e.browser.msie&&8===document.documentMode&&!t.button&&(t.button=1),e.ui.mouse.prototype._mouseMove.call(this,t)},_moveItem:function(){var e;return this.hovered_area&&this.hovered_area.position!==l.NONE?(this.tree.moveNode(this.current_item.node,this.hovered_area.node,this.hovered_area.position),this.hovered_area.position===l.INSIDE&&(this.hovered_area.node.is_open=!0),e=jQuery.Event("tree.move"),e.move_info={moved_node:this.current_item.node,target_node:this.hovered_area.node,position:l.getName(this.hovered_area.position)},this.element.trigger(e),this.element.empty(),this._createDomElements(this.tree)):void 0},_clear:function(){return this.drag_element.remove(),this.drag_element=null},_refreshHitAreas:function(){return this._removeHitAreas(),this._generateHitAreas()},_generateHitAreas:function(){var t,i,n,r,o,s,a,h,c,u,d,p=this;return d=[],u=0,i=function(e){return e.offset().top},t=function(e,t,i){return d.push({top:i,node:e,position:t}),u=i},n=function(e){var t,i,n,r,o;for(n=-1,t=[],r=0,o=d.length;o>r;r++)i=d[r],i.top!==n&&(t.length&&e(t,n,i.top),n=i.top,t=[]),t.push(i);return e(t,n,p.element.offset().top+p.element.height())},a=function(e,n,r){var o;return o=i(r),e===p.current_item.node?t(e,l.NONE,o):t(e,l.INSIDE,o),n===p.current_item.node||e===p.current_item.node?t(e,l.NONE,o):t(e,l.AFTER,o)},h=function(e,n){return e===p.current_item.node?!1:(e.children[0]!==p.current_item.node&&t(e,l.INSIDE,i(n)),!0)},r=function(e,i){return e===p.current_item.node||i===p.current_item.node?t(e,l.NONE,u):t(e,l.AFTER,u)},o=function(e,n,r){var o;return o=i(r),e===p.current_item.node?t(e,l.NONE,o):(t(e,l.INSIDE,o),n!==p.current_item.node?t(e,l.AFTER,o):void 0)},s=function(n){return n!==p.current_item.node?t(n,l.BEFORE,i(e(n.element))):void 0},this._iterateVisibleNodes(a,h,o,r,s),c=[],n(function(e,t,i){var n,r,o,s,a,l;for(n=(i-t)/e.length,r=t,l=[],s=0,a=e.length;a>s;s++)o=e[s],c.push({top:r,bottom:r+n,node:o.node,position:o.position}),l.push(r+=n);return l}),this.hit_areas=c},findHoveredArea:function(e,t){var i,n,r,o,s;if(s=this.element.offset(),e<s.left||t<s.top||e>s.left+this.element.width()||t>s.top+this.element.height())return null;for(r=0,n=this.hit_areas.length;n>r;)if(o=r+n>>1,i=this.hit_areas[o],t<i.top)n=o;else{if(!(t>i.bottom))return i;r=o+1}return null},_iterateVisibleNodes:function(t,i,n,r,o){var s,a;return s=!0,a=function(l,h){var c,u,d,p,f,m,g;if(f=(l.is_open||!l.element)&&l.hasChildren(),l.element){if(c=e(l.element),!c.is(":visible"))return;s&&(o(l,c),s=!1),l.hasChildren()?l.is_open?i(l,c)||(f=!1):n(l,h,c):t(l,h,c)}if(f){for(d=l.children.length,g=l.children,p=0,m=g.length;m>p;p++)u=g[p],p===d-1?a(l.children[p],null):a(l.children[p],l.children[p+1]);if(l.is_open)return r(l,h,c)}},a(this.tree)},_removeHover:function(){return this.hovered_area=null},_removeDropHint:function(){return this.previous_ghost?this.previous_ghost.remove():void 0},_removeHitAreas:function(){return this.hit_areas=[]},_openNodes:function(){var e;if(!(this.options.saveState&&this._restoreState()||this.options.autoOpen===!1))return e=this.options.autoOpen===!0?-1:parseInt(this.options.autoOpen),this.tree.iterate(function(t,i){return t.is_open=!0,i!==e})},_startOpenFolderTimer:function(e){var t,i=this;return t=function(){return i._getNodeElementForNode(e).open(function(){return i._refreshHitAreas(),i._updateDropHint()})},this.open_folder_timer=setTimeout(t,500)},_stopOpenFolderTimer:function(){return this.open_folder_timer?(clearTimeout(this.open_folder_timer),this.open_folder_timer=null):void 0}}),r=function(){function t(t,i,n){this.$element=i,this.node=t,this.$ghost=e('<li class="ghost"><span class="circle"></span><span class="line"></span></li>'),n===l.AFTER?this.moveAfter():n===l.BEFORE?this.moveBefore():n===l.INSIDE&&(t.hasChildren()&&t.is_open?this.moveInsideOpenFolder():this.moveInside())}return t.prototype.remove=function(){return this.$ghost.remove()},t.prototype.moveAfter=function(){return this.$element.after(this.$ghost)},t.prototype.moveBefore=function(){return this.$element.before(this.$ghost)},t.prototype.moveInsideOpenFolder=function(){return e(this.node.children[0].element).before(this.$ghost)},t.prototype.moveInside=function(){return this.$element.after(this.$ghost),this.$ghost.addClass("inside")},t}(),t=function(){function t(t){var i,n;i=t.children("div"),n=t.width()-4,this.$hint=e('<span class="border"></span>'),i.append(this.$hint),this.$hint.css({width:n,height:i.height()-4})}return t.prototype.remove=function(){return this.$hint.remove()},t}(),a=function(){function i(e){this.init(e)}return i.prototype.init=function(t){return this.node=t,this.$element=e(t.element)},i.prototype.getUl=function(){return this.$element.children("ul:first")},i.prototype.getSpan=function(){return this.$element.children("div").find("span.title")},i.prototype.getLi=function(){return this.$element},i.prototype.addDropHint=function(e){return e===l.INSIDE?new t(this.$element):new r(this.node,this.$element,e)},i.prototype.select=function(){return this.getLi().addClass("selected")},i.prototype.deselect=function(){return this.getLi().removeClass("selected")},i}(),n=function(i){function n(){n.__super__.constructor.apply(this,arguments)}return d(n,i),n.prototype.toggle=function(e){return this.node.is_open?this.close(e):this.open(e)},n.prototype.open=function(t){return this.node.is_open=!0,this.getButton().removeClass("closed"),this.getUl().slideDown("fast",e.proxy(function(){return this.getLi().removeClass("closed"),t?t():void 0},this))},n.prototype.close=function(t){return this.node.is_open=!1,this.getButton().addClass("closed"),this.getUl().slideUp("fast",e.proxy(function(){return this.getLi().addClass("closed"),t?t():void 0},this))},n.prototype.getButton=function(){return this.$element.children("div").find("a.toggler")},n.prototype.addDropHint=function(e){return this.node.is_open||e!==l.INSIDE?new r(this.node,this.$element,e):new t(this.$element)},n}(a),i=function(){function t(t,i,n,r){this.offset_x=i,this.offset_y=n,this.$element=e('<span class="title tree-dragging">'+t.name+"</span>"),this.$element.css("position","absolute"),r.append(this.$element)}return t.prototype.move=function(e,t){return this.$element.offset({left:e-this.offset_x,top:t-this.offset_y})},t.prototype.remove=function(){return this.$element.remove()},t}(),this.Tree.Node=s}.call(this),define("treeJquery",["jquery.ui"],function(e){return function(){var t;return t||e.jquery}}(this)),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/TreeView",["require","Underscore","Backbone","treeJquery"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("treeJquery"),r=function(t){function n(){return this.render=e(this.render,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.timeoutId=!1},n.prototype.render=function(e){var t,i,n,r,o,s,a,l;if(this.$el.data("tree")&&this.$el.tree("destroy"),e===!1)return this.$el.html(""),this;for(t=[],o={},l=e.models,s=0,a=l.length;a>s;s++)n=l[s],n.hasOutConnection()===!1&&(o[n.attributes.nid]=n);r=function(e){var t,i,n,o,s;for(t={},t.label=e.get("name"),t.model=e,t.children=[],n=e.getUpstreamNodes(),o=0,s=n.length;s>o;o++)i=n[o],t.children.push(r(i));return t};for(i in o)t.push(r(o[i]));return this.$el.tree({data:t,autoOpen:!0,selectable:!0}),this.$el.bind("tree.click",function(e){var t;return n=e.node.model,$(".node").removeClass("ui-selected"),n.trigger("node:addSelectedClass"),t=$("#container").data("selectable"),t.refresh(),t._mouseStop(null)}),this},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/sidebar/Sidebar",["require","Underscore","Backbone","cs!threenodes/views/sidebar/NodeSidebarView","cs!threenodes/views/TreeView","jquery.ui"],function(t){var n,r,o,s,a,l;return a=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/views/sidebar/NodeSidebarView"),s=t("cs!threenodes/views/TreeView"),t("jquery.ui"),o=function(t){function n(){return this.initNewNode=e(this.initNewNode,this),this.initSearch=e(this.initSearch,this),this.filterList=e(this.filterList,this),this.filterListItem=e(this.filterListItem,this),this.renderNodesAttributes=e(this.renderNodesAttributes,this),this.clearNodesAttributes=e(this.clearNodesAttributes,this),this.initTabs=e(this.initTabs,this),this.clearWorkspace=e(this.clearWorkspace,this),this.render=e(this.render,this),this.initTreeView=e(this.initTreeView,this),l=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.node_views=[],this.initNewNode(),this.initSearch(),this.initTabs(),this.initTreeView(),this.layout=this.$el.layout({scrollToBookmarkOnLoad:!1,north:{closable:!1,resizable:!1,slidable:!1,resizerClass:"ui-layout-resizer-hidden",spacing_open:0,spacing_closed:0},center:{size:"100%"}})},n.prototype.initTreeView=function(){return this.treeview=new s({el:$("#tab-list")}),this},n.prototype.render=function(e){return this.treeview?this.treeview.render(e):void 0},n.prototype.clearWorkspace=function(){return this.treeview.render(!1)},n.prototype.initTabs=function(){return this.$el.tabs({fx:{opacity:"toggle",duration:100}}),this},n.prototype.clearNodesAttributes=function(){var e,t,i=this;return t=function(){return i.node_views.length>0?(a.each(i.node_views,function(e){return e.remove()}),i.node_views=[]):void 0},t(),e=$("#tab-attribute"),e.html(""),this},n.prototype.renderNodesAttributes=function(e){var t,i,n,o,s,a;if(t=$("#tab-attribute"),!e||e.length<1)return this;for(s=0,a=e.length;a>s;s++)i=e[s],"Group"!==i.get("type")?(o=new r({model:i}),t.append(o.el),this.node_views.push(o)):(t.append("<h3>"+i.get("name")+"</h3>"),n=i.nodes.models,this.renderNodesAttributes(n));return this},n.prototype.filterListItem=function(e,t){var i;return i=$.trim($("a",e).html()).toLowerCase(),-1===i.indexOf(t)?e.hide():e.show()},n.prototype.filterList=function(e,t){var i,n,r;return n=this,r=e.prev(),i=!1,$("li",e).each(function(){return n.filterListItem($(this),t)}),0===$("li:visible",e).length?r.hide():r.show(),this},n.prototype.initSearch=function(){var e;return e=this,$("#node_filter").keyup(function(){var t;return t=$.trim($("#node_filter").val()).toLowerCase(),""===t?$("#tab-new li, #tab-new h3").show():$("#tab-new ul").each(function(){return e.filterList($(this),t)})}),this},n.prototype.initNewNode=function(){var e,t,i,n,r,o,s,a,l,h;s=this,e=$("#tab-new"),o=[],r={Base:[],Conditional:[],Math:[],Code:[],Utils:[],Three:[],Geometry:[],Materials:[],Lights:[],PostProcessing:[],Spread:[],Particle:[],"Particle-sparks":[],"Particle-sparks-initializers":[],"Particle-sparks-actions":[],"Particle-sparks-zone":[],"Constructive-Geometry":[]};for(n in ThreeNodes.nodes.models)ThreeNodes.nodes.models[n].group_name&&(i=ThreeNodes.nodes.models[n].group_name.replace(/\./g,"-"),r[i]||(r[i]=[]),r[i].push(n));for(t in r)for(e.append("<h3>"+t+"</h3><ul id='nodetype-"+t+"'></ul>"),h=r[t],a=0,l=h.length;l>a;a++)n=h[a],$("#nodetype-"+t,e).append("<li><a class='button' rel='"+n+"' href='#'>"+ThreeNodes.nodes.models[n].node_name+"</a></li>");return $("a.button",e).draggable({revert:"valid",opacity:.7,helper:"clone",revertDuration:0,scroll:!1,containment:"document"}),this},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/Breadcrumb",["require","Underscore","Backbone"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),r=function(t){function n(){return this.onClick=e(this.onClick,this),this.set=e(this.set,this),this.reset=e(this.reset,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.$el.click(this.onClick)},n.prototype.reset=function(){return this.items=[],this.$el.html("")},n.prototype.set=function(e){var t,i,n,r,o,s;for(this.items=e,this.$el.html("<a href='#' data-gid='global'>Global</a>"),s=[],r=0,o=e.length;o>r;r++)i=e[r],n=i.get("name"),t=i.get("gid"),s.push(this.$el.append("  "+("<a href='#' class='grp' data-gid='"+t+"'>"+n+"</a>")));return s},n.prototype.onClick=function(e){var t;return t=$(e.target).data("gid"),"global"===t?this.trigger("click","global"):void 0},n}(n.View)})}.call(this),define("text!templates/app_menubar.tmpl.html",[],function(){return'<ul id="main-menu-bar" class="menubar ui-layout-north">\n  <li>\n    <a href="#File">File</a>\n    <ul>\n      <li><a href="#NewFile" data-event="ClearWorkspace">New</a></li>\n      <li><a href="#OpenFile" data-event="OpenFile">Open</a></li>\n      <li><a href="#SaveFile" data-event="SaveFile">Save</a></li>\n      <li><a href="#ExportCode" data-event="ExportCode">Export to code</a></li>\n      <li><a href="#ExportImage" data-event="ExportImage" data-eventData="exported-image.png">Export image</a></li>\n    </ul>\n  </li>\n  <li>\n    <a href="#Edit">Edit</a>\n    <ul>\n      <li><a href="#GroupSelectedNodes" data-event="GroupSelectedNodes">Group selected nodes</a></li>\n      <li><a href="#RemoveSelectedNodes" data-event="RemoveSelectedNodes">Remove selected node(s)</a></li>\n      <li><a href="#RebuildAllShaders" data-event="RebuildAllShaders">Rebuild all shaders</a></li>\n    </ul>\n  </li>\n  <li>\n    <a href="#View">View</a>\n    <ul>\n      <li><a href="#Attributes" data-event="ToggleAttributes">Attributes</a></li>\n      <li><a href="#Library" data-event="ToggleLibrary">Library</a></li>\n      <li><a href="#Timeline" data-event="ToggleTimeline">Timeline</a></li>\n    </ul>\n  </li>\n  <li class="expanded">\n    <a href="#examples">Examples</a>\n    <ul>\n      <li><a href="#example/rotating_cube1.json">Simple cube</a></li>\n      <li><a href="#example/geometry_and_material1.json">Geometry & materials</a></li>\n      <li><a href="#example/postprocessing1.json">Postprocessing</a></li>\n      <li><a href="#example/particle1.json">Particles</a></li>\n      <li><a href="#example/particle2.json">Sparks particle and Mouse</a></li>\n      <li><a href="#example/spreads1.json">Spreads</a></li>\n      <li><a href="#example/texture1.json">Texture</a></li>\n      <li><a href="#example/text1.json">Text</a></li>\n      <li><a href="#example/collada1.json">Collada model</a></li>\n      <li><a href="#example/sound1.json">Sound input</a></li>\n    </ul>\n  </li>\n  <li class="expanded">\n    <a href="#about">About</a>\n    <ul>\n      <li><a href="https://github.com/idflood/ThreeNodes.js" target="_blank">Github page</a></li>\n    </ul>\n  </li>\n</ul>\n'}),function(e){e.widget("ui.menubar",{version:"@VERSION",options:{items:"li",menus:"ul",icons:{dropdown:"ui-icon-triangle-1-s"},position:{my:"left top",at:"left bottom"},select:null},_create:function(){this.menuItems=this.element.children(this.options.items),this.items=this.menuItems.children("button, a"),this.openSubmenus=0,this._initializeWidget(),this._initializeMenuItems(),this._initializeItems()},_initializeWidget:function(){this.element.addClass("ui-menubar ui-widget-header ui-helper-clearfix").attr("role","menubar"),this._on({keydown:function(t){var i;t.keyCode===e.ui.keyCode.ESCAPE&&this.active&&this.active.menu("collapse",t)!==!0&&(i=this.active,this.active.blur(),this._close(t),e(t.target).blur().mouseleave(),i.prev().focus())},focusin:function(){clearTimeout(this.closeTimer)},focusout:function(e){this.closeTimer=this._delay(function(){this._close(e),this.items.attr("tabIndex",-1),this.lastFocused.attr("tabIndex",0)},150)},"mouseenter .ui-menubar-item":function(){clearTimeout(this.closeTimer)}})},_initializeMenuItems:function(){var t,i=this;this.menuItems.addClass("ui-menubar-item").attr("role","presentation").css({"border-width":"1px","border-style":"hidden"}),t=this.menuItems.children(i.options.menus).menu({position:{within:this.options.position.within},select:function(e,t){t.item.parents("ul.ui-menu:last").hide(),i._close(),t.item.parents(".ui-menubar-item").children().first().focus(),i._trigger("select",e,t)},menus:this.options.menus}).hide().attr({"aria-hidden":"true","aria-expanded":"false"}),this._on(t,{keydown:function(t){e(t.target).attr("tabIndex",0);var n,r=e(this);if(!r.is(":hidden"))switch(t.keyCode){case e.ui.keyCode.LEFT:n=i.active.prev(".ui-button"),this.openSubmenus?this.openSubmenus--:this._hasSubMenu(n.parent().prev())?(i.active.blur(),i._open(t,n.parent().prev().find(".ui-menu"))):(n.parent().prev().find(".ui-button").focus(),i._close(t),this.open=!0),t.preventDefault(),e(t.target).attr("tabIndex",-1);break;case e.ui.keyCode.RIGHT:this.next(t),t.preventDefault()}},focusout:function(t){e(t.target).removeClass("ui-state-focus")}}),this.menuItems.each(function(t,n){i._identifyMenuItemsNeighbors(e(n),i,t)})},_hasSubMenu:function(t){return e(t).children(this.options.menus).length>0},_identifyMenuItemsNeighbors:function(t,i,n){var r=this.menuItems.length,o=0===n,s=n===r-1;o?(t.data("prevMenuItem",e(this.menuItems[r-1])),t.data("nextMenuItem",e(this.menuItems[n+1]))):s?(t.data("nextMenuItem",e(this.menuItems[0])),t.data("prevMenuItem",e(this.menuItems[n-1]))):(t.data("nextMenuItem",e(this.menuItems[n+1])),t.data("prevMenuItem",e(this.menuItems[n-1])))},_initializeItems:function(){var t=this;this._focusable(this.items),this._hoverable(this.items),this.items.slice(1).attr("tabIndex",-1),this.items.each(function(i,n){t._initializeItem(e(n),t)})},_initializeItem:function(t){var i=this._hasSubMenu(t.parent());t.addClass("ui-button ui-widget ui-button-text-only ui-menubar-link").attr("role","menuitem").wrapInner("<span class='ui-button-text'></span>"),this._on(t,{focus:function(e){t.attr("tabIndex",0),t.addClass("ui-state-focus"),e.preventDefault()},focusout:function(e){t.attr("tabIndex",-1),this.lastFocused=t,t.removeClass("ui-state-focus"),e.preventDefault()}}),i?(this._on(t,{click:this._mouseBehaviorForMenuItemWithSubmenu,focus:this._mouseBehaviorForMenuItemWithSubmenu,mouseenter:this._mouseBehaviorForMenuItemWithSubmenu}),this._on(t,{keydown:function(t){switch(t.keyCode){case e.ui.keyCode.SPACE:case e.ui.keyCode.UP:case e.ui.keyCode.DOWN:this._open(t,e(t.target).next()),t.preventDefault();break;case e.ui.keyCode.LEFT:this.previous(t),t.preventDefault();break;case e.ui.keyCode.RIGHT:this.next(t),t.preventDefault();break;case e.ui.keyCode.TAB:}}}),t.attr("aria-haspopup","true"),this.options.icons&&(t.append("<span class='ui-button-icon-secondary ui-icon "+this.options.icons.dropdown+"'></span>"),t.removeClass("ui-button-text-only").addClass("ui-button-text-icon-secondary"))):this._on(t,{click:function(){this.active?this._close():(this.open=!0,this.active=e(t).parent())},mouseenter:function(){this.open&&(this.stashedOpenMenu=this.active,this._close())},keydown:function(t){t.keyCode===e.ui.keyCode.LEFT?(this.previous(t),t.preventDefault()):t.keyCode===e.ui.keyCode.RIGHT&&(this.next(t),t.preventDefault())}})},_mouseBehaviorForMenuItemWithSubmenu:function(t){var i,n;if("focus"!==t.type||t.originalEvent){if(t.preventDefault(),n=e(t.target).parents(".ui-menubar-item").children(this.options.menus),i="click"===t.type&&n.is(":visible")&&this.active&&this.active[0]===n[0])return this._close(),void 0;"mouseenter"===t.type&&(this.element.find(":focus").focusout(),this.stashedOpenMenu&&this._open(t,n),this.stashedOpenMenu=void 0),(this.open&&"mouseenter"===t.type||"click"===t.type)&&(clearTimeout(this.closeTimer),this._open(t,n),t.stopPropagation())}},_destroy:function(){this.menuItems.removeClass("ui-menubar-item").removeAttr("role").css({"border-width":"","border-style":""}),this.element.removeClass("ui-menubar ui-widget-header ui-helper-clearfix").removeAttr("role").unbind(".menubar"),this.items.unbind(".menubar").removeClass("ui-button ui-widget ui-button-text-only ui-menubar-link ui-state-default").removeAttr("role").removeAttr("aria-haspopup").children(".ui-icon").remove(),this.items.children("span.ui-button-text").each(function(){var t=e(this);t.parent().html(t.html())}),this.element.find(":ui-menu").menu("destroy").show().removeAttr("aria-hidden").removeAttr("aria-expanded").removeAttr("tabindex").unbind(".menubar")},_collapseActiveMenu:function(){this.active.is(":ui-menu")&&this.active.menu("collapseAll").hide().attr({"aria-hidden":"true","aria-expanded":"false"}).closest(this.options.items).removeClass("ui-state-active")},_close:function(){this.active&&(this._collapseActiveMenu(),this.active=null,this.open=!1,this.openSubmenus=0)},_open:function(t,i){var n=i.closest(".ui-menubar-item");this.active&&this.active.length&&this._hasSubMenu(this.active.closest(this.options.items))&&this._collapseActiveMenu(),n.addClass("ui-state-active"),this.lastFocused||(this.lastFocused=i.prev()),this.active=i.show().position(e.extend({of:n},this.options.position)).removeAttr("aria-hidden").attr("aria-expanded","true").menu("focus",t,i.children(".ui-menu-item").first()).focus(),this.open=!0},next:function(e){function t(){return this.active&&this._hasSubMenu(this.active.closest(this.options.items))&&this.active.data("uiMenu")&&this.active.data("uiMenu").active&&this.active.data("uiMenu").active.has(".ui-menu").length}return this.open&&t.call(this)?(this.openSubmenus++,void 0):(this.openSubmenus=0,this._move("next",e),void 0)},previous:function(e){return this.open&&this.openSubmenus?(this.openSubmenus--,void 0):(this.openSubmenus=0,this._move("prev",e),void 0)},_move:function(t,i){var n=e(i.target).closest(".ui-menubar-item"),r=n.data(t+"MenuItem"),o=r.find(".ui-button");this.open?this._hasSubMenu(r)?this._open(i,r.children(".ui-menu")):(this._collapseActiveMenu(),r.find(".ui-button").focus(),this.open=!0):(n.find(".ui-button"),o.focus())}})}(jQuery),define("jquery.menubar",["jquery.ui"],function(e){return function(){var t;return t||e.jquery}}(this)),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/MenuBar",["require","Underscore","Backbone","text!templates/app_menubar.tmpl.html","jquery.menubar"],function(t){var n,r,o,s,a;return o=t("Underscore"),n=t("Backbone"),a=t("text!templates/app_menubar.tmpl.html"),t("jquery.menubar"),r=function(t){function r(){return this.onLinkClick=e(this.onLinkClick,this),s=r.__super__.constructor.apply(this,arguments)}return i(r,t),r.template=a,r.prototype.initialize=function(){var e,t=this;return this.$el.menubar(),e=this,$("a",this.$el).click(function(t){var i;return $(this).next().is("ul")?!1:(i=$(this).attr("href").substr(1),e.onLinkClick(t,this,i))}),$("#main_file_input_open").change(function(e){return t.trigger("LoadFile",e)})},r.prototype.onLinkClick=function(e,t){var i,r;if(r=$(t).data("event"),i=$(t).data("eventData"),r){switch(this.trigger(r,i),r){case"ClearWorkspace":n.history.navigate("",!1);break;case"OpenFile":$("#main_file_input_open").click()}return!0}return!0},r}(n.View)})}.call(this),window.requestAnimationFrame||(window.requestAnimationFrame=function(){return window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}()),define("RequestAnimationFrame",function(e){return function(){var t;return t||e.requestAnimationFrame}}(this)),!function(e){var t,i,n="0.4.2",r="hasOwnProperty",o=/[\.\/]/,s="*",a=function(){},l=function(e,t){return e-t},h={n:{}},c=function(e,n){e=String(e);var r,o=i,s=Array.prototype.slice.call(arguments,2),a=c.listeners(e),h=0,u=[],d={},p=[],f=t;t=e,i=0;for(var m=0,g=a.length;g>m;m++)"zIndex"in a[m]&&(u.push(a[m].zIndex),a[m].zIndex<0&&(d[a[m].zIndex]=a[m]));for(u.sort(l);u[h]<0;)if(r=d[u[h++]],p.push(r.apply(n,s)),i)return i=o,p;for(m=0;g>m;m++)if(r=a[m],"zIndex"in r)if(r.zIndex==u[h]){if(p.push(r.apply(n,s)),i)break;do if(h++,r=d[u[h]],r&&p.push(r.apply(n,s)),i)break;while(r)}else d[r.zIndex]=r;else if(p.push(r.apply(n,s)),i)break;return i=o,t=f,p.length?p:null};c._events=h,c.listeners=function(e){var t,i,n,r,a,l,c,u,d=e.split(o),p=h,f=[p],m=[];for(r=0,a=d.length;a>r;r++){for(u=[],l=0,c=f.length;c>l;l++)for(p=f[l].n,i=[p[d[r]],p[s]],n=2;n--;)t=i[n],t&&(u.push(t),m=m.concat(t.f||[]));f=u}return m},c.on=function(e,t){if(e=String(e),"function"!=typeof t)return function(){};for(var i=e.split(o),n=h,r=0,s=i.length;s>r;r++)n=n.n,n=n.hasOwnProperty(i[r])&&n[i[r]]||(n[i[r]]={n:{}});for(n.f=n.f||[],r=0,s=n.f.length;s>r;r++)if(n.f[r]==t)return a;return n.f.push(t),function(e){+e==+e&&(t.zIndex=+e)}},c.f=function(e){var t=[].slice.call(arguments,1);return function(){c.apply(null,[e,null].concat(t).concat([].slice.call(arguments,0)))}},c.stop=function(){i=1},c.nt=function(e){return e?new RegExp("(?:\\.|\\/|^)"+e+"(?:\\.|\\/|$)").test(t):t},c.nts=function(){return t.split(o)},c.off=c.unbind=function(e,t){if(!e)return c._events=h={n:{}},void 0;var i,n,a,l,u,d,p,f=e.split(o),m=[h];for(l=0,u=f.length;u>l;l++)for(d=0;d<m.length;d+=a.length-2){if(a=[d,1],i=m[d].n,f[l]!=s)i[f[l]]&&a.push(i[f[l]]);else for(n in i)i[r](n)&&a.push(i[n]);m.splice.apply(m,a)}for(l=0,u=m.length;u>l;l++)for(i=m[l];i.n;){if(t){if(i.f){for(d=0,p=i.f.length;p>d;d++)if(i.f[d]==t){i.f.splice(d,1);break}!i.f.length&&delete i.f}for(n in i.n)if(i.n[r](n)&&i.n[n].f){var g=i.n[n].f;for(d=0,p=g.length;p>d;d++)if(g[d]==t){g.splice(d,1);break}!g.length&&delete i.n[n].f}}else{delete i.f;for(n in i.n)i.n[r](n)&&i.n[n].f&&delete i.n[n].f}i=i.n}},c.once=function(e,t){var i=function(){return c.unbind(e,i),t.apply(this,arguments)};return c.on(e,i)},c.version=n,c.toString=function(){return"You are running Eve "+n},"undefined"!=typeof module&&module.exports?module.exports=c:"undefined"!=typeof define?define("eve",[],function(){return c}):e.eve=c}(this),function(e,t){"function"==typeof define&&define.amd?define("Raphael",["eve"],function(i){return t(e,i)}):t(e,e.eve)}(this,function(e,t){function i(e){if(i.is(e,"function"))return b?e():t.on("raphael.DOMload",e);if(i.is(e,q))return i._engine.create[M](i,e.splice(0,3+i.is(e[0],$))).add(e);var n=Array.prototype.slice.call(arguments,0);if(i.is(n[n.length-1],"function")){var r=n.pop();return b?r.call(i._engine.create[M](i,n)):t.on("raphael.DOMload",function(){r.call(i._engine.create[M](i,n))})}return i._engine.create[M](i,arguments)}function n(e){if("function"==typeof e||Object(e)!==e)return e;var t=new e.constructor;for(var i in e)e[R](i)&&(t[i]=n(e[i]));return t}function r(e,t){for(var i=0,n=e.length;n>i;i++)if(e[i]===t)return e.push(e.splice(i,1)[0])}function o(e,t,i){function n(){var o=Array.prototype.slice.call(arguments,0),s=o.join(""),a=n.cache=n.cache||{},l=n.count=n.count||[];return a[R](s)?(r(l,s),i?i(a[s]):a[s]):(l.length>=1e3&&delete a[l.shift()],l.push(s),a[s]=e[M](t,o),i?i(a[s]):a[s])}return n}function s(){return this.hex}function a(e,t){for(var i=[],n=0,r=e.length;r-2*!t>n;n+=2){var o=[{x:+e[n-2],y:+e[n-1]},{x:+e[n],y:+e[n+1]},{x:+e[n+2],y:+e[n+3]},{x:+e[n+4],y:+e[n+5]}];t?n?r-4==n?o[3]={x:+e[0],y:+e[1]}:r-2==n&&(o[2]={x:+e[0],y:+e[1]},o[3]={x:+e[2],y:+e[3]}):o[0]={x:+e[r-2],y:+e[r-1]}:r-4==n?o[3]=o[2]:n||(o[0]={x:+e[n],y:+e[n+1]}),i.push(["C",(-o[0].x+6*o[1].x+o[2].x)/6,(-o[0].y+6*o[1].y+o[2].y)/6,(o[1].x+6*o[2].x-o[3].x)/6,(o[1].y+6*o[2].y-o[3].y)/6,o[2].x,o[2].y])}return i}function l(e,t,i,n,r){var o=-3*t+9*i-9*n+3*r,s=e*o+6*t-12*i+6*n;return e*s-3*t+3*i}function h(e,t,i,n,r,o,s,a,h){null==h&&(h=1),h=h>1?1:0>h?0:h;for(var c=h/2,u=12,d=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],p=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],f=0,m=0;u>m;m++){var g=c*d[m]+c,v=l(g,e,i,r,s),y=l(g,t,n,o,a),_=v*v+y*y;f+=p[m]*O.sqrt(_)}return c*f}function c(e,t,i,n,r,o,s,a,l){if(!(0>l||h(e,t,i,n,r,o,s,a)<l)){var c,u=1,d=u/2,p=u-d,f=.01;for(c=h(e,t,i,n,r,o,s,a,p);U(c-l)>f;)d/=2,p+=(l>c?1:-1)*d,c=h(e,t,i,n,r,o,s,a,p);return p}}function u(e,t,i,n,r,o,s,a){if(!(V(e,i)<B(r,s)||B(e,i)>V(r,s)||V(t,n)<B(o,a)||B(t,n)>V(o,a))){var l=(e*n-t*i)*(r-s)-(e-i)*(r*a-o*s),h=(e*n-t*i)*(o-a)-(t-n)*(r*a-o*s),c=(e-i)*(o-a)-(t-n)*(r-s);if(c){var u=l/c,d=h/c,p=+u.toFixed(2),f=+d.toFixed(2);if(!(p<+B(e,i).toFixed(2)||p>+V(e,i).toFixed(2)||p<+B(r,s).toFixed(2)||p>+V(r,s).toFixed(2)||f<+B(t,n).toFixed(2)||f>+V(t,n).toFixed(2)||f<+B(o,a).toFixed(2)||f>+V(o,a).toFixed(2)))return{x:u,y:d}}}}function d(e,t,n){var r=i.bezierBBox(e),o=i.bezierBBox(t);if(!i.isBBoxIntersect(r,o))return n?0:[];for(var s=h.apply(0,e),a=h.apply(0,t),l=V(~~(s/5),1),c=V(~~(a/5),1),d=[],p=[],f={},m=n?0:[],g=0;l+1>g;g++){var v=i.findDotsAtSegment.apply(i,e.concat(g/l));d.push({x:v.x,y:v.y,t:g/l})}for(g=0;c+1>g;g++)v=i.findDotsAtSegment.apply(i,t.concat(g/c)),p.push({x:v.x,y:v.y,t:g/c});for(g=0;l>g;g++)for(var y=0;c>y;y++){var _=d[g],b=d[g+1],E=p[y],x=p[y+1],T=U(b.x-_.x)<.001?"y":"x",w=U(x.x-E.x)<.001?"y":"x",R=u(_.x,_.y,b.x,b.y,E.x,E.y,x.x,x.y);if(R){if(f[R.x.toFixed(4)]==R.y.toFixed(4))continue;f[R.x.toFixed(4)]=R.y.toFixed(4);var S=_.t+U((R[T]-_[T])/(b[T]-_[T]))*(b.t-_.t),C=E.t+U((R[w]-E[w])/(x[w]-E[w]))*(x.t-E.t);S>=0&&1.001>=S&&C>=0&&1.001>=C&&(n?m++:m.push({x:R.x,y:R.y,t1:B(S,1),t2:B(C,1)}))}}return m}function p(e,t,n){e=i._path2curve(e),t=i._path2curve(t);for(var r,o,s,a,l,h,c,u,p,f,m=n?0:[],g=0,v=e.length;v>g;g++){var y=e[g];if("M"==y[0])r=l=y[1],o=h=y[2];else{"C"==y[0]?(p=[r,o].concat(y.slice(1)),r=p[6],o=p[7]):(p=[r,o,r,o,l,h,l,h],r=l,o=h);for(var _=0,b=t.length;b>_;_++){var E=t[_];if("M"==E[0])s=c=E[1],a=u=E[2];else{"C"==E[0]?(f=[s,a].concat(E.slice(1)),s=f[6],a=f[7]):(f=[s,a,s,a,c,u,c,u],s=c,a=u);var x=d(p,f,n);if(n)m+=x;else{for(var T=0,w=x.length;w>T;T++)x[T].segment1=g,x[T].segment2=_,x[T].bez1=p,x[T].bez2=f;m=m.concat(x)}}}}}return m}function f(e,t,i,n,r,o){null!=e?(this.a=+e,this.b=+t,this.c=+i,this.d=+n,this.e=+r,this.f=+o):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function m(){return this.x+F+this.y+F+this.width+"  "+this.height}function g(e,t,i,n,r,o){function s(e){return((u*e+c)*e+h)*e}function a(e,t){var i=l(e,t);return((f*i+p)*i+d)*i}function l(e,t){var i,n,r,o,a,l;for(r=e,l=0;8>l;l++){if(o=s(r)-e,U(o)<t)return r;if(a=(3*u*r+2*c)*r+h,U(a)<1e-6)break;r-=o/a}if(i=0,n=1,r=e,i>r)return i;if(r>n)return n;for(;n>i;){if(o=s(r),U(o-e)<t)return r;e>o?i=r:n=r,r=(n-i)/2+i}return r}var h=3*t,c=3*(n-t)-h,u=1-h-c,d=3*i,p=3*(r-i)-d,f=1-d-p;return a(e,1/(200*o))}function v(e,t){var i=[],n={};if(this.ms=t,this.times=1,e){for(var r in e)e[R](r)&&(n[Z(r)]=e[r],i.push(Z(r)));i.sort(ut)}this.anim=n,this.top=i[i.length-1],this.percents=i}function y(e,n,r,o,s,a){r=Z(r);var l,h,c,u,d,p,m=e.ms,v={},y={},_={};if(o)for(E=0,T=li.length;T>E;E++){var b=li[E];if(b.el.id==n.id&&b.anim==e){b.percent!=r?(li.splice(E,1),c=1):h=b,n.attr(b.totalOrigin);break}}else o=+y;for(var E=0,T=e.percents.length;T>E;E++){if(e.percents[E]==r||e.percents[E]>o*e.top){r=e.percents[E],d=e.percents[E-1]||0,m=m/e.top*(r-d),u=e.percents[E+1],l=e.anim[r];break}o&&n.attr(e.anim[e.percents[E]])}if(l){if(h)h.initstatus=o,h.start=new Date-h.ms*o;else{for(var w in l)if(l[R](w)&&(nt[R](w)||n.paper.customAttributes[R](w)))switch(v[w]=n.attr(w),null==v[w]&&(v[w]=it[w]),y[w]=l[w],nt[w]){case $:_[w]=(y[w]-v[w])/m;
break;case"colour":v[w]=i.getRGB(v[w]);var S=i.getRGB(y[w]);_[w]={r:(S.r-v[w].r)/m,g:(S.g-v[w].g)/m,b:(S.b-v[w].b)/m};break;case"path":var C=zt(v[w],y[w]),H=C[1];for(v[w]=C[0],_[w]=[],E=0,T=v[w].length;T>E;E++){_[w][E]=[0];for(var M=1,A=v[w][E].length;A>M;M++)_[w][E][M]=(H[E][M]-v[w][E][M])/m}break;case"transform":var P=n._,F=Bt(P[w],y[w]);if(F)for(v[w]=F.from,y[w]=F.to,_[w]=[],_[w].real=!0,E=0,T=v[w].length;T>E;E++)for(_[w][E]=[v[w][E][0]],M=1,A=v[w][E].length;A>M;M++)_[w][E][M]=(y[w][E][M]-v[w][E][M])/m;else{var z=n.matrix||new f,L={_:{transform:P.transform},getBBox:function(){return n.getBBox(1)}};v[w]=[z.a,z.b,z.c,z.d,z.e,z.f],Ot(L,y[w]),y[w]=L._.transform,_[w]=[(L.matrix.a-z.a)/m,(L.matrix.b-z.b)/m,(L.matrix.c-z.c)/m,(L.matrix.d-z.d)/m,(L.matrix.e-z.e)/m,(L.matrix.f-z.f)/m]}break;case"csv":var I=D(l[w])[N](x),O=D(v[w])[N](x);if("clip-rect"==w)for(v[w]=O,_[w]=[],E=O.length;E--;)_[w][E]=(I[E]-v[w][E])/m;y[w]=I;break;default:for(I=[][k](l[w]),O=[][k](v[w]),_[w]=[],E=n.paper.customAttributes[w].length;E--;)_[w][E]=((I[E]||0)-(O[E]||0))/m}var V=l.easing,B=i.easing_formulas[V];if(!B)if(B=D(V).match(Q),B&&5==B.length){var U=B;B=function(e){return g(e,+U[1],+U[2],+U[3],+U[4],m)}}else B=pt;if(p=l.start||e.start||+new Date,b={anim:e,percent:r,timestamp:p,start:p+(e.del||0),status:0,initstatus:o||0,stop:!1,ms:m,easing:B,from:v,diff:_,to:y,el:n,callback:l.callback,prev:d,next:u,repeat:a||e.times,origin:n.attr(),totalOrigin:s},li.push(b),o&&!h&&!c&&(b.stop=!0,b.start=new Date-m*o,1==li.length))return ci();c&&(b.start=new Date-b.ms*o),1==li.length&&hi(ci)}t("raphael.anim.start."+n.id,n,e)}}function _(e){for(var t=0;t<li.length;t++)li[t].el.paper==e&&li.splice(t--,1)}i.version="2.1.2",i.eve=t;var b,E,x=/[, ]+/,T={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},w=/\{(\d+)\}/g,R="hasOwnProperty",S={doc:document,win:e},C={was:Object.prototype[R].call(S.win,"Raphael"),is:S.win.Raphael},H=function(){this.ca=this.customAttributes={}},M="apply",k="concat",A="ontouchstart"in S.win||S.win.DocumentTouch&&S.doc instanceof DocumentTouch,P="",F=" ",D=String,N="split",z="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[N](F),L={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},I=D.prototype.toLowerCase,O=Math,V=O.max,B=O.min,U=O.abs,j=O.pow,W=O.PI,$="number",G="string",q="array",X=Object.prototype.toString,Y=(i._ISURL=/^url\(['"]?([^\)]+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),K={NaN:1,Infinity:1,"-Infinity":1},Q=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,J=O.round,Z=parseFloat,et=parseInt,tt=D.prototype.toUpperCase,it=i._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0},nt=i._availableAnimAttrs={blur:$,"clip-rect":"csv",cx:$,cy:$,fill:"colour","fill-opacity":$,"font-size":$,height:$,opacity:$,path:"path",r:$,rx:$,ry:$,stroke:"colour","stroke-opacity":$,"stroke-width":$,transform:"transform",width:$,x:$,y:$},rt=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,ot={hs:1,rg:1},st=/,?([achlmqrstvxz]),?/gi,at=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,lt=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,ht=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,ct=(i._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),ut=function(e,t){return Z(e)-Z(t)},dt=function(){},pt=function(e){return e},ft=i._rectPath=function(e,t,i,n,r){return r?[["M",e+r,t],["l",i-2*r,0],["a",r,r,0,0,1,r,r],["l",0,n-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-i,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-n],["a",r,r,0,0,1,r,-r],["z"]]:[["M",e,t],["l",i,0],["l",0,n],["l",-i,0],["z"]]},mt=function(e,t,i,n){return null==n&&(n=i),[["M",e,t],["m",0,-n],["a",i,n,0,1,1,0,2*n],["a",i,n,0,1,1,0,-2*n],["z"]]},gt=i._getPath={path:function(e){return e.attr("path")},circle:function(e){var t=e.attrs;return mt(t.cx,t.cy,t.r)},ellipse:function(e){var t=e.attrs;return mt(t.cx,t.cy,t.rx,t.ry)},rect:function(e){var t=e.attrs;return ft(t.x,t.y,t.width,t.height,t.r)},image:function(e){var t=e.attrs;return ft(t.x,t.y,t.width,t.height)},text:function(e){var t=e._getBBox();return ft(t.x,t.y,t.width,t.height)},set:function(e){var t=e._getBBox();return ft(t.x,t.y,t.width,t.height)}},vt=i.mapPath=function(e,t){if(!t)return e;var i,n,r,o,s,a,l;for(e=zt(e),r=0,s=e.length;s>r;r++)for(l=e[r],o=1,a=l.length;a>o;o+=2)i=t.x(l[o],l[o+1]),n=t.y(l[o],l[o+1]),l[o]=i,l[o+1]=n;return e};if(i._g=S,i.type=S.win.SVGAngle||S.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==i.type){var yt,_t=S.doc.createElement("div");if(_t.innerHTML='<v:shape adj="1"/>',yt=_t.firstChild,yt.style.behavior="url(#default#VML)",!yt||"object"!=typeof yt.adj)return i.type=P;_t=null}i.svg=!(i.vml="VML"==i.type),i._Paper=H,i.fn=E=H.prototype=i.prototype,i._id=0,i._oid=0,i.is=function(e,t){return t=I.call(t),"finite"==t?!K[R](+e):"array"==t?e instanceof Array:"null"==t&&null===e||t==typeof e&&null!==e||"object"==t&&e===Object(e)||"array"==t&&Array.isArray&&Array.isArray(e)||X.call(e).slice(8,-1).toLowerCase()==t},i.angle=function(e,t,n,r,o,s){if(null==o){var a=e-n,l=t-r;return a||l?(180+180*O.atan2(-l,-a)/W+360)%360:0}return i.angle(e,t,o,s)-i.angle(n,r,o,s)},i.rad=function(e){return e%360*W/180},i.deg=function(e){return 180*e/W%360},i.snapTo=function(e,t,n){if(n=i.is(n,"finite")?n:10,i.is(e,q)){for(var r=e.length;r--;)if(U(e[r]-t)<=n)return e[r]}else{e=+e;var o=t%e;if(n>o)return t-o;if(o>e-n)return t-o+e}return t},i.createUUID=function(e,t){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(e,t).toUpperCase()}}(/[xy]/g,function(e){var t=0|16*O.random(),i="x"==e?t:8|3&t;return i.toString(16)}),i.setWindow=function(e){t("raphael.setWindow",i,S.win,e),S.win=e,S.doc=S.win.document,i._engine.initWin&&i._engine.initWin(S.win)};var bt=function(e){if(i.vml){var t,n=/^\s+|\s+$/g;try{var r=new ActiveXObject("htmlfile");r.write("<body>"),r.close(),t=r.body}catch(s){t=createPopup().document.body}var a=t.createTextRange();bt=o(function(e){try{t.style.color=D(e).replace(n,P);var i=a.queryCommandValue("ForeColor");return i=(255&i)<<16|65280&i|(16711680&i)>>>16,"#"+("000000"+i.toString(16)).slice(-6)}catch(r){return"none"}})}else{var l=S.doc.createElement("i");l.title="Raphal Colour Picker",l.style.display="none",S.doc.body.appendChild(l),bt=o(function(e){return l.style.color=e,S.doc.defaultView.getComputedStyle(l,P).getPropertyValue("color")})}return bt(e)},Et=function(){return"hsb("+[this.h,this.s,this.b]+")"},xt=function(){return"hsl("+[this.h,this.s,this.l]+")"},Tt=function(){return this.hex},wt=function(e,t,n){if(null==t&&i.is(e,"object")&&"r"in e&&"g"in e&&"b"in e&&(n=e.b,t=e.g,e=e.r),null==t&&i.is(e,G)){var r=i.getRGB(e);e=r.r,t=r.g,n=r.b}return(e>1||t>1||n>1)&&(e/=255,t/=255,n/=255),[e,t,n]},Rt=function(e,t,n,r){e*=255,t*=255,n*=255;var o={r:e,g:t,b:n,hex:i.rgb(e,t,n),toString:Tt};return i.is(r,"finite")&&(o.opacity=r),o};i.color=function(e){var t;return i.is(e,"object")&&"h"in e&&"s"in e&&"b"in e?(t=i.hsb2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):i.is(e,"object")&&"h"in e&&"s"in e&&"l"in e?(t=i.hsl2rgb(e),e.r=t.r,e.g=t.g,e.b=t.b,e.hex=t.hex):(i.is(e,"string")&&(e=i.getRGB(e)),i.is(e,"object")&&"r"in e&&"g"in e&&"b"in e?(t=i.rgb2hsl(e),e.h=t.h,e.s=t.s,e.l=t.l,t=i.rgb2hsb(e),e.v=t.b):(e={hex:"none"},e.r=e.g=e.b=e.h=e.s=e.v=e.l=-1)),e.toString=Tt,e},i.hsb2rgb=function(e,t,i,n){this.is(e,"object")&&"h"in e&&"s"in e&&"b"in e&&(i=e.b,t=e.s,e=e.h,n=e.o),e*=360;var r,o,s,a,l;return e=e%360/60,l=i*t,a=l*(1-U(e%2-1)),r=o=s=i-l,e=~~e,r+=[l,a,0,0,a,l][e],o+=[a,l,l,a,0,0][e],s+=[0,0,a,l,l,a][e],Rt(r,o,s,n)},i.hsl2rgb=function(e,t,i,n){this.is(e,"object")&&"h"in e&&"s"in e&&"l"in e&&(i=e.l,t=e.s,e=e.h),(e>1||t>1||i>1)&&(e/=360,t/=100,i/=100),e*=360;var r,o,s,a,l;return e=e%360/60,l=2*t*(.5>i?i:1-i),a=l*(1-U(e%2-1)),r=o=s=i-l/2,e=~~e,r+=[l,a,0,0,a,l][e],o+=[a,l,l,a,0,0][e],s+=[0,0,a,l,l,a][e],Rt(r,o,s,n)},i.rgb2hsb=function(e,t,i){i=wt(e,t,i),e=i[0],t=i[1],i=i[2];var n,r,o,s;return o=V(e,t,i),s=o-B(e,t,i),n=0==s?null:o==e?(t-i)/s:o==t?(i-e)/s+2:(e-t)/s+4,n=60*((n+360)%6)/360,r=0==s?0:s/o,{h:n,s:r,b:o,toString:Et}},i.rgb2hsl=function(e,t,i){i=wt(e,t,i),e=i[0],t=i[1],i=i[2];var n,r,o,s,a,l;return s=V(e,t,i),a=B(e,t,i),l=s-a,n=0==l?null:s==e?(t-i)/l:s==t?(i-e)/l+2:(e-t)/l+4,n=60*((n+360)%6)/360,o=(s+a)/2,r=0==l?0:.5>o?l/(2*o):l/(2-2*o),{h:n,s:r,l:o,toString:xt}},i._path2string=function(){return this.join(",").replace(st,"$1")},i._preload=function(e,t){var i=S.doc.createElement("img");i.style.cssText="position:absolute;left:-9999em;top:-9999em",i.onload=function(){t.call(this),this.onload=null,S.doc.body.removeChild(this)},i.onerror=function(){S.doc.body.removeChild(this)},S.doc.body.appendChild(i),i.src=e},i.getRGB=o(function(e){if(!e||(e=D(e)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:s};if("none"==e)return{r:-1,g:-1,b:-1,hex:"none",toString:s};!(ot[R](e.toLowerCase().substring(0,2))||"#"==e.charAt())&&(e=bt(e));var t,n,r,o,a,l,h=e.match(Y);return h?(h[2]&&(r=et(h[2].substring(5),16),n=et(h[2].substring(3,5),16),t=et(h[2].substring(1,3),16)),h[3]&&(r=et((a=h[3].charAt(3))+a,16),n=et((a=h[3].charAt(2))+a,16),t=et((a=h[3].charAt(1))+a,16)),h[4]&&(l=h[4][N](rt),t=Z(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),r=Z(l[2]),"%"==l[2].slice(-1)&&(r*=2.55),"rgba"==h[1].toLowerCase().slice(0,4)&&(o=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(o/=100)),h[5]?(l=h[5][N](rt),t=Z(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),r=Z(l[2]),"%"==l[2].slice(-1)&&(r*=2.55),("deg"==l[0].slice(-3)||""==l[0].slice(-1))&&(t/=360),"hsba"==h[1].toLowerCase().slice(0,4)&&(o=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(o/=100),i.hsb2rgb(t,n,r,o)):h[6]?(l=h[6][N](rt),t=Z(l[0]),"%"==l[0].slice(-1)&&(t*=2.55),n=Z(l[1]),"%"==l[1].slice(-1)&&(n*=2.55),r=Z(l[2]),"%"==l[2].slice(-1)&&(r*=2.55),("deg"==l[0].slice(-3)||""==l[0].slice(-1))&&(t/=360),"hsla"==h[1].toLowerCase().slice(0,4)&&(o=Z(l[3])),l[3]&&"%"==l[3].slice(-1)&&(o/=100),i.hsl2rgb(t,n,r,o)):(h={r:t,g:n,b:r,toString:s},h.hex="#"+(16777216|r|n<<8|t<<16).toString(16).slice(1),i.is(o,"finite")&&(h.opacity=o),h)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:s}},i),i.hsb=o(function(e,t,n){return i.hsb2rgb(e,t,n).hex}),i.hsl=o(function(e,t,n){return i.hsl2rgb(e,t,n).hex}),i.rgb=o(function(e,t,i){return"#"+(16777216|i|t<<8|e<<16).toString(16).slice(1)}),i.getColor=function(e){var t=this.getColor.start=this.getColor.start||{h:0,s:1,b:e||.75},i=this.hsb2rgb(t.h,t.s,t.b);return t.h+=.075,t.h>1&&(t.h=0,t.s-=.2,t.s<=0&&(this.getColor.start={h:0,s:1,b:t.b})),i.hex},i.getColor.reset=function(){delete this.start},i.parsePathString=function(e){if(!e)return null;var t=St(e);if(t.arr)return Ht(t.arr);var n={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},r=[];return i.is(e,q)&&i.is(e[0],q)&&(r=Ht(e)),r.length||D(e).replace(at,function(e,t,i){var o=[],s=t.toLowerCase();if(i.replace(ht,function(e,t){t&&o.push(+t)}),"m"==s&&o.length>2&&(r.push([t][k](o.splice(0,2))),s="l",t="m"==t?"l":"L"),"r"==s)r.push([t][k](o));else for(;o.length>=n[s]&&(r.push([t][k](o.splice(0,n[s]))),n[s]););}),r.toString=i._path2string,t.arr=Ht(r),r},i.parseTransformString=o(function(e){if(!e)return null;var t=[];return i.is(e,q)&&i.is(e[0],q)&&(t=Ht(e)),t.length||D(e).replace(lt,function(e,i,n){var r=[];I.call(i),n.replace(ht,function(e,t){t&&r.push(+t)}),t.push([i][k](r))}),t.toString=i._path2string,t});var St=function(e){var t=St.ps=St.ps||{};return t[e]?t[e].sleep=100:t[e]={sleep:100},setTimeout(function(){for(var i in t)t[R](i)&&i!=e&&(t[i].sleep--,!t[i].sleep&&delete t[i])}),t[e]};i.findDotsAtSegment=function(e,t,i,n,r,o,s,a,l){var h=1-l,c=j(h,3),u=j(h,2),d=l*l,p=d*l,f=c*e+3*u*l*i+3*h*l*l*r+p*s,m=c*t+3*u*l*n+3*h*l*l*o+p*a,g=e+2*l*(i-e)+d*(r-2*i+e),v=t+2*l*(n-t)+d*(o-2*n+t),y=i+2*l*(r-i)+d*(s-2*r+i),_=n+2*l*(o-n)+d*(a-2*o+n),b=h*e+l*i,E=h*t+l*n,x=h*r+l*s,T=h*o+l*a,w=90-180*O.atan2(g-y,v-_)/W;return(g>y||_>v)&&(w+=180),{x:f,y:m,m:{x:g,y:v},n:{x:y,y:_},start:{x:b,y:E},end:{x:x,y:T},alpha:w}},i.bezierBBox=function(e,t,n,r,o,s,a,l){i.is(e,"array")||(e=[e,t,n,r,o,s,a,l]);var h=Nt.apply(null,e);return{x:h.min.x,y:h.min.y,x2:h.max.x,y2:h.max.y,width:h.max.x-h.min.x,height:h.max.y-h.min.y}},i.isPointInsideBBox=function(e,t,i){return t>=e.x&&t<=e.x2&&i>=e.y&&i<=e.y2},i.isBBoxIntersect=function(e,t){var n=i.isPointInsideBBox;return n(t,e.x,e.y)||n(t,e.x2,e.y)||n(t,e.x,e.y2)||n(t,e.x2,e.y2)||n(e,t.x,t.y)||n(e,t.x2,t.y)||n(e,t.x,t.y2)||n(e,t.x2,t.y2)||(e.x<t.x2&&e.x>t.x||t.x<e.x2&&t.x>e.x)&&(e.y<t.y2&&e.y>t.y||t.y<e.y2&&t.y>e.y)},i.pathIntersection=function(e,t){return p(e,t)},i.pathIntersectionNumber=function(e,t){return p(e,t,1)},i.isPointInsidePath=function(e,t,n){var r=i.pathBBox(e);return i.isPointInsideBBox(r,t,n)&&1==p(e,[["M",t,n],["H",r.x2+10]],1)%2},i._removedFactory=function(e){return function(){t("raphael.log",null,"Raphal: you are calling to method "+e+" of removed object",e)}};var Ct=i.pathBBox=function(e){var t=St(e);if(t.bbox)return n(t.bbox);if(!e)return{x:0,y:0,width:0,height:0,x2:0,y2:0};e=zt(e);for(var i,r=0,o=0,s=[],a=[],l=0,h=e.length;h>l;l++)if(i=e[l],"M"==i[0])r=i[1],o=i[2],s.push(r),a.push(o);else{var c=Nt(r,o,i[1],i[2],i[3],i[4],i[5],i[6]);s=s[k](c.min.x,c.max.x),a=a[k](c.min.y,c.max.y),r=i[5],o=i[6]}var u=B[M](0,s),d=B[M](0,a),p=V[M](0,s),f=V[M](0,a),m=p-u,g=f-d,v={x:u,y:d,x2:p,y2:f,width:m,height:g,cx:u+m/2,cy:d+g/2};return t.bbox=n(v),v},Ht=function(e){var t=n(e);return t.toString=i._path2string,t},Mt=i._pathToRelative=function(e){var t=St(e);if(t.rel)return Ht(t.rel);i.is(e,q)&&i.is(e&&e[0],q)||(e=i.parsePathString(e));var n=[],r=0,o=0,s=0,a=0,l=0;"M"==e[0][0]&&(r=e[0][1],o=e[0][2],s=r,a=o,l++,n.push(["M",r,o]));for(var h=l,c=e.length;c>h;h++){var u=n[h]=[],d=e[h];if(d[0]!=I.call(d[0]))switch(u[0]=I.call(d[0]),u[0]){case"a":u[1]=d[1],u[2]=d[2],u[3]=d[3],u[4]=d[4],u[5]=d[5],u[6]=+(d[6]-r).toFixed(3),u[7]=+(d[7]-o).toFixed(3);break;case"v":u[1]=+(d[1]-o).toFixed(3);break;case"m":s=d[1],a=d[2];default:for(var p=1,f=d.length;f>p;p++)u[p]=+(d[p]-(p%2?r:o)).toFixed(3)}else{u=n[h]=[],"m"==d[0]&&(s=d[1]+r,a=d[2]+o);for(var m=0,g=d.length;g>m;m++)n[h][m]=d[m]}var v=n[h].length;switch(n[h][0]){case"z":r=s,o=a;break;case"h":r+=+n[h][v-1];break;case"v":o+=+n[h][v-1];break;default:r+=+n[h][v-2],o+=+n[h][v-1]}}return n.toString=i._path2string,t.rel=Ht(n),n},kt=i._pathToAbsolute=function(e){var t=St(e);if(t.abs)return Ht(t.abs);if(i.is(e,q)&&i.is(e&&e[0],q)||(e=i.parsePathString(e)),!e||!e.length)return[["M",0,0]];var n=[],r=0,o=0,s=0,l=0,h=0;"M"==e[0][0]&&(r=+e[0][1],o=+e[0][2],s=r,l=o,h++,n[0]=["M",r,o]);for(var c,u,d=3==e.length&&"M"==e[0][0]&&"R"==e[1][0].toUpperCase()&&"Z"==e[2][0].toUpperCase(),p=h,f=e.length;f>p;p++){if(n.push(c=[]),u=e[p],u[0]!=tt.call(u[0]))switch(c[0]=tt.call(u[0]),c[0]){case"A":c[1]=u[1],c[2]=u[2],c[3]=u[3],c[4]=u[4],c[5]=u[5],c[6]=+(u[6]+r),c[7]=+(u[7]+o);break;case"V":c[1]=+u[1]+o;break;case"H":c[1]=+u[1]+r;break;case"R":for(var m=[r,o][k](u.slice(1)),g=2,v=m.length;v>g;g++)m[g]=+m[g]+r,m[++g]=+m[g]+o;n.pop(),n=n[k](a(m,d));break;case"M":s=+u[1]+r,l=+u[2]+o;default:for(g=1,v=u.length;v>g;g++)c[g]=+u[g]+(g%2?r:o)}else if("R"==u[0])m=[r,o][k](u.slice(1)),n.pop(),n=n[k](a(m,d)),c=["R"][k](u.slice(-2));else for(var y=0,_=u.length;_>y;y++)c[y]=u[y];switch(c[0]){case"Z":r=s,o=l;break;case"H":r=c[1];break;case"V":o=c[1];break;case"M":s=c[c.length-2],l=c[c.length-1];default:r=c[c.length-2],o=c[c.length-1]}}return n.toString=i._path2string,t.abs=Ht(n),n},At=function(e,t,i,n){return[e,t,i,n,i,n]},Pt=function(e,t,i,n,r,o){var s=1/3,a=2/3;return[s*e+a*i,s*t+a*n,s*r+a*i,s*o+a*n,r,o]},Ft=function(e,t,i,n,r,s,a,l,h,c){var u,d=120*W/180,p=W/180*(+r||0),f=[],m=o(function(e,t,i){var n=e*O.cos(i)-t*O.sin(i),r=e*O.sin(i)+t*O.cos(i);return{x:n,y:r}});if(c)w=c[0],R=c[1],x=c[2],T=c[3];else{u=m(e,t,-p),e=u.x,t=u.y,u=m(l,h,-p),l=u.x,h=u.y;var g=(O.cos(W/180*r),O.sin(W/180*r),(e-l)/2),v=(t-h)/2,y=g*g/(i*i)+v*v/(n*n);y>1&&(y=O.sqrt(y),i=y*i,n=y*n);var _=i*i,b=n*n,E=(s==a?-1:1)*O.sqrt(U((_*b-_*v*v-b*g*g)/(_*v*v+b*g*g))),x=E*i*v/n+(e+l)/2,T=E*-n*g/i+(t+h)/2,w=O.asin(((t-T)/n).toFixed(9)),R=O.asin(((h-T)/n).toFixed(9));w=x>e?W-w:w,R=x>l?W-R:R,0>w&&(w=2*W+w),0>R&&(R=2*W+R),a&&w>R&&(w-=2*W),!a&&R>w&&(R-=2*W)}var S=R-w;if(U(S)>d){var C=R,H=l,M=h;R=w+d*(a&&R>w?1:-1),l=x+i*O.cos(R),h=T+n*O.sin(R),f=Ft(l,h,i,n,r,0,a,H,M,[R,C,x,T])}S=R-w;var A=O.cos(w),P=O.sin(w),F=O.cos(R),D=O.sin(R),z=O.tan(S/4),L=4/3*i*z,I=4/3*n*z,V=[e,t],B=[e+L*P,t-I*A],j=[l+L*D,h-I*F],$=[l,h];if(B[0]=2*V[0]-B[0],B[1]=2*V[1]-B[1],c)return[B,j,$][k](f);f=[B,j,$][k](f).join()[N](",");for(var G=[],q=0,X=f.length;X>q;q++)G[q]=q%2?m(f[q-1],f[q],p).y:m(f[q],f[q+1],p).x;return G},Dt=function(e,t,i,n,r,o,s,a,l){var h=1-l;return{x:j(h,3)*e+3*j(h,2)*l*i+3*h*l*l*r+j(l,3)*s,y:j(h,3)*t+3*j(h,2)*l*n+3*h*l*l*o+j(l,3)*a}},Nt=o(function(e,t,i,n,r,o,s,a){var l,h=r-2*i+e-(s-2*r+i),c=2*(i-e)-2*(r-i),u=e-i,d=(-c+O.sqrt(c*c-4*h*u))/2/h,p=(-c-O.sqrt(c*c-4*h*u))/2/h,f=[t,a],m=[e,s];return U(d)>"1e12"&&(d=.5),U(p)>"1e12"&&(p=.5),d>0&&1>d&&(l=Dt(e,t,i,n,r,o,s,a,d),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Dt(e,t,i,n,r,o,s,a,p),m.push(l.x),f.push(l.y)),h=o-2*n+t-(a-2*o+n),c=2*(n-t)-2*(o-n),u=t-n,d=(-c+O.sqrt(c*c-4*h*u))/2/h,p=(-c-O.sqrt(c*c-4*h*u))/2/h,U(d)>"1e12"&&(d=.5),U(p)>"1e12"&&(p=.5),d>0&&1>d&&(l=Dt(e,t,i,n,r,o,s,a,d),m.push(l.x),f.push(l.y)),p>0&&1>p&&(l=Dt(e,t,i,n,r,o,s,a,p),m.push(l.x),f.push(l.y)),{min:{x:B[M](0,m),y:B[M](0,f)},max:{x:V[M](0,m),y:V[M](0,f)}}}),zt=i._path2curve=o(function(e,t){var i=!t&&St(e);if(!t&&i.curve)return Ht(i.curve);for(var n=kt(e),r=t&&kt(t),o={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},s={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},a=(function(e,t,i){var n,r;if(!e)return["C",t.x,t.y,t.x,t.y,t.x,t.y];switch(!(e[0]in{T:1,Q:1})&&(t.qx=t.qy=null),e[0]){case"M":t.X=e[1],t.Y=e[2];break;case"A":e=["C"][k](Ft[M](0,[t.x,t.y][k](e.slice(1))));break;case"S":"C"==i||"S"==i?(n=2*t.x-t.bx,r=2*t.y-t.by):(n=t.x,r=t.y),e=["C",n,r][k](e.slice(1));break;case"T":"Q"==i||"T"==i?(t.qx=2*t.x-t.qx,t.qy=2*t.y-t.qy):(t.qx=t.x,t.qy=t.y),e=["C"][k](Pt(t.x,t.y,t.qx,t.qy,e[1],e[2]));break;case"Q":t.qx=e[1],t.qy=e[2],e=["C"][k](Pt(t.x,t.y,e[1],e[2],e[3],e[4]));break;case"L":e=["C"][k](At(t.x,t.y,e[1],e[2]));break;case"H":e=["C"][k](At(t.x,t.y,e[1],t.y));break;case"V":e=["C"][k](At(t.x,t.y,t.x,e[1]));break;case"Z":e=["C"][k](At(t.x,t.y,t.X,t.Y))}return e}),l=function(e,t){if(e[t].length>7){e[t].shift();for(var i=e[t];i.length;)e.splice(t++,0,["C"][k](i.splice(0,6)));e.splice(t,1),u=V(n.length,r&&r.length||0)}},h=function(e,t,i,o,s){e&&t&&"M"==e[s][0]&&"M"!=t[s][0]&&(t.splice(s,0,["M",o.x,o.y]),i.bx=0,i.by=0,i.x=e[s][1],i.y=e[s][2],u=V(n.length,r&&r.length||0))},c=0,u=V(n.length,r&&r.length||0);u>c;c++){n[c]=a(n[c],o),l(n,c),r&&(r[c]=a(r[c],s)),r&&l(r,c),h(n,r,o,s,c),h(r,n,s,o,c);var d=n[c],p=r&&r[c],f=d.length,m=r&&p.length;o.x=d[f-2],o.y=d[f-1],o.bx=Z(d[f-4])||o.x,o.by=Z(d[f-3])||o.y,s.bx=r&&(Z(p[m-4])||s.x),s.by=r&&(Z(p[m-3])||s.y),s.x=r&&p[m-2],s.y=r&&p[m-1]}return r||(i.curve=Ht(n)),r?[n,r]:n},null,Ht),Lt=(i._parseDots=o(function(e){for(var t=[],n=0,r=e.length;r>n;n++){var o={},s=e[n].match(/^([^:]*):?([\d\.]*)/);if(o.color=i.getRGB(s[1]),o.color.error)return null;o.color=o.color.hex,s[2]&&(o.offset=s[2]+"%"),t.push(o)}for(n=1,r=t.length-1;r>n;n++)if(!t[n].offset){for(var a=Z(t[n-1].offset||0),l=0,h=n+1;r>h;h++)if(t[h].offset){l=t[h].offset;break}l||(l=100,h=r),l=Z(l);for(var c=(l-a)/(h-n+1);h>n;n++)a+=c,t[n].offset=a+"%"}return t}),i._tear=function(e,t){e==t.top&&(t.top=e.prev),e==t.bottom&&(t.bottom=e.next),e.next&&(e.next.prev=e.prev),e.prev&&(e.prev.next=e.next)}),It=(i._tofront=function(e,t){t.top!==e&&(Lt(e,t),e.next=null,e.prev=t.top,t.top.next=e,t.top=e)},i._toback=function(e,t){t.bottom!==e&&(Lt(e,t),e.next=t.bottom,e.prev=null,t.bottom.prev=e,t.bottom=e)},i._insertafter=function(e,t,i){Lt(e,i),t==i.top&&(i.top=e),t.next&&(t.next.prev=e),e.next=t.next,e.prev=t,t.next=e},i._insertbefore=function(e,t,i){Lt(e,i),t==i.bottom&&(i.bottom=e),t.prev&&(t.prev.next=e),e.prev=t.prev,t.prev=e,e.next=t},i.toMatrix=function(e,t){var i=Ct(e),n={_:{transform:P},getBBox:function(){return i}};return Ot(n,t),n.matrix}),Ot=(i.transformPath=function(e,t){return vt(e,It(e,t))},i._extractTransform=function(e,t){if(null==t)return e._.transform;t=D(t).replace(/\.{3}|\u2026/g,e._.transform||P);var n=i.parseTransformString(t),r=0,o=0,s=0,a=1,l=1,h=e._,c=new f;if(h.transform=n||[],n)for(var u=0,d=n.length;d>u;u++){var p,m,g,v,y,_=n[u],b=_.length,E=D(_[0]).toLowerCase(),x=_[0]!=E,T=x?c.invert():0;"t"==E&&3==b?x?(p=T.x(0,0),m=T.y(0,0),g=T.x(_[1],_[2]),v=T.y(_[1],_[2]),c.translate(g-p,v-m)):c.translate(_[1],_[2]):"r"==E?2==b?(y=y||e.getBBox(1),c.rotate(_[1],y.x+y.width/2,y.y+y.height/2),r+=_[1]):4==b&&(x?(g=T.x(_[2],_[3]),v=T.y(_[2],_[3]),c.rotate(_[1],g,v)):c.rotate(_[1],_[2],_[3]),r+=_[1]):"s"==E?2==b||3==b?(y=y||e.getBBox(1),c.scale(_[1],_[b-1],y.x+y.width/2,y.y+y.height/2),a*=_[1],l*=_[b-1]):5==b&&(x?(g=T.x(_[3],_[4]),v=T.y(_[3],_[4]),c.scale(_[1],_[2],g,v)):c.scale(_[1],_[2],_[3],_[4]),a*=_[1],l*=_[2]):"m"==E&&7==b&&c.add(_[1],_[2],_[3],_[4],_[5],_[6]),h.dirtyT=1,e.matrix=c}e.matrix=c,h.sx=a,h.sy=l,h.deg=r,h.dx=o=c.e,h.dy=s=c.f,1==a&&1==l&&!r&&h.bbox?(h.bbox.x+=+o,h.bbox.y+=+s):h.dirtyT=1}),Vt=function(e){var t=e[0];switch(t.toLowerCase()){case"t":return[t,0,0];case"m":return[t,1,0,0,1,0,0];case"r":return 4==e.length?[t,0,e[2],e[3]]:[t,0];case"s":return 5==e.length?[t,1,1,e[3],e[4]]:3==e.length?[t,1,1]:[t,1]}},Bt=i._equaliseTransform=function(e,t){t=D(t).replace(/\.{3}|\u2026/g,e),e=i.parseTransformString(e)||[],t=i.parseTransformString(t)||[];for(var n,r,o,s,a=V(e.length,t.length),l=[],h=[],c=0;a>c;c++){if(o=e[c]||Vt(t[c]),s=t[c]||Vt(o),o[0]!=s[0]||"r"==o[0].toLowerCase()&&(o[2]!=s[2]||o[3]!=s[3])||"s"==o[0].toLowerCase()&&(o[3]!=s[3]||o[4]!=s[4]))return;for(l[c]=[],h[c]=[],n=0,r=V(o.length,s.length);r>n;n++)n in o&&(l[c][n]=o[n]),n in s&&(h[c][n]=s[n])}return{from:l,to:h}};i._getContainer=function(e,t,n,r){var o;return o=null!=r||i.is(e,"object")?e:S.doc.getElementById(e),null!=o?o.tagName?null==t?{container:o,width:o.style.pixelWidth||o.offsetWidth,height:o.style.pixelHeight||o.offsetHeight}:{container:o,width:t,height:n}:{container:1,x:e,y:t,width:n,height:r}:void 0},i.pathToRelative=Mt,i._engine={},i.path2curve=zt,i.matrix=function(e,t,i,n,r,o){return new f(e,t,i,n,r,o)},function(e){function t(e){return e[0]*e[0]+e[1]*e[1]}function n(e){var i=O.sqrt(t(e));e[0]&&(e[0]/=i),e[1]&&(e[1]/=i)}e.add=function(e,t,i,n,r,o){var s,a,l,h,c=[[],[],[]],u=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],d=[[e,i,r],[t,n,o],[0,0,1]];for(e&&e instanceof f&&(d=[[e.a,e.c,e.e],[e.b,e.d,e.f],[0,0,1]]),s=0;3>s;s++)for(a=0;3>a;a++){for(h=0,l=0;3>l;l++)h+=u[s][l]*d[l][a];c[s][a]=h}this.a=c[0][0],this.b=c[1][0],this.c=c[0][1],this.d=c[1][1],this.e=c[0][2],this.f=c[1][2]},e.invert=function(){var e=this,t=e.a*e.d-e.b*e.c;return new f(e.d/t,-e.b/t,-e.c/t,e.a/t,(e.c*e.f-e.d*e.e)/t,(e.b*e.e-e.a*e.f)/t)},e.clone=function(){return new f(this.a,this.b,this.c,this.d,this.e,this.f)},e.translate=function(e,t){this.add(1,0,0,1,e,t)},e.scale=function(e,t,i,n){null==t&&(t=e),(i||n)&&this.add(1,0,0,1,i,n),this.add(e,0,0,t,0,0),(i||n)&&this.add(1,0,0,1,-i,-n)},e.rotate=function(e,t,n){e=i.rad(e),t=t||0,n=n||0;var r=+O.cos(e).toFixed(9),o=+O.sin(e).toFixed(9);this.add(r,o,-o,r,t,n),this.add(1,0,0,1,-t,-n)},e.x=function(e,t){return e*this.a+t*this.c+this.e},e.y=function(e,t){return e*this.b+t*this.d+this.f},e.get=function(e){return+this[D.fromCharCode(97+e)].toFixed(4)},e.toString=function(){return i.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},e.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},e.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},e.split=function(){var e={};e.dx=this.e,e.dy=this.f;var r=[[this.a,this.c],[this.b,this.d]];e.scalex=O.sqrt(t(r[0])),n(r[0]),e.shear=r[0][0]*r[1][0]+r[0][1]*r[1][1],r[1]=[r[1][0]-r[0][0]*e.shear,r[1][1]-r[0][1]*e.shear],e.scaley=O.sqrt(t(r[1])),n(r[1]),e.shear/=e.scaley;var o=-r[0][1],s=r[1][1];return 0>s?(e.rotate=i.deg(O.acos(s)),0>o&&(e.rotate=360-e.rotate)):e.rotate=i.deg(O.asin(o)),e.isSimple=!(+e.shear.toFixed(9)||e.scalex.toFixed(9)!=e.scaley.toFixed(9)&&e.rotate),e.isSuperSimple=!+e.shear.toFixed(9)&&e.scalex.toFixed(9)==e.scaley.toFixed(9)&&!e.rotate,e.noRotation=!+e.shear.toFixed(9)&&!e.rotate,e},e.toTransformString=function(e){var t=e||this[N]();return t.isSimple?(t.scalex=+t.scalex.toFixed(4),t.scaley=+t.scaley.toFixed(4),t.rotate=+t.rotate.toFixed(4),(t.dx||t.dy?"t"+[t.dx,t.dy]:P)+(1!=t.scalex||1!=t.scaley?"s"+[t.scalex,t.scaley,0,0]:P)+(t.rotate?"r"+[t.rotate,0,0]:P)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(f.prototype);var Ut=navigator.userAgent.match(/Version\/(.*?)\s/)||navigator.userAgent.match(/Chrome\/(\d+)/);E.safari="Apple Computer, Inc."==navigator.vendor&&(Ut&&Ut[1]<4||"iP"==navigator.platform.slice(0,2))||"Google Inc."==navigator.vendor&&Ut&&Ut[1]<8?function(){var e=this.rect(-99,-99,this.width+99,this.height+99).attr({stroke:"none"});setTimeout(function(){e.remove()})}:dt;for(var jt=function(){this.returnValue=!1},Wt=function(){return this.originalEvent.preventDefault()},$t=function(){this.cancelBubble=!0},Gt=function(){return this.originalEvent.stopPropagation()},qt=function(e){var t=S.doc.documentElement.scrollTop||S.doc.body.scrollTop,i=S.doc.documentElement.scrollLeft||S.doc.body.scrollLeft;return{x:e.clientX+i,y:e.clientY+t}},Xt=function(){return S.doc.addEventListener?function(e,t,i,n){var r=function(e){var t=qt(e);return i.call(n,e,t.x,t.y)};if(e.addEventListener(t,r,!1),A&&L[t]){var o=function(t){for(var r=qt(t),o=t,s=0,a=t.targetTouches&&t.targetTouches.length;a>s;s++)if(t.targetTouches[s].target==e){t=t.targetTouches[s],t.originalEvent=o,t.preventDefault=Wt,t.stopPropagation=Gt;break}return i.call(n,t,r.x,r.y)};e.addEventListener(L[t],o,!1)}return function(){return e.removeEventListener(t,r,!1),A&&L[t]&&e.removeEventListener(L[t],r,!1),!0}}:S.doc.attachEvent?function(e,t,i,n){var r=function(e){e=e||S.win.event;var t=S.doc.documentElement.scrollTop||S.doc.body.scrollTop,r=S.doc.documentElement.scrollLeft||S.doc.body.scrollLeft,o=e.clientX+r,s=e.clientY+t;return e.preventDefault=e.preventDefault||jt,e.stopPropagation=e.stopPropagation||$t,i.call(n,e,o,s)};e.attachEvent("on"+t,r);var o=function(){return e.detachEvent("on"+t,r),!0};return o}:void 0}(),Yt=[],Kt=function(e){for(var i,n=e.clientX,r=e.clientY,o=S.doc.documentElement.scrollTop||S.doc.body.scrollTop,s=S.doc.documentElement.scrollLeft||S.doc.body.scrollLeft,a=Yt.length;a--;){if(i=Yt[a],A&&e.touches){for(var l,h=e.touches.length;h--;)if(l=e.touches[h],l.identifier==i.el._drag.id){n=l.clientX,r=l.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var c,u=i.el.node,d=u.nextSibling,p=u.parentNode,f=u.style.display;S.win.opera&&p.removeChild(u),u.style.display="none",c=i.el.paper.getElementByPoint(n,r),u.style.display=f,S.win.opera&&(d?p.insertBefore(u,d):p.appendChild(u)),c&&t("raphael.drag.over."+i.el.id,i.el,c),n+=s,r+=o,t("raphael.drag.move."+i.el.id,i.move_scope||i.el,n-i.el._drag.x,r-i.el._drag.y,n,r,e)}},Qt=function(e){i.unmousemove(Kt).unmouseup(Qt);for(var n,r=Yt.length;r--;)n=Yt[r],n.el._drag={},t("raphael.drag.end."+n.el.id,n.end_scope||n.start_scope||n.move_scope||n.el,e);Yt=[]},Jt=i.el={},Zt=z.length;Zt--;)!function(e){i[e]=Jt[e]=function(t,n){return i.is(t,"function")&&(this.events=this.events||[],this.events.push({name:e,f:t,unbind:Xt(this.shape||this.node||S.doc,e,t,n||this)})),this},i["un"+e]=Jt["un"+e]=function(t){for(var n=this.events||[],r=n.length;r--;)n[r].name!=e||!i.is(t,"undefined")&&n[r].f!=t||(n[r].unbind(),n.splice(r,1),!n.length&&delete this.events);return this}}(z[Zt]);Jt.data=function(e,n){var r=ct[this.id]=ct[this.id]||{};if(0==arguments.length)return r;if(1==arguments.length){if(i.is(e,"object")){for(var o in e)e[R](o)&&this.data(o,e[o]);return this}return t("raphael.data.get."+this.id,this,r[e],e),r[e]}return r[e]=n,t("raphael.data.set."+this.id,this,n,e),this},Jt.removeData=function(e){return null==e?ct[this.id]={}:ct[this.id]&&delete ct[this.id][e],this},Jt.getData=function(){return n(ct[this.id]||{})},Jt.hover=function(e,t,i,n){return this.mouseover(e,i).mouseout(t,n||i)},Jt.unhover=function(e,t){return this.unmouseover(e).unmouseout(t)};var ei=[];Jt.drag=function(e,n,r,o,s,a){function l(l){(l.originalEvent||l).preventDefault();var h=l.clientX,c=l.clientY,u=S.doc.documentElement.scrollTop||S.doc.body.scrollTop,d=S.doc.documentElement.scrollLeft||S.doc.body.scrollLeft;if(this._drag.id=l.identifier,A&&l.touches)for(var p,f=l.touches.length;f--;)if(p=l.touches[f],this._drag.id=p.identifier,p.identifier==this._drag.id){h=p.clientX,c=p.clientY;break}this._drag.x=h+d,this._drag.y=c+u,!Yt.length&&i.mousemove(Kt).mouseup(Qt),Yt.push({el:this,move_scope:o,start_scope:s,end_scope:a}),n&&t.on("raphael.drag.start."+this.id,n),e&&t.on("raphael.drag.move."+this.id,e),r&&t.on("raphael.drag.end."+this.id,r),t("raphael.drag.start."+this.id,s||o||this,l.clientX+d,l.clientY+u,l)}return this._drag={},ei.push({el:this,start:l}),this.mousedown(l),this},Jt.onDragOver=function(e){e?t.on("raphael.drag.over."+this.id,e):t.unbind("raphael.drag.over."+this.id)},Jt.undrag=function(){for(var e=ei.length;e--;)ei[e].el==this&&(this.unmousedown(ei[e].start),ei.splice(e,1),t.unbind("raphael.drag.*."+this.id));
!ei.length&&i.unmousemove(Kt).unmouseup(Qt),Yt=[]},E.circle=function(e,t,n){var r=i._engine.circle(this,e||0,t||0,n||0);return this.__set__&&this.__set__.push(r),r},E.rect=function(e,t,n,r,o){var s=i._engine.rect(this,e||0,t||0,n||0,r||0,o||0);return this.__set__&&this.__set__.push(s),s},E.ellipse=function(e,t,n,r){var o=i._engine.ellipse(this,e||0,t||0,n||0,r||0);return this.__set__&&this.__set__.push(o),o},E.path=function(e){e&&!i.is(e,G)&&!i.is(e[0],q)&&(e+=P);var t=i._engine.path(i.format[M](i,arguments),this);return this.__set__&&this.__set__.push(t),t},E.image=function(e,t,n,r,o){var s=i._engine.image(this,e||"about:blank",t||0,n||0,r||0,o||0);return this.__set__&&this.__set__.push(s),s},E.text=function(e,t,n){var r=i._engine.text(this,e||0,t||0,D(n));return this.__set__&&this.__set__.push(r),r},E.set=function(e){!i.is(e,"array")&&(e=Array.prototype.splice.call(arguments,0,arguments.length));var t=new di(e);return this.__set__&&this.__set__.push(t),t.paper=this,t.type="set",t},E.setStart=function(e){this.__set__=e||this.set()},E.setFinish=function(){var e=this.__set__;return delete this.__set__,e},E.setSize=function(e,t){return i._engine.setSize.call(this,e,t)},E.setViewBox=function(e,t,n,r,o){return i._engine.setViewBox.call(this,e,t,n,r,o)},E.top=E.bottom=null,E.raphael=i;var ti=function(e){var t=e.getBoundingClientRect(),i=e.ownerDocument,n=i.body,r=i.documentElement,o=r.clientTop||n.clientTop||0,s=r.clientLeft||n.clientLeft||0,a=t.top+(S.win.pageYOffset||r.scrollTop||n.scrollTop)-o,l=t.left+(S.win.pageXOffset||r.scrollLeft||n.scrollLeft)-s;return{y:a,x:l}};E.getElementByPoint=function(e,t){var i=this,n=i.canvas,r=S.doc.elementFromPoint(e,t);if(S.win.opera&&"svg"==r.tagName){var o=ti(n),s=n.createSVGRect();s.x=e-o.x,s.y=t-o.y,s.width=s.height=1;var a=n.getIntersectionList(s,null);a.length&&(r=a[a.length-1])}if(!r)return null;for(;r.parentNode&&r!=n.parentNode&&!r.raphael;)r=r.parentNode;return r==i.canvas.parentNode&&(r=n),r=r&&r.raphael?i.getById(r.raphaelid):null},E.getElementsByBBox=function(e){var t=this.set();return this.forEach(function(n){i.isBBoxIntersect(n.getBBox(),e)&&t.push(n)}),t},E.getById=function(e){for(var t=this.bottom;t;){if(t.id==e)return t;t=t.next}return null},E.forEach=function(e,t){for(var i=this.bottom;i;){if(e.call(t,i)===!1)return this;i=i.next}return this},E.getElementsByPoint=function(e,t){var i=this.set();return this.forEach(function(n){n.isPointInside(e,t)&&i.push(n)}),i},Jt.isPointInside=function(e,t){var n=this.realPath=gt[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(n=i.transformPath(n,this.attr("transform"))),i.isPointInsidePath(n,e,t)},Jt.getBBox=function(e){if(this.removed)return{};var t=this._;return e?((t.dirty||!t.bboxwt)&&(this.realPath=gt[this.type](this),t.bboxwt=Ct(this.realPath),t.bboxwt.toString=m,t.dirty=0),t.bboxwt):((t.dirty||t.dirtyT||!t.bbox)&&((t.dirty||!this.realPath)&&(t.bboxwt=0,this.realPath=gt[this.type](this)),t.bbox=Ct(vt(this.realPath,this.matrix)),t.bbox.toString=m,t.dirty=t.dirtyT=0),t.bbox)},Jt.clone=function(){if(this.removed)return null;var e=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(e),e},Jt.glow=function(e){if("text"==this.type)return null;e=e||{};var t={width:(e.width||10)+(+this.attr("stroke-width")||1),fill:e.fill||!1,opacity:e.opacity||.5,offsetx:e.offsetx||0,offsety:e.offsety||0,color:e.color||"#000"},i=t.width/2,n=this.paper,r=n.set(),o=this.realPath||gt[this.type](this);o=this.matrix?vt(o,this.matrix):o;for(var s=1;i+1>s;s++)r.push(n.path(o).attr({stroke:t.color,fill:t.fill?t.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(t.width/i*s).toFixed(3),opacity:+(t.opacity/i).toFixed(3)}));return r.insertBefore(this).translate(t.offsetx,t.offsety)};var ii=function(e,t,n,r,o,s,a,l,u){return null==u?h(e,t,n,r,o,s,a,l):i.findDotsAtSegment(e,t,n,r,o,s,a,l,c(e,t,n,r,o,s,a,l,u))},ni=function(e,t){return function(n,r,o){n=zt(n);for(var s,a,l,h,c,u="",d={},p=0,f=0,m=n.length;m>f;f++){if(l=n[f],"M"==l[0])s=+l[1],a=+l[2];else{if(h=ii(s,a,l[1],l[2],l[3],l[4],l[5],l[6]),p+h>r){if(t&&!d.start){if(c=ii(s,a,l[1],l[2],l[3],l[4],l[5],l[6],r-p),u+=["C"+c.start.x,c.start.y,c.m.x,c.m.y,c.x,c.y],o)return u;d.start=u,u=["M"+c.x,c.y+"C"+c.n.x,c.n.y,c.end.x,c.end.y,l[5],l[6]].join(),p+=h,s=+l[5],a=+l[6];continue}if(!e&&!t)return c=ii(s,a,l[1],l[2],l[3],l[4],l[5],l[6],r-p),{x:c.x,y:c.y,alpha:c.alpha}}p+=h,s=+l[5],a=+l[6]}u+=l.shift()+l}return d.end=u,c=e?p:t?d:i.findDotsAtSegment(s,a,l[0],l[1],l[2],l[3],l[4],l[5],1),c.alpha&&(c={x:c.x,y:c.y,alpha:c.alpha}),c}},ri=ni(1),oi=ni(),si=ni(0,1);i.getTotalLength=ri,i.getPointAtLength=oi,i.getSubpath=function(e,t,i){if(this.getTotalLength(e)-i<1e-6)return si(e,t).end;var n=si(e,i,1);return t?si(n,t).end:n},Jt.getTotalLength=function(){var e=this.getPath();return e?this.node.getTotalLength?this.node.getTotalLength():ri(e):void 0},Jt.getPointAtLength=function(e){var t=this.getPath();return t?oi(t,e):void 0},Jt.getPath=function(){var e,t=i._getPath[this.type];return"text"!=this.type&&"set"!=this.type?(t&&(e=t(this)),e):void 0},Jt.getSubpath=function(e,t){var n=this.getPath();return n?i.getSubpath(n,e,t):void 0};var ai=i.easing_formulas={linear:function(e){return e},"<":function(e){return j(e,1.7)},">":function(e){return j(e,.48)},"<>":function(e){var t=.48-e/1.04,i=O.sqrt(.1734+t*t),n=i-t,r=j(U(n),1/3)*(0>n?-1:1),o=-i-t,s=j(U(o),1/3)*(0>o?-1:1),a=r+s+.5;return 3*(1-a)*a*a+a*a*a},backIn:function(e){var t=1.70158;return e*e*((t+1)*e-t)},backOut:function(e){e-=1;var t=1.70158;return e*e*((t+1)*e+t)+1},elastic:function(e){return e==!!e?e:j(2,-10*e)*O.sin(2*(e-.075)*W/.3)+1},bounce:function(e){var t,i=7.5625,n=2.75;return 1/n>e?t=i*e*e:2/n>e?(e-=1.5/n,t=i*e*e+.75):2.5/n>e?(e-=2.25/n,t=i*e*e+.9375):(e-=2.625/n,t=i*e*e+.984375),t}};ai.easeIn=ai["ease-in"]=ai["<"],ai.easeOut=ai["ease-out"]=ai[">"],ai.easeInOut=ai["ease-in-out"]=ai["<>"],ai["back-in"]=ai.backIn,ai["back-out"]=ai.backOut;var li=[],hi=e.requestAnimationFrame||e.webkitRequestAnimationFrame||e.mozRequestAnimationFrame||e.oRequestAnimationFrame||e.msRequestAnimationFrame||function(e){setTimeout(e,16)},ci=function(){for(var e=+new Date,n=0;n<li.length;n++){var r=li[n];if(!r.el.removed&&!r.paused){var o,s,a=e-r.start,l=r.ms,h=r.easing,c=r.from,u=r.diff,d=r.to,p=(r.t,r.el),f={},m={};if(r.initstatus?(a=(r.initstatus*r.anim.top-r.prev)/(r.percent-r.prev)*l,r.status=r.initstatus,delete r.initstatus,r.stop&&li.splice(n--,1)):r.status=(r.prev+(r.percent-r.prev)*(a/l))/r.anim.top,!(0>a))if(l>a){var g=h(a/l);for(var v in c)if(c[R](v)){switch(nt[v]){case $:o=+c[v]+g*l*u[v];break;case"colour":o="rgb("+[ui(J(c[v].r+g*l*u[v].r)),ui(J(c[v].g+g*l*u[v].g)),ui(J(c[v].b+g*l*u[v].b))].join(",")+")";break;case"path":o=[];for(var _=0,b=c[v].length;b>_;_++){o[_]=[c[v][_][0]];for(var E=1,x=c[v][_].length;x>E;E++)o[_][E]=+c[v][_][E]+g*l*u[v][_][E];o[_]=o[_].join(F)}o=o.join(F);break;case"transform":if(u[v].real)for(o=[],_=0,b=c[v].length;b>_;_++)for(o[_]=[c[v][_][0]],E=1,x=c[v][_].length;x>E;E++)o[_][E]=c[v][_][E]+g*l*u[v][_][E];else{var T=function(e){return+c[v][e]+g*l*u[v][e]};o=[["m",T(0),T(1),T(2),T(3),T(4),T(5)]]}break;case"csv":if("clip-rect"==v)for(o=[],_=4;_--;)o[_]=+c[v][_]+g*l*u[v][_];break;default:var w=[][k](c[v]);for(o=[],_=p.paper.customAttributes[v].length;_--;)o[_]=+w[_]+g*l*u[v][_]}f[v]=o}p.attr(f),function(e,i,n){setTimeout(function(){t("raphael.anim.frame."+e,i,n)})}(p.id,p,r.anim)}else{if(function(e,n,r){setTimeout(function(){t("raphael.anim.frame."+n.id,n,r),t("raphael.anim.finish."+n.id,n,r),i.is(e,"function")&&e.call(n)})}(r.callback,p,r.anim),p.attr(d),li.splice(n--,1),r.repeat>1&&!r.next){for(s in d)d[R](s)&&(m[s]=r.totalOrigin[s]);r.el.attr(m),y(r.anim,r.el,r.anim.percents[0],null,r.totalOrigin,r.repeat-1)}r.next&&!r.stop&&y(r.anim,r.el,r.next,null,r.totalOrigin,r.repeat)}}}i.svg&&p&&p.paper&&p.paper.safari(),li.length&&hi(ci)},ui=function(e){return e>255?255:0>e?0:e};Jt.animateWith=function(e,t,n,r,o,s){var a=this;if(a.removed)return s&&s.call(a),a;var l=n instanceof v?n:i.animation(n,r,o,s);y(l,a,l.percents[0],null,a.attr());for(var h=0,c=li.length;c>h;h++)if(li[h].anim==t&&li[h].el==e){li[c-1].start=li[h].start;break}return a},Jt.onAnimation=function(e){return e?t.on("raphael.anim.frame."+this.id,e):t.unbind("raphael.anim.frame."+this.id),this},v.prototype.delay=function(e){var t=new v(this.anim,this.ms);return t.times=this.times,t.del=+e||0,t},v.prototype.repeat=function(e){var t=new v(this.anim,this.ms);return t.del=this.del,t.times=O.floor(V(e,0))||1,t},i.animation=function(e,t,n,r){if(e instanceof v)return e;(i.is(n,"function")||!n)&&(r=r||n||null,n=null),e=Object(e),t=+t||0;var o,s,a={};for(s in e)e[R](s)&&Z(s)!=s&&Z(s)+"%"!=s&&(o=!0,a[s]=e[s]);return o?(n&&(a.easing=n),r&&(a.callback=r),new v({100:a},t)):new v(e,t)},Jt.animate=function(e,t,n,r){var o=this;if(o.removed)return r&&r.call(o),o;var s=e instanceof v?e:i.animation(e,t,n,r);return y(s,o,s.percents[0],null,o.attr()),o},Jt.setTime=function(e,t){return e&&null!=t&&this.status(e,B(t,e.ms)/e.ms),this},Jt.status=function(e,t){var i,n,r=[],o=0;if(null!=t)return y(e,this,-1,B(t,1)),this;for(i=li.length;i>o;o++)if(n=li[o],n.el.id==this.id&&(!e||n.anim==e)){if(e)return n.status;r.push({anim:n.anim,status:n.status})}return e?0:r},Jt.pause=function(e){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||e&&li[i].anim!=e||t("raphael.anim.pause."+this.id,this,li[i].anim)!==!1&&(li[i].paused=!0);return this},Jt.resume=function(e){for(var i=0;i<li.length;i++)if(li[i].el.id==this.id&&(!e||li[i].anim==e)){var n=li[i];t("raphael.anim.resume."+this.id,this,n.anim)!==!1&&(delete n.paused,this.status(n.anim,n.status))}return this},Jt.stop=function(e){for(var i=0;i<li.length;i++)li[i].el.id!=this.id||e&&li[i].anim!=e||t("raphael.anim.stop."+this.id,this,li[i].anim)!==!1&&li.splice(i--,1);return this},t.on("raphael.remove",_),t.on("raphael.clear",_),Jt.toString=function(){return"Raphals object"};var di=function(e){if(this.items=[],this.length=0,this.type="set",e)for(var t=0,i=e.length;i>t;t++)!e[t]||e[t].constructor!=Jt.constructor&&e[t].constructor!=di||(this[this.items.length]=this.items[this.items.length]=e[t],this.length++)},pi=di.prototype;pi.push=function(){for(var e,t,i=0,n=arguments.length;n>i;i++)e=arguments[i],!e||e.constructor!=Jt.constructor&&e.constructor!=di||(t=this.items.length,this[t]=this.items[t]=e,this.length++);return this},pi.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},pi.forEach=function(e,t){for(var i=0,n=this.items.length;n>i;i++)if(e.call(t,this.items[i],i)===!1)return this;return this};for(var fi in Jt)Jt[R](fi)&&(pi[fi]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e][M](i,t)})}}(fi));return pi.attr=function(e,t){if(e&&i.is(e,q)&&i.is(e[0],"object"))for(var n=0,r=e.length;r>n;n++)this.items[n].attr(e[n]);else for(var o=0,s=this.items.length;s>o;o++)this.items[o].attr(e,t);return this},pi.clear=function(){for(;this.length;)this.pop()},pi.splice=function(e,t){e=0>e?V(this.length+e,0):e,t=V(0,B(this.length-e,t));var i,n=[],r=[],o=[];for(i=2;i<arguments.length;i++)o.push(arguments[i]);for(i=0;t>i;i++)r.push(this[e+i]);for(;i<this.length-e;i++)n.push(this[e+i]);var s=o.length;for(i=0;i<s+n.length;i++)this.items[e+i]=this[e+i]=s>i?o[i]:n[i-s];for(i=this.items.length=this.length-=t-s;this[i];)delete this[i++];return new di(r)},pi.exclude=function(e){for(var t=0,i=this.length;i>t;t++)if(this[t]==e)return this.splice(t,1),!0},pi.animate=function(e,t,n,r){(i.is(n,"function")||!n)&&(r=n||null);var o,s,a=this.items.length,l=a,h=this;if(!a)return this;r&&(s=function(){!--a&&r.call(h)}),n=i.is(n,G)?n:s;var c=i.animation(e,t,n,s);for(o=this.items[--l].animate(c);l--;)this.items[l]&&!this.items[l].removed&&this.items[l].animateWith(o,c,c),this.items[l]&&!this.items[l].removed||a--;return this},pi.insertAfter=function(e){for(var t=this.items.length;t--;)this.items[t].insertAfter(e);return this},pi.getBBox=function(){for(var e=[],t=[],i=[],n=[],r=this.items.length;r--;)if(!this.items[r].removed){var o=this.items[r].getBBox();e.push(o.x),t.push(o.y),i.push(o.x+o.width),n.push(o.y+o.height)}return e=B[M](0,e),t=B[M](0,t),i=V[M](0,i),n=V[M](0,n),{x:e,y:t,x2:i,y2:n,width:i-e,height:n-t}},pi.clone=function(e){e=this.paper.set();for(var t=0,i=this.items.length;i>t;t++)e.push(this.items[t].clone());return e},pi.toString=function(){return"Raphals set"},pi.glow=function(e){var t=this.paper.set();return this.forEach(function(i){var n=i.glow(e);null!=n&&n.forEach(function(e){t.push(e)})}),t},pi.isPointInside=function(e,t){var i=!1;return this.forEach(function(n){return n.isPointInside(e,t)?(console.log("runned"),i=!0,!1):void 0}),i},i.registerFont=function(e){if(!e.face)return e;this.fonts=this.fonts||{};var t={w:e.w,face:{},glyphs:{}},i=e.face["font-family"];for(var n in e.face)e.face[R](n)&&(t.face[n]=e.face[n]);if(this.fonts[i]?this.fonts[i].push(t):this.fonts[i]=[t],!e.svg){t.face["units-per-em"]=et(e.face["units-per-em"],10);for(var r in e.glyphs)if(e.glyphs[R](r)){var o=e.glyphs[r];if(t.glyphs[r]={w:o.w,k:{},d:o.d&&"M"+o.d.replace(/[mlcxtrv]/g,function(e){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[e]||"M"})+"z"},o.k)for(var s in o.k)o[R](s)&&(t.glyphs[r].k[s]=o.k[s])}}return e},E.getFont=function(e,t,n,r){if(r=r||"normal",n=n||"normal",t=+t||{normal:400,bold:700,lighter:300,bolder:800}[t]||400,i.fonts){var o=i.fonts[e];if(!o){var s=new RegExp("(^|\\s)"+e.replace(/[^\w\d\s+!~.:_-]/g,P)+"(\\s|$)","i");for(var a in i.fonts)if(i.fonts[R](a)&&s.test(a)){o=i.fonts[a];break}}var l;if(o)for(var h=0,c=o.length;c>h&&(l=o[h],l.face["font-weight"]!=t||l.face["font-style"]!=n&&l.face["font-style"]||l.face["font-stretch"]!=r);h++);return l}},E.print=function(e,t,n,r,o,s,a,l){s=s||"middle",a=V(B(a||0,1),-1),l=V(B(l||1,3),1);var h,c=D(n)[N](P),u=0,d=0,p=P;if(i.is(r,"string")&&(r=this.getFont(r)),r){h=(o||16)/r.face["units-per-em"];for(var f=r.face.bbox[N](x),m=+f[0],g=f[3]-f[1],v=0,y=+f[1]+("baseline"==s?g+ +r.face.descent:g/2),_=0,b=c.length;b>_;_++){if("\n"==c[_])u=0,T=0,d=0,v+=g*l;else{var E=d&&r.glyphs[c[_-1]]||{},T=r.glyphs[c[_]];u+=d?(E.w||r.w)+(E.k&&E.k[c[_]]||0)+r.w*a:0,d=1}T&&T.d&&(p+=i.transformPath(T.d,["t",u*h,v*h,"s",h,h,m,y,"t",(e-m)/h,(t-y)/h]))}}return this.path(p).attr({fill:"#000",stroke:"none"})},E.add=function(e){if(i.is(e,"array"))for(var t,n=this.set(),r=0,o=e.length;o>r;r++)t=e[r]||{},T[R](t.type)&&n.push(this[t.type]().attr(t));return n},i.format=function(e,t){var n=i.is(t,q)?[0][k](t):arguments;return e&&i.is(e,G)&&n.length-1&&(e=e.replace(w,function(e,t){return null==n[++t]?P:n[t]})),e||P},i.fullfill=function(){var e=/\{([^\}]+)\}/g,t=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,i=function(e,i,n){var r=n;return i.replace(t,function(e,t,i,n,o){t=t||n,r&&(t in r&&(r=r[t]),"function"==typeof r&&o&&(r=r()))}),r=(null==r||r==n?e:r)+""};return function(t,n){return String(t).replace(e,function(e,t){return i(e,t,n)})}}(),i.ninja=function(){return C.was?S.win.Raphael=C.is:delete Raphael,i},i.st=pi,function(e,t,n){function r(){/in/.test(e.readyState)?setTimeout(r,9):i.eve("raphael.DOMload")}null==e.readyState&&e.addEventListener&&(e.addEventListener(t,n=function(){e.removeEventListener(t,n,!1),e.readyState="complete"},!1),e.readyState="loading"),r()}(document,"DOMContentLoaded"),t.on("raphael.DOMload",function(){b=!0}),function(){if(i.svg){var e="hasOwnProperty",t=String,n=parseFloat,r=parseInt,o=Math,s=o.max,a=o.abs,l=o.pow,h=/[, ]+/,c=i.eve,u="",d=" ",p="http://www.w3.org/1999/xlink",f={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},m={};i.toString=function(){return"Your browser supports SVG.\nYou are running Raphal "+this.version};var g=function(n,r){if(r){"string"==typeof n&&(n=g(n));for(var o in r)r[e](o)&&("xlink:"==o.substring(0,6)?n.setAttributeNS(p,o.substring(6),t(r[o])):n.setAttribute(o,t(r[o])))}else n=i._g.doc.createElementNS("http://www.w3.org/2000/svg",n),n.style&&(n.style.webkitTapHighlightColor="rgba(0,0,0,0)");return n},v=function(e,r){var h="linear",c=e.id+r,d=.5,p=.5,f=e.node,m=e.paper,v=f.style,y=i._g.doc.getElementById(c);if(!y){if(r=t(r).replace(i._radial_gradient,function(e,t,i){if(h="radial",t&&i){d=n(t),p=n(i);var r=2*(p>.5)-1;l(d-.5,2)+l(p-.5,2)>.25&&(p=o.sqrt(.25-l(d-.5,2))*r+.5)&&.5!=p&&(p=p.toFixed(5)-1e-5*r)}return u}),r=r.split(/\s*\-\s*/),"linear"==h){var _=r.shift();if(_=-n(_),isNaN(_))return null;var b=[0,0,o.cos(i.rad(_)),o.sin(i.rad(_))],E=1/(s(a(b[2]),a(b[3]))||1);b[2]*=E,b[3]*=E,b[2]<0&&(b[0]=-b[2],b[2]=0),b[3]<0&&(b[1]=-b[3],b[3]=0)}var x=i._parseDots(r);if(!x)return null;if(c=c.replace(/[\(\)\s,\xb0#]/g,"_"),e.gradient&&c!=e.gradient.id&&(m.defs.removeChild(e.gradient),delete e.gradient),!e.gradient){y=g(h+"Gradient",{id:c}),e.gradient=y,g(y,"radial"==h?{fx:d,fy:p}:{x1:b[0],y1:b[1],x2:b[2],y2:b[3],gradientTransform:e.matrix.invert()}),m.defs.appendChild(y);for(var T=0,w=x.length;w>T;T++)y.appendChild(g("stop",{offset:x[T].offset?x[T].offset:T?"100%":"0%","stop-color":x[T].color||"#fff"}))}}return g(f,{fill:"url(#"+c+")",opacity:1,"fill-opacity":1}),v.fill=u,v.opacity=1,v.fillOpacity=1,1},y=function(e){var t=e.getBBox(1);g(e.pattern,{patternTransform:e.matrix.invert()+" translate("+t.x+","+t.y+")"})},_=function(n,r,o){if("path"==n.type){for(var s,a,l,h,c,d=t(r).toLowerCase().split("-"),p=n.paper,v=o?"end":"start",y=n.node,_=n.attrs,b=_["stroke-width"],E=d.length,x="classic",T=3,w=3,R=5;E--;)switch(d[E]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":x=d[E];break;case"wide":w=5;break;case"narrow":w=2;break;case"long":T=5;break;case"short":T=2}if("open"==x?(T+=2,w+=2,R+=2,l=1,h=o?4:1,c={fill:"none",stroke:_.stroke}):(h=l=T/2,c={fill:_.stroke,stroke:"none"}),n._.arrows?o?(n._.arrows.endPath&&m[n._.arrows.endPath]--,n._.arrows.endMarker&&m[n._.arrows.endMarker]--):(n._.arrows.startPath&&m[n._.arrows.startPath]--,n._.arrows.startMarker&&m[n._.arrows.startMarker]--):n._.arrows={},"none"!=x){var S="raphael-marker-"+x,C="raphael-marker-"+v+x+T+w;i._g.doc.getElementById(S)?m[S]++:(p.defs.appendChild(g(g("path"),{"stroke-linecap":"round",d:f[x],id:S})),m[S]=1);var H,M=i._g.doc.getElementById(C);M?(m[C]++,H=M.getElementsByTagName("use")[0]):(M=g(g("marker"),{id:C,markerHeight:w,markerWidth:T,orient:"auto",refX:h,refY:w/2}),H=g(g("use"),{"xlink:href":"#"+S,transform:(o?"rotate(180 "+T/2+" "+w/2+") ":u)+"scale("+T/R+","+w/R+")","stroke-width":(1/((T/R+w/R)/2)).toFixed(4)}),M.appendChild(H),p.defs.appendChild(M),m[C]=1),g(H,c);var k=l*("diamond"!=x&&"oval"!=x);o?(s=n._.arrows.startdx*b||0,a=i.getTotalLength(_.path)-k*b):(s=k*b,a=i.getTotalLength(_.path)-(n._.arrows.enddx*b||0)),c={},c["marker-"+v]="url(#"+C+")",(a||s)&&(c.d=i.getSubpath(_.path,s,a)),g(y,c),n._.arrows[v+"Path"]=S,n._.arrows[v+"Marker"]=C,n._.arrows[v+"dx"]=k,n._.arrows[v+"Type"]=x,n._.arrows[v+"String"]=r}else o?(s=n._.arrows.startdx*b||0,a=i.getTotalLength(_.path)-s):(s=0,a=i.getTotalLength(_.path)-(n._.arrows.enddx*b||0)),n._.arrows[v+"Path"]&&g(y,{d:i.getSubpath(_.path,s,a)}),delete n._.arrows[v+"Path"],delete n._.arrows[v+"Marker"],delete n._.arrows[v+"dx"],delete n._.arrows[v+"Type"],delete n._.arrows[v+"String"];for(c in m)if(m[e](c)&&!m[c]){var A=i._g.doc.getElementById(c);A&&A.parentNode.removeChild(A)}}},b={"":[0],none:[0],"-":[3,1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},E=function(e,i,n){if(i=b[t(i).toLowerCase()]){for(var r=e.attrs["stroke-width"]||"1",o={round:r,square:r,butt:0}[e.attrs["stroke-linecap"]||n["stroke-linecap"]]||0,s=[],a=i.length;a--;)s[a]=i[a]*r+(a%2?1:-1)*o;g(e.node,{"stroke-dasharray":s.join(",")})}},x=function(n,o){var l=n.node,c=n.attrs,d=l.style.visibility;l.style.visibility="hidden";for(var f in o)if(o[e](f)){if(!i._availableAttrs[e](f))continue;var m=o[f];switch(c[f]=m,f){case"blur":n.blur(m);break;case"href":case"title":var b=g("title"),x=i._g.doc.createTextNode(m);b.appendChild(x),l.appendChild(b);break;case"target":var T=l.parentNode;if("a"!=T.tagName.toLowerCase()){var b=g("a");T.insertBefore(b,l),b.appendChild(l),T=b}"target"==f?T.setAttributeNS(p,"show","blank"==m?"new":m):T.setAttributeNS(p,f,m);break;case"cursor":l.style.cursor=m;break;case"transform":n.transform(m);break;case"arrow-start":_(n,m);break;case"arrow-end":_(n,m,1);break;case"clip-rect":var R=t(m).split(h);if(4==R.length){n.clip&&n.clip.parentNode.parentNode.removeChild(n.clip.parentNode);var S=g("clipPath"),C=g("rect");S.id=i.createUUID(),g(C,{x:R[0],y:R[1],width:R[2],height:R[3]}),S.appendChild(C),n.paper.defs.appendChild(S),g(l,{"clip-path":"url(#"+S.id+")"}),n.clip=C}if(!m){var H=l.getAttribute("clip-path");if(H){var M=i._g.doc.getElementById(H.replace(/(^url\(#|\)$)/g,u));M&&M.parentNode.removeChild(M),g(l,{"clip-path":u}),delete n.clip}}break;case"path":"path"==n.type&&(g(l,{d:m?c.path=i._pathToAbsolute(m):"M0,0"}),n._.dirty=1,n._.arrows&&("startString"in n._.arrows&&_(n,n._.arrows.startString),"endString"in n._.arrows&&_(n,n._.arrows.endString,1)));break;case"width":if(l.setAttribute(f,m),n._.dirty=1,!c.fx)break;f="x",m=c.x;case"x":c.fx&&(m=-c.x-(c.width||0));case"rx":if("rx"==f&&"rect"==n.type)break;case"cx":l.setAttribute(f,m),n.pattern&&y(n),n._.dirty=1;break;case"height":if(l.setAttribute(f,m),n._.dirty=1,!c.fy)break;f="y",m=c.y;case"y":c.fy&&(m=-c.y-(c.height||0));case"ry":if("ry"==f&&"rect"==n.type)break;case"cy":l.setAttribute(f,m),n.pattern&&y(n),n._.dirty=1;break;case"r":"rect"==n.type?g(l,{rx:m,ry:m}):l.setAttribute(f,m),n._.dirty=1;break;case"src":"image"==n.type&&l.setAttributeNS(p,"href",m);break;case"stroke-width":(1!=n._.sx||1!=n._.sy)&&(m/=s(a(n._.sx),a(n._.sy))||1),n.paper._vbSize&&(m*=n.paper._vbSize),l.setAttribute(f,m),c["stroke-dasharray"]&&E(n,c["stroke-dasharray"],o),n._.arrows&&("startString"in n._.arrows&&_(n,n._.arrows.startString),"endString"in n._.arrows&&_(n,n._.arrows.endString,1));break;case"stroke-dasharray":E(n,m,o);break;case"fill":var k=t(m).match(i._ISURL);if(k){S=g("pattern");var A=g("image");S.id=i.createUUID(),g(S,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),g(A,{x:0,y:0,"xlink:href":k[1]}),S.appendChild(A),function(e){i._preload(k[1],function(){var t=this.offsetWidth,i=this.offsetHeight;g(e,{width:t,height:i}),g(A,{width:t,height:i}),n.paper.safari()})}(S),n.paper.defs.appendChild(S),g(l,{fill:"url(#"+S.id+")"}),n.pattern=S,n.pattern&&y(n);break}var P=i.getRGB(m);if(P.error){if(("circle"==n.type||"ellipse"==n.type||"r"!=t(m).charAt())&&v(n,m)){if("opacity"in c||"fill-opacity"in c){var F=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u));if(F){var D=F.getElementsByTagName("stop");g(D[D.length-1],{"stop-opacity":("opacity"in c?c.opacity:1)*("fill-opacity"in c?c["fill-opacity"]:1)})}}c.gradient=m,c.fill="none";break}}else delete o.gradient,delete c.gradient,!i.is(c.opacity,"undefined")&&i.is(o.opacity,"undefined")&&g(l,{opacity:c.opacity}),!i.is(c["fill-opacity"],"undefined")&&i.is(o["fill-opacity"],"undefined")&&g(l,{"fill-opacity":c["fill-opacity"]});P[e]("opacity")&&g(l,{"fill-opacity":P.opacity>1?P.opacity/100:P.opacity});case"stroke":P=i.getRGB(m),l.setAttribute(f,P.hex),"stroke"==f&&P[e]("opacity")&&g(l,{"stroke-opacity":P.opacity>1?P.opacity/100:P.opacity}),"stroke"==f&&n._.arrows&&("startString"in n._.arrows&&_(n,n._.arrows.startString),"endString"in n._.arrows&&_(n,n._.arrows.endString,1));break;case"gradient":("circle"==n.type||"ellipse"==n.type||"r"!=t(m).charAt())&&v(n,m);break;case"opacity":c.gradient&&!c[e]("stroke-opacity")&&g(l,{"stroke-opacity":m>1?m/100:m});case"fill-opacity":if(c.gradient){F=i._g.doc.getElementById(l.getAttribute("fill").replace(/^url\(#|\)$/g,u)),F&&(D=F.getElementsByTagName("stop"),g(D[D.length-1],{"stop-opacity":m}));break}default:"font-size"==f&&(m=r(m,10)+"px");var N=f.replace(/(\-.)/g,function(e){return e.substring(1).toUpperCase()});l.style[N]=m,n._.dirty=1,l.setAttribute(f,m)}}w(n,o),l.style.visibility=d},T=1.2,w=function(n,o){if("text"==n.type&&(o[e]("text")||o[e]("font")||o[e]("font-size")||o[e]("x")||o[e]("y"))){var s=n.attrs,a=n.node,l=a.firstChild?r(i._g.doc.defaultView.getComputedStyle(a.firstChild,u).getPropertyValue("font-size"),10):10;if(o[e]("text")){for(s.text=o.text;a.firstChild;)a.removeChild(a.firstChild);for(var h,c=t(o.text).split("\n"),d=[],p=0,f=c.length;f>p;p++)h=g("tspan"),p&&g(h,{dy:l*T,x:s.x}),h.appendChild(i._g.doc.createTextNode(c[p])),a.appendChild(h),d[p]=h}else for(d=a.getElementsByTagName("tspan"),p=0,f=d.length;f>p;p++)p?g(d[p],{dy:l*T,x:s.x}):g(d[0],{dy:0});g(a,{x:s.x,y:s.y}),n._.dirty=1;var m=n._getBBox(),v=s.y-(m.y+m.height/2);v&&i.is(v,"finite")&&g(d[0],{dy:v})}},R=function(e,t){this[0]=this.node=e,e.raphael=!0,this.id=i._oid++,e.raphaelid=this.id,this.matrix=i.matrix(),this.realPath=null,this.paper=t,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},S=i.el;R.prototype=S,S.constructor=R,i._engine.path=function(e,t){var i=g("path");t.canvas&&t.canvas.appendChild(i);var n=new R(i,t);return n.type="path",x(n,{fill:"none",stroke:"#000",path:e}),n},S.rotate=function(e,i,r){if(this.removed)return this;if(e=t(e).split(h),e.length-1&&(i=n(e[1]),r=n(e[2])),e=n(e[0]),null==r&&(i=r),null==i||null==r){var o=this.getBBox(1);i=o.x+o.width/2,r=o.y+o.height/2}return this.transform(this._.transform.concat([["r",e,i,r]])),this},S.scale=function(e,i,r,o){if(this.removed)return this;if(e=t(e).split(h),e.length-1&&(i=n(e[1]),r=n(e[2]),o=n(e[3])),e=n(e[0]),null==i&&(i=e),null==o&&(r=o),null==r||null==o)var s=this.getBBox(1);return r=null==r?s.x+s.width/2:r,o=null==o?s.y+s.height/2:o,this.transform(this._.transform.concat([["s",e,i,r,o]])),this},S.translate=function(e,i){return this.removed?this:(e=t(e).split(h),e.length-1&&(i=n(e[1])),e=n(e[0])||0,i=+i||0,this.transform(this._.transform.concat([["t",e,i]])),this)},S.transform=function(t){var n=this._;if(null==t)return n.transform;if(i._extractTransform(this,t),this.clip&&g(this.clip,{transform:this.matrix.invert()}),this.pattern&&y(this),this.node&&g(this.node,{transform:this.matrix}),1!=n.sx||1!=n.sy){var r=this.attrs[e]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":r})}return this},S.hide=function(){return!this.removed&&this.paper.safari(this.node.style.display="none"),this},S.show=function(){return!this.removed&&this.paper.safari(this.node.style.display=""),this},S.remove=function(){if(!this.removed&&this.node.parentNode){var e=this.paper;e.__set__&&e.__set__.exclude(this),c.unbind("raphael.*.*."+this.id),this.gradient&&e.defs.removeChild(this.gradient),i._tear(this,e),"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.removeChild(this.node.parentNode):this.node.parentNode.removeChild(this.node);for(var t in this)this[t]="function"==typeof this[t]?i._removedFactory(t):null;this.removed=!0}},S._getBBox=function(){if("none"==this.node.style.display){this.show();var e=!0}var t={};try{t=this.node.getBBox()}catch(i){}finally{t=t||{}}return e&&this.hide(),t},S.attr=function(t,n){if(this.removed)return this;if(null==t){var r={};for(var o in this.attrs)this.attrs[e](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r}if(null==n&&i.is(t,"string")){if("fill"==t&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==t)return this._.transform;for(var s=t.split(h),a={},l=0,u=s.length;u>l;l++)t=s[l],a[t]=t in this.attrs?this.attrs[t]:i.is(this.paper.customAttributes[t],"function")?this.paper.customAttributes[t].def:i._availableAttrs[t];return u-1?a:a[s[0]]}if(null==n&&i.is(t,"array")){for(a={},l=0,u=t.length;u>l;l++)a[t[l]]=this.attr(t[l]);return a}if(null!=n){var d={};d[t]=n}else null!=t&&i.is(t,"object")&&(d=t);for(var p in d)c("raphael.attr."+p+"."+this.id,this,d[p]);for(p in this.paper.customAttributes)if(this.paper.customAttributes[e](p)&&d[e](p)&&i.is(this.paper.customAttributes[p],"function")){var f=this.paper.customAttributes[p].apply(this,[].concat(d[p]));this.attrs[p]=d[p];for(var m in f)f[e](m)&&(d[m]=f[m])}return x(this,d),this},S.toFront=function(){if(this.removed)return this;"a"==this.node.parentNode.tagName.toLowerCase()?this.node.parentNode.parentNode.appendChild(this.node.parentNode):this.node.parentNode.appendChild(this.node);var e=this.paper;return e.top!=this&&i._tofront(this,e),this},S.toBack=function(){if(this.removed)return this;var e=this.node.parentNode;return"a"==e.tagName.toLowerCase()?e.parentNode.insertBefore(this.node.parentNode,this.node.parentNode.parentNode.firstChild):e.firstChild!=this.node&&e.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper),this.paper,this},S.insertAfter=function(e){if(this.removed)return this;var t=e.node||e[e.length-1].node;return t.nextSibling?t.parentNode.insertBefore(this.node,t.nextSibling):t.parentNode.appendChild(this.node),i._insertafter(this,e,this.paper),this},S.insertBefore=function(e){if(this.removed)return this;var t=e.node||e[0].node;return t.parentNode.insertBefore(this.node,t),i._insertbefore(this,e,this.paper),this},S.blur=function(e){var t=this;if(0!==+e){var n=g("filter"),r=g("feGaussianBlur");t.attrs.blur=e,n.id=i.createUUID(),g(r,{stdDeviation:+e||1.5}),n.appendChild(r),t.paper.defs.appendChild(n),t._blur=n,g(t.node,{filter:"url(#"+n.id+")"})}else t._blur&&(t._blur.parentNode.removeChild(t._blur),delete t._blur,delete t.attrs.blur),t.node.removeAttribute("filter");return t},i._engine.circle=function(e,t,i,n){var r=g("circle");e.canvas&&e.canvas.appendChild(r);var o=new R(r,e);return o.attrs={cx:t,cy:i,r:n,fill:"none",stroke:"#000"},o.type="circle",g(r,o.attrs),o},i._engine.rect=function(e,t,i,n,r,o){var s=g("rect");e.canvas&&e.canvas.appendChild(s);var a=new R(s,e);return a.attrs={x:t,y:i,width:n,height:r,r:o||0,rx:o||0,ry:o||0,fill:"none",stroke:"#000"},a.type="rect",g(s,a.attrs),a},i._engine.ellipse=function(e,t,i,n,r){var o=g("ellipse");e.canvas&&e.canvas.appendChild(o);var s=new R(o,e);return s.attrs={cx:t,cy:i,rx:n,ry:r,fill:"none",stroke:"#000"},s.type="ellipse",g(o,s.attrs),s},i._engine.image=function(e,t,i,n,r,o){var s=g("image");g(s,{x:i,y:n,width:r,height:o,preserveAspectRatio:"none"}),s.setAttributeNS(p,"href",t),e.canvas&&e.canvas.appendChild(s);var a=new R(s,e);return a.attrs={x:i,y:n,width:r,height:o,src:t},a.type="image",a},i._engine.text=function(e,t,n,r){var o=g("text");e.canvas&&e.canvas.appendChild(o);var s=new R(o,e);return s.attrs={x:t,y:n,"text-anchor":"middle",text:r,font:i._availableAttrs.font,stroke:"none",fill:"#000"},s.type="text",x(s,s.attrs),s},i._engine.setSize=function(e,t){return this.width=e||this.width,this.height=t||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},i._engine.create=function(){var e=i._getContainer.apply(0,arguments),t=e&&e.container,n=e.x,r=e.y,o=e.width,s=e.height;if(!t)throw new Error("SVG container not found.");var a,l=g("svg"),h="overflow:hidden;";return n=n||0,r=r||0,o=o||512,s=s||342,g(l,{height:s,version:1.1,width:o,xmlns:"http://www.w3.org/2000/svg"}),1==t?(l.style.cssText=h+"position:absolute;left:"+n+"px;top:"+r+"px",i._g.doc.body.appendChild(l),a=1):(l.style.cssText=h+"position:relative",t.firstChild?t.insertBefore(l,t.firstChild):t.appendChild(l)),t=new i._Paper,t.width=o,t.height=s,t.canvas=l,t.clear(),t._left=t._top=0,a&&(t.renderfix=function(){}),t.renderfix(),t},i._engine.setViewBox=function(e,t,i,n,r){c("raphael.setViewBox",this,this._viewBox,[e,t,i,n,r]);var o,a,l=s(i/this.width,n/this.height),h=this.top,u=r?"meet":"xMinYMin";for(null==e?(this._vbSize&&(l=1),delete this._vbSize,o="0 0 "+this.width+d+this.height):(this._vbSize=l,o=e+d+t+d+i+d+n),g(this.canvas,{viewBox:o,preserveAspectRatio:u});l&&h;)a="stroke-width"in h.attrs?h.attrs["stroke-width"]:1,h.attr({"stroke-width":a}),h._.dirty=1,h._.dirtyT=1,h=h.prev;
return this._viewBox=[e,t,i,n,!!r],this},i.prototype.renderfix=function(){var e,t=this.canvas,i=t.style;try{e=t.getScreenCTM()||t.createSVGMatrix()}catch(n){e=t.createSVGMatrix()}var r=-e.e%1,o=-e.f%1;(r||o)&&(r&&(this._left=(this._left+r)%1,i.left=this._left+"px"),o&&(this._top=(this._top+o)%1,i.top=this._top+"px"))},i.prototype.clear=function(){i.eve("raphael.clear",this);for(var e=this.canvas;e.firstChild;)e.removeChild(e.firstChild);this.bottom=this.top=null,(this.desc=g("desc")).appendChild(i._g.doc.createTextNode("Created with Raphal "+i.version)),e.appendChild(this.desc),e.appendChild(this.defs=g("defs"))},i.prototype.remove=function(){c("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null};var C=i.st;for(var H in S)S[e](H)&&!C[e](H)&&(C[H]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e].apply(i,t)})}}(H))}}(),function(){if(i.vml){var e="hasOwnProperty",t=String,n=parseFloat,r=Math,o=r.round,s=r.max,a=r.min,l=r.abs,h="fill",c=/[, ]+/,u=i.eve,d=" progid:DXImageTransform.Microsoft",p=" ",f="",m={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},g=/([clmz]),?([^clmz]*)/gi,v=/ progid:\S+Blur\([^\)]+\)/g,y=/-?[^,\s-]+/g,_="position:absolute;left:0;top:0;width:1px;height:1px",b=21600,E={path:1,rect:1,image:1},x={circle:1,ellipse:1},T=function(e){var n=/[ahqstv]/gi,r=i._pathToAbsolute;if(t(e).match(n)&&(r=i._path2curve),n=/[clmz]/g,r==i._pathToAbsolute&&!t(e).match(n)){var s=t(e).replace(g,function(e,t,i){var n=[],r="m"==t.toLowerCase(),s=m[t];return i.replace(y,function(e){r&&2==n.length&&(s+=n+m["m"==t?"l":"L"],n=[]),n.push(o(e*b))}),s+n});return s}var a,l,h=r(e);s=[];for(var c=0,u=h.length;u>c;c++){a=h[c],l=h[c][0].toLowerCase(),"z"==l&&(l="x");for(var d=1,v=a.length;v>d;d++)l+=o(a[d]*b)+(d!=v-1?",":f);s.push(l)}return s.join(p)},w=function(e,t,n){var r=i.matrix();return r.rotate(-e,.5,.5),{dx:r.x(t,n),dy:r.y(t,n)}},R=function(e,t,i,n,r,o){var s=e._,a=e.matrix,c=s.fillpos,u=e.node,d=u.style,f=1,m="",g=b/t,v=b/i;if(d.visibility="hidden",t&&i){if(u.coordsize=l(g)+p+l(v),d.rotation=o*(0>t*i?-1:1),o){var y=w(o,n,r);n=y.dx,r=y.dy}if(0>t&&(m+="x"),0>i&&(m+=" y")&&(f=-1),d.flip=m,u.coordorigin=n*-g+p+r*-v,c||s.fillsize){var _=u.getElementsByTagName(h);_=_&&_[0],u.removeChild(_),c&&(y=w(o,a.x(c[0],c[1]),a.y(c[0],c[1])),_.position=y.dx*f+p+y.dy*f),s.fillsize&&(_.size=s.fillsize[0]*l(t)+p+s.fillsize[1]*l(i)),u.appendChild(_)}d.visibility="visible"}};i.toString=function(){return"Your browser doesnt support SVG. Falling down to VML.\nYou are running Raphal "+this.version};var S=function(e,i,n){for(var r=t(i).toLowerCase().split("-"),o=n?"end":"start",s=r.length,a="classic",l="medium",h="medium";s--;)switch(r[s]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":a=r[s];break;case"wide":case"narrow":h=r[s];break;case"long":case"short":l=r[s]}var c=e.node.getElementsByTagName("stroke")[0];c[o+"arrow"]=a,c[o+"arrowlength"]=l,c[o+"arrowwidth"]=h},C=function(r,l){r.attrs=r.attrs||{};var u=r.node,d=r.attrs,m=u.style,g=E[r.type]&&(l.x!=d.x||l.y!=d.y||l.width!=d.width||l.height!=d.height||l.cx!=d.cx||l.cy!=d.cy||l.rx!=d.rx||l.ry!=d.ry||l.r!=d.r),v=x[r.type]&&(d.cx!=l.cx||d.cy!=l.cy||d.r!=l.r||d.rx!=l.rx||d.ry!=l.ry),y=r;for(var _ in l)l[e](_)&&(d[_]=l[_]);if(g&&(d.path=i._getPath[r.type](r),r._.dirty=1),l.href&&(u.href=l.href),l.title&&(u.title=l.title),l.target&&(u.target=l.target),l.cursor&&(m.cursor=l.cursor),"blur"in l&&r.blur(l.blur),(l.path&&"path"==r.type||g)&&(u.path=T(~t(d.path).toLowerCase().indexOf("r")?i._pathToAbsolute(d.path):d.path),"image"==r.type&&(r._.fillpos=[d.x,d.y],r._.fillsize=[d.width,d.height],R(r,1,1,0,0,0))),"transform"in l&&r.transform(l.transform),v){var w=+d.cx,C=+d.cy,M=+d.rx||+d.r||0,k=+d.ry||+d.r||0;u.path=i.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",o((w-M)*b),o((C-k)*b),o((w+M)*b),o((C+k)*b),o(w*b)),r._.dirty=1}if("clip-rect"in l){var P=t(l["clip-rect"]).split(c);if(4==P.length){P[2]=+P[2]+ +P[0],P[3]=+P[3]+ +P[1];var F=u.clipRect||i._g.doc.createElement("div"),D=F.style;D.clip=i.format("rect({1}px {2}px {3}px {0}px)",P),u.clipRect||(D.position="absolute",D.top=0,D.left=0,D.width=r.paper.width+"px",D.height=r.paper.height+"px",u.parentNode.insertBefore(F,u),F.appendChild(u),u.clipRect=F)}l["clip-rect"]||u.clipRect&&(u.clipRect.style.clip="auto")}if(r.textpath){var N=r.textpath.style;l.font&&(N.font=l.font),l["font-family"]&&(N.fontFamily='"'+l["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,f)+'"'),l["font-size"]&&(N.fontSize=l["font-size"]),l["font-weight"]&&(N.fontWeight=l["font-weight"]),l["font-style"]&&(N.fontStyle=l["font-style"])}if("arrow-start"in l&&S(y,l["arrow-start"]),"arrow-end"in l&&S(y,l["arrow-end"],1),null!=l.opacity||null!=l["stroke-width"]||null!=l.fill||null!=l.src||null!=l.stroke||null!=l["stroke-width"]||null!=l["stroke-opacity"]||null!=l["fill-opacity"]||null!=l["stroke-dasharray"]||null!=l["stroke-miterlimit"]||null!=l["stroke-linejoin"]||null!=l["stroke-linecap"]){var z=u.getElementsByTagName(h),L=!1;if(z=z&&z[0],!z&&(L=z=A(h)),"image"==r.type&&l.src&&(z.src=l.src),l.fill&&(z.on=!0),(null==z.on||"none"==l.fill||null===l.fill)&&(z.on=!1),z.on&&l.fill){var I=t(l.fill).match(i._ISURL);if(I){z.parentNode==u&&u.removeChild(z),z.rotate=!0,z.src=I[1],z.type="tile";var O=r.getBBox(1);z.position=O.x+p+O.y,r._.fillpos=[O.x,O.y],i._preload(I[1],function(){r._.fillsize=[this.offsetWidth,this.offsetHeight]})}else z.color=i.getRGB(l.fill).hex,z.src=f,z.type="solid",i.getRGB(l.fill).error&&(y.type in{circle:1,ellipse:1}||"r"!=t(l.fill).charAt())&&H(y,l.fill,z)&&(d.fill="none",d.gradient=l.fill,z.rotate=!1)}if("fill-opacity"in l||"opacity"in l){var V=((+d["fill-opacity"]+1||2)-1)*((+d.opacity+1||2)-1)*((+i.getRGB(l.fill).o+1||2)-1);V=a(s(V,0),1),z.opacity=V,z.src&&(z.color="none")}u.appendChild(z);var B=u.getElementsByTagName("stroke")&&u.getElementsByTagName("stroke")[0],U=!1;!B&&(U=B=A("stroke")),(l.stroke&&"none"!=l.stroke||l["stroke-width"]||null!=l["stroke-opacity"]||l["stroke-dasharray"]||l["stroke-miterlimit"]||l["stroke-linejoin"]||l["stroke-linecap"])&&(B.on=!0),("none"==l.stroke||null===l.stroke||null==B.on||0==l.stroke||0==l["stroke-width"])&&(B.on=!1);var j=i.getRGB(l.stroke);B.on&&l.stroke&&(B.color=j.hex),V=((+d["stroke-opacity"]+1||2)-1)*((+d.opacity+1||2)-1)*((+j.o+1||2)-1);var W=.75*(n(l["stroke-width"])||1);if(V=a(s(V,0),1),null==l["stroke-width"]&&(W=d["stroke-width"]),l["stroke-width"]&&(B.weight=W),W&&1>W&&(V*=W)&&(B.weight=1),B.opacity=V,l["stroke-linejoin"]&&(B.joinstyle=l["stroke-linejoin"]||"miter"),B.miterlimit=l["stroke-miterlimit"]||8,l["stroke-linecap"]&&(B.endcap="butt"==l["stroke-linecap"]?"flat":"square"==l["stroke-linecap"]?"square":"round"),l["stroke-dasharray"]){var $={"-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};B.dashstyle=$[e](l["stroke-dasharray"])?$[l["stroke-dasharray"]]:f}U&&u.appendChild(B)}if("text"==y.type){y.paper.canvas.style.display=f;var G=y.paper.span,q=100,X=d.font&&d.font.match(/\d+(?:\.\d*)?(?=px)/);m=G.style,d.font&&(m.font=d.font),d["font-family"]&&(m.fontFamily=d["font-family"]),d["font-weight"]&&(m.fontWeight=d["font-weight"]),d["font-style"]&&(m.fontStyle=d["font-style"]),X=n(d["font-size"]||X&&X[0])||10,m.fontSize=X*q+"px",y.textpath.string&&(G.innerHTML=t(y.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var Y=G.getBoundingClientRect();y.W=d.w=(Y.right-Y.left)/q,y.H=d.h=(Y.bottom-Y.top)/q,y.X=d.x,y.Y=d.y+y.H/2,("x"in l||"y"in l)&&(y.path.v=i.format("m{0},{1}l{2},{1}",o(d.x*b),o(d.y*b),o(d.x*b)+1));for(var K=["x","y","text","font","font-family","font-weight","font-style","font-size"],Q=0,J=K.length;J>Q;Q++)if(K[Q]in l){y._.dirty=1;break}switch(d["text-anchor"]){case"start":y.textpath.style["v-text-align"]="left",y.bbx=y.W/2;break;case"end":y.textpath.style["v-text-align"]="right",y.bbx=-y.W/2;break;default:y.textpath.style["v-text-align"]="center",y.bbx=0}y.textpath.style["v-text-kern"]=!0}},H=function(e,o,s){e.attrs=e.attrs||{};var a=(e.attrs,Math.pow),l="linear",h=".5 .5";if(e.attrs.gradient=o,o=t(o).replace(i._radial_gradient,function(e,t,i){return l="radial",t&&i&&(t=n(t),i=n(i),a(t-.5,2)+a(i-.5,2)>.25&&(i=r.sqrt(.25-a(t-.5,2))*(2*(i>.5)-1)+.5),h=t+p+i),f}),o=o.split(/\s*\-\s*/),"linear"==l){var c=o.shift();if(c=-n(c),isNaN(c))return null}var u=i._parseDots(o);if(!u)return null;if(e=e.shape||e.node,u.length){e.removeChild(s),s.on=!0,s.method="none",s.color=u[0].color,s.color2=u[u.length-1].color;for(var d=[],m=0,g=u.length;g>m;m++)u[m].offset&&d.push(u[m].offset+p+u[m].color);s.colors=d.length?d.join():"0% "+s.color,"radial"==l?(s.type="gradientTitle",s.focus="100%",s.focussize="0 0",s.focusposition=h,s.angle=0):(s.type="gradient",s.angle=(270-c)%360),e.appendChild(s)}return 1},M=function(e,t){this[0]=this.node=e,e.raphael=!0,this.id=i._oid++,e.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=t,this.matrix=i.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!t.bottom&&(t.bottom=this),this.prev=t.top,t.top&&(t.top.next=this),t.top=this,this.next=null},k=i.el;M.prototype=k,k.constructor=M,k.transform=function(e){if(null==e)return this._.transform;var n,r=this.paper._viewBoxShift,o=r?"s"+[r.scale,r.scale]+"-1-1t"+[r.dx,r.dy]:f;r&&(n=e=t(e).replace(/\.{3}|\u2026/g,this._.transform||f)),i._extractTransform(this,o+e);var s,a=this.matrix.clone(),l=this.skew,h=this.node,c=~t(this.attrs.fill).indexOf("-"),u=!t(this.attrs.fill).indexOf("url(");if(a.translate(1,1),u||c||"image"==this.type)if(l.matrix="1 0 0 1",l.offset="0 0",s=a.split(),c&&s.noRotation||!s.isSimple){h.style.filter=a.toFilter();var d=this.getBBox(),m=this.getBBox(1),g=d.x-m.x,v=d.y-m.y;h.coordorigin=g*-b+p+v*-b,R(this,1,1,g,v,0)}else h.style.filter=f,R(this,s.scalex,s.scaley,s.dx,s.dy,s.rotate);else h.style.filter=f,l.matrix=t(a),l.offset=a.offset();return n&&(this._.transform=n),this},k.rotate=function(e,i,r){if(this.removed)return this;if(null!=e){if(e=t(e).split(c),e.length-1&&(i=n(e[1]),r=n(e[2])),e=n(e[0]),null==r&&(i=r),null==i||null==r){var o=this.getBBox(1);i=o.x+o.width/2,r=o.y+o.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",e,i,r]])),this}},k.translate=function(e,i){return this.removed?this:(e=t(e).split(c),e.length-1&&(i=n(e[1])),e=n(e[0])||0,i=+i||0,this._.bbox&&(this._.bbox.x+=e,this._.bbox.y+=i),this.transform(this._.transform.concat([["t",e,i]])),this)},k.scale=function(e,i,r,o){if(this.removed)return this;if(e=t(e).split(c),e.length-1&&(i=n(e[1]),r=n(e[2]),o=n(e[3]),isNaN(r)&&(r=null),isNaN(o)&&(o=null)),e=n(e[0]),null==i&&(i=e),null==o&&(r=o),null==r||null==o)var s=this.getBBox(1);return r=null==r?s.x+s.width/2:r,o=null==o?s.y+s.height/2:o,this.transform(this._.transform.concat([["s",e,i,r,o]])),this._.dirtyT=1,this},k.hide=function(){return!this.removed&&(this.node.style.display="none"),this},k.show=function(){return!this.removed&&(this.node.style.display=f),this},k._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},k.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),i.eve.unbind("raphael.*.*."+this.id),i._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;this.removed=!0}},k.attr=function(t,n){if(this.removed)return this;if(null==t){var r={};for(var o in this.attrs)this.attrs[e](o)&&(r[o]=this.attrs[o]);return r.gradient&&"none"==r.fill&&(r.fill=r.gradient)&&delete r.gradient,r.transform=this._.transform,r}if(null==n&&i.is(t,"string")){if(t==h&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var s=t.split(c),a={},l=0,d=s.length;d>l;l++)t=s[l],a[t]=t in this.attrs?this.attrs[t]:i.is(this.paper.customAttributes[t],"function")?this.paper.customAttributes[t].def:i._availableAttrs[t];return d-1?a:a[s[0]]}if(this.attrs&&null==n&&i.is(t,"array")){for(a={},l=0,d=t.length;d>l;l++)a[t[l]]=this.attr(t[l]);return a}var p;null!=n&&(p={},p[t]=n),null==n&&i.is(t,"object")&&(p=t);for(var f in p)u("raphael.attr."+f+"."+this.id,this,p[f]);if(p){for(f in this.paper.customAttributes)if(this.paper.customAttributes[e](f)&&p[e](f)&&i.is(this.paper.customAttributes[f],"function")){var m=this.paper.customAttributes[f].apply(this,[].concat(p[f]));this.attrs[f]=p[f];for(var g in m)m[e](g)&&(p[g]=m[g])}p.text&&"text"==this.type&&(this.textpath.string=p.text),C(this,p)}return this},k.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&i._tofront(this,this.paper),this},k.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),i._toback(this,this.paper)),this)},k.insertAfter=function(e){return this.removed?this:(e.constructor==i.st.constructor&&(e=e[e.length-1]),e.node.nextSibling?e.node.parentNode.insertBefore(this.node,e.node.nextSibling):e.node.parentNode.appendChild(this.node),i._insertafter(this,e,this.paper),this)},k.insertBefore=function(e){return this.removed?this:(e.constructor==i.st.constructor&&(e=e[0]),e.node.parentNode.insertBefore(this.node,e.node),i._insertbefore(this,e,this.paper),this)},k.blur=function(e){var t=this.node.runtimeStyle,n=t.filter;return n=n.replace(v,f),0!==+e?(this.attrs.blur=e,t.filter=n+p+d+".Blur(pixelradius="+(+e||1.5)+")",t.margin=i.format("-{0}px 0 0 -{0}px",o(+e||1.5))):(t.filter=n,t.margin=0,delete this.attrs.blur),this},i._engine.path=function(e,t){var i=A("shape");i.style.cssText=_,i.coordsize=b+p+b,i.coordorigin=t.coordorigin;var n=new M(i,t),r={fill:"none",stroke:"#000"};e&&(r.path=e),n.type="path",n.path=[],n.Path=f,C(n,r),t.canvas.appendChild(i);var o=A("skew");return o.on=!0,i.appendChild(o),n.skew=o,n.transform(f),n},i._engine.rect=function(e,t,n,r,o,s){var a=i._rectPath(t,n,r,o,s),l=e.path(a),h=l.attrs;return l.X=h.x=t,l.Y=h.y=n,l.W=h.width=r,l.H=h.height=o,h.r=s,h.path=a,l.type="rect",l},i._engine.ellipse=function(e,t,i,n,r){var o=e.path();return o.attrs,o.X=t-n,o.Y=i-r,o.W=2*n,o.H=2*r,o.type="ellipse",C(o,{cx:t,cy:i,rx:n,ry:r}),o},i._engine.circle=function(e,t,i,n){var r=e.path();return r.attrs,r.X=t-n,r.Y=i-n,r.W=r.H=2*n,r.type="circle",C(r,{cx:t,cy:i,r:n}),r},i._engine.image=function(e,t,n,r,o,s){var a=i._rectPath(n,r,o,s),l=e.path(a).attr({stroke:"none"}),c=l.attrs,u=l.node,d=u.getElementsByTagName(h)[0];return c.src=t,l.X=c.x=n,l.Y=c.y=r,l.W=c.width=o,l.H=c.height=s,c.path=a,l.type="image",d.parentNode==u&&u.removeChild(d),d.rotate=!0,d.src=t,d.type="tile",l._.fillpos=[n,r],l._.fillsize=[o,s],u.appendChild(d),R(l,1,1,0,0,0),l},i._engine.text=function(e,n,r,s){var a=A("shape"),l=A("path"),h=A("textpath");n=n||0,r=r||0,s=s||"",l.v=i.format("m{0},{1}l{2},{1}",o(n*b),o(r*b),o(n*b)+1),l.textpathok=!0,h.string=t(s),h.on=!0,a.style.cssText=_,a.coordsize=b+p+b,a.coordorigin="0 0";var c=new M(a,e),u={fill:"#000",stroke:"none",font:i._availableAttrs.font,text:s};c.shape=a,c.path=l,c.textpath=h,c.type="text",c.attrs.text=t(s),c.attrs.x=n,c.attrs.y=r,c.attrs.w=1,c.attrs.h=1,C(c,u),a.appendChild(h),a.appendChild(l),e.canvas.appendChild(a);var d=A("skew");return d.on=!0,a.appendChild(d),c.skew=d,c.transform(f),c},i._engine.setSize=function(e,t){var n=this.canvas.style;return this.width=e,this.height=t,e==+e&&(e+="px"),t==+t&&(t+="px"),n.width=e,n.height=t,n.clip="rect(0 "+e+" "+t+" 0)",this._viewBox&&i._engine.setViewBox.apply(this,this._viewBox),this},i._engine.setViewBox=function(e,t,n,r,o){i.eve("raphael.setViewBox",this,this._viewBox,[e,t,n,r,o]);var a,l,h=this.width,c=this.height,u=1/s(n/h,r/c);return o&&(a=c/r,l=h/n,h>n*a&&(e-=(h-n*a)/2/a),c>r*l&&(t-=(c-r*l)/2/l)),this._viewBox=[e,t,n,r,!!o],this._viewBoxShift={dx:-e,dy:-t,scale:u},this.forEach(function(e){e.transform("...")}),this};var A;i._engine.initWin=function(e){var t=e.document;t.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)");try{!t.namespaces.rvml&&t.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),A=function(e){return t.createElement("<rvml:"+e+' class="rvml">')}}catch(i){A=function(e){return t.createElement("<"+e+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},i._engine.initWin(i._g.win),i._engine.create=function(){var e=i._getContainer.apply(0,arguments),t=e.container,n=e.height,r=e.width,o=e.x,s=e.y;if(!t)throw new Error("VML container not found.");var a=new i._Paper,l=a.canvas=i._g.doc.createElement("div"),h=l.style;return o=o||0,s=s||0,r=r||512,n=n||342,a.width=r,a.height=n,r==+r&&(r+="px"),n==+n&&(n+="px"),a.coordsize=1e3*b+p+1e3*b,a.coordorigin="0 0",a.span=i._g.doc.createElement("span"),a.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",l.appendChild(a.span),h.cssText=i.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",r,n),1==t?(i._g.doc.body.appendChild(l),h.left=o+"px",h.top=s+"px",h.position="absolute"):t.firstChild?t.insertBefore(l,t.firstChild):t.appendChild(l),a.renderfix=function(){},a},i.prototype.clear=function(){i.eve("raphael.clear",this),this.canvas.innerHTML=f,this.span=i._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},i.prototype.remove=function(){i.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var e in this)this[e]="function"==typeof this[e]?i._removedFactory(e):null;return!0};var P=i.st;for(var F in k)k[e](F)&&!P[e](F)&&(P[F]=function(e){return function(){var t=arguments;return this.forEach(function(i){i[e].apply(i,t)})}}(F))}}(),C.was?S.win.Raphael=i:Raphael=i,i}),function(e,t,i,n,r){function o(t){t=t.split(")");var i,r,o,s=e.trim,a=-1,l=t.length-1,h=T?new Float32Array(6):[],c=T?new Float32Array(6):[],u=T?new Float32Array(6):[1,0,0,1,0,0];for(h[0]=h[3]=u[0]=u[3]=1,h[1]=h[2]=h[4]=h[5]=0;++a<l;){switch(i=t[a].split("("),r=s(i[0]),o=i[1],c[0]=c[3]=1,c[1]=c[2]=c[4]=c[5]=0,r){case H+"X":c[4]=parseInt(o,10);break;case H+"Y":c[5]=parseInt(o,10);break;case H:o=o.split(","),c[4]=parseInt(o[0],10),c[5]=parseInt(o[1]||0,10);break;case M:o=d(o),c[0]=n.cos(o),c[1]=n.sin(o),c[2]=-n.sin(o),c[3]=n.cos(o);break;case k+"X":c[0]=+o;break;case k+"Y":c[3]=o;break;case k:o=o.split(","),c[0]=o[0],c[3]=o.length>1?o[1]:o[0];break;case A+"X":c[2]=n.tan(d(o));break;case A+"Y":c[1]=n.tan(d(o));break;case P:o=o.split(","),c[0]=o[0],c[1]=o[1],c[2]=o[2],c[3]=o[3],c[4]=parseInt(o[4],10),c[5]=parseInt(o[5],10)}u[0]=h[0]*c[0]+h[2]*c[1],u[1]=h[1]*c[0]+h[3]*c[1],u[2]=h[0]*c[2]+h[2]*c[3],u[3]=h[1]*c[2]+h[3]*c[3],u[4]=h[0]*c[4]+h[2]*c[5]+h[4],u[5]=h[1]*c[4]+h[3]*c[5]+h[5],h=[u[0],u[1],u[2],u[3],u[4],u[5]]}return u}function s(e){var t,i,r,o=e[0],s=e[1],a=e[2],l=e[3];return o*l-s*a?(t=n.sqrt(o*o+s*s),o/=t,s/=t,r=o*a+s*l,a-=o*r,l-=s*r,i=n.sqrt(a*a+l*l),a/=i,l/=i,r/=i,s*a>o*l&&(o=-o,s=-s,r=-r,t=-t)):t=i=r=0,[[H,[+e[4],+e[5]]],[M,n.atan2(s,o)],[A+"X",n.atan(r)],[k,[t,i]]]}function a(t,i){var n,r,a,d,f={start:[],end:[]},m=-1;if(("none"==t||h(t))&&(t=""),("none"==i||h(i))&&(i=""),t&&i&&!i.indexOf("matrix")&&p(t).join()==p(i.split(")")[0]).join()&&(f.origin=t,t="",i=i.slice(i.indexOf(")")+1)),t||i){if(t&&i&&c(t)!=c(i))f.start=s(o(t)),f.end=s(o(i));else for(t&&(t=t.split(")"))&&(n=t.length),i&&(i=i.split(")"))&&(n=i.length);++m<n-1;)t[m]&&(r=t[m].split("(")),i[m]&&(a=i[m].split("(")),d=e.trim((r||a)[0]),u(f.start,l(d,r?r[1]:0)),u(f.end,l(d,a?a[1]:0));return f}}function l(e,t){var i,n=+!e.indexOf(k),r=e.replace(/e[XY]/,"e");switch(e){case H+"Y":case k+"Y":t=[n,t?parseFloat(t):n];break;case H+"X":case H:case k+"X":i=1;case k:t=t?(t=t.split(","))&&[parseFloat(t[0]),parseFloat(t.length>1?t[1]:e==k?i||t[0]:n+"")]:[n,n];break;case A+"X":case A+"Y":case M:t=t?d(t):0;break;case P:return s(t?p(t):[1,0,0,1,0,0])}return[[r,t]]}function h(e){return R.test(e)}function c(e){return e.replace(/(?:\([^)]*\))|\s/g,"")}function u(e,t,i){for(;i=t.shift();)e.push(i)}function d(e){return~e.indexOf("deg")?parseInt(e,10)*(2*n.PI/360):~e.indexOf("grad")?parseInt(e,10)*(n.PI/200):parseFloat(e)}function p(e){return e=/([^,]*),([^,]*),([^,]*),([^,]*),([^,p]*)(?:px)?,([^)p]*)(?:px)?/.exec(e),[e[1],e[2],e[3],e[4],e[5],e[6]]}for(var f,m,g,v,y=i.createElement("div"),_=y.style,b="Transform",E=["O"+b,"ms"+b,"Webkit"+b,"Moz"+b],x=E.length,T=("Float32Array"in t),w=/Matrix([^)]*)/,R=/^\s*matrix\(\s*1\s*,\s*0\s*,\s*0\s*,\s*1\s*(?:,\s*0(?:px)?\s*){2}\)\s*$/,S="transform",C="transformOrigin",H="translate",M="rotate",k="scale",A="skew",P="matrix";x--;)E[x]in _&&(e.support[S]=f=E[x],e.support[C]=f+"Origin");f||(e.support.matrixFilter=m=""===_.filter),e.cssNumber[S]=e.cssNumber[C]=!0,f&&f!=S?(e.cssProps[S]=f,e.cssProps[C]=f+"Origin",f=="Moz"+b?g={get:function(t,i){return i?e.css(t,f).split("px").join(""):t.style[f]},set:function(e,t){e.style[f]=/matrix\([^)p]*\)/.test(t)?t.replace(/matrix((?:[^,]*,){4})([^,]*),([^)]*)/,P+"$1$2px,$3px"):t}}:/^1\.[0-5](?:\.|$)/.test(e.fn.jquery)&&(g={get:function(t,i){return i?e.css(t,f.replace(/^ms/,"Ms")):t.style[f]}})):m&&(g={get:function(t,i,n){var o,s,a=i&&t.currentStyle?t.currentStyle:t.style;return a&&w.test(a.filter)?(o=RegExp.$1.split(","),o=[o[0].split("=")[1],o[2].split("=")[1],o[1].split("=")[1],o[3].split("=")[1]]):o=[1,0,0,1],e.cssHooks[C]?(s=e._data(t,"transformTranslate",r),o[4]=s?s[0]:0,o[5]=s?s[1]:0):(o[4]=a?parseInt(a.left,10)||0:0,o[5]=a?parseInt(a.top,10)||0:0),n?o:P+"("+o+")"},set:function(t,i,n){var r,s,a,l,h=t.style;n||(h.zoom=1),i=o(i),s=["Matrix(M11="+i[0],"M12="+i[2],"M21="+i[1],"M22="+i[3],"SizingMethod='auto expand'"].join(),a=(r=t.currentStyle)&&r.filter||h.filter||"",h.filter=w.test(a)?a.replace(w,s):a+" progid:DXImageTransform.Microsoft."+s+")",e.cssHooks[C]?e.cssHooks[C].set(t,i):((l=e.transform.centerOrigin)&&(h["margin"==l?"marginLeft":"left"]=-(t.offsetWidth/2)+t.clientWidth/2+"px",h["margin"==l?"marginTop":"top"]=-(t.offsetHeight/2)+t.clientHeight/2+"px"),h.left=i[4]+"px",h.top=i[5]+"px")}}),g&&(e.cssHooks[S]=g),v=g&&g.get||e.css,e.fx.step.transform=function(t){var i,r,o,s,l=t.elem,h=t.start,c=t.end,u=t.pos,d="",p=1e5;for(h&&"string"!=typeof h||(h||(h=v(l,f)),m&&(l.style.zoom=1),c=c.split("+=").join(h),e.extend(t,a(h,c)),h=t.start,c=t.end),i=h.length;i--;)switch(r=h[i],o=c[i],s=0,r[0]){case H:s="px";case k:s||(s=""),d=r[0]+"("+n.round((r[1][0]+(o[1][0]-r[1][0])*u)*p)/p+s+","+n.round((r[1][1]+(o[1][1]-r[1][1])*u)*p)/p+s+")"+d;break;case A+"X":case A+"Y":case M:d=r[0]+"("+n.round((r[1]+(o[1]-r[1])*u)*p)/p+"rad)"+d}t.origin&&(d=t.origin+d),g&&g.set?g.set(l,d,1):l.style[f]=d},e.transform={centerOrigin:"margin"}}(jQuery,window,document,Math),define("libs/jquery.transform2d",function(){}),function(){function e(){this.initialize.apply(this,arguments)}e.prototype={initialize:function(e,t){var i=-1!=navigator.userAgent.indexOf("Gecko/"),n=-1!=navigator.userAgent.indexOf("Opera/"),r=-1!=navigator.userAgent.indexOf("Mac OS");n?(this.grab="default",this.grabbing="move"):r&&i||!t?i?(this.grab="-moz-grab",this.grabbing="-moz-grabbing"):(this.grab="default",this.grabbing="move"):(t.grab&&(this.grab='url("'+t.grab+'"),default'),t.grabbing&&(this.grabbing="url("+t.grabbing+"),move")),this.m=$(e),this.i=this.m.children().css("cursor",this.grab),this.isgrabbing=!1;var o=this;this.i.mousedown(function(t){return t.target!=$("svg",$(e))[0]?!1:(o.startgrab(),this.xp=t.pageX,this.yp=t.pageY,!1)}).mousemove(function(e){return o.isgrabbing?(o.scrollTo(this.xp-e.pageX,this.yp-e.pageY),this.xp=e.pageX,this.yp=e.pageY,!1):!0}).mouseout(function(){o.stopgrab()}).mouseup(function(){o.stopgrab()}),this.centering()},centering:function(){var e=this.m,t=this.i.width()-e.width(),i=this.i.height()-e.height();e.scrollLeft(t/2).scrollTop(i/2)},startgrab:function(){this.isgrabbing=!0,this.i.css("cursor",this.grabbing)},stopgrab:function(){this.isgrabbing=!1,this.i.css("cursor",this.grab)},scrollTo:function(e,t){var i=this.m,n=i.scrollLeft()+e,r=i.scrollTop()+t;i.scrollLeft(n).scrollTop(r)}},jQuery.fn.scrollview=function(t){return this.each(function(){new e(this,t)})}}(jQuery),define("libs/jquery-scrollview/jquery.scrollview",function(){}),function($){var min=Math.min,max=Math.max,round=Math.floor,isStr=function(e){return"string"===$.type(e)},runPluginCallbacks=function(Instance,a_fn){function g(e){return e}if($.isArray(a_fn))for(var i=0,c=a_fn.length;c>i;i++){var fn=a_fn[i];try{isStr(fn)&&(fn=eval(fn)),$.isFunction(fn)&&g(fn)(Instance)}catch(ex){}}};$.layout={version:"1.3.rc30.79",revision:.033007,browser:{},effects:{slide:{all:{duration:"fast"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},drop:{all:{duration:"slow"},north:{direction:"up"},south:{direction:"down"},east:{direction:"right"},west:{direction:"left"}},scale:{all:{duration:"fast"}},blind:{},clip:{},explode:{},fade:{},fold:{},puff:{},size:{all:{easing:"swing"}}},config:{optionRootKeys:"effects,panes,north,south,west,east,center".split(","),allPanes:"north,south,west,east,center".split(","),borderPanes:"north,south,west,east".split(","),oppositeEdge:{north:"south",south:"north",east:"west",west:"east"},offscreenCSS:{left:"-99999px",right:"auto"},offscreenReset:"offscreenReset",hidden:{visibility:"hidden"},visible:{visibility:"visible"},resizers:{cssReq:{position:"absolute",padding:0,margin:0,fontSize:"1px",textAlign:"left",overflow:"hidden"},cssDemo:{background:"#DDD",border:"none"}},togglers:{cssReq:{position:"absolute",display:"block",padding:0,margin:0,overflow:"hidden",textAlign:"center",fontSize:"1px",cursor:"pointer",zIndex:1},cssDemo:{background:"#AAA"}},content:{cssReq:{position:"relative"},cssDemo:{overflow:"auto",padding:"10px"},cssDemoPane:{overflow:"hidden",padding:0}},panes:{cssReq:{position:"absolute",margin:0},cssDemo:{padding:"10px",background:"#FFF",border:"1px solid #BBB",overflow:"auto"}},north:{side:"top",sizeType:"Height",dir:"horz",cssReq:{top:0,bottom:"auto",left:0,right:0,width:"auto"}},south:{side:"bottom",sizeType:"Height",dir:"horz",cssReq:{top:"auto",bottom:0,left:0,right:0,width:"auto"}},east:{side:"right",sizeType:"Width",dir:"vert",cssReq:{left:"auto",right:0,top:"auto",bottom:"auto",height:"auto"}},west:{side:"left",sizeType:"Width",dir:"vert",cssReq:{left:0,right:"auto",top:"auto",bottom:"auto",height:"auto"}},center:{dir:"center",cssReq:{left:"auto",right:"auto",top:"auto",bottom:"auto",height:"auto",width:"auto"}}},callbacks:{},getParentPaneElem:function(e){var t=$(e),i=t.data("layout")||t.data("parentLayout");if(i){var n=i.container;if(n.data("layoutPane"))return n;var r=n.closest("."+$.layout.defaults.panes.paneClass);if(r.data("layoutPane"))return r}return null},getParentPaneInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("layoutPane"):null},getParentLayoutInstance:function(e){var t=$.layout.getParentPaneElem(e);return t?t.data("parentLayout"):null},getEventObject:function(e){return"object"==typeof e&&e.stopPropagation?e:null},parsePaneName:function(e){var t=$.layout.getEventObject(e),i=e;return t&&(t.stopPropagation(),i=$(this).data("layoutEdge")),i&&!/^(west|east|north|south|center)$/.test(i)&&($.layout.msg('LAYOUT ERROR - Invalid pane-name: "'+i+'"'),i="error"),i},plugins:{draggable:!!$.fn.draggable,effects:{core:!!$.effects,slide:$.effects&&($.effects.slide||$.effects.effect&&$.effects.effect.slide)}},onCreate:[],onLoad:[],onReady:[],onDestroy:[],onUnload:[],afterOpen:[],afterClose:[],scrollbarWidth:function(){return window.scrollbarWidth||$.layout.getScrollbarSize("width")},scrollbarHeight:function(){return window.scrollbarHeight||$.layout.getScrollbarSize("height")},getScrollbarSize:function(e){var t=$('<div style="position: absolute; top: -10000px; left: -10000px; width: 100px; height: 100px; overflow: scroll;"></div>').appendTo("body"),i={width:t.css("width")-t[0].clientWidth,height:t.height()-t[0].clientHeight};return t.remove(),window.scrollbarWidth=i.width,window.scrollbarHeight=i.height,e.match(/^(width|height)$/)?i[e]:i},showInvisibly:function(e,t){if(e&&e.length&&(t||"none"===e.css("display"))){var i=e[0].style,n={display:i.display||"",visibility:i.visibility||""};return e.css({display:"block",visibility:"hidden"}),n}return{}},getElementDimensions:function(e,t){var i,n,r,o={css:{},inset:{}},s=o.css,a={bottom:0},l=$.layout.cssNum,h=e.offset();return o.offsetLeft=h.left,o.offsetTop=h.top,t||(t={}),$.each("Left,Right,Top,Bottom".split(","),function(l,h){i=s["border"+h]=$.layout.borderWidth(e,h),n=s["padding"+h]=$.layout.cssNum(e,"padding"+h),r=h.toLowerCase(),o.inset[r]=t[r]>=0?t[r]:n,a[r]=o.inset[r]+i}),s.width=e.width(),s.height=e.height(),s.top=l(e,"top",!0),s.bottom=l(e,"bottom",!0),s.left=l(e,"left",!0),s.right=l(e,"right",!0),o.outerWidth=e.outerWidth(),o.outerHeight=e.outerHeight(),o.innerWidth=max(0,o.outerWidth-a.left-a.right),o.innerHeight=max(0,o.outerHeight-a.top-a.bottom),o.layoutWidth=e.innerWidth(),o.layoutHeight=e.innerHeight(),o},getElementStyles:function(e,t){var i,n,r,o,s,a,l={},h=e[0].style,c=t.split(","),u="Top,Bottom,Left,Right".split(","),d="Color,Style,Width".split(",");for(o=0;o<c.length;o++)if(i=c[o],i.match(/(border|padding|margin)$/))for(s=0;4>s;s++)if(n=u[s],"border"===i)for(a=0;3>a;a++)r=d[a],l[i+n+r]=h[i+n+r];else l[i+n]=h[i+n];else l[i]=h[i];return l},cssWidth:function(e,t){if(0>=t)return 0;var i=$.layout.browser.boxModel?$.support.boxSizing?e.css("boxSizing"):"content-box":"border-box",n=$.layout.borderWidth,r=$.layout.cssNum,o=t;return"border-box"!==i&&(o-=n(e,"Left")+n(e,"Right")),"content-box"===i&&(o-=r(e,"paddingLeft")+r(e,"paddingRight")),max(0,o)},cssHeight:function(e,t){if(0>=t)return 0;var i=$.layout.browser.boxModel?$.support.boxSizing?e.css("boxSizing"):"content-box":"border-box",n=$.layout.borderWidth,r=$.layout.cssNum,o=t;return"border-box"!==i&&(o-=n(e,"Top")+n(e,"Bottom")),"content-box"===i&&(o-=r(e,"paddingTop")+r(e,"paddingBottom")),max(0,o)},cssNum:function(e,t,i){e.jquery||(e=$(e));var n=$.layout.showInvisibly(e),r=$.css(e[0],t,!0),o=i&&"auto"==r?r:Math.round(parseFloat(r)||0);return e.css(n),o},borderWidth:function(e,t){e.jquery&&(e=e[0]);var i="border"+t.substr(0,1).toUpperCase()+t.substr(1);return"none"===$.css(e,i+"Style",!0)?0:Math.round(parseFloat($.css(e,i+"Width",!0))||0)},isMouseOverElem:function(e,t){var i=$(t||this),n=i.offset(),r=n.top,o=n.left,s=o+i.outerWidth(),a=r+i.outerHeight(),l=e.pageX,h=e.pageY;return $.layout.browser.msie&&0>l&&0>h||l>=o&&s>=l&&h>=r&&a>=h},msg:function(e,t,i,n){function r(){var e=$.support.fixedPosition?"fixed":"absolute",t=$('<div id="layoutLogger" style="position: '+e+'; top: 5px; z-index: 999999; max-width: 25%; overflow: hidden; border: 1px solid #000; border-radius: 5px; background: #FBFBFB; box-shadow: 0 2px 10px rgba(0,0,0,0.3);">'+'<div style="font-size: 13px; font-weight: bold; padding: 5px 10px; background: #F6F6F6; border-radius: 5px 5px 0 0; cursor: move;">'+'<span style="float: right; padding-left: 7px; cursor: pointer;" title="Remove Console" onclick="$(this).closest(\'#layoutLogger\').remove()">X</span>Layout console.log</div>'+'<ul style="font-size: 13px; font-weight: none; list-style: none; margin: 0; padding: 0 0 2px;"></ul>'+"</div>").appendTo("body");return t.css("left",$(window).width()-t.outerWidth()-5),$.ui.draggable&&t.draggable({handle:":first-child"}),t}if($.isPlainObject(e)&&window.debugData){"string"==typeof t?(n=i,i=t):"object"==typeof i&&(n=i,i=null);var o=i||"log( <object> )",s=$.extend({sort:!1,returnHTML:!1,display:!1},n);t===!0||s.display?debugData(e,o,s):window.console&&console.log(debugData(e,o,s))}else if(t)alert(e);else if(window.console)console.log(e);
else{var a="#layoutLogger",l=$(a);l.length||(l=r()),l.children("ul").append('<li style="padding: 4px 10px; margin: 0; border-top: 1px solid #CCC;">'+e.replace(/\</g,"&lt;").replace(/\>/g,"&gt;")+"</li>")}}};var u=navigator.userAgent.toLowerCase(),m=/(chrome)[ \/]([\w.]+)/.exec(u)||/(webkit)[ \/]([\w.]+)/.exec(u)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(u)||/(msie) ([\w.]+)/.exec(u)||u.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(u)||[],b=m[1]||"",v=m[2]||0,ie="msie"===b;$.layout.browser={version:v,safari:"webkit"===b,webkit:"chrome"===b,msie:ie,isIE6:ie&&6==v,boxModel:!ie||$.support.boxModel!==!1},b&&($.layout.browser[b]=!0),ie&&$(function(){$.layout.browser.boxModel=$.support.boxModel}),$.layout.defaults={name:"",containerClass:"ui-layout-container",inset:null,scrollToBookmarkOnLoad:!0,resizeWithWindow:!0,resizeWithWindowDelay:200,resizeWithWindowMaxDelay:0,maskPanesEarly:!1,onresizeall_start:null,onresizeall_end:null,onload_start:null,onload_end:null,onunload_start:null,onunload_end:null,initPanes:!0,showErrorMessages:!0,showDebugMessages:!1,zIndex:null,zIndexes:{pane_normal:0,content_mask:1,resizer_normal:2,pane_sliding:100,pane_animate:1e3,resizer_drag:1e4},errors:{pane:"pane",selector:"selector",addButtonError:"Error Adding Button\nInvalid ",containerMissing:"UI Layout Initialization Error\nThe specified layout-container does not exist.",centerPaneMissing:"UI Layout Initialization Error\nThe center-pane element does not exist.\nThe center-pane is a required element.",noContainerHeight:"UI Layout Initialization Warning\nThe layout-container \"CONTAINER\" has no height.\nTherefore the layout is 0-height and hence 'invisible'!",callbackError:"UI Layout Callback Error\nThe EVENT callback is not a valid function."},panes:{applyDemoStyles:!1,closable:!0,resizable:!0,slidable:!0,initClosed:!1,initHidden:!1,contentSelector:".ui-layout-content",contentIgnoreSelector:".ui-layout-ignore",findNestedContent:!1,paneClass:"ui-layout-pane",resizerClass:"ui-layout-resizer",togglerClass:"ui-layout-toggler",buttonClass:"ui-layout-button",minSize:0,maxSize:0,spacing_open:6,spacing_closed:6,togglerLength_open:50,togglerLength_closed:50,togglerAlign_open:"center",togglerAlign_closed:"center",togglerContent_open:"",togglerContent_closed:"",resizerDblClickToggle:!0,autoResize:!0,autoReopen:!0,resizerDragOpacity:1,maskContents:!1,maskObjects:!1,maskZindex:null,resizingGrid:!1,livePaneResizing:!1,liveContentResizing:!1,liveResizingTolerance:1,sliderCursor:"pointer",slideTrigger_open:"click",slideTrigger_close:"mouseleave",slideDelay_open:300,slideDelay_close:300,hideTogglerOnSlide:!1,preventQuickSlideClose:$.layout.browser.webkit,preventPrematureSlideClose:!1,tips:{Open:"Open",Close:"Close",Resize:"Resize",Slide:"Slide Open",Pin:"Pin",Unpin:"Un-Pin",noRoomToOpen:"Not enough room to show this panel.",minSizeWarning:"Panel has reached its minimum size",maxSizeWarning:"Panel has reached its maximum size"},showOverflowOnHover:!1,enableCursorHotkey:!0,customHotkeyModifier:"SHIFT",fxName:"slide",fxSpeed:null,fxSettings:{},fxOpacityFix:!0,animatePaneSizing:!1,children:null,containerSelector:"",initChildren:!0,destroyChildren:!0,resizeChildren:!0,triggerEventsOnLoad:!1,triggerEventsDuringLiveResize:!0,onshow_start:null,onshow_end:null,onhide_start:null,onhide_end:null,onopen_start:null,onopen_end:null,onclose_start:null,onclose_end:null,onresize_start:null,onresize_end:null,onsizecontent_start:null,onsizecontent_end:null,onswap_start:null,onswap_end:null,ondrag_start:null,ondrag_end:null},north:{paneSelector:".ui-layout-north",size:"auto",resizerCursor:"n-resize",customHotkey:""},south:{paneSelector:".ui-layout-south",size:"auto",resizerCursor:"s-resize",customHotkey:""},east:{paneSelector:".ui-layout-east",size:200,resizerCursor:"e-resize",customHotkey:""},west:{paneSelector:".ui-layout-west",size:200,resizerCursor:"w-resize",customHotkey:""},center:{paneSelector:".ui-layout-center",minWidth:0,minHeight:0}},$.layout.optionsMap={layout:"name,instanceKey,stateManagement,effects,inset,zIndexes,errors,zIndex,scrollToBookmarkOnLoad,showErrorMessages,maskPanesEarly,outset,resizeWithWindow,resizeWithWindowDelay,resizeWithWindowMaxDelay,onresizeall,onresizeall_start,onresizeall_end,onload,onload_start,onload_end,onunload,onunload_start,onunload_end".split(","),center:"paneClass,contentSelector,contentIgnoreSelector,findNestedContent,applyDemoStyles,triggerEventsOnLoad,showOverflowOnHover,maskContents,maskObjects,liveContentResizing,containerSelector,children,initChildren,resizeChildren,destroyChildren,onresize,onresize_start,onresize_end,onsizecontent,onsizecontent_start,onsizecontent_end".split(","),noDefault:"paneSelector,resizerCursor,customHotkey".split(",")},$.layout.transformData=function(e,t){var i,n,r,o,s,a,l,h=t?{panes:{},center:{}}:{};if("object"!=typeof e)return h;for(n in e)for(i=h,s=e[n],r=n.split("__"),l=r.length-1,a=0;l>=a;a++)o=r[a],a===l?i[o]=$.isPlainObject(s)?$.layout.transformData(s):s:(i[o]||(i[o]={}),i=i[o]);return h},$.layout.backwardCompatibility={map:{applyDefaultStyles:"applyDemoStyles",childOptions:"children",initChildLayout:"initChildren",destroyChildLayout:"destroyChildren",resizeChildLayout:"resizeChildren",resizeNestedLayout:"resizeChildren",resizeWhileDragging:"livePaneResizing",resizeContentWhileDragging:"liveContentResizing",triggerEventsWhileDragging:"triggerEventsDuringLiveResize",maskIframesOnResize:"maskContents",useStateCookie:"stateManagement.enabled","cookie.autoLoad":"stateManagement.autoLoad","cookie.autoSave":"stateManagement.autoSave","cookie.keys":"stateManagement.stateKeys","cookie.name":"stateManagement.cookie.name","cookie.domain":"stateManagement.cookie.domain","cookie.path":"stateManagement.cookie.path","cookie.expires":"stateManagement.cookie.expires","cookie.secure":"stateManagement.cookie.secure",noRoomToOpenTip:"tips.noRoomToOpen",togglerTip_open:"tips.Close",togglerTip_closed:"tips.Open",resizerTip:"tips.Resize",sliderTip:"tips.Slide"},renameOptions:function(e){function t(t,i){for(var n,r=t.split("."),o=r.length-1,s={branch:e,key:r[o]},a=0;o>a;a++)n=r[a],s.branch=void 0==s.branch[n]?i?s.branch[n]={}:{}:s.branch[n];return s}var i,n,r,o=$.layout.backwardCompatibility.map;for(var s in o)i=t(s),r=i.branch[i.key],void 0!==r&&(n=t(o[s],!0),n.branch[n.key]=r,delete i.branch[i.key])},renameAllOptions:function(e){var t=$.layout.backwardCompatibility.renameOptions;return t(e),e.defaults&&("object"!=typeof e.panes&&(e.panes={}),$.extend(!0,e.panes,e.defaults),delete e.defaults),e.panes&&t(e.panes),$.each($.layout.config.allPanes,function(i,n){e[n]&&t(e[n])}),e}},$.fn.layout=function(opts){function keyDown(e){if(!e)return!0;var t=e.keyCode;if(33>t)return!0;var i,n,r,o,s={38:"north",40:"south",37:"west",39:"east"},a=(e.altKey,e.shiftKey),l=e.ctrlKey,h=l&&t>=37&&40>=t;return h&&options[s[t]].enableCursorHotkey?o=s[t]:(l||a)&&$.each(_c.borderPanes,function(e,s){return i=options[s],n=i.customHotkey,r=i.customHotkeyModifier,(a&&"SHIFT"==r||l&&"CTRL"==r||l&&a)&&n&&t===(isNaN(n)||9>=n?n.toUpperCase().charCodeAt(0):n)?(o=s,!1):void 0}),o&&$Ps[o]&&options[o].closable&&!state[o].isHidden?(toggle(o),e.stopPropagation(),e.returnValue=!1,!1):!0}function allowOverflow(e){if(isInitialized()){this&&this.tagName&&(e=this);var t;if(isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each(function(){return $(this).data("layoutRole")?(t=$(this),!1):void 0}),t&&t.length){var i=t.data("layoutEdge"),n=state[i];if(n.cssSaved&&resetOverflow(i),n.isSliding||n.isResizing||n.isClosed)return n.cssSaved=!1,void 0;var r={zIndex:options.zIndexes.resizer_normal+1},o={},s=t.css("overflow"),a=t.css("overflowX"),l=t.css("overflowY");"visible"!=s&&(o.overflow=s,r.overflow="visible"),a&&!a.match(/(visible|auto)/)&&(o.overflowX=a,r.overflowX="visible"),l&&!l.match(/(visible|auto)/)&&(o.overflowY=a,r.overflowY="visible"),n.cssSaved=o,t.css(r),$.each(_c.allPanes,function(e,t){t!=i&&resetOverflow(t)})}}}function resetOverflow(e){if(isInitialized()){this&&this.tagName&&(e=this);var t;if(isStr(e)?t=$Ps[e]:$(e).data("layoutRole")?t=$(e):$(e).parents().each(function(){return $(this).data("layoutRole")?(t=$(this),!1):void 0}),t&&t.length){var i=t.data("layoutEdge"),n=state[i],r=n.cssSaved||{};n.isSliding||n.isResizing||t.css("zIndex",options.zIndexes.pane_normal),t.css(r),n.cssSaved=!1}}}var browser=$.layout.browser,_c=$.layout.config,cssW=$.layout.cssWidth,cssH=$.layout.cssHeight,elDims=$.layout.getElementDimensions,styles=$.layout.getElementStyles,evtObj=$.layout.getEventObject,evtPane=$.layout.parsePaneName,options=$.extend(!0,{},$.layout.defaults),effects=options.effects=$.extend(!0,{},$.layout.effects),state={id:"layout"+$.now(),initialized:!1,paneResizing:!1,panesSliding:{},container:{innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0,layoutWidth:0,layoutHeight:0},north:{childIdx:0},south:{childIdx:0},east:{childIdx:0},west:{childIdx:0},center:{childIdx:0}},children={north:null,south:null,east:null,west:null,center:null},timer={data:{},set:function(e,t,i){timer.clear(e),timer.data[e]=setTimeout(t,i)},clear:function(e){var t=timer.data;t[e]&&(clearTimeout(t[e]),delete t[e])}},_log=function(e,t,i){var n=options;return(n.showErrorMessages&&!i||i&&n.showDebugMessages)&&$.layout.msg(n.name+" / "+e,t!==!1),!1},_runCallbacks=function(evtName,pane,skipBoundEvents){function g(e){return e}var hasPane=pane&&isStr(pane),s=hasPane?state[pane]:state,o=hasPane?options[pane]:options,lName=options.name,lng=evtName+(evtName.match(/_/)?"":"_end"),shrt=lng.match(/_end$/)?lng.substr(0,lng.length-4):"",fn=o[lng]||o[shrt],retVal="NC",args=[],$P;if(hasPane||"boolean"!==$.type(pane)||(skipBoundEvents=pane,pane=""),fn)try{isStr(fn)&&(fn.match(/,/)?(args=fn.split(","),fn=eval(args[0])):fn=eval(fn)),$.isFunction(fn)&&(retVal=args.length?g(fn)(args[1]):hasPane?g(fn)(pane,$Ps[pane],s,o,lName):g(fn)(Instance,s,o,lName))}catch(ex){_log(options.errors.callbackError.replace(/EVENT/,$.trim((pane||"")+" "+lng)),!1),"string"===$.type(ex)&&string.length&&_log("Exception:  "+ex,!1)}return skipBoundEvents||retVal===!1||(hasPane?($P=$Ps[pane],o=options[pane],s=state[pane],$P.triggerHandler("layoutpane"+lng,[pane,$P,s,o,lName]),shrt&&$P.triggerHandler("layoutpane"+shrt,[pane,$P,s,o,lName])):($N.triggerHandler("layout"+lng,[Instance,s,o,lName]),shrt&&$N.triggerHandler("layout"+shrt,[Instance,s,o,lName]))),hasPane&&"onresize_end"===evtName&&resizeChildren(pane+"",!0),retVal},_fixIframe=function(e){if(!browser.mozilla){var t=$Ps[e];"IFRAME"===state[e].tagName?t.css(_c.hidden).css(_c.visible):t.find("IFRAME").css(_c.hidden).css(_c.visible)}},cssSize=function(e,t){var i="horz"==_c[e].dir?cssH:cssW;return i($Ps[e],t)},cssMinDims=function(e){var t=$Ps[e],i=_c[e].dir,n={minWidth:1001-cssW(t,1e3),minHeight:1001-cssH(t,1e3)};return"horz"===i&&(n.minSize=n.minHeight),"vert"===i&&(n.minSize=n.minWidth),n},setOuterWidth=function(e,t,i){var n,r=e;isStr(e)?r=$Ps[e]:e.jquery||(r=$(e)),n=cssW(r,t),r.css({width:n}),n>0?i&&r.data("autoHidden")&&r.innerHeight()>0&&(r.show().data("autoHidden",!1),browser.mozilla||r.css(_c.hidden).css(_c.visible)):i&&!r.data("autoHidden")&&r.hide().data("autoHidden",!0)},setOuterHeight=function(e,t,i){var n,r=e;isStr(e)?r=$Ps[e]:e.jquery||(r=$(e)),n=cssH(r,t),r.css({height:n,visibility:"visible"}),n>0&&r.innerWidth()>0?i&&r.data("autoHidden")&&(r.show().data("autoHidden",!1),browser.mozilla||r.css(_c.hidden).css(_c.visible)):i&&!r.data("autoHidden")&&r.hide().data("autoHidden",!0)},_parseSize=function(e,t,i){if(i||(i=_c[e].dir),isStr(t)&&t.match(/%/)&&(t="100%"===t?-1:parseInt(t,10)/100),0===t)return 0;if(t>=1)return parseInt(t,10);var n=options,r=0;if("horz"==i?r=sC.innerHeight-($Ps.north?n.north.spacing_open:0)-($Ps.south?n.south.spacing_open:0):"vert"==i&&(r=sC.innerWidth-($Ps.west?n.west.spacing_open:0)-($Ps.east?n.east.spacing_open:0)),-1===t)return r;if(t>0)return round(r*t);if("center"==e)return 0;var o="horz"===i?"height":"width",s=$Ps[e],a="height"===o?$Cs[e]:!1,l=$.layout.showInvisibly(s),h=s.css(o),c=a?a.css(o):0;return s.css(o,"auto"),a&&a.css(o,"auto"),t="height"===o?s.outerHeight():s.outerWidth(),s.css(o,h).css(l),a&&a.css(o,c),t},getPaneSize=function(e,t){var i=$Ps[e],n=options[e],r=state[e],o=t?n.spacing_open:0,s=t?n.spacing_closed:0;return!i||r.isHidden?0:r.isClosed||r.isSliding&&t?s:"horz"===_c[e].dir?i.outerHeight()+o:i.outerWidth()+o},setSizeLimits=function(e,t){if(isInitialized()){var i=options[e],n=state[e],r=_c[e],o=r.dir,s=(r.sizeType.toLowerCase(),void 0!=t?t:n.isSliding),a=($Ps[e],i.spacing_open),l=_c.oppositeEdge[e],h=state[l],c=$Ps[l],u=!c||h.isVisible===!1||h.isSliding?0:"horz"==o?c.outerHeight():c.outerWidth(),d=(!c||h.isHidden?0:options[l][h.isClosed!==!1?"spacing_closed":"spacing_open"])||0,p="horz"==o?sC.innerHeight:sC.innerWidth,f=cssMinDims("center"),m="horz"==o?max(options.center.minHeight,f.minHeight):max(options.center.minWidth,f.minWidth),g=p-a-(s?0:_parseSize("center",m,o)+u+d),v=n.minSize=max(_parseSize(e,i.minSize),cssMinDims(e).minSize),y=n.maxSize=min(i.maxSize?_parseSize(e,i.maxSize):1e5,g),_=n.resizerPosition={},b=sC.inset.top,E=sC.inset.left,x=sC.innerWidth,T=sC.innerHeight,w=i.spacing_open;switch(e){case"north":_.min=b+v,_.max=b+y;break;case"west":_.min=E+v,_.max=E+y;break;case"south":_.min=b+T-y-w,_.max=b+T-v-w;break;case"east":_.min=E+x-y-w,_.max=E+x-v-w}}},calcNewCenterPaneDims=function(){var e={top:getPaneSize("north",!0),bottom:getPaneSize("south",!0),left:getPaneSize("west",!0),right:getPaneSize("east",!0),width:0,height:0};return e.width=sC.innerWidth-e.left-e.right,e.height=sC.innerHeight-e.bottom-e.top,e.top+=sC.inset.top,e.bottom+=sC.inset.bottom,e.left+=sC.inset.left,e.right+=sC.inset.right,e},getHoverClasses=function(e,t){var i=$(e),n=i.data("layoutRole"),r=i.data("layoutEdge"),o=options[r],s=o[n+"Class"],a="-"+r,l="-open",h="-closed",c="-sliding",u="-hover ",d=i.hasClass(s+h)?h:l,p=d===h?l:h,f=s+u+(s+a+u)+(s+d+u)+(s+a+d+u);return t&&(f+=s+p+u+(s+a+p+u)),"resizer"==n&&i.hasClass(s+c)&&(f+=s+c+u+(s+a+c+u)),$.trim(f)},addHover=function(e,t){var i=$(t||this);e&&"toggler"===i.data("layoutRole")&&e.stopPropagation(),i.addClass(getHoverClasses(i))},removeHover=function(e,t){var i=$(t||this);i.removeClass(getHoverClasses(i,!0))},onResizerEnter=function(){var e=$(this).data("layoutEdge"),t=state[e];t.isClosed||t.isResizing||state.paneResizing||($.fn.disableSelection&&$("body").disableSelection(),options.maskPanesEarly&&showMasks(e,{resizing:!0}))},onResizerLeave=function(e,t){var i=t||this,n=$(i).data("layoutEdge"),r=n+"ResizerLeave";timer.clear(n+"_openSlider"),timer.clear(r),t?state.paneResizing||($.fn.enableSelection&&$("body").enableSelection(),options.maskPanesEarly&&hideMasks()):timer.set(r,function(){onResizerLeave(e,i)},200)},_create=function(){initOptions();var e=options,t=state;return t.creatingLayout=!0,runPluginCallbacks(Instance,$.layout.onCreate),!1===_runCallbacks("onload_start")?"cancel":(_initContainer(),initHotkeys(),$(window).bind("unload."+sID,unload),runPluginCallbacks(Instance,$.layout.onLoad),e.initPanes&&_initLayoutElements(),delete t.creatingLayout,state.initialized)},isInitialized=function(){return state.initialized||state.creatingLayout?!0:_initLayoutElements()},_initLayoutElements=function(e){var t=options;if(!$N.is(":visible"))return!e&&browser.webkit&&"BODY"===$N[0].tagName&&setTimeout(function(){_initLayoutElements(!0)},50),!1;if(!getPane("center").length)return _log(t.errors.centerPaneMissing);if(state.creatingLayout=!0,$.extend(sC,elDims($N,t.inset)),initPanes(),t.scrollToBookmarkOnLoad){var i=self.location;i.hash&&i.replace(i.hash)}return Instance.hasParentLayout?t.resizeWithWindow=!1:t.resizeWithWindow&&$(window).bind("resize."+sID,windowResize),delete state.creatingLayout,state.initialized=!0,runPluginCallbacks(Instance,$.layout.onReady),_runCallbacks("onload_end"),!0},createChildren=function(e,t){var i=evtPane.call(this,e),n=$Ps[i];if(n){var r=$Cs[i],o=state[i],s=options[i],a=options.stateManagement||{},l=t?s.children=t:s.children;if($.isPlainObject(l))l=[l];else if(!l||!$.isArray(l))return;$.each(l,function(e,t){if($.isPlainObject(t)){var s=t.containerSelector?n.find(t.containerSelector):r||n;s.each(function(){var e=$(this),n=e.data("layout");if(!n){if(setInstanceKey({container:e,options:t},o),a.includeChildren&&state.stateData[i]){var r=state.stateData[i].children||{},s=r[t.instanceKey],l=t.stateManagement||(t.stateManagement={autoLoad:!0});l.autoLoad===!0&&s&&(l.autoSave=!1,l.includeChildren=!0,l.autoLoad=$.extend(!0,{},s))}n=e.layout(t),n&&refreshChildren(i,n)}})}})}},setInstanceKey=function(e,t){var i=e.container,n=e.options,r=n.stateManagement,o=n.instanceKey||i.data("layoutInstanceKey");return o||(o=(r&&r.cookie?r.cookie.name:"")||n.name),o=o?o.replace(/[^\w-]/gi,"_").replace(/_{2,}/g,"_"):"layout"+ ++t.childIdx,n.instanceKey=o,i.data("layoutInstanceKey",o),o},refreshChildren=function(e,t){var i,n=$Ps[e],r=children[e],o=state[e];$.isPlainObject(r)&&($.each(r,function(e,t){t.destroyed&&delete r[e]}),$.isEmptyObject(r)&&(r=children[e]=null)),t||r||(t=n.data("layout")),t&&(t.hasParentLayout=!0,i=t.options,setInstanceKey(t,o),r||(r=children[e]={}),r[i.instanceKey]=t.container.data("layout")),Instance[e].children=children[e],t||createChildren(e)},windowResize=function(){var e=options,t=Number(e.resizeWithWindowDelay);10>t&&(t=100),timer.clear("winResize"),timer.set("winResize",function(){timer.clear("winResize"),timer.clear("winResizeRepeater");var t=elDims($N,e.inset);(t.innerWidth!==sC.innerWidth||t.innerHeight!==sC.innerHeight)&&resizeAll()},t),timer.data.winResizeRepeater||setWindowResizeRepeater()},setWindowResizeRepeater=function(){var e=Number(options.resizeWithWindowMaxDelay);e>0&&timer.set("winResizeRepeater",function(){setWindowResizeRepeater(),resizeAll()},e)},unload=function(){_runCallbacks("onunload_start"),runPluginCallbacks(Instance,$.layout.onUnload),_runCallbacks("onunload_end")},_initContainer=function(){var e,t,i=$N[0],n=$("html"),r=sC.tagName=i.tagName,o=sC.id=i.id,s=sC.className=i.className,a=options,l=a.name,h="position,margin,padding,border",c="layoutCSS",u={},d="hidden",p=$N.data("parentLayout"),f=$N.data("layoutEdge"),m=p&&f,g=$.layout.cssNum;sC.selector=$N.selector.split(".slice")[0],sC.ref=(a.name?a.name+" layout / ":"")+r+(o?"#"+o:s?".["+s+"]":""),sC.isBody="BODY"===r,m||sC.isBody||(e=$N.closest("."+$.layout.defaults.panes.paneClass),p=e.data("parentLayout"),f=e.data("layoutEdge"),m=p&&f),$N.data({layout:Instance,layoutContainer:sID}).addClass(a.containerClass);var v={destroy:"",initPanes:"",resizeAll:"resizeAll",resize:"resizeAll"};for(l in v)$N.bind("layout"+l.toLowerCase()+"."+sID,Instance[v[l]||l]);m&&(Instance.hasParentLayout=!0,p.refreshChildren(f,Instance)),$N.data(c)||(sC.isBody?($N.data(c,$.extend(styles($N,h),{height:$N.css("height"),overflow:$N.css("overflow"),overflowX:$N.css("overflowX"),overflowY:$N.css("overflowY")})),n.data(c,$.extend(styles(n,"padding"),{height:"auto",overflow:n.css("overflow"),overflowX:n.css("overflowX"),overflowY:n.css("overflowY")}))):$N.data(c,styles($N,h+",top,bottom,left,right,width,height,overflow,overflowX,overflowY")));try{if(u={overflow:d,overflowX:d,overflowY:d},$N.css(u),a.inset&&!$.isPlainObject(a.inset)&&(t=parseInt(a.inset,10)||0,a.inset={top:t,bottom:t,left:t,right:t}),sC.isBody)a.outset?$.isPlainObject(a.outset)||(t=parseInt(a.outset,10)||0,a.outset={top:t,bottom:t,left:t,right:t}):a.outset={top:g(n,"paddingTop"),bottom:g(n,"paddingBottom"),left:g(n,"paddingLeft"),right:g(n,"paddingRight")},n.css(u).css({height:"100%",border:"none",padding:0,margin:0}),browser.isIE6?($N.css({width:"100%",height:"100%",border:"none",padding:0,margin:0,position:"relative"}),a.inset||(a.inset=elDims($N).inset)):($N.css({width:"auto",height:"auto",margin:0,position:"absolute"}),$N.css(a.outset)),$.extend(sC,elDims($N,a.inset));else{var y=$N.css("position");y&&y.match(/(fixed|absolute|relative)/)||$N.css("position","relative"),$N.is(":visible")&&($.extend(sC,elDims($N,a.inset)),sC.innerHeight<1&&_log(a.errors.noContainerHeight.replace(/CONTAINER/,sC.ref)))}g($N,"minWidth")&&$N.parent().css("overflowX","auto"),g($N,"minHeight")&&$N.parent().css("overflowY","auto")}catch(_){}},initHotkeys=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var i=options[t];return i.enableCursorHotkey||i.customHotkey?($(document).bind("keydown."+sID,keyDown),!1):void 0})},initOptions=function(){function e(e){var t=options[e],i=options.panes;t.fxSettings||(t.fxSettings={}),i.fxSettings||(i.fxSettings={}),$.each(["_open","_close","_size"],function(n,r){var o="fxName"+r,s="fxSpeed"+r,a="fxSettings"+r,l=t[o]=t[o]||i[o]||t.fxName||i.fxName||"none",h=$.effects&&($.effects[l]||$.effects.effect&&$.effects.effect[l]);"none"!==l&&options.effects[l]&&h||(l=t[o]="none");var c=options.effects[l]||{},u=c.all||null,d=c[e]||null;t[s]=t[s]||i[s]||t.fxSpeed||i.fxSpeed||null,t[a]=$.extend(!0,{},u,d,i.fxSettings,t.fxSettings,i[a],t[a])}),delete t.fxName,delete t.fxSpeed,delete t.fxSettings}var t,i,n,r,o,s,a;if(opts=$.layout.transformData(opts,!0),opts=$.layout.backwardCompatibility.renameAllOptions(opts),!$.isEmptyObject(opts.panes)){for(t=$.layout.optionsMap.noDefault,o=0,s=t.length;s>o;o++)n=t[o],delete opts.panes[n];for(t=$.layout.optionsMap.layout,o=0,s=t.length;s>o;o++)n=t[o],delete opts.panes[n]}t=$.layout.optionsMap.layout;var l=$.layout.config.optionRootKeys;for(n in opts)r=opts[n],$.inArray(n,l)<0&&$.inArray(n,t)<0&&(opts.panes[n]||(opts.panes[n]=$.isPlainObject(r)?$.extend(!0,{},r):r),delete opts[n]);$.extend(!0,options,opts),$.each(_c.allPanes,function(r,o){if(_c[o]=$.extend(!0,{},_c.panes,_c[o]),i=options.panes,a=options[o],"center"===o)for(t=$.layout.optionsMap.center,r=0,s=t.length;s>r;r++)n=t[r],opts.center[n]||!opts.panes[n]&&a[n]||(a[n]=i[n]);else a=options[o]=$.extend(!0,{},i,a),e(o),a.resizerClass||(a.resizerClass="ui-layout-resizer"),a.togglerClass||(a.togglerClass="ui-layout-toggler");a.paneClass||(a.paneClass="ui-layout-pane")});var h=opts.zIndex,c=options.zIndexes;h>0&&(c.pane_normal=h,c.content_mask=max(h+1,c.content_mask),c.resizer_normal=max(h+2,c.resizer_normal)),delete options.panes},getPane=function(e){var t=options[e].paneSelector;if("#"===t.substr(0,1))return $N.find(t).eq(0);var i=$N.children(t).eq(0);return i.length?i:$N.children("form:first").children(t).eq(0)},initPanes=function(e){evtPane(e),$.each(_c.allPanes,function(e,t){addPane(t,!0)}),initHandles(),$.each(_c.borderPanes,function(e,t){$Ps[t]&&state[t].isVisible&&(setSizeLimits(t),makePaneFit(t))}),sizeMidPanes("center"),$.each(_c.allPanes,function(e,t){afterInitPane(t)})},addPane=function(e,t){if(t||isInitialized()){var i,n,r,o=options[e],s=state[e],a=_c[e],l=a.dir,h=(s.fx,o.spacing_open||0,"center"===e),c={},u=$Ps[e];if(u?removePane(e,!1,!0,!1):$Cs[e]=!1,u=$Ps[e]=getPane(e),!u.length)return $Ps[e]=!1,void 0;if(!u.data("layoutCSS")){var d="position,top,left,bottom,right,width,height,overflow,zIndex,display,backgroundColor,padding,margin,border";u.data("layoutCSS",styles(u,d))}Instance[e]={name:e,pane:$Ps[e],content:$Cs[e],options:options[e],state:state[e],children:children[e]},u.data({parentLayout:Instance,layoutPane:Instance[e],layoutEdge:e,layoutRole:"pane"}).css(a.cssReq).css("zIndex",options.zIndexes.pane_normal).css(o.applyDemoStyles?a.cssDemo:{}).addClass(o.paneClass+" "+o.paneClass+"-"+e).bind("mouseenter."+sID,addHover).bind("mouseleave."+sID,removeHover);var p,f={hide:"",show:"",toggle:"",close:"",open:"",slideOpen:"",slideClose:"",slideToggle:"",size:"sizePane",sizePane:"sizePane",sizeContent:"",sizeHandles:"",enableClosable:"",disableClosable:"",enableSlideable:"",disableSlideable:"",enableResizable:"",disableResizable:"",swapPanes:"swapPanes",swap:"swapPanes",move:"swapPanes",removePane:"removePane",remove:"removePane",createChildren:"",resizeChildren:"",resizeAll:"resizeAll",resizeLayout:"resizeAll"};for(p in f)u.bind("layoutpane"+p.toLowerCase()+"."+sID,Instance[f[p]||p]);initContent(e,!1),h||(i=s.size=_parseSize(e,o.size),n=_parseSize(e,o.minSize)||1,r=_parseSize(e,o.maxSize)||1e5,i>0&&(i=max(min(i,r),n)),s.autoResize=o.autoResize,s.isClosed=!1,s.isSliding=!1,s.isResizing=!1,s.isHidden=!1,s.pins||(s.pins=[])),s.tagName=u[0].tagName,s.edge=e,s.noRoom=!1,s.isVisible=!0,setPanePosition(e),"horz"===l?c.height=cssH(u,i):"vert"===l&&(c.width=cssW(u,i)),u.css(c),"horz"!=l&&sizeMidPanes(e,!0),state.initialized&&(initHandles(e),initHotkeys(e)),o.initClosed&&o.closable&&!o.initHidden?close(e,!0,!0):o.initHidden||o.initClosed?hide(e):s.noRoom||u.css("display","block"),u.css("visibility","visible"),o.showOverflowOnHover&&u.hover(allowOverflow,resetOverflow),state.initialized&&afterInitPane(e)}},afterInitPane=function(e){var t=$Ps[e],i=state[e],n=options[e];t&&(t.data("layout")&&refreshChildren(e,t.data("layout")),i.isVisible&&(state.initialized?resizeAll():sizeContent(e),n.triggerEventsOnLoad?_runCallbacks("onresize_end",e):resizeChildren(e,!0)),n.initChildren&&n.children&&createChildren(e))},setPanePosition=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var i=$Ps[t],n=$Rs[t],r=(options[t],state[t]),o=_c[t].side,s={};if(i){switch(t){case"north":s.top=sC.inset.top,s.left=sC.inset.left,s.right=sC.inset.right;break;case"south":s.bottom=sC.inset.bottom,s.left=sC.inset.left,s.right=sC.inset.right;break;case"west":s.left=sC.inset.left;break;case"east":s.right=sC.inset.right;break;case"center":}i.css(s),n&&r.isClosed?n.css(o,sC.inset[o]):n&&!r.isHidden&&n.css(o,sC.inset[o]+getPaneSize(t))}})},initHandles=function(e){e=e?e.split(","):_c.borderPanes,$.each(e,function(e,t){var i=$Ps[t];if($Rs[t]=!1,$Ts[t]=!1,i){var n=options[t],r=state[t],o=(_c[t],"#"===n.paneSelector.substr(0,1)?n.paneSelector.substr(1):""),s=n.resizerClass,a=n.togglerClass,l=(r.isVisible?n.spacing_open:n.spacing_closed,"-"+t),h=(r.isVisible?"-open":"-closed",Instance[t]),c=h.resizer=$Rs[t]=$("<div></div>"),u=h.toggler=n.closable?$Ts[t]=$("<div></div>"):!1;!r.isVisible&&n.slidable&&c.attr("title",n.tips.Slide).css("cursor",n.sliderCursor),c.attr("id",o?o+"-resizer":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"resizer"}).css(_c.resizers.cssReq).css("zIndex",options.zIndexes.resizer_normal).css(n.applyDemoStyles?_c.resizers.cssDemo:{}).addClass(s+" "+s+l).hover(addHover,removeHover).hover(onResizerEnter,onResizerLeave).appendTo($N),n.resizerDblClickToggle&&c.bind("dblclick."+sID,toggle),u&&(u.attr("id",o?o+"-toggler":"").data({parentLayout:Instance,layoutPane:Instance[t],layoutEdge:t,layoutRole:"toggler"}).css(_c.togglers.cssReq).css(n.applyDemoStyles?_c.togglers.cssDemo:{}).addClass(a+" "+a+l).hover(addHover,removeHover).bind("mouseenter",onResizerEnter).appendTo(c),n.togglerContent_open&&$("<span>"+n.togglerContent_open+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).data("layoutRole","togglerContent").data("layoutEdge",t).addClass("content content-open").css("display","none").appendTo(u),n.togglerContent_closed&&$("<span>"+n.togglerContent_closed+"</span>").data({layoutEdge:t,layoutRole:"togglerContent"}).addClass("content content-closed").css("display","none").appendTo(u),enableClosable(t)),initResizable(t),r.isVisible?setAsOpen(t):(setAsClosed(t),bindStartSlidingEvents(t,!0))}}),sizeHandles()},initContent=function(e,t){if(isInitialized()){var i,n=options[e],r=n.contentSelector,o=Instance[e],s=$Ps[e];r&&(i=o.content=$Cs[e]=n.findNestedContent?s.find(r).eq(0):s.children(r).eq(0)),i&&i.length?(i.data("layoutRole","content"),i.data("layoutCSS")||i.data("layoutCSS",styles(i,"height")),i.css(_c.content.cssReq),n.applyDemoStyles&&(i.css(_c.content.cssDemo),s.css(_c.content.cssDemoPane)),s.css("overflowX").match(/(scroll|auto)/)&&s.css("overflow","hidden"),state[e].content={},t!==!1&&sizeContent(e)):o.content=$Cs[e]=!1}},initResizable=function(e){var t=$.layout.plugins.draggable;e=e?e.split(","):_c.borderPanes,$.each(e,function(e,n){var r=options[n];if(!t||!$Ps[n]||!r.resizable)return r.resizable=!1,!0;var o,s,a=state[n],l=options.zIndexes,h=_c[n],c="horz"==h.dir?"top":"left",u=($Ps[n],$Rs[n]),d=r.resizerClass,p=0,f=d+"-drag",m=d+"-"+n+"-drag",g=d+"-dragging",v=d+"-"+n+"-dragging",y=d+"-dragging-limit",_=d+"-"+n+"-dragging-limit",b=!1;a.isClosed||u.attr("title",r.tips.Resize).css("cursor",r.resizerCursor),u.draggable({containment:$N[0],axis:"horz"==h.dir?"y":"x",delay:0,distance:1,grid:r.resizingGrid,helper:"clone",opacity:r.resizerDragOpacity,addClasses:!1,zIndex:l.resizer_drag,start:function(e,t){return r=options[n],a=state[n],s=r.livePaneResizing,!1===_runCallbacks("ondrag_start",n)?!1:(a.isResizing=!0,state.paneResizing=n,timer.clear(n+"_closeSlider"),setSizeLimits(n),o=a.resizerPosition,p=t.position[c],u.addClass(f+" "+m),b=!1,$("body").disableSelection(),showMasks(n,{resizing:!0}),void 0)},drag:function(e,t){b||(t.helper.addClass(g+" "+v).css({right:"auto",bottom:"auto"}).children().css("visibility","hidden"),b=!0,a.isSliding&&$Ps[n].css("zIndex",l.pane_sliding));var h=0;t.position[c]<o.min?(t.position[c]=o.min,h=-1):t.position[c]>o.max&&(t.position[c]=o.max,h=1),h?(t.helper.addClass(y+" "+_),window.defaultStatus=h>0&&n.match(/(north|west)/)||0>h&&n.match(/(south|east)/)?r.tips.maxSizeWarning:r.tips.minSizeWarning):(t.helper.removeClass(y+" "+_),window.defaultStatus=""),s&&Math.abs(t.position[c]-p)>=r.liveResizingTolerance&&(p=t.position[c],i(e,t,n))},stop:function(e,t){$("body").enableSelection(),window.defaultStatus="",u.removeClass(f+" "+m),a.isResizing=!1,state.paneResizing=!1,i(e,t,n,!0)}})});var i=function(e,t,i,n){var r,o=t.position,s=_c[i],a=options[i],l=state[i];switch(i){case"north":r=o.top;break;case"west":r=o.left;break;case"south":r=sC.layoutHeight-o.top-a.spacing_open;break;case"east":r=sC.layoutWidth-o.left-a.spacing_open}var h=r-sC.inset[s.side];if(n)!1!==_runCallbacks("ondrag_end",i)&&manualSizePane(i,h,!1,!0),hideMasks(!0),l.isSliding&&showMasks(i,{resizing:!0});else{if(Math.abs(h-l.size)<a.liveResizingTolerance)return;manualSizePane(i,h,!1,!0),sizeMasks()}}},sizeMask=function(){var e=$(this),t=e.data("layoutMask"),i=state[t];"IFRAME"==i.tagName&&i.isVisible&&e.css({top:i.offsetTop,left:i.offsetLeft,width:i.outerWidth,height:i.outerHeight})},sizeMasks=function(){$Ms.each(sizeMask)},showMasks=function(e,t){var i,n,r=_c[e],o=["center"],s=options.zIndexes,a=$.extend({objectsOnly:!1,animation:!1,resizing:!0,sliding:state[e].isSliding},t);a.resizing&&o.push(e),a.sliding&&o.push(_c.oppositeEdge[e]),"horz"===r.dir&&(o.push("west"),o.push("east")),$.each(o,function(e,t){n=state[t],i=options[t],n.isVisible&&(i.maskObjects||!a.objectsOnly&&i.maskContents)&&getMasks(t).each(function(){sizeMask.call(this),this.style.zIndex=n.isSliding?s.pane_sliding+1:s.pane_normal+1,this.style.display="block"})})},hideMasks=function(e){if(e||!state.paneResizing)$Ms.hide();else if(!e&&!$.isEmptyObject(state.panesSliding))for(var t,i,n=$Ms.length-1;n>=0;n--)i=$Ms.eq(n),t=i.data("layoutMask"),options[t].maskObjects||i.hide()},getMasks=function(e){for(var t,i=$([]),n=0,r=$Ms.length;r>n;n++)t=$Ms.eq(n),t.data("layoutMask")===e&&(i=i.add(t));return i.length?i:createMasks(e)},createMasks=function(e){var t,i,n,r,o,s=$Ps[e],a=state[e],l=options[e],h=options.zIndexes,c=$([]);if(!l.maskContents&&!l.maskObjects)return c;for(o=0;o<(l.maskObjects?2:1);o++)t=l.maskObjects&&0==o,i=document.createElement(t?"iframe":"div"),n=$(i).data("layoutMask",e),i.className="ui-layout-mask ui-layout-mask-"+e,r=i.style,r.display="block",r.position="absolute",r.background="#FFF",t&&(i.frameborder=0,i.src="about:blank",r.opacity=0,r.filter="Alpha(Opacity='0')",r.border=0),"IFRAME"==a.tagName?(r.zIndex=h.pane_normal+1,$N.append(i)):(n.addClass("ui-layout-mask-inside-pane"),r.zIndex=l.maskZindex||h.content_mask,r.top=0,r.left=0,r.width="100%",r.height="100%",s.append(i)),c=c.add(i),$Ms=$Ms.add(i);return c},destroy=function(e,t){$(window).unbind("."+sID),$(document).unbind("."+sID),"object"==typeof e?evtPane(e):t=e,$N.clearQueue().removeData("layout").removeData("layoutContainer").removeClass(options.containerClass).unbind("."+sID),$Ms.remove(),$.each(_c.allPanes,function(e,i){removePane(i,!1,!0,t)
});var i="layoutCSS";$N.data(i)&&!$N.data("layoutRole")&&$N.css($N.data(i)).removeData(i),"BODY"===sC.tagName&&($N=$("html")).data(i)&&$N.css($N.data(i)).removeData(i),runPluginCallbacks(Instance,$.layout.onDestroy),unload();for(var n in Instance)n.match(/^(container|options)$/)||delete Instance[n];return Instance.destroyed=!0,Instance},removePane=function(e,t,i,n){if(isInitialized()){var r=evtPane.call(this,e),o=$Ps[r],s=$Cs[r],a=$Rs[r],l=$Ts[r];o&&$.isEmptyObject(o.data())&&(o=!1),s&&$.isEmptyObject(s.data())&&(s=!1),a&&$.isEmptyObject(a.data())&&(a=!1),l&&$.isEmptyObject(l.data())&&(l=!1),o&&o.stop(!0,!0);var h=options[r],c=state[r],u="layout",d="layoutCSS",p=children[r],f=$.isPlainObject(p)&&!$.isEmptyObject(p),m=void 0!==n?n:h.destroyChildren;if(f&&m&&($.each(p,function(e,t){t.destroyed||t.destroy(!0),t.destroyed&&delete p[e]}),$.isEmptyObject(p)&&(p=children[r]=null,f=!1)),o&&t&&!f)o.remove();else if(o&&o[0]){var g=h.paneClass,v=g+"-"+r,y="-open",_="-sliding",b="-closed",E=[g,g+y,g+b,g+_,v,v+y,v+b,v+_];$.merge(E,getHoverClasses(o,!0)),o.removeClass(E.join(" ")).removeData("parentLayout").removeData("layoutPane").removeData("layoutRole").removeData("layoutEdge").removeData("autoHidden").unbind("."+sID),f&&s?(s.width(s.width()),$.each(p,function(e,t){t.resizeAll()})):s&&s.css(s.data(d)).removeData(d).removeData("layoutRole"),o.data(u)||o.css(o.data(d)).removeData(d)}l&&l.remove(),a&&a.remove(),Instance[r]=$Ps[r]=$Cs[r]=$Rs[r]=$Ts[r]=!1,c={removed:!0},i||resizeAll()}},_hidePane=function(e){var t=$Ps[e],i=options[e],n=t[0].style;i.useOffscreenClose?(t.data(_c.offscreenReset)||t.data(_c.offscreenReset,{left:n.left,right:n.right}),t.css(_c.offscreenCSS)):t.hide().removeData(_c.offscreenReset)},_showPane=function(e){var t=$Ps[e],i=options[e],n=_c.offscreenCSS,r=t.data(_c.offscreenReset),o=t[0].style;t.show().removeData(_c.offscreenReset),i.useOffscreenClose&&r&&(o.left==n.left&&(o.left=r.left),o.right==n.right&&(o.right=r.right))},hide=function(e,t){if(isInitialized()){var i=evtPane.call(this,e),n=options[i],r=state[i],o=$Ps[i],s=$Rs[i];o&&!r.isHidden&&(state.initialized&&!1===_runCallbacks("onhide_start",i)||(r.isSliding=!1,delete state.panesSliding[i],s&&s.hide(),!state.initialized||r.isClosed?(r.isClosed=!0,r.isHidden=!0,r.isVisible=!1,state.initialized||_hidePane(i),sizeMidPanes("horz"===_c[i].dir?"":"center"),(state.initialized||n.triggerEventsOnLoad)&&_runCallbacks("onhide_end",i)):(r.isHiding=!0,close(i,!1,t))))}},show=function(e,t,i,n){if(isInitialized()){var r=evtPane.call(this,e),o=(options[r],state[r]),s=$Ps[r];$Rs[r],s&&o.isHidden&&!1!==_runCallbacks("onshow_start",r)&&(o.isShowing=!0,o.isSliding=!1,delete state.panesSliding[r],t===!1?close(r,!0):open(r,!1,i,n))}},toggle=function(e,t){if(isInitialized()){var i=evtObj(e),n=evtPane.call(this,e),r=state[n];i&&i.stopImmediatePropagation(),r.isHidden?show(n):r.isClosed?open(n,!!t):close(n)}},_closePane=function(e,t){var i=($Ps[e],state[e]);_hidePane(e),i.isClosed=!0,i.isVisible=!1,t&&setAsClosed(e)},close=function(e,t,i,n){function r(){d.isMoving=!1,bindStartSlidingEvents(o,!0);var e=_c.oppositeEdge[o];state[e].noRoom&&(setSizeLimits(e),makePaneFit(e)),n||!state.initialized&&!u.triggerEventsOnLoad||(a||_runCallbacks("onclose_end",o),a&&_runCallbacks("onshow_end",o),l&&_runCallbacks("onhide_end",o))}var o=evtPane.call(this,e);if(!state.initialized&&$Ps[o])return _closePane(o,!0),void 0;if(isInitialized()){var s,a,l,h,c=$Ps[o],u=($Rs[o],$Ts[o],options[o]),d=state[o];_c[o],$N.queue(function(e){if(!c||!u.closable&&!d.isShowing&&!d.isHiding||!t&&d.isClosed&&!d.isShowing)return e();var n=!d.isShowing&&!1===_runCallbacks("onclose_start",o);return a=d.isShowing,l=d.isHiding,h=d.isSliding,delete d.isShowing,delete d.isHiding,n?e():(s=!i&&!d.isClosed&&"none"!=u.fxName_close,d.isMoving=!0,d.isClosed=!0,d.isVisible=!1,l?d.isHidden=!0:a&&(d.isHidden=!1),d.isSliding?bindStopSlidingEvents(o,!1):sizeMidPanes("horz"===_c[o].dir?"":"center",!1),setAsClosed(o),s?(lockPaneForFX(o,!0),c.hide(u.fxName_close,u.fxSettings_close,u.fxSpeed_close,function(){lockPaneForFX(o,!1),d.isClosed&&r(),e()})):(_hidePane(o),r(),e()),void 0)})}},setAsClosed=function(e){if($Rs[e]){var t=($Ps[e],$Rs[e]),i=$Ts[e],n=options[e],r=(state[e],_c[e].side),o=n.resizerClass,s=n.togglerClass,a="-"+e,l="-open",h="-sliding",c="-closed";t.css(r,sC.inset[r]).removeClass(o+l+" "+o+a+l).removeClass(o+h+" "+o+a+h).addClass(o+c+" "+o+a+c),n.resizable&&$.layout.plugins.draggable&&t.draggable("disable").removeClass("ui-state-disabled").css("cursor","default").attr("title",""),i&&(i.removeClass(s+l+" "+s+a+l).addClass(s+c+" "+s+a+c).attr("title",n.tips.Open),i.children(".content-open").hide(),i.children(".content-closed").css("display","block")),syncPinBtns(e,!1),state.initialized&&sizeHandles()}},open=function(e,t,i,n){function r(){c.isMoving=!1,_fixIframe(a),c.isSliding||sizeMidPanes("vert"==_c[a].dir?"center":"",!1),setAsOpen(a)}if(isInitialized()){var o,s,a=evtPane.call(this,e),l=$Ps[a],h=($Rs[a],$Ts[a],options[a]),c=state[a];_c[a],$N.queue(function(e){if(!l||!h.resizable&&!h.closable&&!c.isShowing||c.isVisible&&!c.isSliding)return e();if(c.isHidden&&!c.isShowing)return e(),show(a,!0),void 0;c.autoResize&&c.size!=h.size?sizePane(a,h.size,!0,!0,!0):setSizeLimits(a,t);var u=_runCallbacks("onopen_start",a);return"abort"===u?e():("NC"!==u&&setSizeLimits(a,t),c.minSize>c.maxSize?(syncPinBtns(a,!1),!n&&h.tips.noRoomToOpen&&alert(h.tips.noRoomToOpen),e()):(t?bindStopSlidingEvents(a,!0):c.isSliding?bindStopSlidingEvents(a,!1):h.slidable&&bindStartSlidingEvents(a,!1),c.noRoom=!1,makePaneFit(a),s=c.isShowing,delete c.isShowing,o=!i&&c.isClosed&&"none"!=h.fxName_open,c.isMoving=!0,c.isVisible=!0,c.isClosed=!1,s&&(c.isHidden=!1),o?(lockPaneForFX(a,!0),l.show(h.fxName_open,h.fxSettings_open,h.fxSpeed_open,function(){lockPaneForFX(a,!1),c.isVisible&&r(),e()})):(_showPane(a),r(),e()),void 0))})}},setAsOpen=function(e,t){var i=$Ps[e],n=$Rs[e],r=$Ts[e],o=options[e],s=state[e],a=_c[e].side,l=o.resizerClass,h=o.togglerClass,c="-"+e,u="-open",d="-closed",p="-sliding";n.css(a,sC.inset[a]+getPaneSize(e)).removeClass(l+d+" "+l+c+d).addClass(l+u+" "+l+c+u),s.isSliding?n.addClass(l+p+" "+l+c+p):n.removeClass(l+p+" "+l+c+p),removeHover(0,n),o.resizable&&$.layout.plugins.draggable?n.draggable("enable").css("cursor",o.resizerCursor).attr("title",o.tips.Resize):s.isSliding||n.css("cursor","default"),r&&(r.removeClass(h+d+" "+h+c+d).addClass(h+u+" "+h+c+u).attr("title",o.tips.Close),removeHover(0,r),r.children(".content-closed").hide(),r.children(".content-open").css("display","block")),syncPinBtns(e,!s.isSliding),$.extend(s,elDims(i)),state.initialized&&(sizeHandles(),sizeContent(e,!0)),!t&&(state.initialized||o.triggerEventsOnLoad)&&i.is(":visible")&&(_runCallbacks("onopen_end",e),s.isShowing&&_runCallbacks("onshow_end",e),state.initialized&&_runCallbacks("onresize_end",e))},slideOpen=function(e){function t(){r.isClosed?r.isMoving||open(n,!0):bindStopSlidingEvents(n,!0)}if(isInitialized()){var i=evtObj(e),n=evtPane.call(this,e),r=state[n],o=options[n].slideDelay_open;i&&i.stopImmediatePropagation(),r.isClosed&&i&&"mouseenter"===i.type&&o>0?timer.set(n+"_openSlider",t,o):t()}},slideClose=function(e){function t(){o.isClosed?bindStopSlidingEvents(n,!1):o.isMoving||close(n)}if(isInitialized()){var i=evtObj(e),n=evtPane.call(this,e),r=options[n],o=state[n],s=o.isMoving?1e3:300;if(!o.isClosed&&!o.isResizing)if("click"===r.slideTrigger_close)t();else{if(r.preventQuickSlideClose&&o.isMoving)return;if(r.preventPrematureSlideClose&&i&&$.layout.isMouseOverElem(i,$Ps[n]))return;i?timer.set(n+"_closeSlider",t,max(r.slideDelay_close,s)):t()}}},slideToggle=function(e){var t=evtPane.call(this,e);toggle(t,!0)},lockPaneForFX=function(e,t){var i=$Ps[e],n=state[e],r=options[e],o=options.zIndexes;t?(showMasks(e,{animation:!0,objectsOnly:!0}),i.css({zIndex:o.pane_animate}),"south"==e?i.css({top:sC.inset.top+sC.innerHeight-i.outerHeight()}):"east"==e&&i.css({left:sC.inset.left+sC.innerWidth-i.outerWidth()})):(hideMasks(),i.css({zIndex:n.isSliding?o.pane_sliding:o.pane_normal}),"south"==e?i.css({top:"auto"}):"east"!=e||i.css("left").match(/\-99999/)||i.css({left:"auto"}),browser.msie&&r.fxOpacityFix&&"slide"!=r.fxName_open&&i.css("filter")&&1==i.css("opacity")&&i[0].style.removeAttribute("filter"))},bindStartSlidingEvents=function(e,t){var i=options[e],n=($Ps[e],$Rs[e]),r=i.slideTrigger_open.toLowerCase();!n||t&&!i.slidable||(r.match(/mouseover/)?r=i.slideTrigger_open="mouseenter":r.match(/(click|dblclick|mouseenter)/)||(r=i.slideTrigger_open="click"),i.resizerDblClickToggle&&r.match(/click/)&&n[t?"unbind":"bind"]("dblclick."+sID,toggle),n[t?"bind":"unbind"](r+"."+sID,slideOpen).css("cursor",t?i.sliderCursor:"default").attr("title",t?i.tips.Slide:""))},bindStopSlidingEvents=function(e,t){function i(t){timer.clear(e+"_closeSlider"),t.stopPropagation()}var n=options[e],r=state[e],o=(_c[e],options.zIndexes),s=n.slideTrigger_close.toLowerCase(),a=t?"bind":"unbind",l=$Ps[e],h=$Rs[e];timer.clear(e+"_closeSlider"),t?(r.isSliding=!0,state.panesSliding[e]=!0,bindStartSlidingEvents(e,!1)):(r.isSliding=!1,delete state.panesSliding[e]),l.css("zIndex",t?o.pane_sliding:o.pane_normal),h.css("zIndex",t?o.pane_sliding+2:o.resizer_normal),s.match(/(click|mouseleave)/)||(s=n.slideTrigger_close="mouseleave"),h[a](s,slideClose),"mouseleave"===s&&(l[a]("mouseleave."+sID,slideClose),h[a]("mouseenter."+sID,i),l[a]("mouseenter."+sID,i)),t?"click"!==s||n.resizable||(h.css("cursor",t?n.sliderCursor:"default"),h.attr("title",t?n.tips.Close:"")):timer.clear(e+"_closeSlider")},makePaneFit=function(e,t,i,n){var r=options[e],o=state[e],s=_c[e],a=$Ps[e],l=$Rs[e],h="vert"===s.dir,c=!1;if(("center"===e||h&&o.noVerticalRoom)&&(c=o.maxHeight>=0,c&&o.noRoom?(_showPane(e),l&&l.show(),o.isVisible=!0,o.noRoom=!1,h&&(o.noVerticalRoom=!1),_fixIframe(e)):c||o.noRoom||(_hidePane(e),l&&l.hide(),o.isVisible=!1,o.noRoom=!0)),"center"===e);else if(o.minSize<=o.maxSize){if(c=!0,o.size>o.maxSize)sizePane(e,o.maxSize,i,!0,n);else if(o.size<o.minSize)sizePane(e,o.minSize,i,!0,n);else if(l&&o.isVisible&&a.is(":visible")){var u=o.size+sC.inset[s.side];$.layout.cssNum(l,s.side)!=u&&l.css(s.side,u)}o.noRoom&&(o.wasOpen&&r.closable?r.autoReopen?open(e,!1,!0,!0):o.noRoom=!1:show(e,o.wasOpen,!0,!0))}else o.noRoom||(o.noRoom=!0,o.wasOpen=!o.isClosed&&!o.isSliding,o.isClosed||(r.closable?close(e,!0,!0):hide(e,!0)))},manualSizePane=function(e,t,i,n,r){if(isInitialized()){var o=evtPane.call(this,e),s=options[o],a=state[o],l=r||s.livePaneResizing&&!a.isResizing;a.autoResize=!1,sizePane(o,t,i,n,l)}},sizePane=function(e,t,i,n,r){function o(){for(var e="width"===f?u.outerWidth():u.outerHeight(),n=[{pane:l,count:1,target:t,actual:e,correct:t===e,attempt:t,cssSize:a}],o=n[0],h={},g="Inaccurate size after resizing the "+l+"-pane.";!(o.correct||(h={pane:l,count:o.count+1,target:t},h.attempt=o.actual>t?max(0,o.attempt-(o.actual-t)):max(0,o.attempt+(t-o.actual)),h.cssSize=cssSize(l,h.attempt),u.css(f,h.cssSize),h.actual="width"==f?u.outerWidth():u.outerHeight(),h.correct=t===h.actual,1===n.length&&(_log(g,!1,!0),_log(o,!1,!0)),_log(h,!1,!0),n.length>3));)n.push(h),o=n[n.length-1];c.size=t,$.extend(c,elDims(u)),c.isVisible&&u.is(":visible")&&(d&&d.css(p,t+sC.inset[p]),sizeContent(l)),!i&&!m&&state.initialized&&c.isVisible&&_runCallbacks("onresize_end",l),i||(c.isSliding||sizeMidPanes("horz"==_c[l].dir?"":"center",m,r),sizeHandles());var v=_c.oppositeEdge[l];s>t&&state[v].noRoom&&(setSizeLimits(v),makePaneFit(v,!1,i)),n.length>1&&_log(g+"\nSee the Error Console for details.",!0,!0)}if(isInitialized()){var s,a,l=evtPane.call(this,e),h=options[l],c=state[l],u=$Ps[l],d=$Rs[l],p=_c[l].side,f=_c[l].sizeType.toLowerCase(),m=c.isResizing&&!h.triggerEventsDuringLiveResize,g=n!==!0&&h.animatePaneSizing;$N.queue(function(e){if(setSizeLimits(l),s=c.size,t=_parseSize(l,t),t=max(t,_parseSize(l,h.minSize)),t=min(t,c.maxSize),t<c.minSize)return e(),makePaneFit(l,!1,i),void 0;if(!r&&t===s)return e();if(c.newSize=t,!i&&state.initialized&&c.isVisible&&_runCallbacks("onresize_start",l),a=cssSize(l,t),g&&u.is(":visible")){var n=$.layout.effects.size[l]||$.layout.effects.size.all,d=h.fxSettings_size.easing||n.easing,p=options.zIndexes,m={};m[f]=a+"px",c.isMoving=!0,u.css({zIndex:p.pane_animate}).show().animate(m,h.fxSpeed_size,d,function(){u.css({zIndex:c.isSliding?p.pane_sliding:p.pane_normal}),c.isMoving=!1,delete c.newSize,o(),e()})}else u.css(f,a),delete c.newSize,u.is(":visible")?o():(c.size=t,$.extend(c,elDims(u))),e()})}},sizeMidPanes=function(e,t,i){e=(e?e:"east,west,center").split(","),$.each(e,function(e,n){if($Ps[n]){var r=options[n],o=state[n],s=$Ps[n],a=($Rs[n],!0),l={},h=$.layout.showInvisibly(s),c=calcNewCenterPaneDims();if($.extend(o,elDims(s)),"center"===n){if(!i&&o.isVisible&&c.width===o.outerWidth&&c.height===o.outerHeight)return s.css(h),!0;if($.extend(o,cssMinDims(n),{maxWidth:c.width,maxHeight:c.height}),l=c,o.newWidth=l.width,o.newHeight=l.height,l.width=cssW(s,l.width),l.height=cssH(s,l.height),a=l.width>=0&&l.height>=0,!state.initialized&&r.minWidth>c.width){var u=r.minWidth-o.outerWidth,d=options.east.minSize||0,p=options.west.minSize||0,f=state.east.size,m=state.west.size,g=f,v=m;if(u>0&&state.east.isVisible&&f>d&&(g=max(f-d,f-u),u-=f-g),u>0&&state.west.isVisible&&m>p&&(v=max(m-p,m-u),u-=m-v),0===u)return f&&f!=d&&sizePane("east",g,!0,!0,i),m&&m!=p&&sizePane("west",v,!0,!0,i),sizeMidPanes("center",t,i),s.css(h),void 0}}else{if(o.isVisible&&!o.noVerticalRoom&&$.extend(o,elDims(s),cssMinDims(n)),!i&&!o.noVerticalRoom&&c.height===o.outerHeight)return s.css(h),!0;l.top=c.top,l.bottom=c.bottom,o.newSize=c.height,l.height=cssH(s,c.height),o.maxHeight=l.height,a=o.maxHeight>=0,a||(o.noVerticalRoom=!0)}if(a?(!t&&state.initialized&&_runCallbacks("onresize_start",n),s.css(l),"center"!==n&&sizeHandles(n),!o.noRoom||o.isClosed||o.isHidden||makePaneFit(n),o.isVisible&&($.extend(o,elDims(s)),state.initialized&&sizeContent(n))):!o.noRoom&&o.isVisible&&makePaneFit(n),s.css(h),delete o.newSize,delete o.newWidth,delete o.newHeight,!o.isVisible)return!0;if("center"===n){var y=browser.isIE6||!browser.boxModel;$Ps.north&&(y||"IFRAME"==state.north.tagName)&&$Ps.north.css("width",cssW($Ps.north,sC.innerWidth)),$Ps.south&&(y||"IFRAME"==state.south.tagName)&&$Ps.south.css("width",cssW($Ps.south,sC.innerWidth))}!t&&state.initialized&&_runCallbacks("onresize_end",n)}})},resizeAll=function(e){var t=sC.innerWidth,i=sC.innerHeight;if(evtPane(e),$N.is(":visible")){if(!state.initialized)return _initLayoutElements(),void 0;if(e===!0&&$.isPlainObject(options.outset)&&$N.css(options.outset),$.extend(sC,elDims($N,options.inset)),sC.outerHeight){if(e===!0&&setPanePosition(),!1===_runCallbacks("onresizeall_start"))return!1;var n,r,o;sC.innerHeight<i,sC.innerWidth<t,$.each(["south","north","east","west"],function(e,t){$Ps[t]&&(r=options[t],o=state[t],o.autoResize&&o.size!=r.size?sizePane(t,r.size,!0,!0,!0):(setSizeLimits(t),makePaneFit(t,!1,!0,!0)))}),sizeMidPanes("",!0,!0),sizeHandles(),$.each(_c.allPanes,function(e,t){n=$Ps[t],n&&state[t].isVisible&&_runCallbacks("onresize_end",t)}),_runCallbacks("onresizeall_end")}}},resizeChildren=function(e,t){var i=evtPane.call(this,e);if(options[i].resizeChildren){t||refreshChildren(i);var n=children[i];$.isPlainObject(n)&&$.each(n,function(e,t){t.destroyed||t.resizeAll()})}},sizeContent=function(e,t){if(isInitialized()){var i=evtPane.call(this,e);i=i?i.split(","):_c.allPanes,$.each(i,function(e,i){function n(e){return max(l.css.paddingBottom,parseInt(e.css("marginBottom"),10)||0)}function r(){var e=options[i].contentIgnoreSelector,t=s.nextAll().not(".ui-layout-mask").not(e||":lt(0)"),r=t.filter(":visible"),o=r.filter(":last");h={top:s[0].offsetTop,height:s.outerHeight(),numFooters:t.length,hiddenFooters:t.length-r.length,spaceBelow:0},h.spaceAbove=h.top,h.bottom=h.top+h.height,h.spaceBelow=o.length?o[0].offsetTop+o.outerHeight()-h.bottom+n(o):n(s)}var o=$Ps[i],s=$Cs[i],a=options[i],l=state[i],h=l.content;if(!o||!s||!o.is(":visible"))return!0;if((s.length||(initContent(i,!1),s))&&!1!==_runCallbacks("onsizecontent_start",i)){(!l.isMoving&&!l.isResizing||a.liveContentResizing||t||void 0==h.top)&&(r(),h.hiddenFooters>0&&"hidden"===o.css("overflow")&&(o.css("overflow","visible"),r(),o.css("overflow","hidden")));var c=l.innerHeight-(h.spaceAbove-l.css.paddingTop)-(h.spaceBelow-l.css.paddingBottom);s.is(":visible")&&h.height==c||(setOuterHeight(s,c,!0),h.height=c),state.initialized&&_runCallbacks("onsizecontent_end",i)}})}},sizeHandles=function(e){var t=evtPane.call(this,e);t=t?t.split(","):_c.borderPanes,$.each(t,function(e,t){var i,n=options[t],r=state[t],o=$Ps[t],s=$Rs[t],a=$Ts[t];if(o&&s){var l,h,c,u=_c[t].dir,d=r.isClosed?"_closed":"_open",p=n["spacing"+d],f=n["togglerAlign"+d],m=n["togglerLength"+d];if(0===p)return s.hide(),void 0;if(r.noRoom||r.isHidden||s.show(),"horz"===u?(l=sC.innerWidth,r.resizerLength=l,h=$.layout.cssNum(o,"left"),s.css({width:cssW(s,l),height:cssH(s,p),left:h>-9999?h:sC.inset.left})):(l=o.outerHeight(),r.resizerLength=l,s.css({height:cssH(s,l),width:cssW(s,p),top:sC.inset.top+getPaneSize("north",!0)})),removeHover(n,s),a){if(0===m||r.isSliding&&n.hideTogglerOnSlide)return a.hide(),void 0;if(a.show(),!(m>0)||"100%"===m||m>l)m=l,c=0;else if(isStr(f))switch(f){case"top":case"left":c=0;break;case"bottom":case"right":c=l-m;break;case"middle":case"center":default:c=round((l-m)/2)}else{var g=parseInt(f,10);c=f>=0?g:l-m+g}if("horz"===u){var v=cssW(a,m);a.css({width:v,height:cssH(a,p),left:c,top:0}),a.children(".content").each(function(){i=$(this),i.css("marginLeft",round((v-i.outerWidth())/2))})}else{var y=cssH(a,m);a.css({height:y,width:cssW(a,p),top:c,left:0}),a.children(".content").each(function(){i=$(this),i.css("marginTop",round((y-i.outerHeight())/2))})}removeHover(0,a)}state.initialized||!n.initHidden&&!r.isHidden||(s.hide(),a&&a.hide())}})},enableClosable=function(e){if(isInitialized()){var t=evtPane.call(this,e),i=$Ts[t],n=options[t];i&&(n.closable=!0,i.bind("click."+sID,function(e){e.stopPropagation(),toggle(t)}).css("visibility","visible").css("cursor","pointer").attr("title",state[t].isClosed?n.tips.Open:n.tips.Close).show())}},disableClosable=function(e,t){if(isInitialized()){var i=evtPane.call(this,e),n=$Ts[i];n&&(options[i].closable=!1,state[i].isClosed&&open(i,!1,!0),n.unbind("."+sID).css("visibility",t?"hidden":"visible").css("cursor","default").attr("title",""))}},enableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),i=$Rs[t];i&&i.data("draggable")&&(options[t].slidable=!0,state[t].isClosed&&bindStartSlidingEvents(t,!0))}},disableSlidable=function(e){if(isInitialized()){var t=evtPane.call(this,e),i=$Rs[t];i&&(options[t].slidable=!1,state[t].isSliding?close(t,!1,!0):(bindStartSlidingEvents(t,!1),i.css("cursor","default").attr("title",""),removeHover(null,i[0])))}},enableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),i=$Rs[t],n=options[t];i&&i.data("draggable")&&(n.resizable=!0,i.draggable("enable"),state[t].isClosed||i.css("cursor",n.resizerCursor).attr("title",n.tips.Resize))}},disableResizable=function(e){if(isInitialized()){var t=evtPane.call(this,e),i=$Rs[t];i&&i.data("draggable")&&(options[t].resizable=!1,i.draggable("disable").css("cursor","default").attr("title",""),removeHover(null,i[0]))}},swapPanes=function(e,t){function i(e){var t=$Ps[e],i=$Cs[e];return t?{pane:e,P:t?t[0]:!1,C:i?i[0]:!1,state:$.extend(!0,{},state[e]),options:$.extend(!0,{},options[e])}:!1}function n(e,t){if(e){var i,n,r=e.P,o=e.C,s=e.pane,l=_c[t],h=$.extend(!0,{},state[t]),c=options[t],u={resizerCursor:c.resizerCursor};$.each("fxName,fxSpeed,fxSettings".split(","),function(e,t){u[t+"_open"]=c[t+"_open"],u[t+"_close"]=c[t+"_close"],u[t+"_size"]=c[t+"_size"]}),$Ps[t]=$(r).data({layoutPane:Instance[t],layoutEdge:t}).css(_c.hidden).css(l.cssReq),$Cs[t]=o?$(o):!1,options[t]=$.extend(!0,{},e.options,u),state[t]=$.extend(!0,{},e.state),i=new RegExp(c.paneClass+"-"+s,"g"),r.className=r.className.replace(i,c.paneClass+"-"+t),initHandles(t),l.dir!=_c[s].dir?(n=a[t]||0,setSizeLimits(t),n=max(n,state[t].minSize),manualSizePane(t,n,!0,!0)):$Rs[t].css(l.side,sC.inset[l.side]+(state[t].isVisible?getPaneSize(t):0)),e.state.isVisible&&!h.isVisible?setAsOpen(t,!0):(setAsClosed(t),bindStartSlidingEvents(t,!0)),e=null}}if(isInitialized()){var r=evtPane.call(this,e);if(state[r].edge=t,state[t].edge=r,!1===_runCallbacks("onswap_start",r)||!1===_runCallbacks("onswap_start",t))return state[r].edge=r,state[t].edge=t,void 0;var o=i(r),s=i(t),a={};a[r]=o?o.state.size:0,a[t]=s?s.state.size:0,$Ps[r]=!1,$Ps[t]=!1,state[r]={},state[t]={},$Ts[r]&&$Ts[r].remove(),$Ts[t]&&$Ts[t].remove(),$Rs[r]&&$Rs[r].remove(),$Rs[t]&&$Rs[t].remove(),$Rs[r]=$Rs[t]=$Ts[r]=$Ts[t]=!1,n(o,t),n(s,r),o=s=a=null,$Ps[r]&&$Ps[r].css(_c.visible),$Ps[t]&&$Ps[t].css(_c.visible),resizeAll(),_runCallbacks("onswap_end",r),_runCallbacks("onswap_end",t)}},syncPinBtns=function(e,t){$.layout.plugins.buttons&&$.each(state[e].pins,function(i,n){$.layout.buttons.setPinState(Instance,$(n),e,t)})},$N=$(this).eq(0);if(!$N.length)return _log(options.errors.containerMissing);if($N.data("layoutContainer")&&$N.data("layout"))return $N.data("layout");var $Ps={},$Cs={},$Rs={},$Ts={},$Ms=$([]),sC=state.container,sID=state.id,Instance={options:options,state:state,container:$N,panes:$Ps,contents:$Cs,resizers:$Rs,togglers:$Ts,hide:hide,show:show,toggle:toggle,open:open,close:close,slideOpen:slideOpen,slideClose:slideClose,slideToggle:slideToggle,setSizeLimits:setSizeLimits,_sizePane:sizePane,sizePane:manualSizePane,sizeContent:sizeContent,swapPanes:swapPanes,showMasks:showMasks,hideMasks:hideMasks,initContent:initContent,addPane:addPane,removePane:removePane,createChildren:createChildren,refreshChildren:refreshChildren,enableClosable:enableClosable,disableClosable:disableClosable,enableSlidable:enableSlidable,disableSlidable:disableSlidable,enableResizable:enableResizable,disableResizable:disableResizable,allowOverflow:allowOverflow,resetOverflow:resetOverflow,destroy:destroy,initPanes:isInitialized,resizeAll:resizeAll,runCallbacks:_runCallbacks,hasParentLayout:!1,children:children,north:!1,south:!1,west:!1,east:!1,center:!1};return"cancel"===_create()?null:Instance}}(jQuery),function(e){e.ui||(e.ui={}),e.ui.cookie={acceptsCookies:!!navigator.cookieEnabled,read:function(t){for(var i,n=document.cookie,r=n?n.split(";"):[],o=0,s=r.length;s>o;o++)if(i=e.trim(r[o]).split("="),i[0]==t)return decodeURIComponent(i[1]);return null},write:function(t,i,n){var r="",o="",s=!1,a=n||{},l=a.expires||null,h=e.type(l);"date"===h?o=l:"string"===h&&l>0&&(l=parseInt(l,10),h="number"),"number"===h&&(o=new Date,l>0?o.setDate(o.getDate()+l):(o.setFullYear(1970),s=!0)),o&&(r+=";expires="+o.toUTCString()),a.path&&(r+=";path="+a.path),a.domain&&(r+=";domain="+a.domain),a.secure&&(r+=";secure"),document.cookie=t+"="+(s?"":encodeURIComponent(i))+r},clear:function(t){e.ui.cookie.write(t,"",{expires:-1})}},e.cookie||(e.cookie=function(t,i,n){var r=e.ui.cookie;if(null===i)r.clear(t);else{if(void 0===i)return r.read(t);r.write(t,i,n)}}),e.layout.plugins.stateManagement=!0,e.layout.config.optionRootKeys.push("stateManagement"),e.layout.defaults.stateManagement={enabled:!1,autoSave:!0,autoLoad:!0,animateLoad:!0,includeChildren:!0,stateKeys:"north.size,south.size,east.size,west.size,north.isClosed,south.isClosed,east.isClosed,west.isClosed,north.isHidden,south.isHidden,east.isHidden,west.isHidden",cookie:{name:"",domain:"",path:"",expires:"",secure:!1}},e.layout.optionsMap.layout.push("stateManagement"),e.layout.state={saveCookie:function(t,i,n){var r=t.options,o=r.stateManagement,s=e.extend(!0,{},o.cookie,n||null),a=t.state.stateData=t.readState(i||o.stateKeys);return e.ui.cookie.write(s.name||r.name||"Layout",e.layout.state.encodeJSON(a),s),e.extend(!0,{},a)},deleteCookie:function(t){var i=t.options;e.ui.cookie.clear(i.stateManagement.cookie.name||i.name||"Layout")},readCookie:function(t){var i=t.options,n=e.ui.cookie.read(i.stateManagement.cookie.name||i.name||"Layout");return n?e.layout.state.decodeJSON(n):{}},loadCookie:function(t){var i=e.layout.state.readCookie(t);return i&&(t.state.stateData=e.extend(!0,{},i),t.loadState(i)),i},loadState:function(t,i,n){if(e.isPlainObject(i)&&!e.isEmptyObject(i)){i=t.state.stateData=e.layout.transformData(i);var r=t.options.stateManagement;if(n=e.extend({animateLoad:!1,includeChildren:r.includeChildren},n),t.state.initialized){var o,a,l,h,c,u=!n.animateLoad;if(e.each(e.layout.config.borderPanes,function(n,r){o=i[r],e.isPlainObject(o)&&(s=o.size,a=o.initClosed,l=o.initHidden,ar=o.autoResize,h=t.state[r],c=h.isVisible,ar&&(h.autoResize=ar),c||t._sizePane(r,s,!1,!1,!1),l===!0?t.hide(r,u):a===!0?t.close(r,!1,u):a===!1?t.open(r,!1,u):l===!1&&t.show(r,!1,u),c&&t._sizePane(r,s,!1,!1,u))}),n.includeChildren){var d,p;e.each(t.children,function(t,n){d=i[t]?i[t].children:0,d&&n&&e.each(n,function(e,t){p=d[e],t&&p&&t.loadState(p)})})}}else{var o=e.extend(!0,{},i);e.each(e.layout.config.allPanes,function(e,t){o[t]&&delete o[t].children}),e.extend(!0,t.options,o)}}},readState:function(t,i){"string"===e.type(i)&&(i={keys:i}),i||(i={});var n,r,o,s,a,l,h,c=t.options.stateManagement,u=i.includeChildren,d=void 0!==u?u:c.includeChildren,p=i.stateKeys||c.stateKeys,f={isClosed:"initClosed",isHidden:"initHidden"},m=t.state,g=e.layout.config.allPanes,v={};e.isArray(p)&&(p=p.join(",")),p=p.replace(/__/g,".").split(",");for(var y=0,_=p.length;_>y;y++)n=p[y].split("."),r=n[0],o=n[1],e.inArray(r,g)<0||(s=m[r][o],void 0!=s&&("isClosed"==o&&m[r].isSliding&&(s=!0),(v[r]||(v[r]={}))[f[o]?f[o]:o]=s));return d&&e.each(g,function(i,n){l=t.children[n],a=m.stateData[n],e.isPlainObject(l)&&!e.isEmptyObject(l)&&(h=v[n]||(v[n]={}),h.children||(h.children={}),e.each(l,function(t,i){i.state.initialized?h.children[t]=e.layout.state.readState(i):a&&a.children&&a.children[t]&&(h.children[t]=e.extend(!0,{},a.children[t]))}))}),v},encodeJSON:function(t){function i(t){var n,r,o,s=[],a=0,l=e.isArray(t);for(n in t)r=t[n],o=typeof r,"string"==o?r='"'+r+'"':"object"==o&&(r=i(r)),s[a++]=(l?"":'"'+n+'":')+r;return(l?"[":"{")+s.join(",")+(l?"]":"}")}return i(t)},decodeJSON:function(t){try{return e.parseJSON?e.parseJSON(t):window.eval("("+t+")")||{}}catch(i){return{}}},_create:function(t){var i=e.layout.state,n=t.options,r=n.stateManagement;if(e.extend(t,{readCookie:function(){return i.readCookie(t)},deleteCookie:function(){i.deleteCookie(t)},saveCookie:function(e,n){return i.saveCookie(t,e,n)},loadCookie:function(){return i.loadCookie(t)},loadState:function(e,n){i.loadState(t,e,n)},readState:function(e){return i.readState(t,e)},encodeJSON:i.encodeJSON,decodeJSON:i.decodeJSON}),t.state.stateData={},r.autoLoad)if(e.isPlainObject(r.autoLoad))e.isEmptyObject(r.autoLoad)||t.loadState(r.autoLoad);else if(r.enabled)if(e.isFunction(r.autoLoad)){var o={};try{o=r.autoLoad(t,t.state,t.options,t.options.name||"")}catch(s){}o&&e.isPlainObject(o)&&!e.isEmptyObject(o)&&t.loadState(o)}else t.loadCookie()},_unload:function(t){var i=t.options.stateManagement;if(i.enabled&&i.autoSave)if(e.isFunction(i.autoSave))try{i.autoSave(t,t.state,t.options,t.options.name||"")}catch(n){}else t.saveCookie()}},e.layout.onCreate.push(e.layout.state._create),e.layout.onUnload.push(e.layout.state._unload),e.layout.plugins.buttons=!0,e.layout.defaults.autoBindCustomButtons=!1,e.layout.optionsMap.layout.push("autoBindCustomButtons"),e.layout.buttons={init:function(t){var i,n="ui-layout-button-",r=t.options.name||"";e.each("toggle,open,close,pin,toggle-slide,open-slide".split(","),function(o,s){e.each(e.layout.config.borderPanes,function(o,a){e("."+n+s+"-"+a).each(function(){i=e(this).data("layoutName")||e(this).attr("layoutName"),(void 0==i||i===r)&&t.bindButton(this,s,a)})})})},get:function(t,i,n,r){var o=e(i),s=t.options,a=s.errors.addButtonError;if(o.length)if(e.inArray(n,e.layout.config.borderPanes)<0)e.layout.msg(a+" "+s.errors.pane+": "+n,!0),o=e("");else{var l=s[n].buttonClass+"-"+r;o.addClass(l+" "+l+"-"+n).data("layoutName",s.name)}else e.layout.msg(a+" "+s.errors.selector+": "+i,!0);return o},bind:function(t,i,n,r){var o=e.layout.buttons;switch(n.toLowerCase()){case"toggle":o.addToggle(t,i,r);break;case"open":o.addOpen(t,i,r);break;case"close":o.addClose(t,i,r);break;case"pin":o.addPin(t,i,r);break;case"toggle-slide":o.addToggle(t,i,r,!0);break;case"open-slide":o.addOpen(t,i,r,!0)}return t},addToggle:function(t,i,n,r){return e.layout.buttons.get(t,i,n,"toggle").click(function(e){t.toggle(n,!!r),e.stopPropagation()}),t},addOpen:function(t,i,n,r){return e.layout.buttons.get(t,i,n,"open").attr("title",t.options[n].tips.Open).click(function(e){t.open(n,!!r),e.stopPropagation()}),t},addClose:function(t,i,n){return e.layout.buttons.get(t,i,n,"close").attr("title",t.options[n].tips.Close).click(function(e){t.close(n),e.stopPropagation()}),t},addPin:function(t,i,n){var r=e.layout.buttons,o=r.get(t,i,n,"pin");if(o.length){var s=t.state[n];o.click(function(i){r.setPinState(t,e(this),n,s.isSliding||s.isClosed),s.isSliding||s.isClosed?t.open(n):t.close(n),i.stopPropagation()}),r.setPinState(t,o,n,!s.isClosed&&!s.isSliding),s.pins.push(i)}return t},setPinState:function(e,t,i,n){var r=t.attr("pin");if(!r||n!==("down"==r)){var o=e.options[i],s=o.buttonClass+"-pin",a=s+"-"+i,l=s+"-up "+a+"-up",h=s+"-down "+a+"-down";t.attr("pin",n?"down":"up").attr("title",n?o.tips.Unpin:o.tips.Pin).removeClass(n?l:h).addClass(n?h:l)}},syncPinBtns:function(t,i,n){e.each(t.state[i].pins,function(r,o){e.layout.buttons.setPinState(t,e(o),i,n)})},_load:function(t){var i=e.layout.buttons;e.extend(t,{bindButton:function(e,n,r){return i.bind(t,e,n,r)},addToggleBtn:function(e,n,r){return i.addToggle(t,e,n,r)},addOpenBtn:function(e,n,r){return i.addOpen(t,e,n,r)},addCloseBtn:function(e,n){return i.addClose(t,e,n)},addPinBtn:function(e,n){return i.addPin(t,e,n)}});for(var n=0;4>n;n++){var r=e.layout.config.borderPanes[n];t.state[r].pins=[]}t.options.autoBindCustomButtons&&i.init(t)},_unload:function(){}},e.layout.onLoad.push(e.layout.buttons._load),e.layout.plugins.browserZoom=!0,e.layout.defaults.browserZoomCheckInterval=1e3,e.layout.optionsMap.layout.push("browserZoomCheckInterval"),e.layout.browserZoom={_init:function(t){e.layout.browserZoom.ratio()!==!1&&e.layout.browserZoom._setTimer(t)},_setTimer:function(t){if(!t.destroyed){var i=t.options,n=t.state,r=t.hasParentLayout?5e3:Math.max(i.browserZoomCheckInterval,100);setTimeout(function(){if(!t.destroyed&&i.resizeWithWindow){var r=e.layout.browserZoom.ratio();r!==n.browserZoom&&(n.browserZoom=r,t.resizeAll()),e.layout.browserZoom._setTimer(t)}},r)}},ratio:function(){function t(e,t){return(100*(parseInt(e,10)/parseInt(t,10))).toFixed()}var i,n,r,o=window,s=screen,a=document,l=a.documentElement||a.body,h=e.layout.browser,c=h.version;return h.msie&&c>8||!h.msie?!1:s.deviceXDPI&&s.systemXDPI?t(s.deviceXDPI,s.systemXDPI):h.webkit&&(i=a.body.getBoundingClientRect)?t(i.left-i.right,a.body.offsetWidth):h.webkit&&(n=o.outerWidth)?t(n,o.innerWidth):(n=s.width)&&(r=l.clientWidth)?t(n,r):!1}},e.layout.onReady.push(e.layout.browserZoom._init)}(jQuery),define("jquery.layout",["jquery","jquery.ui"],function(e){return function(){var t;return t||e.jquery}}(this)),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/UI",["require","Underscore","Backbone","text!templates/app_ui.tmpl.html","cs!threenodes/views/sidebar/Sidebar","cs!threenodes/views/Breadcrumb","cs!threenodes/views/MenuBar","RequestAnimationFrame","Raphael","jquery.ui","libs/jquery.transform2d","libs/jquery-scrollview/jquery.scrollview","jquery.layout"],function(t){var n,r,o,s,a,l,h,c;return l=t("Underscore"),n=t("Backbone"),c=t("text!templates/app_ui.tmpl.html"),s=t("cs!threenodes/views/sidebar/Sidebar"),r=t("cs!threenodes/views/Breadcrumb"),o=t("cs!threenodes/views/MenuBar"),t("RequestAnimationFrame"),t("Raphael"),t("jquery.ui"),t("libs/jquery.transform2d"),t("libs/jquery-scrollview/jquery.scrollview"),t("jquery.layout"),a=function(t){function n(){return this.animate=e(this.animate,this),this.onUiWindowResize=e(this.onUiWindowResize,this),this.showApplication=e(this.showApplication,this),this.initResizeSlider=e(this.initResizeSlider,this),this.initBottomToolbox=e(this.initBottomToolbox,this),this.initDisplayModeSwitch=e(this.initDisplayModeSwitch,this),this.switchDisplayMode=e(this.switchDisplayMode,this),this.scrollTo=e(this.scrollTo,this),this.setupMouseScroll=e(this.setupMouseScroll,this),this.setDisplayMode=e(this.setDisplayMode,this),this.initLayout=e(this.initLayout,this),this.initMenubar=e(this.initMenubar,this),this.clearWorkspace=e(this.clearWorkspace,this),this.onNodeListRebuild=e(this.onNodeListRebuild,this),h=n.__super__.constructor.apply(this,arguments)
}return i(n,t),n.svg=!1,n.connecting_line=!1,n.prototype.initialize=function(e){var t;return n.__super__.initialize.apply(this,arguments),this.settings=e.settings,this.is_grabbing=!1,$(window).resize(this.onUiWindowResize),t=l.template(c,{}),this.$el.append(t),this.breadcrumb=new r({el:$("#breadcrumb")}),n.svg=Raphael("graph",4e3,4e3),n.connecting_line=n.svg.path("M0 -20 L0 -20").attr({stroke:"#fff","stroke-dasharray":"-",fill:"none",opacity:0}),this.sidebar=new s({el:$("#sidebar")}),this.initMenubar(),this.initLayout(),this.showApplication(),this.onUiWindowResize(),this.animate()},n.prototype.onNodeListRebuild=function(e){var t,i=this;return this.timeoutId&&clearTimeout(this.timeoutId),t=function(){return i.sidebar.render(e)},this.timeoutId=setTimeout(t,10)},n.prototype.clearWorkspace=function(){return this.sidebar.clearWorkspace()},n.prototype.initMenubar=function(){var e,t,i=this;return t=l.template(o.template,{}),e=$(t).prependTo("body"),this.menubar=new o({el:e}),this.menubar.on("ToggleAttributes",function(){return i.layout?i.layout.toggle("west"):void 0}),this.menubar.on("ToggleLibrary",function(){return i.layout?i.layout.toggle("east"):void 0}),this.menubar.on("ToggleTimeline",function(){return i.layout?i.layout.toggle("south"):void 0}),this},n.prototype.initLayout=function(){var e=this;return this.makeSelectable(),this.setupMouseScroll(),this.initBottomToolbox(),this.initDisplayModeSwitch(),this.layout=$("body").layout({scrollToBookmarkOnLoad:!1,animatePaneSizing:!1,fxName:"none",center:{size:"100%"},north:{closable:!1,resizable:!1,slidable:!1,showOverflowOnHover:!0,size:27,resizerClass:"ui-layout-resizer-hidden",spacing_open:0,spacing_closed:0},east:{minSize:220,initClosed:!0,onresize:function(){return e.onUiWindowResize()},onopen:function(){return e.onUiWindowResize()},onclose:function(){return e.onUiWindowResize()}},west:{minSize:220},south:{minSize:48,size:48,onopen:function(t,i){return e.trigger("timelineResize",i.innerHeight()),e.onUiWindowResize()},onclose:function(t,i){return e.trigger("timelineResize",i.innerHeight()),e.onUiWindowResize()},onresize:function(t,i){return e.trigger("timelineResize",i.innerHeight()),e.onUiWindowResize()}}}),this.trigger("timelineResize",48),this},n.prototype.makeSelectable=function(){var e=this;return $("#container").selectable({filter:".node",stop:function(){var t,i,n;return t=$(".node.ui-selected"),n=[],i=[],t.each(function(){var e,t;return e=$(this).data("object"),e.get("parent")?(t=e.get("parent"),t.anim.objectTrack.name=e.get("name"),l.find(n,function(e){return e.cid===t.cid})?void 0:(i.push(t.anim),n.push(t))):(e.anim.objectTrack.name=e.get("name"),i.push(e.anim),n.push(e))}),e.sidebar.clearNodesAttributes(),e.sidebar.renderNodesAttributes(n),e.trigger("selectAnims",i)}}),$("#container").mousedown(function(){return $("input, textarea").trigger("blur")}),this},n.prototype.setDisplayMode=function(e){return null==e&&(e=!1),e===!0?($("body").addClass("player-mode"),$("body").removeClass("editor-mode"),$("#display-mode-switch").html("")):($("body").addClass("editor-mode"),$("body").removeClass("player-mode"),$("#display-mode-switch").html("player mode")),$("#display-mode-switch").toggleClass("icon-pencil",e),this.settings.player_mode=e,e===!1&&this.trigger("renderConnections"),!0},n.prototype.setupMouseScroll=function(){var e,t=this;return this.scroll_target=$("#container-wrapper"),e=function(e){return e.target===$("#graph svg")[0]?!0:!1},this.scroll_target.bind("contextmenu",function(){return!1}),this.scroll_target.mousedown(function(i){return!e(i)||2!==i.which&&3!==i.which?void 0:(t.is_grabbing=!0,t.xp=i.pageX,t.yp=i.pageY,!1)}),this.scroll_target.mousemove(function(i){return e(i)&&t.is_grabbing===!0?(t.scrollTo(t.xp-i.pageX,t.yp-i.pageY),t.xp=i.pageX,t.yp=i.pageY):void 0}),this.scroll_target.mouseout(function(){return t.is_grabbing=!1}),this.scroll_target.mouseup(function(i){return!e(i)||2!==i.which&&3!==i.which?void 0:t.is_grabbing=!1}),!0},n.prototype.scrollTo=function(e,t){var i,n;return i=this.scroll_target.scrollLeft()+e,n=this.scroll_target.scrollTop()+t,this.scroll_target.scrollLeft(i).scrollTop(n)},n.prototype.switchDisplayMode=function(){return this.setDisplayMode(!this.settings.player_mode),this},n.prototype.initDisplayModeSwitch=function(){var e=this;return $("body").append("<div id='display-mode-switch'>switch mode</div>"),$("#display-mode-switch").click(function(){return e.switchDisplayMode()})},n.prototype.initBottomToolbox=function(){var e;return $("body").append("<div id='bottom-toolbox'></div>"),e=$("#bottom-toolbox"),this.initResizeSlider(e)},n.prototype.initResizeSlider=function(e){var t;return e.append("<div id='zoom-slider'></div>"),t=function(e){var t;return t=e/100,$("#container").css("transform","scale("+t+", "+t+")")},$("#zoom-slider").slider({min:25,step:25,value:100,change:function(e,i){return t(i.value)},slide:function(e,i){return t(i.value)}})},n.prototype.showApplication=function(){var e;return e=500,$("body > header").delay(e).hide(),$("#sidebar").delay(e).show(),$("#container-wrapper").delay(e).show(),this.trigger("renderConnections")},n.prototype.onUiWindowResize=function(){var e,t;return e=20,t=25,this.layout.south.state.isClosed===!1&&(e+=$("#timeline").innerHeight()),this.layout.east.state.isClosed===!1&&(t+=$("#library").innerWidth()),$("#bottom-toolbox").attr("style","bottom: "+e+"px !important; right: "+t+"px"),$("#webgl-window").css({right:t})},n.prototype.animate=function(){return this.trigger("render"),requestAnimationFrame(this.animate)},n}(n.View)})}.call(this),define("text!threenodes/fields/templates/node_field_input.tmpl.html",[],function(){return'<span class="inner-field"><span></span><%= name %></span>'}),define("text!threenodes/fields/templates/node_field_output.tmpl.html",[],function(){return'<span class="inner-field"><%= name %><span></span></span>'}),define("text!threenodes/fields/templates/field_context_menu.tmpl.html",[],function(){return'<ul id="field-context-menu" class="context-menu">\n  <li><a href="#removeConnection">Remove connection(s)</a></li>\n</ul>'}),jQuery&&function(){$.extend($.fn,{contextMenu:function(e,t){return void 0==e.menu?!1:(void 0==e.inSpeed&&(e.inSpeed=150),void 0==e.outSpeed&&(e.outSpeed=75),0==e.inSpeed&&(e.inSpeed=-1),0==e.outSpeed&&(e.outSpeed=-1),$(this).each(function(){var i=$(this),n=$(i).offset();$("#"+e.menu).addClass("contextMenu"),$(this).mousedown(function(r){var o=r;o.preventDefault(),$(this).mouseup(function(r){r.preventDefault();var s=$(this);if($(this).unbind("mouseup"),2==o.button){$(".contextMenu").hide();var a=$("#"+e.menu);if($(i).hasClass("disabled"))return!1;var l,h,c={};self.innerHeight?(c.pageYOffset=self.pageYOffset,c.pageXOffset=self.pageXOffset,c.innerHeight=self.innerHeight,c.innerWidth=self.innerWidth):document.documentElement&&document.documentElement.clientHeight?(c.pageYOffset=document.documentElement.scrollTop,c.pageXOffset=document.documentElement.scrollLeft,c.innerHeight=document.documentElement.clientHeight,c.innerWidth=document.documentElement.clientWidth):document.body&&(c.pageYOffset=document.body.scrollTop,c.pageXOffset=document.body.scrollLeft,c.innerHeight=document.body.clientHeight,c.innerWidth=document.body.clientWidth),l=r.pageX?r.pageX:r.clientX+c.scrollLeft,h=r.pageY?r.pageY:r.clientY+c.scrollTop,$(document).unbind("click"),$(a).css({top:h,left:l}).fadeIn(e.inSpeed),$(a).find("A").mouseover(function(){$(a).find("LI.hover").removeClass("hover"),$(this).parent().addClass("hover")}).mouseout(function(){$(a).find("LI.hover").removeClass("hover")}),$(document).keypress(function(e){switch(e.keyCode){case 38:0==$(a).find("LI.hover").size()?$(a).find("LI:last").addClass("hover"):($(a).find("LI.hover").removeClass("hover").prevAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(a).find("LI.hover").size()&&$(a).find("LI:last").addClass("hover"));break;case 40:0==$(a).find("LI.hover").size()?$(a).find("LI:first").addClass("hover"):($(a).find("LI.hover").removeClass("hover").nextAll("LI:not(.disabled)").eq(0).addClass("hover"),0==$(a).find("LI.hover").size()&&$(a).find("LI:first").addClass("hover"));break;case 13:$(a).find("LI.hover A").trigger("click");break;case 27:$(document).trigger("click")}}),$("#"+e.menu).find("A").unbind("click"),$("#"+e.menu).find("LI:not(.disabled) A").click(function(){return $(document).unbind("click").unbind("keypress"),$(".contextMenu").hide(),t&&t($(this).attr("href").substr(1),$(s),{x:l-n.left,y:h-n.top,docX:l,docY:h}),!1}),setTimeout(function(){$(document).click(function(){return $(document).unbind("click").unbind("keypress"),$(a).fadeOut(e.outSpeed),!1})},0)}})}),$("#"+e.menu).each(function(){$(this).bind("mousedown.disableTextSelect",function(){return!1})}),$(i).add($("UL.contextMenu")).bind("contextmenu",function(){return!1})}),$(this))},disableContextMenuItems:function(e){return void 0==e?($(this).find("LI").addClass("disabled"),$(this)):($(this).each(function(){if(void 0!=e)for(var t=e.split(","),i=0;i<t.length;i++)$(this).find('A[href="'+t[i]+'"]').parent().addClass("disabled")}),$(this))},enableContextMenuItems:function(e){return void 0==e?($(this).find("LI.disabled").removeClass("disabled"),$(this)):($(this).each(function(){if(void 0!=e)for(var t=e.split(","),i=0;i<t.length;i++)$(this).find('A[href="'+t[i]+'"]').parent().removeClass("disabled")}),$(this))},disableContextMenu:function(){return $(this).each(function(){$(this).addClass("disabled")}),$(this)},enableContextMenu:function(){return $(this).each(function(){$(this).removeClass("disabled")}),$(this)},destroyContextMenu:function(){return $(this).each(function(){$(this).unbind("mousedown").unbind("mouseup")}),$(this)}})}(jQuery),define("libs/jquery.contextMenu",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/fields/views/FieldButton",["require","Underscore","Backbone","cs!threenodes/views/UI","text!../templates/node_field_input.tmpl.html","text!../templates/node_field_output.tmpl.html","text!../templates/field_context_menu.tmpl.html","cs!threenodes/utils/Utils","libs/jquery.contextMenu"],function(t){var n,r,o,s,a,l,h,c;return s=t("Underscore"),n=t("Backbone"),o=t("cs!threenodes/views/UI"),h=t("text!../templates/node_field_input.tmpl.html"),c=t("text!../templates/node_field_output.tmpl.html"),l=t("text!../templates/field_context_menu.tmpl.html"),t("cs!threenodes/utils/Utils"),t("libs/jquery.contextMenu"),r=function(t){function n(){return this.render=e(this.render,this),this.makeElement=e(this.makeElement,this),this.remove=e(this.remove,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.className="field",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.makeElement(),this.render()},n.prototype.remove=function(){var e;return e=$(".inner-field",this.$el),e.data("droppable")&&e.droppable("destroy"),e.data("draggable")&&e.draggable("destroy"),e.remove(),n.__super__.remove.apply(this,arguments)},n.prototype.makeElement=function(){var e,t;return t=this.model.get("is_output")?c:h,e=s.template(t,{fid:this.model.get("fid"),name:this.model.get("name")}),this.$el.html(e)},n.prototype.render=function(){return this.$el.attr("rel",this.model.get("name")),this.$el.addClass("field-"+this.model.get("name")),this.$el.data("object",this.model),this.$el.data("fid",this.model.get("fid")),this.initContextMenu(),this.addFieldListener()},n.prototype.initContextMenu=function(){var e,t=this;return $("#field-context-menu").length<1&&(e=s.template(l,{}),$("body").append(e)),this.$el.contextMenu({menu:"field-context-menu"},function(e){return"removeConnection"===e?t.model.removeConnections():void 0}),this},n.prototype.addFieldListener=function(){var e,t,i,n,r;return r=this,t=this.model,i=function(e,t,i){var n,r;return n=$("#container-wrapper").scrollLeft(),r=$("#container-wrapper").scrollTop(),"M"+(e.left+i.left+n+2)+" "+(e.top+i.top+r+2)+" L"+(t.left+i.left+n)+" "+(t.top+i.top+r)},n=function(){var e;return e=".outputs .field",t.get("is_output")===!0&&(e=".inputs .field"),$(e).filter(function(){return $(this).parent().parent().parent().data("nid")!==t.node.get("nid")}).addClass("field-possible-target")},$(".inner-field",this.$el).draggable({helper:function(){return $("<div class='ui-widget-drag-helper'></div>")},scroll:!0,cursor:"pointer",cursorAt:{left:0,top:0},start:function(){return n(),o.connecting_line?o.connecting_line.attr({opacity:1}):void 0},stop:function(){return $(".field").removeClass("field-possible-target"),o.connecting_line?o.connecting_line.attr({opacity:0}):void 0},drag:function(e,n){var r,s;return o.connecting_line?(s=$(this).position(),r={left:t.node.get("x"),top:t.node.get("y")},o.connecting_line.attr({path:i(s,n.position,r)}),!0):void 0}}),e=".outputs .inner-field",t&&t.get("is_output")===!0&&(e=".inputs .inner-field"),$(".inner-field",this.$el).droppable({accept:e,activeClass:"ui-state-active",hoverClass:"ui-state-hover",drop:function(e,i){var n,r;return r=$(i.draggable).parent(),n=r.data("object"),t.node.parent?n.node.createConnection(t,n):t.node.createConnection(t,n)}}),this},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/fields/views/FieldsView",["require","Underscore","Backbone","cs!./FieldButton","jquery.ui"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!./FieldButton"),t("jquery.ui"),o=function(t){function n(){return this.remove=e(this.remove,this),this.onFieldCreated=e(this.onFieldCreated,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e){return n.__super__.initialize.apply(this,arguments),this.node=e.node,this.subviews=[],this.collection.on("add",this.onFieldCreated),this.collection.each(this.onFieldCreated)},n.prototype.onFieldCreated=function(e){var t,i,n,o,s,a,l;return s=e.get("is_output")===!1?".inputs":".outputs",e.get("is_output")===!1&&e.isConnected()&&(i=e.connections[0],t=this.$el.parent(),o=function(){return t.parent().closest(".node").length>0},o()&&(n=i.from_field.node.get("gid"),a=i.to_field.node.get("gid"),"-1"!==n&&"-1"!==a&&n===a))?void 0:(l=new r({model:e}),l.$el.appendTo($(s,this.$el)),e.button=l.$el,this.subviews.push(l))},n.prototype.remove=function(){var e;return this.undelegateEvents(),this.collection.off("add",this.onFieldCreated),e=this.subviews.concat(),s.each(e,function(e){return e.remove()}),$("input",$(this.el)).remove(),delete this.collection,delete this.node,delete this.subviews,n.__super__.remove.apply(this,arguments)},n}(n.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/NodeView",["require","Underscore","Backbone","text!../templates/node.tmpl.html","text!../templates/node_context_menu.tmpl.html","cs!threenodes/fields/views/FieldsView","libs/jquery.contextMenu","jquery.ui"],function(t){var n,r,o,s,a,l,h;return s=t("Underscore"),n=t("Backbone"),h=t("text!../templates/node.tmpl.html"),l=t("text!../templates/node_context_menu.tmpl.html"),r=t("cs!threenodes/fields/views/FieldsView"),t("libs/jquery.contextMenu"),t("jquery.ui"),namespace("ThreeNodes",{NodeView:o=function(t){function n(){return this.makeDraggable=e(this.makeDraggable,this),this.remove=e(this.remove,this),this.computeNodePosition=e(this.computeNodePosition,this),this.renderConnections=e(this.renderConnections,this),this.addSelectedClass=e(this.addSelectedClass,this),this.highlighAnimations=e(this.highlighAnimations,this),this.render=e(this.render,this),this.makeElement=e(this.makeElement,this),this.initContextMenus=e(this.initContextMenus,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.className="node",n.prototype.initialize=function(e){var t=this;return this.makeElement(),e.isSubNode||this.makeDraggable(),this.initNodeClick(),this.initTitleClick(),this.fields_view=new r({node:this.model,collection:this.model.fields,el:$("> .options",this.$el)}),this.model.on("change",this.render),this.model.on("remove",function(){return t.remove()}),this.model.on("node:computePosition",this.computeNodePosition),this.model.on("node:renderConnections",this.renderConnections),this.model.on("node:addSelectedClass",this.addSelectedClass),this.render(),this.initContextMenus(),this.highlighAnimations()},n.prototype.initContextMenus=function(){var e,t=this;return $("#node-context-menu").length<1&&(e=s.template(l,{}),$("body").append(e)),this.$el.find(".head").contextMenu({menu:"node-context-menu"},function(e){return"remove_node"===e?t.model.remove():void 0}),this},n.prototype.makeElement=function(){return this.template=s.template(h,this.model),this.$el.html(this.template),this.$el.addClass("type-"+this.model.constructor.group_name),this.$el.addClass("node-"+this.model.typename())},n.prototype.render=function(){return this.$el.css({left:parseInt(this.model.get("x")),top:parseInt(this.model.get("y"))}),this.$el.find("> .head span").text(this.model.get("name")),this.$el.find("> .head span").show()},n.prototype.highlighAnimations=function(){var e,t,i,n,r,o;for(t=!1,o=this.model.anim.objectTrack.propertyTracks,n=0,r=o.length;r>n;n++)i=o[n],e=$(".inputs .field-"+i.name,this.$el),i.anims.length>0?(e.addClass("has-animation"),t=!0):e.removeClass("has-animation");return this.$el.toggleClass("node-has-animation",t),!0},n.prototype.addSelectedClass=function(){return this.$el.addClass("ui-selected")},n.prototype.renderConnections=function(){return this.model.fields.renderConnections(),this.model.nodes?s.each(this.model.nodes.models,function(e){return e.fields.renderConnections()}):void 0},n.prototype.computeNodePosition=function(){var e,t;return t=$(this.el).position(),e=$("#container-wrapper").offset(),this.model.set({x:t.left+$("#container-wrapper").scrollLeft(),y:t.top+$("#container-wrapper").scrollTop()})},n.prototype.remove=function(){return $(".field",this.el).destroyContextMenu(),this.$el.data("draggable")&&this.$el.draggable("destroy"),$(this.el).unbind(),this.undelegateEvents(),this.fields_view&&this.fields_view.remove(),delete this.fields_view,n.__super__.remove.apply(this,arguments)},n.prototype.initNodeClick=function(){var e;return e=this,$(this.el).click(function(t){var i;return t.metaKey===!1?($(".node").removeClass("ui-selected"),$(this).addClass("ui-selecting")):$(this).hasClass("ui-selected")?$(this).removeClass("ui-selected"):$(this).addClass("ui-selecting"),(i=$("#container").data("ui-selectable"))?(i.refresh(),i._mouseStop(null),e.model.fields.renderSidebar()):void 0}),this},n.prototype.initTitleClick=function(){var e;return e=this,this.$el.find("> .head span").dblclick(function(){var t,i,n;return n=$(this).html(),e.$el.find("> .head").append("<input type='text' />"),$(this).hide(),t=e.$el.find("> .head input"),t.val(n),i=function(){return e.model.set("name",t.val()),t.remove()},t.blur(function(){return i()}),$("#graph").click(function(){return i()}),t.keydown(function(e){return 13===e.keyCode?i():void 0})}),this},n.prototype.makeDraggable=function(){var e,t,i;return i=this,e={top:0,left:0},t=$([]),$(this.el).draggable({start:function(){return $(this).hasClass("ui-selected")?t=$(".ui-selected").each(function(){return $(this).data("offset",$(this).offset())}):(t=$([]),$(".node").removeClass("ui-selected")),e=$(this).offset()},drag:function(n,r){var o,s;return s=r.position.top-e.top,o=r.position.left-e.left,t.not(this).each(function(){var e,t,i,n;return i=$(this),n=i.data("offset"),e=n.top+s,t=n.left+o,i.css({top:e,left:t}),i.data("object").trigger("node:computePosition"),i.data("object").trigger("node:renderConnections")}),i.renderConnections()},stop:function(){return t.not(this).each(function(){var e;return e=$(this).data("object"),e.trigger("node:renderConnections")}),i.computeNodePosition(),i.renderConnections()}}),this},n}(n.View)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/NodeWithCenterTextfield",["require","Underscore","Backbone","cs!../models/Node","cs!./NodeView"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!../models/Node"),t("cs!./NodeView"),r=function(t){function n(){return this.getCenterField=e(this.getCenterField,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){var e,t,i;return n.__super__.initialize.apply(this,arguments),i=this.getCenterField(),e=$("<div><input type='text' data-fid='"+i.get("fid")+"' /></div>").appendTo($(".center",this.$el)),t=$("input",e),i.on_value_update_hooks.update_center_textfield=function(e){return null!==e?t.val(e.toString()):void 0},t.val(i.getValue()),i.get("is_output")===!0?t.attr("disabled","disabled"):t.keypress(function(e){return 13===e.which?(i.setValue($(this).val()),$(this).blur()):void 0}),this},n.prototype.getCenterField=function(){return this.model.fields.getField("in")},n}(ThreeNodes.NodeView)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},i=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/nodes/models/components/Base",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node","cs!threenodes/nodes/models/NodeNumberSimple","cs!threenodes/nodes/views/NodeWithCenterTextfield"],function(e){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R;return m=e("Underscore"),n=e("Backbone"),a=e("cs!threenodes/nodes/models/Node"),l=e("cs!threenodes/nodes/models/NodeNumberSimple"),h=e("cs!threenodes/nodes/views/NodeWithCenterTextfield"),namespace("ThreeNodes.nodes.views",{Number:c=function(e){function i(){return g=i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(h),String:d=function(e){function n(){return this.getCenterField=i(this.getCenterField,this),v=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.prototype.getCenterField=function(){return this.model.fields.getField("string")},n}(h)}),namespace("ThreeNodes.nodes.models",{Number:c=function(e){function i(){return y=i.__super__.constructor.apply(this,arguments)}return t(i,e),i.node_name="Number",i.group_name="Base",i}(l),Boolean:r=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),this.initialize=i(this.initialize,this),_=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Boolean",n.group_name="Base",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.value=!0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{bool:!0},outputs:{out:{type:"Bool",val:this.value}}},$.extend(!0,e,t)},n.prototype.compute=function(){return this.fields.setField("out",this.fields.getField("bool").getValue())},n}(a),String:d=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),this.initialize=i(this.initialize,this),b=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="String",n.group_name="Base",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.value=""},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{string:""},outputs:{out:{type:"Any",val:this.value}}},$.extend(!0,e,t)},n.prototype.compute=function(){return this.fields.setField("out",this.fields.getField("string").getValue())},n}(a),Vector2:p=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),E=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Vector2",n.group_name="Base",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{x:0,y:0},outputs:{xy:{type:"Vector2",val:!1},x:0,y:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o;for(i=[],n=[],r=[],t=this.fields.getMaxInputSliceCount(),e=o=0;t>=0?t>=o:o>=t;e=t>=0?++o:--o)n[e]=this.fields.getField("x").getValue(e),r[e]=this.fields.getField("y").getValue(e),i[e]=new THREE.Vector3(n[e],r[e]);return this.fields.setField("xy",i),this.fields.setField("x",n),this.fields.setField("y",r)},n}(a),Vector3:f=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),x=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Vector3",n.group_name="Base",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{x:0,y:0,z:0},outputs:{xyz:{type:"Vector3",val:!1},x:0,y:0,z:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s;for(i=[],n=[],r=[],o=[],t=this.fields.getMaxInputSliceCount(),e=s=0;t>=0?t>=s:s>=t;e=t>=0?++s:--s)n[e]=this.fields.getField("x").getValue(e),r[e]=this.fields.getField("y").getValue(e),o[e]=this.fields.getField("z").getValue(e),i[e]=new THREE.Vector3(n[e],r[e],o[e]);return this.fields.setField("xyz",i),this.fields.setField("x",n),this.fields.setField("y",r),this.fields.setField("z",o)},n}(a),Quaternion:u=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),T=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Quaternion",n.group_name="Base",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{x:0,y:0,z:0,w:1},outputs:{xyzw:{type:"Quaternion",val:!1},x:0,y:0,z:0,w:1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a;for(i=[],r=[],o=[],s=[],n=[],t=this.fields.getMaxInputSliceCount(),e=a=0;t>=0?t>=a:a>=t;e=t>=0?++a:--a)r[e]=this.fields.getField("x").getValue(e),o[e]=this.fields.getField("y").getValue(e),s[e]=this.fields.getField("z").getValue(e),n[e]=this.fields.getField("w").getValue(e),i[e]=new THREE.Quaternion(r[e],o[e],s[e],n[e]);return this.fields.setField("xyzw",i),this.fields.setField("x",r),this.fields.setField("y",o),this.fields.setField("z",s),this.fields.setField("w",n)},n}(a),Euler:s=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),w=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Euler",n.group_name="Base",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{x:0,y:0,z:0,order:{type:"String",val:"XYZ",values:{XYZ:"XYZ",YZX:"YZX",ZXY:"ZXY",XZY:"XZY",YXZ:"YXZ",ZYX:"ZYX"}}},outputs:{euler:{type:"Euler",val:!1},x:0,y:0,z:0,order:"XYZ"}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a;for(i=[],r=[],o=[],s=[],n=[],t=this.fields.getMaxInputSliceCount(),e=a=0;t>=0?t>=a:a>=t;e=t>=0?++a:--a)r[e]=this.fields.getField("x").getValue(e),o[e]=this.fields.getField("y").getValue(e),s[e]=this.fields.getField("z").getValue(e),n[e]=this.fields.getField("order").getValue(e),i[e]=new THREE.Euler(r[e],o[e],s[e],n[e]);return this.fields.setField("euler",i),this.fields.setField("x",r),this.fields.setField("y",o),this.fields.setField("z",s),this.fields.setField("order",n)},n}(a),Color:o=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),R=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Color",n.group_name="Base",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{r:0,g:0,b:0},outputs:{rgb:{type:"Color",val:!1},r:0,g:0,b:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s;for(i=[],o=[],r=[],n=[],t=this.fields.getMaxInputSliceCount(),e=s=0;t>=0?t>=s:s>=t;e=t>=0?++s:--s)o[e]=this.fields.getField("r").getValue(e),r[e]=this.fields.getField("g").getValue(e),n[e]=this.fields.getField("b").getValue(e),i[e]=(new THREE.Color).setRGB(o[e],r[e],n[e]);return this.fields.setField("rgb",i),this.fields.setField("r",o),this.fields.setField("g",r),this.fields.setField("b",n)},n}(a)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Conditional",["require","jquery","Underscore","Backbone","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y;return u=t("jquery"),d=t("Underscore"),r=t("Backbone"),l=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes.nodes.models",{IfElse:a=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),p=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="IfElse",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{condition:!1,val1:{type:"Any",val:0},val2:{type:"Any",val:1}},outputs:{out:{type:"Any",val:!1}}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t;return e=this.fields.getField("condition").getValue(),t=e===!1?this.fields.getField("val1").attributes.value:this.fields.getField("val2").attributes.value,this.fields.setField("out",t)},n}(l),And:n=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),f=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="And",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{val1:!1,val2:!1},outputs:{out:!1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("val1").getValue()!==!1&&this.fields.getField("val2").getValue()!==!1,this.fields.setField("out",e)},n}(l),Or:h=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),m=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Or",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{val1:!1,val2:!1},outputs:{out:!1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("val1").getValue()!==!1||this.fields.getField("val2").getValue()!==!1,this.fields.setField("out",e)},n}(l),Equal:o=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),g=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Equal",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{val1:{type:"Any",val:0},val2:{type:"Any",val:1}},outputs:{out:!1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("val1").getValue(0)===this.fields.getField("val2").getValue(0),this.fields.setField("out",e)},n}(l),Smaller:c=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),v=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Smaller",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;
return e=n.__super__.getFields.apply(this,arguments),t={inputs:{val1:{type:"Float",val:0},val2:{type:"Float",val:1}},outputs:{out:!1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("val1").getValue(0)<this.fields.getField("val2").getValue(0),this.fields.setField("out",e)},n}(l),Greater:s=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),y=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Greater",n.group_name="Conditional",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{val1:{type:"Float",val:0},val2:{type:"Float",val:1}},outputs:{out:!1}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("val1").getValue(0)>this.fields.getField("val2").getValue(0),this.fields.setField("out",e)},n}(l)})})}.call(this),function(e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else{if("function"==typeof define&&define.amd)return define("bower_components/codemirror/lib/codemirror",[],e);this.CodeMirror=e()}}(function(){function e(i,n){if(!(this instanceof e))return new e(i,n);this.options=n=n||{},ro(bs,n,!1),f(n);var r=n.value;"string"==typeof r&&(r=new Ws(r,n.mode)),this.doc=r;var o=this.display=new t(i,r);o.wrapper.CodeMirror=this,c(this),l(this),n.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap"),n.autofocus&&!Zo&&pi(this),this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,draggingText:!1,highlight:new Qr},Io&&setTimeout(oo(di,this,!0),20),gi(this),bo();var s=this;Kt(this,function(){s.curOp.forceUpdate=!0,yr(s,r),n.autofocus&&!Zo||fo()==o.input?setTimeout(oo(Oi,s),20):Vi(s);for(var e in Es)Es.hasOwnProperty(e)&&Es[e](s,n[e],xs);for(var t=0;t<Ss.length;++t)Ss[t](s)})}function t(e,t){var i=this,n=i.input=ho("textarea",null,null,"position: absolute; padding: 0; width: 1px; height: 1em; outline: none");Wo?n.style.width="1000px":n.setAttribute("wrap","off"),Jo&&(n.style.border="1px solid black"),n.setAttribute("autocorrect","off"),n.setAttribute("autocapitalize","off"),n.setAttribute("spellcheck","false"),i.inputDiv=ho("div",[n],null,"overflow: hidden; position: relative; width: 3px; height: 0px;"),i.scrollbarH=ho("div",[ho("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar"),i.scrollbarV=ho("div",[ho("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),i.scrollbarFiller=ho("div",null,"CodeMirror-scrollbar-filler"),i.gutterFiller=ho("div",null,"CodeMirror-gutter-filler"),i.lineDiv=ho("div",null,"CodeMirror-code"),i.selectionDiv=ho("div",null,null,"position: relative; z-index: 1"),i.cursorDiv=ho("div",null,"CodeMirror-cursors"),i.measure=ho("div",null,"CodeMirror-measure"),i.lineMeasure=ho("div",null,"CodeMirror-measure"),i.lineSpace=ho("div",[i.measure,i.lineMeasure,i.selectionDiv,i.cursorDiv,i.lineDiv],null,"position: relative; outline: none"),i.mover=ho("div",[ho("div",[i.lineSpace],"CodeMirror-lines")],null,"position: relative"),i.sizer=ho("div",[i.mover],"CodeMirror-sizer"),i.heightForcer=ho("div",null,null,"position: absolute; height: "+ta+"px; width: 1px;"),i.gutters=ho("div",null,"CodeMirror-gutters"),i.lineGutter=null,i.scroller=ho("div",[i.sizer,i.heightForcer,i.gutters],"CodeMirror-scroll"),i.scroller.setAttribute("tabIndex","-1"),i.wrapper=ho("div",[i.inputDiv,i.scrollbarH,i.scrollbarV,i.scrollbarFiller,i.gutterFiller,i.scroller],"CodeMirror"),Oo&&(i.gutters.style.zIndex=-1,i.scroller.style.paddingRight=0),Jo&&(n.style.width="0px"),Wo||(i.scroller.draggable=!0),Yo&&(i.inputDiv.style.height="1px",i.inputDiv.style.position="absolute"),Oo&&(i.scrollbarH.style.minHeight=i.scrollbarV.style.minWidth="18px"),e.appendChild?e.appendChild(i.wrapper):e(i.wrapper),i.viewFrom=i.viewTo=t.first,i.view=[],i.externalMeasured=null,i.viewOffset=0,i.lastSizeC=0,i.updateLineNumbers=null,i.lineNumWidth=i.lineNumInnerWidth=i.lineNumChars=null,i.prevInput="",i.alignWidgets=!1,i.pollingFast=!1,i.poll=new Qr,i.cachedCharWidth=i.cachedTextHeight=i.cachedPaddingH=null,i.inaccurateSelection=!1,i.maxLine=null,i.maxLineLength=0,i.maxLineChanged=!1,i.wheelDX=i.wheelDY=i.wheelStartX=i.wheelStartY=null,i.shift=!1,i.selForContextMenu=null}function i(t){t.doc.mode=e.getMode(t.options,t.doc.modeOption),n(t)}function n(e){e.doc.iter(function(e){e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null)}),e.doc.frontier=e.doc.first,yt(e,100),e.state.modeGen++,e.curOp&&ii(e)}function r(e){e.options.lineWrapping?(vo(e.display.wrapper,"CodeMirror-wrap"),e.display.sizer.style.minWidth=""):(go(e.display.wrapper,"CodeMirror-wrap"),p(e)),s(e),ii(e),Nt(e),setTimeout(function(){g(e)},100)}function o(e){var t=Gt(e.display),i=e.options.lineWrapping,n=i&&Math.max(5,e.display.scroller.clientWidth/qt(e.display)-3);return function(r){if($n(e.doc,r))return 0;var o=0;if(r.widgets)for(var s=0;s<r.widgets.length;s++)r.widgets[s].height&&(o+=r.widgets[s].height);return i?o+(Math.ceil(r.text.length/n)||1)*t:o+t}}function s(e){var t=e.doc,i=o(e);t.iter(function(e){var t=i(e);t!=e.height&&xr(e,t)})}function a(e){var t=As[e.options.keyMap],i=t.style;e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-keymap-\S+/g,"")+(i?" cm-keymap-"+i:"")}function l(e){e.display.wrapper.className=e.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+e.options.theme.replace(/(^|\s)\s*/g," cm-s-"),Nt(e)}function h(e){c(e),ii(e),setTimeout(function(){y(e)},20)}function c(e){var t=e.display.gutters,i=e.options.gutters;co(t);for(var n=0;n<i.length;++n){var r=i[n],o=t.appendChild(ho("div",null,"CodeMirror-gutter "+r));"CodeMirror-linenumbers"==r&&(e.display.lineGutter=o,o.style.width=(e.display.lineNumWidth||1)+"px")}t.style.display=n?"":"none",u(e)}function u(e){var t=e.display.gutters.offsetWidth;e.display.sizer.style.marginLeft=t+"px",e.display.scrollbarH.style.left=e.options.fixedGutter?t+"px":0}function d(e){if(0==e.height)return 0;for(var t,i=e.text.length,n=e;t=In(n);){var r=t.find(0,!0);n=r.from.line,i+=r.from.ch-r.to.ch}for(n=e;t=On(n);){var r=t.find(0,!0);i-=n.text.length-r.from.ch,n=r.to.line,i+=n.text.length-r.to.ch}return i}function p(e){var t=e.display,i=e.doc;t.maxLine=_r(i,i.first),t.maxLineLength=d(t.maxLine),t.maxLineChanged=!0,i.iter(function(e){var i=d(e);i>t.maxLineLength&&(t.maxLineLength=i,t.maxLine=e)})}function f(e){var t=to(e.gutters,"CodeMirror-linenumbers");-1==t&&e.lineNumbers?e.gutters=e.gutters.concat(["CodeMirror-linenumbers"]):t>-1&&!e.lineNumbers&&(e.gutters=e.gutters.slice(0),e.gutters.splice(t,1))}function m(e){var t=e.display.scroller;return{clientHeight:t.clientHeight,barHeight:e.display.scrollbarV.clientHeight,scrollWidth:t.scrollWidth,clientWidth:t.clientWidth,barWidth:e.display.scrollbarH.clientWidth,docHeight:Math.round(e.doc.height+Tt(e.display))}}function g(e,t){t||(t=m(e));var i=e.display,n=t.docHeight+ta,r=t.scrollWidth>t.clientWidth,o=n>t.clientHeight;if(o?(i.scrollbarV.style.display="block",i.scrollbarV.style.bottom=r?xo(i.measure)+"px":"0",i.scrollbarV.firstChild.style.height=Math.max(0,n-t.clientHeight+(t.barHeight||i.scrollbarV.clientHeight))+"px"):(i.scrollbarV.style.display="",i.scrollbarV.firstChild.style.height="0"),r?(i.scrollbarH.style.display="block",i.scrollbarH.style.right=o?xo(i.measure)+"px":"0",i.scrollbarH.firstChild.style.width=t.scrollWidth-t.clientWidth+(t.barWidth||i.scrollbarH.clientWidth)+"px"):(i.scrollbarH.style.display="",i.scrollbarH.firstChild.style.width="0"),r&&o?(i.scrollbarFiller.style.display="block",i.scrollbarFiller.style.height=i.scrollbarFiller.style.width=xo(i.measure)+"px"):i.scrollbarFiller.style.display="",r&&e.options.coverGutterNextToScrollbar&&e.options.fixedGutter?(i.gutterFiller.style.display="block",i.gutterFiller.style.height=xo(i.measure)+"px",i.gutterFiller.style.width=i.gutters.offsetWidth+"px"):i.gutterFiller.style.display="",!e.state.checkedOverlayScrollbar&&t.clientHeight>0){if(0===xo(i.measure)){var s=es&&!Ko?"12px":"18px";i.scrollbarV.style.minWidth=i.scrollbarH.style.minHeight=s;var a=function(t){jr(t)!=i.scrollbarV&&jr(t)!=i.scrollbarH&&Qt(e,bi)(t)};Qs(i.scrollbarV,"mousedown",a),Qs(i.scrollbarH,"mousedown",a)}e.state.checkedOverlayScrollbar=!0}}function v(e,t,i){var n=i&&null!=i.top?Math.max(0,i.top):e.scroller.scrollTop;n=Math.floor(n-xt(e));var r=i&&null!=i.bottom?i.bottom:n+e.wrapper.clientHeight,o=wr(t,n),s=wr(t,r);if(i&&i.ensure){var a=i.ensure.from.line,l=i.ensure.to.line;if(o>a)return{from:a,to:wr(t,Rr(_r(t,a))+e.wrapper.clientHeight)};if(Math.min(l,t.lastLine())>=s)return{from:wr(t,Rr(_r(t,l))-e.wrapper.clientHeight),to:l}}return{from:o,to:Math.max(s,o+1)}}function y(e){var t=e.display,i=t.view;if(t.alignWidgets||t.gutters.firstChild&&e.options.fixedGutter){for(var n=E(t)-t.scroller.scrollLeft+e.doc.scrollLeft,r=t.gutters.offsetWidth,o=n+"px",s=0;s<i.length;s++)if(!i[s].hidden){e.options.fixedGutter&&i[s].gutter&&(i[s].gutter.style.left=o);var a=i[s].alignable;if(a)for(var l=0;l<a.length;l++)a[l].style.left=o}e.options.fixedGutter&&(t.gutters.style.left=n+r+"px")}}function _(e){if(!e.options.lineNumbers)return!1;var t=e.doc,i=b(e.options,t.first+t.size-1),n=e.display;if(i.length!=n.lineNumChars){var r=n.measure.appendChild(ho("div",[ho("div",i)],"CodeMirror-linenumber CodeMirror-gutter-elt")),o=r.firstChild.offsetWidth,s=r.offsetWidth-o;return n.lineGutter.style.width="",n.lineNumInnerWidth=Math.max(o,n.lineGutter.offsetWidth-s),n.lineNumWidth=n.lineNumInnerWidth+s,n.lineNumChars=n.lineNumInnerWidth?i.length:-1,n.lineGutter.style.width=n.lineNumWidth+"px",u(e),!0}return!1}function b(e,t){return String(e.lineNumberFormatter(t+e.firstLineNumber))}function E(e){return e.scroller.getBoundingClientRect().left-e.sizer.getBoundingClientRect().left}function x(e,t,i){for(var n,r=e.display.viewFrom,o=e.display.viewTo,s=v(e.display,e.doc,t),a=!0;;a=!1){var l=e.display.scroller.clientWidth;if(!T(e,s,i))break;n=!0,e.display.maxLineChanged&&!e.options.lineWrapping&&w(e);var h=m(e);if(ft(e),R(e,h),g(e,h),Wo&&e.options.lineWrapping&&S(e,h),a&&e.options.lineWrapping&&l!=e.display.scroller.clientWidth)i=!0;else if(i=!1,t&&null!=t.top&&(t={top:Math.min(h.docHeight-ta-h.clientHeight,t.top)}),s=v(e.display,e.doc,t),s.from>=e.display.viewFrom&&s.to<=e.display.viewTo)break}return e.display.updateLineNumbers=null,n&&($r(e,"update",e),(e.display.viewFrom!=r||e.display.viewTo!=o)&&$r(e,"viewportChange",e,e.display.viewFrom,e.display.viewTo)),n}function T(e,t,i){var n=e.display,r=e.doc;if(!n.wrapper.offsetWidth)return ri(e),void 0;if(!(!i&&t.from>=n.viewFrom&&t.to<=n.viewTo&&0==li(e))){_(e)&&ri(e);var o=M(e),s=r.first+r.size,a=Math.max(t.from-e.options.viewportMargin,r.first),l=Math.min(s,t.to+e.options.viewportMargin);n.viewFrom<a&&a-n.viewFrom<20&&(a=Math.max(r.first,n.viewFrom)),n.viewTo>l&&n.viewTo-l<20&&(l=Math.min(s,n.viewTo)),ss&&(a=jn(e.doc,a),l=Wn(e.doc,l));var h=a!=n.viewFrom||l!=n.viewTo||n.lastSizeC!=n.wrapper.clientHeight;ai(e,a,l),n.viewOffset=Rr(_r(e.doc,n.viewFrom)),e.display.mover.style.top=n.viewOffset+"px";var c=li(e);if(h||0!=c||i){var u=fo();return c>4&&(n.lineDiv.style.display="none"),k(e,n.updateLineNumbers,o),c>4&&(n.lineDiv.style.display=""),u&&fo()!=u&&u.offsetHeight&&u.focus(),co(n.cursorDiv),co(n.selectionDiv),h&&(n.lastSizeC=n.wrapper.clientHeight,yt(e,400)),C(e),!0}}}function w(e){var t=e.display,i=Ht(e,t.maxLine,t.maxLine.text.length).left;t.maxLineChanged=!1;var n=Math.max(0,i+3),r=Math.max(0,t.sizer.offsetLeft+n+ta-t.scroller.clientWidth);t.sizer.style.minWidth=n+"px",r<e.doc.scrollLeft&&Mi(e,Math.min(t.scroller.scrollLeft,r),!0)}function R(e,t){e.display.sizer.style.minHeight=e.display.heightForcer.style.top=t.docHeight+"px",e.display.gutters.style.height=Math.max(t.docHeight,t.clientHeight-ta)+"px"}function S(e,t){e.display.sizer.offsetWidth+e.display.gutters.offsetWidth<e.display.scroller.clientWidth-1&&(e.display.sizer.style.minHeight=e.display.heightForcer.style.top="0px",e.display.gutters.style.height=t.docHeight+"px")}function C(e){for(var t=e.display,i=t.lineDiv.offsetTop,n=0;n<t.view.length;n++){var r,o=t.view[n];if(!o.hidden){if(Oo){var s=o.node.offsetTop+o.node.offsetHeight;r=s-i,i=s}else{var a=o.node.getBoundingClientRect();r=a.bottom-a.top}var l=o.line.height-r;if(2>r&&(r=Gt(t)),(l>.001||-.001>l)&&(xr(o.line,r),H(o.line),o.rest))for(var h=0;h<o.rest.length;h++)H(o.rest[h])}}}function H(e){if(e.widgets)for(var t=0;t<e.widgets.length;++t)e.widgets[t].height=e.widgets[t].node.offsetHeight}function M(e){for(var t=e.display,i={},n={},r=t.gutters.firstChild,o=0;r;r=r.nextSibling,++o)i[e.options.gutters[o]]=r.offsetLeft,n[e.options.gutters[o]]=r.offsetWidth;return{fixedPos:E(t),gutterTotalWidth:t.gutters.offsetWidth,gutterLeft:i,gutterWidth:n,wrapperWidth:t.wrapper.clientWidth}}function k(e,t,i){function n(t){var i=t.nextSibling;return Wo&&es&&e.display.currentWheelTarget==t?t.style.display="none":t.parentNode.removeChild(t),i}for(var r=e.display,o=e.options.lineNumbers,s=r.lineDiv,a=s.firstChild,l=r.view,h=r.viewFrom,c=0;c<l.length;c++){var u=l[c];if(u.hidden);else if(u.node){for(;a!=u.node;)a=n(a);var d=o&&null!=t&&h>=t&&u.lineNumber;u.changes&&(to(u.changes,"gutter")>-1&&(d=!1),A(e,u,h,i)),d&&(co(u.lineNumber),u.lineNumber.appendChild(document.createTextNode(b(e.options,h)))),a=u.node.nextSibling}else{var p=O(e,u,h,i);s.insertBefore(p,a)}h+=u.size}for(;a;)a=n(a)}function A(e,t,i,n){for(var r=0;r<t.changes.length;r++){var o=t.changes[r];"text"==o?N(e,t):"gutter"==o?L(e,t,i,n):"class"==o?z(t):"widget"==o&&I(t,n)}t.changes=null}function P(e){return e.node==e.text&&(e.node=ho("div",null,null,"position: relative"),e.text.parentNode&&e.text.parentNode.replaceChild(e.node,e.text),e.node.appendChild(e.text),Oo&&(e.node.style.zIndex=2)),e.node}function F(e){var t=e.bgClass?e.bgClass+" "+(e.line.bgClass||""):e.line.bgClass;if(t&&(t+=" CodeMirror-linebackground"),e.background)t?e.background.className=t:(e.background.parentNode.removeChild(e.background),e.background=null);else if(t){var i=P(e);e.background=i.insertBefore(ho("div",null,t),i.firstChild)}}function D(e,t){var i=e.display.externalMeasured;return i&&i.line==t.line?(e.display.externalMeasured=null,t.measure=i.measure,i.built):sr(e,t)}function N(e,t){var i=t.text.className,n=D(e,t);t.text==t.node&&(t.node=n.pre),t.text.parentNode.replaceChild(n.pre,t.text),t.text=n.pre,n.bgClass!=t.bgClass||n.textClass!=t.textClass?(t.bgClass=n.bgClass,t.textClass=n.textClass,z(t)):i&&(t.text.className=i)}function z(e){F(e),e.line.wrapClass?P(e).className=e.line.wrapClass:e.node!=e.text&&(e.node.className="");var t=e.textClass?e.textClass+" "+(e.line.textClass||""):e.line.textClass;e.text.className=t||""}function L(e,t,i,n){t.gutter&&(t.node.removeChild(t.gutter),t.gutter=null);var r=t.line.gutterMarkers;if(e.options.lineNumbers||r){var o=P(t),s=t.gutter=o.insertBefore(ho("div",null,"CodeMirror-gutter-wrapper","position: absolute; left: "+(e.options.fixedGutter?n.fixedPos:-n.gutterTotalWidth)+"px"),t.text);if(!e.options.lineNumbers||r&&r["CodeMirror-linenumbers"]||(t.lineNumber=s.appendChild(ho("div",b(e.options,i),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+n.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+e.display.lineNumInnerWidth+"px"))),r)for(var a=0;a<e.options.gutters.length;++a){var l=e.options.gutters[a],h=r.hasOwnProperty(l)&&r[l];h&&s.appendChild(ho("div",[h],"CodeMirror-gutter-elt","left: "+n.gutterLeft[l]+"px; width: "+n.gutterWidth[l]+"px"))}}}function I(e,t){e.alignable&&(e.alignable=null);for(var i,n=e.node.firstChild;n;n=i){var i=n.nextSibling;"CodeMirror-linewidget"==n.className&&e.node.removeChild(n)}V(e,t)}function O(e,t,i,n){var r=D(e,t);return t.text=t.node=r.pre,r.bgClass&&(t.bgClass=r.bgClass),r.textClass&&(t.textClass=r.textClass),z(t),L(e,t,i,n),V(t,n),t.node}function V(e,t){if(B(e.line,e,t,!0),e.rest)for(var i=0;i<e.rest.length;i++)B(e.rest[i],e,t,!1)}function B(e,t,i,n){if(e.widgets)for(var r=P(t),o=0,s=e.widgets;o<s.length;++o){var a=s[o],l=ho("div",[a.node],"CodeMirror-linewidget");a.handleMouseEvents||(l.ignoreEvents=!0),U(a,l,t,i),n&&a.above?r.insertBefore(l,t.gutter||t.text):r.appendChild(l),$r(a,"redraw")}}function U(e,t,i,n){if(e.noHScroll){(i.alignable||(i.alignable=[])).push(t);var r=n.wrapperWidth;t.style.left=n.fixedPos+"px",e.coverGutter||(r-=n.gutterTotalWidth,t.style.paddingLeft=n.gutterTotalWidth+"px"),t.style.width=r+"px"}e.coverGutter&&(t.style.zIndex=5,t.style.position="relative",e.noHScroll||(t.style.marginLeft=-n.gutterTotalWidth+"px"))}function j(e){return as(e.line,e.ch)}function W(e,t){return ls(e,t)<0?t:e}function $(e,t){return ls(e,t)<0?e:t}function G(e,t){this.ranges=e,this.primIndex=t}function q(e,t){this.anchor=e,this.head=t}function X(e,t){var i=e[t];e.sort(function(e,t){return ls(e.from(),t.from())}),t=to(e,i);for(var n=1;n<e.length;n++){var r=e[n],o=e[n-1];if(ls(o.to(),r.from())>=0){var s=$(o.from(),r.from()),a=W(o.to(),r.to()),l=o.empty()?r.from()==r.head:o.from()==o.head;t>=n&&--t,e.splice(--n,2,new q(l?a:s,l?s:a))}}return new G(e,t)}function Y(e,t){return new G([new q(e,t||e)],0)}function K(e,t){return Math.max(e.first,Math.min(t,e.first+e.size-1))}function Q(e,t){if(t.line<e.first)return as(e.first,0);var i=e.first+e.size-1;return t.line>i?as(i,_r(e,i).text.length):J(t,_r(e,t.line).text.length)}function J(e,t){var i=e.ch;return null==i||i>t?as(e.line,t):0>i?as(e.line,0):e}function Z(e,t){return t>=e.first&&t<e.first+e.size}function et(e,t){for(var i=[],n=0;n<t.length;n++)i[n]=Q(e,t[n]);return i}function tt(e,t,i,n){if(e.cm&&e.cm.display.shift||e.extend){var r=t.anchor;if(n){var o=ls(i,r)<0;o!=ls(n,r)<0?(r=i,i=n):o!=ls(i,n)<0&&(i=n)}return new q(r,i)}return new q(n||i,i)}function it(e,t,i,n){lt(e,new G([tt(e,e.sel.primary(),t,i)],0),n)}function nt(e,t,i){for(var n=[],r=0;r<e.sel.ranges.length;r++)n[r]=tt(e,e.sel.ranges[r],t[r],null);var o=X(n,e.sel.primIndex);lt(e,o,i)}function rt(e,t,i,n){var r=e.sel.ranges.slice(0);r[t]=i,lt(e,X(r,e.sel.primIndex),n)}function ot(e,t,i,n){lt(e,Y(t,i),n)}function st(e,t){var i={ranges:t.ranges,update:function(t){this.ranges=[];for(var i=0;i<t.length;i++)this.ranges[i]=new q(Q(e,t[i].anchor),Q(e,t[i].head))}};return Zs(e,"beforeSelectionChange",e,i),e.cm&&Zs(e.cm,"beforeSelectionChange",e.cm,i),i.ranges!=t.ranges?X(i.ranges,i.ranges.length-1):t}function at(e,t,i){var n=e.history.done,r=eo(n);r&&r.ranges?(n[n.length-1]=t,ht(e,t,i)):lt(e,t,i)}function lt(e,t,i){ht(e,t,i),Fr(e,e.sel,e.cm?e.cm.curOp.id:0/0,i)}function ht(e,t,i){(Yr(e,"beforeSelectionChange")||e.cm&&Yr(e.cm,"beforeSelectionChange"))&&(t=st(e,t));var n=i&&i.bias||(ls(t.primary().head,e.sel.primary().head)<0?-1:1);ct(e,dt(e,t,n,!0)),i&&i.scroll===!1||!e.cm||an(e.cm)}function ct(e,t){t.equals(e.sel)||(e.sel=t,e.cm&&(e.cm.curOp.updateInput=e.cm.curOp.selectionChanged=!0,Xr(e.cm)),$r(e,"cursorActivity",e))}function ut(e){ct(e,dt(e,e.sel,null,!1),na)}function dt(e,t,i,n){for(var r,o=0;o<t.ranges.length;o++){var s=t.ranges[o],a=pt(e,s.anchor,i,n),l=pt(e,s.head,i,n);(r||a!=s.anchor||l!=s.head)&&(r||(r=t.ranges.slice(0,o)),r[o]=new q(a,l))}return r?X(r,t.primIndex):t}function pt(e,t,i,n){var r=!1,o=t,s=i||1;e.cantEdit=!1;e:for(;;){var a=_r(e,o.line);if(a.markedSpans)for(var l=0;l<a.markedSpans.length;++l){var h=a.markedSpans[l],c=h.marker;if((null==h.from||(c.inclusiveLeft?h.from<=o.ch:h.from<o.ch))&&(null==h.to||(c.inclusiveRight?h.to>=o.ch:h.to>o.ch))){if(n&&(Zs(c,"beforeCursorEnter"),c.explicitlyCleared)){if(a.markedSpans){--l;continue}break}if(!c.atomic)continue;var u=c.find(0>s?-1:1);if(0==ls(u,o)&&(u.ch+=s,u.ch<0?u=u.line>e.first?Q(e,as(u.line-1)):null:u.ch>a.text.length&&(u=u.line<e.first+e.size-1?as(u.line+1,0):null),!u)){if(r)return n?(e.cantEdit=!0,as(e.first,0)):pt(e,t,i,!0);r=!0,u=t,s=-s}o=u;continue e}}return o}}function ft(e){for(var t=e.display,i=e.doc,n=document.createDocumentFragment(),r=document.createDocumentFragment(),o=0;o<i.sel.ranges.length;o++){var s=i.sel.ranges[o],a=s.empty();(a||e.options.showCursorWhenSelecting)&&mt(e,s,n),a||gt(e,s,r)}if(e.options.moveInputWithCursor){var l=Bt(e,i.sel.primary().head,"div"),h=t.wrapper.getBoundingClientRect(),c=t.lineDiv.getBoundingClientRect(),u=Math.max(0,Math.min(t.wrapper.clientHeight-10,l.top+c.top-h.top)),d=Math.max(0,Math.min(t.wrapper.clientWidth-10,l.left+c.left-h.left));t.inputDiv.style.top=u+"px",t.inputDiv.style.left=d+"px"}uo(t.cursorDiv,n),uo(t.selectionDiv,r)}function mt(e,t,i){var n=Bt(e,t.head,"div"),r=i.appendChild(ho("div","","CodeMirror-cursor"));if(r.style.left=n.left+"px",r.style.top=n.top+"px",r.style.height=Math.max(0,n.bottom-n.top)*e.options.cursorHeight+"px",n.other){var o=i.appendChild(ho("div","","CodeMirror-cursor CodeMirror-secondarycursor"));o.style.display="",o.style.left=n.other.left+"px",o.style.top=n.other.top+"px",o.style.height=.85*(n.other.bottom-n.other.top)+"px"}}function gt(e,t,i){function n(e,t,i,n){0>t&&(t=0),t=Math.round(t),n=Math.round(n),a.appendChild(ho("div",null,"CodeMirror-selected","position: absolute; left: "+e+"px; top: "+t+"px; width: "+(null==i?c-e:i)+"px; height: "+(n-t)+"px"))}function r(t,i,r){function o(i,n){return Vt(e,as(t,i),"div",u,n)}var a,l,u=_r(s,t),d=u.text.length;return Ro(Sr(u),i||0,null==r?d:r,function(e,t,s){var u,p,f,m=o(e,"left");if(e==t)u=m,p=f=m.left;else{if(u=o(t-1,"right"),"rtl"==s){var g=m;m=u,u=g}p=m.left,f=u.right}null==i&&0==e&&(p=h),u.top-m.top>3&&(n(p,m.top,null,m.bottom),p=h,m.bottom<u.top&&n(p,m.bottom,null,u.top)),null==r&&t==d&&(f=c),(!a||m.top<a.top||m.top==a.top&&m.left<a.left)&&(a=m),(!l||u.bottom>l.bottom||u.bottom==l.bottom&&u.right>l.right)&&(l=u),h+1>p&&(p=h),n(p,u.top,f-p,u.bottom)}),{start:a,end:l}}var o=e.display,s=e.doc,a=document.createDocumentFragment(),l=wt(e.display),h=l.left,c=o.lineSpace.offsetWidth-l.right,u=t.from(),d=t.to();if(u.line==d.line)r(u.line,u.ch,d.ch);else{var p=_r(s,u.line),f=_r(s,d.line),m=Bn(p)==Bn(f),g=r(u.line,u.ch,m?p.text.length+1:null).end,v=r(d.line,m?0:null,d.ch).start;m&&(g.top<v.top-2?(n(g.right,g.top,null,g.bottom),n(h,v.top,v.left,v.bottom)):n(g.right,g.top,v.left-g.right,g.bottom)),g.bottom<v.top&&n(h,g.bottom,null,v.top)}i.appendChild(a)}function vt(e){if(e.state.focused){var t=e.display;clearInterval(t.blinker);var i=!0;t.cursorDiv.style.visibility="",e.options.cursorBlinkRate>0&&(t.blinker=setInterval(function(){t.cursorDiv.style.visibility=(i=!i)?"":"hidden"},e.options.cursorBlinkRate))}}function yt(e,t){e.doc.mode.startState&&e.doc.frontier<e.display.viewTo&&e.state.highlight.set(t,oo(_t,e))}function _t(e){var t=e.doc;if(t.frontier<t.first&&(t.frontier=t.first),!(t.frontier>=e.display.viewTo)){var i=+new Date+e.options.workTime,n=Hs(t.mode,Et(e,t.frontier));Kt(e,function(){t.iter(t.frontier,Math.min(t.first+t.size,e.display.viewTo+500),function(r){if(t.frontier>=e.display.viewFrom){var o=r.styles,s=ir(e,r,n,!0);r.styles=s.styles,s.classes?r.styleClasses=s.classes:r.styleClasses&&(r.styleClasses=null);for(var a=!o||o.length!=r.styles.length,l=0;!a&&l<o.length;++l)a=o[l]!=r.styles[l];a&&ni(e,t.frontier,"text"),r.stateAfter=Hs(t.mode,n)}else rr(e,r.text,n),r.stateAfter=0==t.frontier%5?Hs(t.mode,n):null;return++t.frontier,+new Date>i?(yt(e,e.options.workDelay),!0):void 0})})}}function bt(e,t,i){for(var n,r,o=e.doc,s=i?-1:t-(e.doc.mode.innerMode?1e3:100),a=t;a>s;--a){if(a<=o.first)return o.first;var l=_r(o,a-1);if(l.stateAfter&&(!i||a<=o.frontier))return a;var h=sa(l.text,null,e.options.tabSize);(null==r||n>h)&&(r=a-1,n=h)}return r}function Et(e,t,i){var n=e.doc,r=e.display;if(!n.mode.startState)return!0;var o=bt(e,t,i),s=o>n.first&&_r(n,o-1).stateAfter;return s=s?Hs(n.mode,s):Ms(n.mode),n.iter(o,t,function(i){rr(e,i.text,s);var a=o==t-1||0==o%5||o>=r.viewFrom&&o<r.viewTo;i.stateAfter=a?Hs(n.mode,s):null,++o}),i&&(n.frontier=o),s}function xt(e){return e.lineSpace.offsetTop}function Tt(e){return e.mover.offsetHeight-e.lineSpace.offsetHeight}function wt(e){if(e.cachedPaddingH)return e.cachedPaddingH;var t=uo(e.measure,ho("pre","x")),i=window.getComputedStyle?window.getComputedStyle(t):t.currentStyle,n={left:parseInt(i.paddingLeft),right:parseInt(i.paddingRight)};return isNaN(n.left)||isNaN(n.right)||(e.cachedPaddingH=n),n}function Rt(e,t,i){var n=e.options.lineWrapping,r=n&&e.display.scroller.clientWidth;if(!t.measure.heights||n&&t.measure.width!=r){var o=t.measure.heights=[];if(n){t.measure.width=r;for(var s=t.text.firstChild.getClientRects(),a=0;a<s.length-1;a++){var l=s[a],h=s[a+1];Math.abs(l.bottom-h.bottom)>2&&o.push((l.bottom+h.top)/2-i.top)}}o.push(i.bottom-i.top)}}function St(e,t,i){if(e.line==t)return{map:e.measure.map,cache:e.measure.cache};for(var n=0;n<e.rest.length;n++)if(e.rest[n]==t)return{map:e.measure.maps[n],cache:e.measure.caches[n]};for(var n=0;n<e.rest.length;n++)if(Tr(e.rest[n])>i)return{map:e.measure.maps[n],cache:e.measure.caches[n],before:!0}}function Ct(e,t){t=Bn(t);var i=Tr(t),n=e.display.externalMeasured=new ei(e.doc,t,i);n.lineN=i;var r=n.built=sr(e,n);return n.text=r.pre,uo(e.display.lineMeasure,r.pre),n}function Ht(e,t,i,n){return At(e,kt(e,t),i,n)}function Mt(e,t){if(t>=e.display.viewFrom&&t<e.display.viewTo)return e.display.view[oi(e,t)];var i=e.display.externalMeasured;return i&&t>=i.lineN&&t<i.lineN+i.size?i:void 0}function kt(e,t){var i=Tr(t),n=Mt(e,i);n&&!n.text?n=null:n&&n.changes&&A(e,n,i,M(e)),n||(n=Ct(e,t));var r=St(n,t,i);return{line:t,view:n,rect:null,map:r.map,cache:r.cache,before:r.before,hasHeights:!1}}function At(e,t,i,n){t.before&&(i=-1);var r,o=i+(n||"");return t.cache.hasOwnProperty(o)?r=t.cache[o]:(t.rect||(t.rect=t.view.text.getBoundingClientRect()),t.hasHeights||(Rt(e,t.view,t.rect),t.hasHeights=!0),r=Pt(e,t,i,n),r.bogus||(t.cache[o]=r)),{left:r.left,right:r.right,top:r.top,bottom:r.bottom}}function Pt(e,t,i,n){for(var r,o,s,a,l=t.map,h=0;h<l.length;h+=3){var c=l[h],u=l[h+1];if(c>i?(o=0,s=1,a="left"):u>i?(o=i-c,s=o+1):(h==l.length-3||i==u&&l[h+3]>i)&&(s=u-c,o=s-1,i>=u&&(a="right")),null!=o){if(r=l[h+2],c==u&&n==(r.insertLeft?"left":"right")&&(a=n),"left"==n&&0==o)for(;h&&l[h-2]==l[h-3]&&l[h-1].insertLeft;)r=l[(h-=3)+2],a="left";if("right"==n&&o==u-c)for(;h<l.length-3&&l[h+3]==l[h+4]&&!l[h+5].insertLeft;)r=l[(h+=3)+2],a="right";break}}var d;if(3==r.nodeType){for(;o&&lo(t.line.text.charAt(c+o));)--o;for(;u>c+s&&lo(t.line.text.charAt(c+s));)++s;if(Vo&&0==o&&s==u-c)d=r.parentNode.getBoundingClientRect();else if(jo&&e.options.lineWrapping){var p=ha(r,o,s).getClientRects();d=p.length?p["right"==n?p.length-1:0]:ds}else d=ha(r,o,s).getBoundingClientRect()||ds}else{o>0&&(a=n="right");var p;d=e.options.lineWrapping&&(p=r.getClientRects()).length>1?p["right"==n?p.length-1:0]:r.getBoundingClientRect()}if(Vo&&!o&&(!d||!d.left&&!d.right)){var f=r.parentNode.getClientRects()[0];d=f?{left:f.left,right:f.left+qt(e.display),top:f.top,bottom:f.bottom}:ds}for(var m,g=(d.bottom+d.top)/2-t.rect.top,v=t.view.measure.heights,h=0;h<v.length-1&&!(g<v[h]);h++);m=h?v[h-1]:0,g=v[h];var y={left:("right"==a?d.right:d.left)-t.rect.left,right:("left"==a?d.left:d.right)-t.rect.left,top:m,bottom:g};return d.left||d.right||(y.bogus=!0),y}function Ft(e){if(e.measure&&(e.measure.cache={},e.measure.heights=null,e.rest))for(var t=0;t<e.rest.length;t++)e.measure.caches[t]={}}function Dt(e){e.display.externalMeasure=null,co(e.display.lineMeasure);for(var t=0;t<e.display.view.length;t++)Ft(e.display.view[t])}function Nt(e){Dt(e),e.display.cachedCharWidth=e.display.cachedTextHeight=e.display.cachedPaddingH=null,e.options.lineWrapping||(e.display.maxLineChanged=!0),e.display.lineNumChars=null}function zt(){return window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Lt(){return window.pageYOffset||(document.documentElement||document.body).scrollTop}function It(e,t,i,n){if(t.widgets)for(var r=0;r<t.widgets.length;++r)if(t.widgets[r].above){var o=Xn(t.widgets[r]);i.top+=o,i.bottom+=o}if("line"==n)return i;n||(n="local");var s=Rr(t);if("local"==n?s+=xt(e.display):s-=e.display.viewOffset,"page"==n||"window"==n){var a=e.display.lineSpace.getBoundingClientRect();s+=a.top+("window"==n?0:Lt());var l=a.left+("window"==n?0:zt());i.left+=l,i.right+=l}return i.top+=s,i.bottom+=s,i}function Ot(e,t,i){if("div"==i)return t;var n=t.left,r=t.top;if("page"==i)n-=zt(),r-=Lt();else if("local"==i||!i){var o=e.display.sizer.getBoundingClientRect();n+=o.left,r+=o.top}var s=e.display.lineSpace.getBoundingClientRect();return{left:n-s.left,top:r-s.top}}function Vt(e,t,i,n,r){return n||(n=_r(e.doc,t.line)),It(e,n,Ht(e,n,t.ch,r),i)}function Bt(e,t,i,n,r){function o(t,o){var s=At(e,r,t,o?"right":"left");return o?s.left=s.right:s.right=s.left,It(e,n,s,i)}function s(e,t){var i=a[t],n=i.level%2;return e==So(i)&&t&&i.level<a[t-1].level?(i=a[--t],e=Co(i)-(i.level%2?0:1),n=!0):e==Co(i)&&t<a.length-1&&i.level<a[t+1].level&&(i=a[++t],e=So(i)-i.level%2,n=!1),n&&e==i.to&&e>i.from?o(e-1):o(e,n)}n=n||_r(e.doc,t.line),r||(r=kt(e,n));var a=Sr(n),l=t.ch;if(!a)return o(l);var h=Fo(a,l),c=s(l,h);return null!=xa&&(c.other=s(l,xa)),c}function Ut(e,t){var i=0,t=Q(e.doc,t);e.options.lineWrapping||(i=qt(e.display)*t.ch);var n=_r(e.doc,t.line),r=Rr(n)+xt(e.display);return{left:i,right:i,top:r,bottom:r+n.height}}function jt(e,t,i,n){var r=as(e,t);return r.xRel=n,i&&(r.outside=!0),r}function Wt(e,t,i){var n=e.doc;if(i+=e.display.viewOffset,0>i)return jt(n.first,0,!0,-1);var r=wr(n,i),o=n.first+n.size-1;if(r>o)return jt(n.first+n.size-1,_r(n,o).text.length,!0,1);0>t&&(t=0);for(var s=_r(n,r);;){var a=$t(e,s,r,t,i),l=On(s),h=l&&l.find(0,!0);if(!l||!(a.ch>h.from.ch||a.ch==h.from.ch&&a.xRel>0))return a;r=Tr(s=h.to.line)}}function $t(e,t,i,n,r){function o(n){var r=Bt(e,as(i,n),"line",t,h);return a=!0,s>r.bottom?r.left-l:s<r.top?r.left+l:(a=!1,r.left)}var s=r-Rr(t),a=!1,l=2*e.display.wrapper.clientWidth,h=kt(e,t),c=Sr(t),u=t.text.length,d=Ho(t),p=Mo(t),f=o(d),m=a,g=o(p),v=a;if(n>g)return jt(i,p,v,1);for(;;){if(c?p==d||p==No(t,d,1):1>=p-d){for(var y=f>n||g-n>=n-f?d:p,_=n-(y==d?f:g);lo(t.text.charAt(y));)++y;var b=jt(i,y,y==d?m:v,-1>_?-1:_>1?1:0);return b}var E=Math.ceil(u/2),x=d+E;if(c){x=d;for(var T=0;E>T;++T)x=No(t,x,1)}var w=o(x);w>n?(p=x,g=w,(v=a)&&(g+=1e3),u=E):(d=x,f=w,m=a,u-=E)}}function Gt(e){if(null!=e.cachedTextHeight)return e.cachedTextHeight;if(null==hs){hs=ho("pre");for(var t=0;49>t;++t)hs.appendChild(document.createTextNode("x")),hs.appendChild(ho("br"));hs.appendChild(document.createTextNode("x"))}uo(e.measure,hs);var i=hs.offsetHeight/50;return i>3&&(e.cachedTextHeight=i),co(e.measure),i||1}function qt(e){if(null!=e.cachedCharWidth)return e.cachedCharWidth;var t=ho("span","xxxxxxxxxx"),i=ho("pre",[t]);uo(e.measure,i);var n=t.getBoundingClientRect(),r=(n.right-n.left)/10;return r>2&&(e.cachedCharWidth=r),r||10}function Xt(e){e.curOp={viewChanged:!1,startHeight:e.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,id:++ps},ea++||(qs=[])}function Yt(e){var t=e.curOp,i=e.doc,n=e.display;if(e.curOp=null,t.updateMaxLine&&p(e),t.viewChanged||t.forceUpdate||null!=t.scrollTop||t.scrollToPos&&(t.scrollToPos.from.line<n.viewFrom||t.scrollToPos.to.line>=n.viewTo)||n.maxLineChanged&&e.options.lineWrapping){var r=x(e,{top:t.scrollTop,ensure:t.scrollToPos},t.forceUpdate);e.display.scroller.offsetHeight&&(e.doc.scrollTop=e.display.scroller.scrollTop)}if(!r&&t.selectionChanged&&ft(e),r||t.startHeight==e.doc.height||g(e),null==n.wheelStartX||null==t.scrollTop&&null==t.scrollLeft&&!t.scrollToPos||(n.wheelStartX=n.wheelStartY=null),null!=t.scrollTop&&n.scroller.scrollTop!=t.scrollTop){var o=Math.max(0,Math.min(n.scroller.scrollHeight-n.scroller.clientHeight,t.scrollTop));n.scroller.scrollTop=n.scrollbarV.scrollTop=i.scrollTop=o}if(null!=t.scrollLeft&&n.scroller.scrollLeft!=t.scrollLeft){var s=Math.max(0,Math.min(n.scroller.scrollWidth-n.scroller.clientWidth,t.scrollLeft));n.scroller.scrollLeft=n.scrollbarH.scrollLeft=i.scrollLeft=s,y(e)}if(t.scrollToPos){var a=nn(e,Q(e.doc,t.scrollToPos.from),Q(e.doc,t.scrollToPos.to),t.scrollToPos.margin);
t.scrollToPos.isCursor&&e.state.focused&&tn(e,a)}t.selectionChanged&&vt(e),e.state.focused&&t.updateInput&&di(e,t.typing);var l=t.maybeHiddenMarkers,h=t.maybeUnhiddenMarkers;if(l)for(var c=0;c<l.length;++c)l[c].lines.length||Zs(l[c],"hide");if(h)for(var c=0;c<h.length;++c)h[c].lines.length&&Zs(h[c],"unhide");var u;if(--ea||(u=qs,qs=null),t.changeObjs&&Zs(e,"changes",e,t.changeObjs),u)for(var c=0;c<u.length;++c)u[c]();if(t.cursorActivityHandlers)for(var c=0;c<t.cursorActivityHandlers.length;c++)t.cursorActivityHandlers[c](e)}function Kt(e,t){if(e.curOp)return t();Xt(e);try{return t()}finally{Yt(e)}}function Qt(e,t){return function(){if(e.curOp)return t.apply(e,arguments);Xt(e);try{return t.apply(e,arguments)}finally{Yt(e)}}}function Jt(e){return function(){if(this.curOp)return e.apply(this,arguments);Xt(this);try{return e.apply(this,arguments)}finally{Yt(this)}}}function Zt(e){return function(){var t=this.cm;if(!t||t.curOp)return e.apply(this,arguments);Xt(t);try{return e.apply(this,arguments)}finally{Yt(t)}}}function ei(e,t,i){this.line=t,this.rest=Un(t),this.size=this.rest?Tr(eo(this.rest))-i+1:1,this.node=this.text=null,this.hidden=$n(e,t)}function ti(e,t,i){for(var n,r=[],o=t;i>o;o=n){var s=new ei(e.doc,_r(e.doc,o),o);n=o+s.size,r.push(s)}return r}function ii(e,t,i,n){null==t&&(t=e.doc.first),null==i&&(i=e.doc.first+e.doc.size),n||(n=0);var r=e.display;if(n&&i<r.viewTo&&(null==r.updateLineNumbers||r.updateLineNumbers>t)&&(r.updateLineNumbers=t),e.curOp.viewChanged=!0,t>=r.viewTo)ss&&jn(e.doc,t)<r.viewTo&&ri(e);else if(i<=r.viewFrom)ss&&Wn(e.doc,i+n)>r.viewFrom?ri(e):(r.viewFrom+=n,r.viewTo+=n);else if(t<=r.viewFrom&&i>=r.viewTo)ri(e);else if(t<=r.viewFrom){var o=si(e,i,i+n,1);o?(r.view=r.view.slice(o.index),r.viewFrom=o.lineN,r.viewTo+=n):ri(e)}else if(i>=r.viewTo){var o=si(e,t,t,-1);o?(r.view=r.view.slice(0,o.index),r.viewTo=o.lineN):ri(e)}else{var s=si(e,t,t,-1),a=si(e,i,i+n,1);s&&a?(r.view=r.view.slice(0,s.index).concat(ti(e,s.lineN,a.lineN)).concat(r.view.slice(a.index)),r.viewTo+=n):ri(e)}var l=r.externalMeasured;l&&(i<l.lineN?l.lineN+=n:t<l.lineN+l.size&&(r.externalMeasured=null))}function ni(e,t,i){e.curOp.viewChanged=!0;var n=e.display,r=e.display.externalMeasured;if(r&&t>=r.lineN&&t<r.lineN+r.size&&(n.externalMeasured=null),!(t<n.viewFrom||t>=n.viewTo)){var o=n.view[oi(e,t)];if(null!=o.node){var s=o.changes||(o.changes=[]);-1==to(s,i)&&s.push(i)}}}function ri(e){e.display.viewFrom=e.display.viewTo=e.doc.first,e.display.view=[],e.display.viewOffset=0}function oi(e,t){if(t>=e.display.viewTo)return null;if(t-=e.display.viewFrom,0>t)return null;for(var i=e.display.view,n=0;n<i.length;n++)if(t-=i[n].size,0>t)return n}function si(e,t,i,n){var r,o=oi(e,t),s=e.display.view;if(!ss||i==e.doc.first+e.doc.size)return{index:o,lineN:i};for(var a=0,l=e.display.viewFrom;o>a;a++)l+=s[a].size;if(l!=t){if(n>0){if(o==s.length-1)return null;r=l+s[o].size-t,o++}else r=l-t;t+=r,i+=r}for(;jn(e.doc,i)!=i;){if(o==(0>n?0:s.length-1))return null;i+=n*s[o-(0>n?1:0)].size,o+=n}return{index:o,lineN:i}}function ai(e,t,i){var n=e.display,r=n.view;0==r.length||t>=n.viewTo||i<=n.viewFrom?(n.view=ti(e,t,i),n.viewFrom=t):(n.viewFrom>t?n.view=ti(e,t,n.viewFrom).concat(n.view):n.viewFrom<t&&(n.view=n.view.slice(oi(e,t))),n.viewFrom=t,n.viewTo<i?n.view=n.view.concat(ti(e,n.viewTo,i)):n.viewTo>i&&(n.view=n.view.slice(0,oi(e,i)))),n.viewTo=i}function li(e){for(var t=e.display.view,i=0,n=0;n<t.length;n++){var r=t[n];r.hidden||r.node&&!r.changes||++i}return i}function hi(e){e.display.pollingFast||e.display.poll.set(e.options.pollInterval,function(){ui(e),e.state.focused&&hi(e)})}function ci(e){function t(){var n=ui(e);n||i?(e.display.pollingFast=!1,hi(e)):(i=!0,e.display.poll.set(60,t))}var i=!1;e.display.pollingFast=!0,e.display.poll.set(20,t)}function ui(e){var t=e.display.input,i=e.display.prevInput,n=e.doc;if(!e.state.focused||_a(t)&&!i||mi(e)||e.options.disableInput)return!1;e.state.pasteIncoming&&e.state.fakedLastChar&&(t.value=t.value.substring(0,t.value.length-1),e.state.fakedLastChar=!1);var r=t.value;if(r==i&&!e.somethingSelected())return!1;if(jo&&!Vo&&e.display.inputHasSelection===r)return di(e),!1;var o=!e.curOp;o&&Xt(e),e.display.shift=!1,8203!=r.charCodeAt(0)||n.sel!=e.display.selForContextMenu||i||(i="");for(var s=0,a=Math.min(i.length,r.length);a>s&&i.charCodeAt(s)==r.charCodeAt(s);)++s;for(var l=r.slice(s),h=ya(l),c=e.state.pasteIncoming&&h.length>1&&n.sel.ranges.length==h.length,u=n.sel.ranges.length-1;u>=0;u--){var d=n.sel.ranges[u],p=d.from(),f=d.to();s<i.length?p=as(p.line,p.ch-(i.length-s)):e.state.overwrite&&d.empty()&&!e.state.pasteIncoming&&(f=as(f.line,Math.min(_r(n,f.line).text.length,f.ch+eo(h).length)));var m=e.curOp.updateInput,g={from:p,to:f,text:c?[h[u]]:h,origin:e.state.pasteIncoming?"paste":e.state.cutIncoming?"cut":"+input"};if(Xi(e.doc,g),$r(e,"inputRead",e,g),l&&!e.state.pasteIncoming&&e.options.electricChars&&e.options.smartIndent&&d.head.ch<100&&(!u||n.sel.ranges[u-1].head.line!=d.head.line)){var v=e.getModeAt(d.head);if(v.electricChars){for(var y=0;y<v.electricChars.length;y++)if(l.indexOf(v.electricChars.charAt(y))>-1){hn(e,d.head.line,"smart");break}}else if(v.electricInput){var _=_s(g);v.electricInput.test(_r(n,_.line).text.slice(0,_.ch))&&hn(e,d.head.line,"smart")}}}return an(e),e.curOp.updateInput=m,e.curOp.typing=!0,r.length>1e3||r.indexOf("\n")>-1?t.value=e.display.prevInput="":e.display.prevInput=r,o&&Yt(e),e.state.pasteIncoming=e.state.cutIncoming=!1,!0}function di(e,t){var i,n,r=e.doc;if(e.somethingSelected()){e.display.prevInput="";var o=r.sel.primary();i=ba&&(o.to().line-o.from().line>100||(n=e.getSelection()).length>1e3);var s=i?"-":n||e.getSelection();e.display.input.value=s,e.state.focused&&la(e.display.input),jo&&!Vo&&(e.display.inputHasSelection=s)}else t||(e.display.prevInput=e.display.input.value="",jo&&!Vo&&(e.display.inputHasSelection=null));e.display.inaccurateSelection=i}function pi(e){"nocursor"==e.options.readOnly||Zo&&fo()==e.display.input||e.display.input.focus()}function fi(e){e.state.focused||(pi(e),Oi(e))}function mi(e){return e.options.readOnly||e.doc.cantEdit}function gi(e){function t(){e.state.focused&&setTimeout(oo(pi,e),0)}function i(t){qr(e,t)||Ks(t)}function n(t){if(e.somethingSelected())r.inaccurateSelection&&(r.prevInput="",r.inaccurateSelection=!1,r.input.value=e.getSelection(),la(r.input));else{for(var i="",n=[],o=0;o<e.doc.sel.ranges.length;o++){var s=e.doc.sel.ranges[o].head.line,a={anchor:as(s,0),head:as(s+1,0)};n.push(a),i+=e.getRange(a.anchor,a.head)}"cut"==t.type?e.setSelections(n,null,na):(r.prevInput="",r.input.value=i,la(r.input))}"cut"==t.type&&(e.state.cutIncoming=!0)}var r=e.display;Qs(r.scroller,"mousedown",Qt(e,bi)),Io?Qs(r.scroller,"dblclick",Qt(e,function(t){if(!qr(e,t)){var i=_i(e,t);if(i&&!Ri(e,t)&&!yi(e.display,t)){Xs(t);var n=fn(e,i);it(e.doc,n.anchor,n.head)}}})):Qs(r.scroller,"dblclick",function(t){qr(e,t)||Xs(t)}),Qs(r.lineSpace,"selectstart",function(e){yi(r,e)||Xs(e)}),rs||Qs(r.scroller,"contextmenu",function(t){Bi(e,t)}),Qs(r.scroller,"scroll",function(){r.scroller.clientHeight&&(Hi(e,r.scroller.scrollTop),Mi(e,r.scroller.scrollLeft,!0),Zs(e,"scroll",e))}),Qs(r.scrollbarV,"scroll",function(){r.scroller.clientHeight&&Hi(e,r.scrollbarV.scrollTop)}),Qs(r.scrollbarH,"scroll",function(){r.scroller.clientHeight&&Mi(e,r.scrollbarH.scrollLeft)}),Qs(r.scroller,"mousewheel",function(t){ki(e,t)}),Qs(r.scroller,"DOMMouseScroll",function(t){ki(e,t)}),Qs(r.scrollbarH,"mousedown",t),Qs(r.scrollbarV,"mousedown",t),Qs(r.wrapper,"scroll",function(){r.wrapper.scrollTop=r.wrapper.scrollLeft=0}),Qs(r.input,"keyup",Qt(e,Li)),Qs(r.input,"input",function(){jo&&!Vo&&e.display.inputHasSelection&&(e.display.inputHasSelection=null),ci(e)}),Qs(r.input,"keydown",Qt(e,Ni)),Qs(r.input,"keypress",Qt(e,Ii)),Qs(r.input,"focus",oo(Oi,e)),Qs(r.input,"blur",oo(Vi,e)),e.options.dragDrop&&(Qs(r.scroller,"dragstart",function(t){Ci(e,t)}),Qs(r.scroller,"dragenter",i),Qs(r.scroller,"dragover",i),Qs(r.scroller,"drop",Qt(e,Si))),Qs(r.scroller,"paste",function(t){yi(r,t)||(e.state.pasteIncoming=!0,pi(e),ci(e))}),Qs(r.input,"paste",function(){if(Wo&&!e.state.fakedLastChar&&!(new Date-e.state.lastMiddleDown<200)){var t=r.input.selectionStart,i=r.input.selectionEnd;r.input.value+="$",r.input.selectionStart=t,r.input.selectionEnd=i,e.state.fakedLastChar=!0}e.state.pasteIncoming=!0,ci(e)}),Qs(r.input,"cut",n),Qs(r.input,"copy",n),Yo&&Qs(r.sizer,"mouseup",function(){fo()==r.input&&r.input.blur(),pi(e)})}function vi(e){var t=e.display;t.cachedCharWidth=t.cachedTextHeight=t.cachedPaddingH=null,e.setSize()}function yi(e,t){for(var i=jr(t);i!=e.wrapper;i=i.parentNode)if(!i||i.ignoreEvents||i.parentNode==e.sizer&&i!=e.mover)return!0}function _i(e,t,i,n){var r=e.display;if(!i){var o=jr(t);if(o==r.scrollbarH||o==r.scrollbarV||o==r.scrollbarFiller||o==r.gutterFiller)return null}var s,a,l=r.lineSpace.getBoundingClientRect();try{s=t.clientX-l.left,a=t.clientY-l.top}catch(t){return null}var h,c=Wt(e,s,a);if(n&&1==c.xRel&&(h=_r(e.doc,c.line).text).length==c.ch){var u=sa(h,h.length,e.options.tabSize)-h.length;c=as(c.line,Math.max(0,Math.round((s-wt(e.display).left)/qt(e.display))-u))}return c}function bi(e){if(!qr(this,e)){var t=this,i=t.display;if(i.shift=e.shiftKey,yi(i,e))return Wo||(i.scroller.draggable=!1,setTimeout(function(){i.scroller.draggable=!0},100)),void 0;if(!Ri(t,e)){var n=_i(t,e);switch(window.focus(),Wr(e)){case 1:n?Ei(t,e,n):jr(e)==i.scroller&&Xs(e);break;case 2:Wo&&(t.state.lastMiddleDown=+new Date),n&&it(t.doc,n),setTimeout(oo(pi,t),20),Xs(e);break;case 3:rs&&Bi(t,e)}}}}function Ei(e,t,i){setTimeout(oo(fi,e),0);var n,r=+new Date;us&&us.time>r-400&&0==ls(us.pos,i)?n="triple":cs&&cs.time>r-400&&0==ls(cs.pos,i)?(n="double",us={time:r,pos:i}):(n="single",cs={time:r,pos:i});var o=e.doc.sel,s=es?t.metaKey:t.ctrlKey;e.options.dragDrop&&va&&!mi(e)&&"single"==n&&o.contains(i)>-1&&o.somethingSelected()?xi(e,t,i,s):Ti(e,t,i,n,s)}function xi(e,t,i,n){var r=e.display,o=Qt(e,function(s){Wo&&(r.scroller.draggable=!1),e.state.draggingText=!1,Js(document,"mouseup",o),Js(r.scroller,"drop",o),Math.abs(t.clientX-s.clientX)+Math.abs(t.clientY-s.clientY)<10&&(Xs(s),n||it(e.doc,i),pi(e),Io&&!Vo&&setTimeout(function(){document.body.focus(),pi(e)},20))});Wo&&(r.scroller.draggable=!0),e.state.draggingText=o,r.scroller.dragDrop&&r.scroller.dragDrop(),Qs(document,"mouseup",o),Qs(r.scroller,"drop",o)}function Ti(e,t,i,n,r){function o(t){if(0!=ls(m,t))if(m=t,"rect"==n){for(var r=[],o=e.options.tabSize,s=sa(_r(h,i.line).text,i.ch,o),a=sa(_r(h,t.line).text,t.ch,o),l=Math.min(s,a),p=Math.max(s,a),f=Math.min(i.line,t.line),g=Math.min(e.lastLine(),Math.max(i.line,t.line));g>=f;f++){var v=_r(h,f).text,y=Jr(v,l,o);l==p?r.push(new q(as(f,y),as(f,y))):v.length>y&&r.push(new q(as(f,y),as(f,Jr(v,p,o))))}r.length||r.push(new q(i,i)),lt(h,X(d.ranges.slice(0,u).concat(r),u),{origin:"*mouse",scroll:!1}),e.scrollIntoView(t)}else{var _=c,b=_.anchor,E=t;if("single"!=n){if("double"==n)var x=fn(e,t);else var x=new q(as(t.line,0),Q(h,as(t.line+1,0)));ls(x.anchor,b)>0?(E=x.head,b=$(_.from(),x.anchor)):(E=x.anchor,b=W(_.to(),x.head))}var r=d.ranges.slice(0);r[u]=new q(Q(h,b),E),lt(h,X(r,u),ra)}}function s(t){var i=++y,r=_i(e,t,!0,"rect"==n);if(r)if(0!=ls(r,m)){fi(e),o(r);var a=v(l,h);(r.line>=a.to||r.line<a.from)&&setTimeout(Qt(e,function(){y==i&&s(t)}),150)}else{var c=t.clientY<g.top?-20:t.clientY>g.bottom?20:0;c&&setTimeout(Qt(e,function(){y==i&&(l.scroller.scrollTop+=c,s(t))}),50)}}function a(t){y=1/0,Xs(t),pi(e),Js(document,"mousemove",_),Js(document,"mouseup",b),h.history.lastSelOrigin=null}var l=e.display,h=e.doc;Xs(t);var c,u,d=h.sel;if(r&&!t.shiftKey?(u=h.sel.contains(i),c=u>-1?h.sel.ranges[u]:new q(i,i)):c=h.sel.primary(),t.altKey)n="rect",r||(c=new q(i,i)),i=_i(e,t,!0,!0),u=-1;else if("double"==n){var p=fn(e,i);c=e.display.shift||h.extend?tt(h,c,p.anchor,p.head):p}else if("triple"==n){var f=new q(as(i.line,0),Q(h,as(i.line+1,0)));c=e.display.shift||h.extend?tt(h,c,f.anchor,f.head):f}else c=tt(h,c,i);r?u>-1?rt(h,u,c,ra):(u=h.sel.ranges.length,lt(h,X(h.sel.ranges.concat([c]),u),{scroll:!1,origin:"*mouse"})):(u=0,lt(h,new G([c],0),ra),d=h.sel);var m=i,g=l.wrapper.getBoundingClientRect(),y=0,_=Qt(e,function(e){(jo&&!Bo?e.buttons:Wr(e))?s(e):a(e)}),b=Qt(e,a);Qs(document,"mousemove",_),Qs(document,"mouseup",b)}function wi(e,t,i,n,r){try{var o=t.clientX,s=t.clientY}catch(t){return!1}if(o>=Math.floor(e.display.gutters.getBoundingClientRect().right))return!1;n&&Xs(t);var a=e.display,l=a.lineDiv.getBoundingClientRect();if(s>l.bottom||!Yr(e,i))return Ur(t);s-=l.top-a.viewOffset;for(var h=0;h<e.options.gutters.length;++h){var c=a.gutters.childNodes[h];if(c&&c.getBoundingClientRect().right>=o){var u=wr(e.doc,s),d=e.options.gutters[h];return r(e,i,e,u,d,t),Ur(t)}}}function Ri(e,t){return wi(e,t,"gutterClick",!0,$r)}function Si(e){var t=this;if(!qr(t,e)&&!yi(t.display,e)){Xs(e),jo&&(fs=+new Date);var i=_i(t,e,!0),n=e.dataTransfer.files;if(i&&!mi(t))if(n&&n.length&&window.FileReader&&window.File)for(var r=n.length,o=Array(r),s=0,a=function(e,n){var a=new FileReader;a.onload=Qt(t,function(){if(o[n]=a.result,++s==r){i=Q(t.doc,i);var e={from:i,to:i,text:ya(o.join("\n")),origin:"paste"};Xi(t.doc,e),at(t.doc,Y(i,_s(e)))}}),a.readAsText(e)},l=0;r>l;++l)a(n[l],l);else{if(t.state.draggingText&&t.doc.sel.contains(i)>-1)return t.state.draggingText(e),setTimeout(oo(pi,t),20),void 0;try{var o=e.dataTransfer.getData("Text");if(o){if(t.state.draggingText&&!(es?e.metaKey:e.ctrlKey))var h=t.listSelections();if(ht(t.doc,Y(i,i)),h)for(var l=0;l<h.length;++l)en(t.doc,"",h[l].anchor,h[l].head,"drag");t.replaceSelection(o,"around","paste"),pi(t)}}catch(e){}}}}function Ci(e,t){if(jo&&(!e.state.draggingText||+new Date-fs<100))return Ks(t),void 0;if(!qr(e,t)&&!yi(e.display,t)&&(t.dataTransfer.setData("Text",e.getSelection()),t.dataTransfer.setDragImage&&!Xo)){var i=ho("img",null,null,"position: fixed; left: 0; top: 0;");i.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==",qo&&(i.width=i.height=1,e.display.wrapper.appendChild(i),i._top=i.offsetTop),t.dataTransfer.setDragImage(i,0,0),qo&&i.parentNode.removeChild(i)}}function Hi(e,t){Math.abs(e.doc.scrollTop-t)<2||(e.doc.scrollTop=t,Lo||x(e,{top:t}),e.display.scroller.scrollTop!=t&&(e.display.scroller.scrollTop=t),e.display.scrollbarV.scrollTop!=t&&(e.display.scrollbarV.scrollTop=t),Lo&&x(e),yt(e,100))}function Mi(e,t,i){(i?t==e.doc.scrollLeft:Math.abs(e.doc.scrollLeft-t)<2)||(t=Math.min(t,e.display.scroller.scrollWidth-e.display.scroller.clientWidth),e.doc.scrollLeft=t,y(e),e.display.scroller.scrollLeft!=t&&(e.display.scroller.scrollLeft=t),e.display.scrollbarH.scrollLeft!=t&&(e.display.scrollbarH.scrollLeft=t))}function ki(e,t){var i=t.wheelDeltaX,n=t.wheelDeltaY;null==i&&t.detail&&t.axis==t.HORIZONTAL_AXIS&&(i=t.detail),null==n&&t.detail&&t.axis==t.VERTICAL_AXIS?n=t.detail:null==n&&(n=t.wheelDelta);var r=e.display,o=r.scroller;if(i&&o.scrollWidth>o.clientWidth||n&&o.scrollHeight>o.clientHeight){if(n&&es&&Wo)e:for(var s=t.target,a=r.view;s!=o;s=s.parentNode)for(var l=0;l<a.length;l++)if(a[l].node==s){e.display.currentWheelTarget=s;break e}if(i&&!Lo&&!qo&&null!=gs)return n&&Hi(e,Math.max(0,Math.min(o.scrollTop+n*gs,o.scrollHeight-o.clientHeight))),Mi(e,Math.max(0,Math.min(o.scrollLeft+i*gs,o.scrollWidth-o.clientWidth))),Xs(t),r.wheelStartX=null,void 0;if(n&&null!=gs){var h=n*gs,c=e.doc.scrollTop,u=c+r.wrapper.clientHeight;0>h?c=Math.max(0,c+h-50):u=Math.min(e.doc.height,u+h+50),x(e,{top:c,bottom:u})}20>ms&&(null==r.wheelStartX?(r.wheelStartX=o.scrollLeft,r.wheelStartY=o.scrollTop,r.wheelDX=i,r.wheelDY=n,setTimeout(function(){if(null!=r.wheelStartX){var e=o.scrollLeft-r.wheelStartX,t=o.scrollTop-r.wheelStartY,i=t&&r.wheelDY&&t/r.wheelDY||e&&r.wheelDX&&e/r.wheelDX;r.wheelStartX=r.wheelStartY=null,i&&(gs=(gs*ms+i)/(ms+1),++ms)}},200)):(r.wheelDX+=i,r.wheelDY+=n))}}function Ai(e,t,i){if("string"==typeof t&&(t=ks[t],!t))return!1;e.display.pollingFast&&ui(e)&&(e.display.pollingFast=!1);var n=e.display.shift,r=!1;try{mi(e)&&(e.state.suppressEdits=!0),i&&(e.display.shift=!1),r=t(e)!=ia}finally{e.display.shift=n,e.state.suppressEdits=!1}return r}function Pi(e){var t=e.state.keyMaps.slice(0);return e.options.extraKeys&&t.push(e.options.extraKeys),t.push(e.options.keyMap),t}function Fi(e,t){var i=gn(e.options.keyMap),n=i.auto;clearTimeout(vs),n&&!Fs(t)&&(vs=setTimeout(function(){gn(e.options.keyMap)==i&&(e.options.keyMap=n.call?n.call(null,e):n,a(e))},50));var r=Ds(t,!0),o=!1;if(!r)return!1;var s=Pi(e);return o=t.shiftKey?Ps("Shift-"+r,s,function(t){return Ai(e,t,!0)})||Ps(r,s,function(t){return("string"==typeof t?/^go[A-Z]/.test(t):t.motion)?Ai(e,t):void 0}):Ps(r,s,function(t){return Ai(e,t)}),o&&(Xs(t),vt(e),$r(e,"keyHandled",e,r,t)),o}function Di(e,t,i){var n=Ps("'"+i+"'",Pi(e),function(t){return Ai(e,t,!0)});return n&&(Xs(t),vt(e),$r(e,"keyHandled",e,"'"+i+"'",t)),n}function Ni(e){var t=this;if(fi(t),!qr(t,e)){Io&&27==e.keyCode&&(e.returnValue=!1);var i=e.keyCode;t.display.shift=16==i||e.shiftKey;var n=Fi(t,e);qo&&(ys=n?i:null,!n&&88==i&&!ba&&(es?e.metaKey:e.ctrlKey)&&t.replaceSelection("",null,"cut")),18!=i||/\bCodeMirror-crosshair\b/.test(t.display.lineDiv.className)||zi(t)}}function zi(e){function t(e){18!=e.keyCode&&e.altKey||(go(i,"CodeMirror-crosshair"),Js(document,"keyup",t),Js(document,"mouseover",t))}var i=e.display.lineDiv;vo(i,"CodeMirror-crosshair"),Qs(document,"keyup",t),Qs(document,"mouseover",t)}function Li(e){qr(this,e)||16==e.keyCode&&(this.doc.sel.shift=!1)}function Ii(e){var t=this;if(!qr(t,e)){var i=e.keyCode,n=e.charCode;if(qo&&i==ys)return ys=null,Xs(e),void 0;if(!(qo&&(!e.which||e.which<10)||Yo)||!Fi(t,e)){var r=String.fromCharCode(null==n?i:n);Di(t,e,r)||(jo&&!Vo&&(t.display.inputHasSelection=null),ci(t))}}}function Oi(e){"nocursor"!=e.options.readOnly&&(e.state.focused||(Zs(e,"focus",e),e.state.focused=!0,vo(e.display.wrapper,"CodeMirror-focused"),e.curOp||e.display.selForContextMenu==e.doc.sel||(di(e),Wo&&setTimeout(oo(di,e,!0),0))),hi(e),vt(e))}function Vi(e){e.state.focused&&(Zs(e,"blur",e),e.state.focused=!1,go(e.display.wrapper,"CodeMirror-focused")),clearInterval(e.display.blinker),setTimeout(function(){e.state.focused||(e.display.shift=!1)},150)}function Bi(e,t){function i(){if(null!=r.input.selectionStart){var t=e.somethingSelected(),i=r.input.value=""+(t?r.input.value:"");r.prevInput=t?"":"",r.input.selectionStart=1,r.input.selectionEnd=i.length,r.selForContextMenu=e.doc.sel}}function n(){if(r.inputDiv.style.position="relative",r.input.style.cssText=l,Vo&&(r.scrollbarV.scrollTop=r.scroller.scrollTop=s),hi(e),null!=r.input.selectionStart){(!jo||Vo)&&i();var t=0,n=function(){r.selForContextMenu==e.doc.sel&&0==r.input.selectionStart?Qt(e,ks.selectAll)(e):t++<10?r.detectingSelectAll=setTimeout(n,500):di(e)};r.detectingSelectAll=setTimeout(n,200)}}if(!qr(e,t,"contextmenu")){var r=e.display;if(!yi(r,t)&&!Ui(e,t)){var o=_i(e,t),s=r.scroller.scrollTop;if(o&&!qo){var a=e.options.resetSelectionOnContextMenu;a&&-1==e.doc.sel.contains(o)&&Qt(e,lt)(e.doc,Y(o),na);var l=r.input.style.cssText;if(r.inputDiv.style.position="absolute",r.input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(t.clientY-5)+"px; left: "+(t.clientX-5)+"px; z-index: 1000; background: "+(jo?"rgba(255, 255, 255, .05)":"transparent")+"; outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",pi(e),di(e),e.somethingSelected()||(r.input.value=r.prevInput=" "),r.selForContextMenu=e.doc.sel,clearTimeout(r.detectingSelectAll),jo&&!Vo&&i(),rs){Ks(t);var h=function(){Js(window,"mouseup",h),setTimeout(n,20)};Qs(window,"mouseup",h)}else setTimeout(n,50)}}}}function Ui(e,t){return Yr(e,"gutterContextMenu")?wi(e,t,"gutterContextMenu",!1,Zs):!1}function ji(e,t){if(ls(e,t.from)<0)return e;if(ls(e,t.to)<=0)return _s(t);var i=e.line+t.text.length-(t.to.line-t.from.line)-1,n=e.ch;return e.line==t.to.line&&(n+=_s(t).ch-t.to.ch),as(i,n)}function Wi(e,t){for(var i=[],n=0;n<e.sel.ranges.length;n++){var r=e.sel.ranges[n];i.push(new q(ji(r.anchor,t),ji(r.head,t)))}return X(i,e.sel.primIndex)}function $i(e,t,i){return e.line==t.line?as(i.line,e.ch-t.ch+i.ch):as(i.line+(e.line-t.line),e.ch)}function Gi(e,t,i){for(var n=[],r=as(e.first,0),o=r,s=0;s<t.length;s++){var a=t[s],l=$i(a.from,r,o),h=$i(_s(a),r,o);if(r=a.to,o=h,"around"==i){var c=e.sel.ranges[s],u=ls(c.head,c.anchor)<0;n[s]=new q(u?h:l,u?l:h)}else n[s]=new q(l,l)}return new G(n,e.sel.primIndex)}function qi(e,t,i){var n={canceled:!1,from:t.from,to:t.to,text:t.text,origin:t.origin,cancel:function(){this.canceled=!0}};return i&&(n.update=function(t,i,n,r){t&&(this.from=Q(e,t)),i&&(this.to=Q(e,i)),n&&(this.text=n),void 0!==r&&(this.origin=r)}),Zs(e,"beforeChange",e,n),e.cm&&Zs(e.cm,"beforeChange",e.cm,n),n.canceled?null:{from:n.from,to:n.to,text:n.text,origin:n.origin}}function Xi(e,t,i){if(e.cm){if(!e.cm.curOp)return Qt(e.cm,Xi)(e,t,i);if(e.cm.state.suppressEdits)return}if(!(Yr(e,"beforeChange")||e.cm&&Yr(e.cm,"beforeChange"))||(t=qi(e,t,!0))){var n=os&&!i&&An(e,t.from,t.to);if(n)for(var r=n.length-1;r>=0;--r)Yi(e,{from:n[r].from,to:n[r].to,text:r?[""]:t.text});else Yi(e,t)}}function Yi(e,t){if(1!=t.text.length||""!=t.text[0]||0!=ls(t.from,t.to)){var i=Wi(e,t);Ar(e,t,i,e.cm?e.cm.curOp.id:0/0),Ji(e,t,i,Hn(e,t));var n=[];vr(e,function(e,i){i||-1!=to(n,e.history)||(Br(e.history,t),n.push(e.history)),Ji(e,t,null,Hn(e,t))})}}function Ki(e,t,i){if(!e.cm||!e.cm.state.suppressEdits){for(var n,r=e.history,o=e.sel,s="undo"==t?r.done:r.undone,a="undo"==t?r.undone:r.done,l=0;l<s.length&&(n=s[l],i?!n.ranges||n.equals(e.sel):n.ranges);l++);if(l!=s.length){for(r.lastOrigin=r.lastSelOrigin=null;n=s.pop(),n.ranges;){if(Dr(n,a),i&&!n.equals(e.sel))return lt(e,n,{clearRedo:!1}),void 0;o=n}var h=[];Dr(o,a),a.push({changes:h,generation:r.generation}),r.generation=n.generation||++r.maxGeneration;for(var c=Yr(e,"beforeChange")||e.cm&&Yr(e.cm,"beforeChange"),l=n.changes.length-1;l>=0;--l){var u=n.changes[l];if(u.origin=t,c&&!qi(e,u,!1))return s.length=0,void 0;h.push(Hr(e,u));var d=l?Wi(e,u,null):eo(s);Ji(e,u,d,kn(e,u)),!l&&e.cm&&e.cm.scrollIntoView(u);var p=[];vr(e,function(e,t){t||-1!=to(p,e.history)||(Br(e.history,u),p.push(e.history)),Ji(e,u,null,kn(e,u))})}}}}function Qi(e,t){if(0!=t&&(e.first+=t,e.sel=new G(io(e.sel.ranges,function(e){return new q(as(e.anchor.line+t,e.anchor.ch),as(e.head.line+t,e.head.ch))}),e.sel.primIndex),e.cm)){ii(e.cm,e.first,e.first-t,t);for(var i=e.cm.display,n=i.viewFrom;n<i.viewTo;n++)ni(e.cm,n,"gutter")}}function Ji(e,t,i,n){if(e.cm&&!e.cm.curOp)return Qt(e.cm,Ji)(e,t,i,n);if(t.to.line<e.first)return Qi(e,t.text.length-1-(t.to.line-t.from.line)),void 0;if(!(t.from.line>e.lastLine())){if(t.from.line<e.first){var r=t.text.length-1-(e.first-t.from.line);Qi(e,r),t={from:as(e.first,0),to:as(t.to.line+r,t.to.ch),text:[eo(t.text)],origin:t.origin}}var o=e.lastLine();t.to.line>o&&(t={from:t.from,to:as(o,_r(e,o).text.length),text:[t.text[0]],origin:t.origin}),t.removed=br(e,t.from,t.to),i||(i=Wi(e,t,null)),e.cm?Zi(e.cm,t,n):fr(e,t,n),ht(e,i,na)}}function Zi(e,t,i){var n=e.doc,r=e.display,s=t.from,a=t.to,l=!1,h=s.line;e.options.lineWrapping||(h=Tr(Bn(_r(n,s.line))),n.iter(h,a.line+1,function(e){return e==r.maxLine?(l=!0,!0):void 0})),n.sel.contains(t.from,t.to)>-1&&Xr(e),fr(n,t,i,o(e)),e.options.lineWrapping||(n.iter(h,s.line+t.text.length,function(e){var t=d(e);t>r.maxLineLength&&(r.maxLine=e,r.maxLineLength=t,r.maxLineChanged=!0,l=!1)}),l&&(e.curOp.updateMaxLine=!0)),n.frontier=Math.min(n.frontier,s.line),yt(e,400);var c=t.text.length-(a.line-s.line)-1;s.line!=a.line||1!=t.text.length||pr(e.doc,t)?ii(e,s.line,a.line+1,c):ni(e,s.line,"text");var u=Yr(e,"changes"),p=Yr(e,"change");if(p||u){var f={from:s,to:a,text:t.text,removed:t.removed,origin:t.origin};p&&$r(e,"change",e,f),u&&(e.curOp.changeObjs||(e.curOp.changeObjs=[])).push(f)}e.display.selForContextMenu=null}function en(e,t,i,n,r){if(n||(n=i),ls(n,i)<0){var o=n;n=i,i=o}"string"==typeof t&&(t=ya(t)),Xi(e,{from:i,to:n,text:t,origin:r})}function tn(e,t){var i=e.display,n=i.sizer.getBoundingClientRect(),r=null;if(t.top+n.top<0?r=!0:t.bottom+n.top>(window.innerHeight||document.documentElement.clientHeight)&&(r=!1),null!=r&&!Qo){var o=ho("div","",null,"position: absolute; top: "+(t.top-i.viewOffset-xt(e.display))+"px; height: "+(t.bottom-t.top+ta)+"px; left: "+t.left+"px; width: 2px;");e.display.lineSpace.appendChild(o),o.scrollIntoView(r),e.display.lineSpace.removeChild(o)}}function nn(e,t,i,n){for(null==n&&(n=0);;){var r=!1,o=Bt(e,t),s=i&&i!=t?Bt(e,i):o,a=on(e,Math.min(o.left,s.left),Math.min(o.top,s.top)-n,Math.max(o.left,s.left),Math.max(o.bottom,s.bottom)+n),l=e.doc.scrollTop,h=e.doc.scrollLeft;if(null!=a.scrollTop&&(Hi(e,a.scrollTop),Math.abs(e.doc.scrollTop-l)>1&&(r=!0)),null!=a.scrollLeft&&(Mi(e,a.scrollLeft),Math.abs(e.doc.scrollLeft-h)>1&&(r=!0)),!r)return o}}function rn(e,t,i,n,r){var o=on(e,t,i,n,r);null!=o.scrollTop&&Hi(e,o.scrollTop),null!=o.scrollLeft&&Mi(e,o.scrollLeft)}function on(e,t,i,n,r){var o=e.display,s=Gt(e.display);0>i&&(i=0);var a=e.curOp&&null!=e.curOp.scrollTop?e.curOp.scrollTop:o.scroller.scrollTop,l=o.scroller.clientHeight-ta,h={},c=e.doc.height+Tt(o),u=s>i,d=r>c-s;if(a>i)h.scrollTop=u?0:i;else if(r>a+l){var p=Math.min(i,(d?c:r)-l);p!=a&&(h.scrollTop=p)}var f=e.curOp&&null!=e.curOp.scrollLeft?e.curOp.scrollLeft:o.scroller.scrollLeft,m=o.scroller.clientWidth-ta;t+=o.gutters.offsetWidth,n+=o.gutters.offsetWidth;var g=o.gutters.offsetWidth,v=g+10>t;return f+g>t||v?(v&&(t=0),h.scrollLeft=Math.max(0,t-10-g)):n>m+f-3&&(h.scrollLeft=n+10-m),h}function sn(e,t,i){(null!=t||null!=i)&&ln(e),null!=t&&(e.curOp.scrollLeft=(null==e.curOp.scrollLeft?e.doc.scrollLeft:e.curOp.scrollLeft)+t),null!=i&&(e.curOp.scrollTop=(null==e.curOp.scrollTop?e.doc.scrollTop:e.curOp.scrollTop)+i)}function an(e){ln(e);var t=e.getCursor(),i=t,n=t;e.options.lineWrapping||(i=t.ch?as(t.line,t.ch-1):t,n=as(t.line,t.ch+1)),e.curOp.scrollToPos={from:i,to:n,margin:e.options.cursorScrollMargin,isCursor:!0}}function ln(e){var t=e.curOp.scrollToPos;if(t){e.curOp.scrollToPos=null;var i=Ut(e,t.from),n=Ut(e,t.to),r=on(e,Math.min(i.left,n.left),Math.min(i.top,n.top)-t.margin,Math.max(i.right,n.right),Math.max(i.bottom,n.bottom)+t.margin);e.scrollTo(r.scrollLeft,r.scrollTop)}}function hn(e,t,i,n){var r,o=e.doc;null==i&&(i="add"),"smart"==i&&(e.doc.mode.indent?r=Et(e,t):i="prev");var s=e.options.tabSize,a=_r(o,t),l=sa(a.text,null,s);a.stateAfter&&(a.stateAfter=null);var h,c=a.text.match(/^\s*/)[0];if(n||/\S/.test(a.text)){if("smart"==i&&(h=e.doc.mode.indent(r,a.text.slice(c.length),a.text),h==ia)){if(!n)return;i="prev"}}else h=0,i="not";"prev"==i?h=t>o.first?sa(_r(o,t-1).text,null,s):0:"add"==i?h=l+e.options.indentUnit:"subtract"==i?h=l-e.options.indentUnit:"number"==typeof i&&(h=l+i),h=Math.max(0,h);var u="",d=0;if(e.options.indentWithTabs)for(var p=Math.floor(h/s);p;--p)d+=s,u+="	";if(h>d&&(u+=Zr(h-d)),u!=c)en(e.doc,u,as(t,0),as(t,c.length),"+input");else for(var p=0;p<o.sel.ranges.length;p++){var f=o.sel.ranges[p];if(f.head.line==t&&f.head.ch<c.length){var d=as(t,c.length);rt(o,p,new q(d,d));break}}a.stateAfter=null}function cn(e,t,i,n){var r=t,o=t,s=e.doc;return"number"==typeof t?o=_r(s,K(s,t)):r=Tr(t),null==r?null:(n(o,r)&&ni(e,r,i),o)}function un(e,t){for(var i=e.doc.sel.ranges,n=[],r=0;r<i.length;r++){for(var o=t(i[r]);n.length&&ls(o.from,eo(n).to)<=0;){var s=n.pop();if(ls(s.from,o.from)<0){o.from=s.from;break}}n.push(o)}Kt(e,function(){for(var t=n.length-1;t>=0;t--)en(e.doc,"",n[t].from,n[t].to,"+delete");an(e)})}function dn(e,t,i,n,r){function o(){var t=a+i;return t<e.first||t>=e.first+e.size?u=!1:(a=t,c=_r(e,t))}function s(e){var t=(r?No:zo)(c,l,i,!0);if(null==t){if(e||!o())return u=!1;l=r?(0>i?Mo:Ho)(c):0>i?c.text.length:0}else l=t;return!0}var a=t.line,l=t.ch,h=i,c=_r(e,a),u=!0;if("char"==n)s();else if("column"==n)s(!0);else if("word"==n||"group"==n)for(var d=null,p="group"==n,f=e.cm&&e.cm.getHelper(t,"wordChars"),m=!0;!(0>i)||s(!m);m=!1){var g=c.text.charAt(l)||"\n",v=so(g,f)?"w":p&&"\n"==g?"n":!p||/\s/.test(g)?null:"p";if(!p||m||v||(v="s"),d&&d!=v){0>i&&(i=1,s());break}if(v&&(d=v),i>0&&!s(!m))break}var y=pt(e,as(a,l),h,!0);return u||(y.hitSide=!0),y}function pn(e,t,i,n){var r,o=e.doc,s=t.left;if("page"==n){var a=Math.min(e.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight);r=t.top+i*(a-(0>i?1.5:.5)*Gt(e.display))}else"line"==n&&(r=i>0?t.bottom+3:t.top-3);for(;;){var l=Wt(e,s,r);if(!l.outside)break;if(0>i?0>=r:r>=o.height){l.hitSide=!0;break}r+=5*i}return l}function fn(e,t){var i=e.doc,n=_r(i,t.line).text,r=t.ch,o=t.ch;if(n){var s=e.getHelper(t,"wordChars");(t.xRel<0||o==n.length)&&r?--r:++o;for(var a=n.charAt(r),l=so(a,s)?function(e){return so(e,s)}:/\s/.test(a)?function(e){return/\s/.test(e)}:function(e){return!/\s/.test(e)&&!so(e)};r>0&&l(n.charAt(r-1));)--r;for(;o<n.length&&l(n.charAt(o));)++o}return new q(as(t.line,r),as(t.line,o))}function mn(t,i,n,r){e.defaults[t]=i,n&&(Es[t]=r?function(e,t,i){i!=xs&&n(e,t,i)}:n)}function gn(e){return"string"==typeof e?As[e]:e}function vn(e,t,i,n,r){if(n&&n.shared)return yn(e,t,i,n,r);if(e.cm&&!e.cm.curOp)return Qt(e.cm,vn)(e,t,i,n,r);var o=new zs(e,r),s=ls(t,i);if(n&&ro(n,o,!1),s>0||0==s&&o.clearWhenEmpty!==!1)return o;if(o.replacedWith&&(o.collapsed=!0,o.widgetNode=ho("span",[o.replacedWith],"CodeMirror-widget"),n.handleMouseEvents||(o.widgetNode.ignoreEvents=!0),n.insertLeft&&(o.widgetNode.insertLeft=!0)),o.collapsed){if(Vn(e,t.line,t,i,o)||t.line!=i.line&&Vn(e,i.line,t,i,o))throw new Error("Inserting collapsed marker partially overlapping an existing one");ss=!0}o.addToHistory&&Ar(e,{from:t,to:i,origin:"markText"},e.sel,0/0);var a,l=t.line,h=e.cm;if(e.iter(l,i.line+1,function(e){h&&o.collapsed&&!h.options.lineWrapping&&Bn(e)==h.display.maxLine&&(a=!0),o.collapsed&&l!=t.line&&xr(e,0),Rn(e,new xn(o,l==t.line?t.ch:null,l==i.line?i.ch:null)),++l}),o.collapsed&&e.iter(t.line,i.line+1,function(t){$n(e,t)&&xr(t,0)}),o.clearOnEnter&&Qs(o,"beforeCursorEnter",function(){o.clear()}),o.readOnly&&(os=!0,(e.history.done.length||e.history.undone.length)&&e.clearHistory()),o.collapsed&&(o.id=++Ls,o.atomic=!0),h){if(a&&(h.curOp.updateMaxLine=!0),o.collapsed)ii(h,t.line,i.line+1);else if(o.className||o.title||o.startStyle||o.endStyle)for(var c=t.line;c<=i.line;c++)ni(h,c,"text");o.atomic&&ut(h.doc),$r(h,"markerAdded",h,o)}return o}function yn(e,t,i,n,r){n=ro(n),n.shared=!1;var o=[vn(e,t,i,n,r)],s=o[0],a=n.widgetNode;return vr(e,function(e){a&&(n.widgetNode=a.cloneNode(!0)),o.push(vn(e,Q(e,t),Q(e,i),n,r));for(var l=0;l<e.linked.length;++l)if(e.linked[l].isParent)return;s=eo(o)}),new Is(o,s)}function _n(e){return e.findMarks(as(e.first,0),e.clipPos(as(e.lastLine())),function(e){return e.parent})}function bn(e,t){for(var i=0;i<t.length;i++){var n=t[i],r=n.find(),o=e.clipPos(r.from),s=e.clipPos(r.to);if(ls(o,s)){var a=vn(e,o,s,n.primary,n.primary.type);n.markers.push(a),a.parent=n}}}function En(e){for(var t=0;t<e.length;t++){var i=e[t],n=[i.primary.doc];vr(i.primary.doc,function(e){n.push(e)});for(var r=0;r<i.markers.length;r++){var o=i.markers[r];-1==to(n,o.doc)&&(o.parent=null,i.markers.splice(r--,1))}}}function xn(e,t,i){this.marker=e,this.from=t,this.to=i}function Tn(e,t){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(n.marker==t)return n}}function wn(e,t){for(var i,n=0;n<e.length;++n)e[n]!=t&&(i||(i=[])).push(e[n]);return i}function Rn(e,t){e.markedSpans=e.markedSpans?e.markedSpans.concat([t]):[t],t.marker.attachLine(e)}function Sn(e,t,i){if(e)for(var n,r=0;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);if(a||o.from==t&&"bookmark"==s.type&&(!i||!o.marker.insertLeft)){var l=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);(n||(n=[])).push(new xn(s,o.from,l?null:o.to))}}return n}function Cn(e,t,i){if(e)for(var n,r=0;r<e.length;++r){var o=e[r],s=o.marker,a=null==o.to||(s.inclusiveRight?o.to>=t:o.to>t);if(a||o.from==t&&"bookmark"==s.type&&(!i||o.marker.insertLeft)){var l=null==o.from||(s.inclusiveLeft?o.from<=t:o.from<t);
(n||(n=[])).push(new xn(s,l?null:o.from-t,null==o.to?null:o.to-t))}}return n}function Hn(e,t){var i=Z(e,t.from.line)&&_r(e,t.from.line).markedSpans,n=Z(e,t.to.line)&&_r(e,t.to.line).markedSpans;if(!i&&!n)return null;var r=t.from.ch,o=t.to.ch,s=0==ls(t.from,t.to),a=Sn(i,r,s),l=Cn(n,o,s),h=1==t.text.length,c=eo(t.text).length+(h?r:0);if(a)for(var u=0;u<a.length;++u){var d=a[u];if(null==d.to){var p=Tn(l,d.marker);p?h&&(d.to=null==p.to?null:p.to+c):d.to=r}}if(l)for(var u=0;u<l.length;++u){var d=l[u];if(null!=d.to&&(d.to+=c),null==d.from){var p=Tn(a,d.marker);p||(d.from=c,h&&(a||(a=[])).push(d))}else d.from+=c,h&&(a||(a=[])).push(d)}a&&(a=Mn(a)),l&&l!=a&&(l=Mn(l));var f=[a];if(!h){var m,g=t.text.length-2;if(g>0&&a)for(var u=0;u<a.length;++u)null==a[u].to&&(m||(m=[])).push(new xn(a[u].marker,null,null));for(var u=0;g>u;++u)f.push(m);f.push(l)}return f}function Mn(e){for(var t=0;t<e.length;++t){var i=e[t];null!=i.from&&i.from==i.to&&i.marker.clearWhenEmpty!==!1&&e.splice(t--,1)}return e.length?e:null}function kn(e,t){var i=Lr(e,t),n=Hn(e,t);if(!i)return n;if(!n)return i;for(var r=0;r<i.length;++r){var o=i[r],s=n[r];if(o&&s)e:for(var a=0;a<s.length;++a){for(var l=s[a],h=0;h<o.length;++h)if(o[h].marker==l.marker)continue e;o.push(l)}else s&&(i[r]=s)}return i}function An(e,t,i){var n=null;if(e.iter(t.line,i.line+1,function(e){if(e.markedSpans)for(var t=0;t<e.markedSpans.length;++t){var i=e.markedSpans[t].marker;!i.readOnly||n&&-1!=to(n,i)||(n||(n=[])).push(i)}}),!n)return null;for(var r=[{from:t,to:i}],o=0;o<n.length;++o)for(var s=n[o],a=s.find(0),l=0;l<r.length;++l){var h=r[l];if(!(ls(h.to,a.from)<0||ls(h.from,a.to)>0)){var c=[l,1],u=ls(h.from,a.from),d=ls(h.to,a.to);(0>u||!s.inclusiveLeft&&!u)&&c.push({from:h.from,to:a.from}),(d>0||!s.inclusiveRight&&!d)&&c.push({from:a.to,to:h.to}),r.splice.apply(r,c),l+=c.length-1}}return r}function Pn(e){var t=e.markedSpans;if(t){for(var i=0;i<t.length;++i)t[i].marker.detachLine(e);e.markedSpans=null}}function Fn(e,t){if(t){for(var i=0;i<t.length;++i)t[i].marker.attachLine(e);e.markedSpans=t}}function Dn(e){return e.inclusiveLeft?-1:0}function Nn(e){return e.inclusiveRight?1:0}function zn(e,t){var i=e.lines.length-t.lines.length;if(0!=i)return i;var n=e.find(),r=t.find(),o=ls(n.from,r.from)||Dn(e)-Dn(t);if(o)return-o;var s=ls(n.to,r.to)||Nn(e)-Nn(t);return s?s:t.id-e.id}function Ln(e,t){var i,n=ss&&e.markedSpans;if(n)for(var r,o=0;o<n.length;++o)r=n[o],r.marker.collapsed&&null==(t?r.from:r.to)&&(!i||zn(i,r.marker)<0)&&(i=r.marker);return i}function In(e){return Ln(e,!0)}function On(e){return Ln(e,!1)}function Vn(e,t,i,n,r){var o=_r(e,t),s=ss&&o.markedSpans;if(s)for(var a=0;a<s.length;++a){var l=s[a];if(l.marker.collapsed){var h=l.marker.find(0),c=ls(h.from,i)||Dn(l.marker)-Dn(r),u=ls(h.to,n)||Nn(l.marker)-Nn(r);if(!(c>=0&&0>=u||0>=c&&u>=0)&&(0>=c&&(ls(h.to,i)||Nn(l.marker)-Dn(r))>0||c>=0&&(ls(h.from,n)||Dn(l.marker)-Nn(r))<0))return!0}}}function Bn(e){for(var t;t=In(e);)e=t.find(-1,!0).line;return e}function Un(e){for(var t,i;t=On(e);)e=t.find(1,!0).line,(i||(i=[])).push(e);return i}function jn(e,t){var i=_r(e,t),n=Bn(i);return i==n?t:Tr(n)}function Wn(e,t){if(t>e.lastLine())return t;var i,n=_r(e,t);if(!$n(e,n))return t;for(;i=On(n);)n=i.find(1,!0).line;return Tr(n)+1}function $n(e,t){var i=ss&&t.markedSpans;if(i)for(var n,r=0;r<i.length;++r)if(n=i[r],n.marker.collapsed){if(null==n.from)return!0;if(!n.marker.widgetNode&&0==n.from&&n.marker.inclusiveLeft&&Gn(e,t,n))return!0}}function Gn(e,t,i){if(null==i.to){var n=i.marker.find(1,!0);return Gn(e,n.line,Tn(n.line.markedSpans,i.marker))}if(i.marker.inclusiveRight&&i.to==t.text.length)return!0;for(var r,o=0;o<t.markedSpans.length;++o)if(r=t.markedSpans[o],r.marker.collapsed&&!r.marker.widgetNode&&r.from==i.to&&(null==r.to||r.to!=i.from)&&(r.marker.inclusiveLeft||i.marker.inclusiveRight)&&Gn(e,t,r))return!0}function qn(e,t,i){Rr(t)<(e.curOp&&e.curOp.scrollTop||e.doc.scrollTop)&&sn(e,null,i)}function Xn(e){return null!=e.height?e.height:(po(document.body,e.node)||uo(e.cm.display.measure,ho("div",[e.node],null,"position: relative")),e.height=e.node.offsetHeight)}function Yn(e,t,i,n){var r=new Os(e,i,n);return r.noHScroll&&(e.display.alignWidgets=!0),cn(e,t,"widget",function(t){var i=t.widgets||(t.widgets=[]);if(null==r.insertAt?i.push(r):i.splice(Math.min(i.length-1,Math.max(0,r.insertAt)),0,r),r.line=t,!$n(e.doc,t)){var n=Rr(t)<e.doc.scrollTop;xr(t,t.height+Xn(r)),n&&sn(e,null,r.height),e.curOp.forceUpdate=!0}return!0}),r}function Kn(e,t,i,n){e.text=t,e.stateAfter&&(e.stateAfter=null),e.styles&&(e.styles=null),null!=e.order&&(e.order=null),Pn(e),Fn(e,i);var r=n?n(e):1;r!=e.height&&xr(e,r)}function Qn(e){e.parent=null,Pn(e)}function Jn(e,t){if(e)for(;;){var i=e.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!i)break;e=e.slice(0,i.index)+e.slice(i.index+i[0].length);var n=i[1]?"bgClass":"textClass";null==t[n]?t[n]=i[2]:new RegExp("(?:^|s)"+i[2]+"(?:$|s)").test(t[n])||(t[n]+=" "+i[2])}return e}function Zn(t,i){if(t.blankLine)return t.blankLine(i);if(t.innerMode){var n=e.innerMode(t,i);return n.mode.blankLine?n.mode.blankLine(n.state):void 0}}function er(e,t,i){for(var n=0;10>n;n++){var r=e.token(t,i);if(t.pos>t.start)return r}throw new Error("Mode "+e.name+" failed to advance stream.")}function tr(t,i,n,r,o,s,a){var l=n.flattenSpans;null==l&&(l=t.options.flattenSpans);var h,c=0,u=null,d=new Ns(i,t.options.tabSize);for(""==i&&Jn(Zn(n,r),s);!d.eol();){if(d.pos>t.options.maxHighlightLength?(l=!1,a&&rr(t,i,r,d.pos),d.pos=i.length,h=null):h=Jn(er(n,d,r),s),t.options.addModeClass){var p=e.innerMode(n,r).mode.name;p&&(h="m-"+(h?p+" "+h:p))}l&&u==h||(c<d.start&&o(d.start,u),c=d.start,u=h),d.start=d.pos}for(;c<d.pos;){var f=Math.min(d.pos,c+5e4);o(f,u),c=f}}function ir(e,t,i,n){var r=[e.state.modeGen],o={};tr(e,t.text,e.doc.mode,i,function(e,t){r.push(e,t)},o,n);for(var s=0;s<e.state.overlays.length;++s){var a=e.state.overlays[s],l=1,h=0;tr(e,t.text,a.mode,!0,function(e,t){for(var i=l;e>h;){var n=r[l];n>e&&r.splice(l,1,e,r[l+1],n),l+=2,h=Math.min(e,n)}if(t)if(a.opaque)r.splice(i,l-i,e,"cm-overlay "+t),l=i+2;else for(;l>i;i+=2){var o=r[i+1];r[i+1]=(o?o+" ":"")+"cm-overlay "+t}},o)}return{styles:r,classes:o.bgClass||o.textClass?o:null}}function nr(e,t){if(!t.styles||t.styles[0]!=e.state.modeGen){var i=ir(e,t,t.stateAfter=Et(e,Tr(t)));t.styles=i.styles,i.classes?t.styleClasses=i.classes:t.styleClasses&&(t.styleClasses=null)}return t.styles}function rr(e,t,i,n){var r=e.doc.mode,o=new Ns(t,e.options.tabSize);for(o.start=o.pos=n||0,""==t&&Zn(r,i);!o.eol()&&o.pos<=e.options.maxHighlightLength;)er(r,o,i),o.start=o.pos}function or(e,t){if(!e||/^\s*$/.test(e))return null;var i=t.addModeClass?Us:Bs;return i[e]||(i[e]=e.replace(/\S+/g,"cm-$&"))}function sr(e,t){var i=ho("span",null,null,Wo?"padding-right: .1px":null),n={pre:ho("pre",[i]),content:i,col:0,pos:0,cm:e};t.measure={};for(var r=0;r<=(t.rest?t.rest.length:0);r++){var o,s=r?t.rest[r-1]:t.line;n.pos=0,n.addToken=lr,(jo||Wo)&&e.getOption("lineWrapping")&&(n.addToken=hr(n.addToken)),wo(e.display.measure)&&(o=Sr(s))&&(n.addToken=cr(n.addToken,o)),n.map=[],dr(s,n,nr(e,s)),s.styleClasses&&(s.styleClasses.bgClass&&(n.bgClass=yo(s.styleClasses.bgClass,n.bgClass||"")),s.styleClasses.textClass&&(n.textClass=yo(s.styleClasses.textClass,n.textClass||""))),0==n.map.length&&n.map.push(0,0,n.content.appendChild(To(e.display.measure))),0==r?(t.measure.map=n.map,t.measure.cache={}):((t.measure.maps||(t.measure.maps=[])).push(n.map),(t.measure.caches||(t.measure.caches=[])).push({}))}return Zs(e,"renderLine",e,t.line,n.pre),n.pre.className&&(n.textClass=yo(n.pre.className,n.textClass||"")),n}function ar(e){var t=ho("span","","cm-invalidchar");return t.title="\\u"+e.charCodeAt(0).toString(16),t}function lr(e,t,i,n,r,o){if(t){var s=e.cm.options.specialChars,a=!1;if(s.test(t))for(var l=document.createDocumentFragment(),h=0;;){s.lastIndex=h;var c=s.exec(t),u=c?c.index-h:t.length-h;if(u){var d=document.createTextNode(t.slice(h,h+u));Vo?l.appendChild(ho("span",[d])):l.appendChild(d),e.map.push(e.pos,e.pos+u,d),e.col+=u,e.pos+=u}if(!c)break;if(h+=u+1,"	"==c[0]){var p=e.cm.options.tabSize,f=p-e.col%p,d=l.appendChild(ho("span",Zr(f),"cm-tab"));e.col+=f}else{var d=e.cm.options.specialCharPlaceholder(c[0]);Vo?l.appendChild(ho("span",[d])):l.appendChild(d),e.col+=1}e.map.push(e.pos,e.pos+1,d),e.pos++}else{e.col+=t.length;var l=document.createTextNode(t);e.map.push(e.pos,e.pos+t.length,l),Vo&&(a=!0),e.pos+=t.length}if(i||n||r||a){var m=i||"";n&&(m+=n),r&&(m+=r);var g=ho("span",[l],m);return o&&(g.title=o),e.content.appendChild(g)}e.content.appendChild(l)}}function hr(e){function t(e){for(var t=" ",i=0;i<e.length-2;++i)t+=i%2?" ":"";return t+=" "}return function(i,n,r,o,s,a){e(i,n.replace(/ {3,}/g,t),r,o,s,a)}}function cr(e,t){return function(i,n,r,o,s,a){r=r?r+" cm-force-border":"cm-force-border";for(var l=i.pos,h=l+n.length;;){for(var c=0;c<t.length;c++){var u=t[c];if(u.to>l&&u.from<=l)break}if(u.to>=h)return e(i,n,r,o,s,a);e(i,n.slice(0,u.to-l),r,o,null,a),o=null,n=n.slice(u.to-l),l=u.to}}}function ur(e,t,i,n){var r=!n&&i.widgetNode;r&&(e.map.push(e.pos,e.pos+t,r),e.content.appendChild(r)),e.pos+=t}function dr(e,t,i){var n=e.markedSpans,r=e.text,o=0;if(n)for(var s,a,l,h,c,u,d=r.length,p=0,f=1,m="",g=0;;){if(g==p){a=l=h=c="",u=null,g=1/0;for(var v=[],y=0;y<n.length;++y){var _=n[y],b=_.marker;_.from<=p&&(null==_.to||_.to>p)?(null!=_.to&&g>_.to&&(g=_.to,l=""),b.className&&(a+=" "+b.className),b.startStyle&&_.from==p&&(h+=" "+b.startStyle),b.endStyle&&_.to==g&&(l+=" "+b.endStyle),b.title&&!c&&(c=b.title),b.collapsed&&(!u||zn(u.marker,b)<0)&&(u=_)):_.from>p&&g>_.from&&(g=_.from),"bookmark"==b.type&&_.from==p&&b.widgetNode&&v.push(b)}if(u&&(u.from||0)==p&&(ur(t,(null==u.to?d+1:u.to)-p,u.marker,null==u.from),null==u.to))return;if(!u&&v.length)for(var y=0;y<v.length;++y)ur(t,0,v[y])}if(p>=d)break;for(var E=Math.min(d,g);;){if(m){var x=p+m.length;if(!u){var T=x>E?m.slice(0,E-p):m;t.addToken(t,T,s?s+a:a,h,p+T.length==g?l:"",c)}if(x>=E){m=m.slice(E-p),p=E;break}p=x,h=""}m=r.slice(o,o=i[f++]),s=or(i[f++],t.cm.options)}}else for(var f=1;f<i.length;f+=2)t.addToken(t,r.slice(o,o=i[f]),or(i[f+1],t.cm.options))}function pr(e,t){return 0==t.from.ch&&0==t.to.ch&&""==eo(t.text)&&(!e.cm||e.cm.options.wholeLineUpdateBefore)}function fr(e,t,i,n){function r(e){return i?i[e]:null}function o(e,i,r){Kn(e,i,r,n),$r(e,"change",e,t)}var s=t.from,a=t.to,l=t.text,h=_r(e,s.line),c=_r(e,a.line),u=eo(l),d=r(l.length-1),p=a.line-s.line;if(pr(e,t)){for(var f=0,m=[];f<l.length-1;++f)m.push(new Vs(l[f],r(f),n));o(c,c.text,d),p&&e.remove(s.line,p),m.length&&e.insert(s.line,m)}else if(h==c)if(1==l.length)o(h,h.text.slice(0,s.ch)+u+h.text.slice(a.ch),d);else{for(var m=[],f=1;f<l.length-1;++f)m.push(new Vs(l[f],r(f),n));m.push(new Vs(u+h.text.slice(a.ch),d,n)),o(h,h.text.slice(0,s.ch)+l[0],r(0)),e.insert(s.line+1,m)}else if(1==l.length)o(h,h.text.slice(0,s.ch)+l[0]+c.text.slice(a.ch),r(0)),e.remove(s.line+1,p);else{o(h,h.text.slice(0,s.ch)+l[0],r(0)),o(c,u+c.text.slice(a.ch),d);for(var f=1,m=[];f<l.length-1;++f)m.push(new Vs(l[f],r(f),n));p>1&&e.remove(s.line+1,p-1),e.insert(s.line+1,m)}$r(e,"change",e,t)}function mr(e){this.lines=e,this.parent=null;for(var t=0,i=0;t<e.length;++t)e[t].parent=this,i+=e[t].height;this.height=i}function gr(e){this.children=e;for(var t=0,i=0,n=0;n<e.length;++n){var r=e[n];t+=r.chunkSize(),i+=r.height,r.parent=this}this.size=t,this.height=i,this.parent=null}function vr(e,t,i){function n(e,r,o){if(e.linked)for(var s=0;s<e.linked.length;++s){var a=e.linked[s];if(a.doc!=r){var l=o&&a.sharedHist;(!i||l)&&(t(a.doc,l),n(a.doc,e,l))}}}n(e,null,!0)}function yr(e,t){if(t.cm)throw new Error("This document is already in use.");e.doc=t,t.cm=e,s(e),i(e),e.options.lineWrapping||p(e),e.options.mode=t.modeOption,ii(e)}function _r(e,t){if(t-=e.first,0>t||t>=e.size)throw new Error("There is no line "+(t+e.first)+" in the document.");for(var i=e;!i.lines;)for(var n=0;;++n){var r=i.children[n],o=r.chunkSize();if(o>t){i=r;break}t-=o}return i.lines[t]}function br(e,t,i){var n=[],r=t.line;return e.iter(t.line,i.line+1,function(e){var o=e.text;r==i.line&&(o=o.slice(0,i.ch)),r==t.line&&(o=o.slice(t.ch)),n.push(o),++r}),n}function Er(e,t,i){var n=[];return e.iter(t,i,function(e){n.push(e.text)}),n}function xr(e,t){var i=t-e.height;if(i)for(var n=e;n;n=n.parent)n.height+=i}function Tr(e){if(null==e.parent)return null;for(var t=e.parent,i=to(t.lines,e),n=t.parent;n;t=n,n=n.parent)for(var r=0;n.children[r]!=t;++r)i+=n.children[r].chunkSize();return i+t.first}function wr(e,t){var i=e.first;e:do{for(var n=0;n<e.children.length;++n){var r=e.children[n],o=r.height;if(o>t){e=r;continue e}t-=o,i+=r.chunkSize()}return i}while(!e.lines);for(var n=0;n<e.lines.length;++n){var s=e.lines[n],a=s.height;if(a>t)break;t-=a}return i+n}function Rr(e){e=Bn(e);for(var t=0,i=e.parent,n=0;n<i.lines.length;++n){var r=i.lines[n];if(r==e)break;t+=r.height}for(var o=i.parent;o;i=o,o=i.parent)for(var n=0;n<o.children.length;++n){var s=o.children[n];if(s==i)break;t+=s.height}return t}function Sr(e){var t=e.order;return null==t&&(t=e.order=Ta(e.text)),t}function Cr(e){this.done=[],this.undone=[],this.undoDepth=1/0,this.lastModTime=this.lastSelTime=0,this.lastOp=null,this.lastOrigin=this.lastSelOrigin=null,this.generation=this.maxGeneration=e||1}function Hr(e,t){var i={from:j(t.from),to:_s(t),text:br(e,t.from,t.to)};return Nr(e,i,t.from.line,t.to.line+1),vr(e,function(e){Nr(e,i,t.from.line,t.to.line+1)},!0),i}function Mr(e){for(;e.length;){var t=eo(e);if(!t.ranges)break;e.pop()}}function kr(e,t){return t?(Mr(e.done),eo(e.done)):e.done.length&&!eo(e.done).ranges?eo(e.done):e.done.length>1&&!e.done[e.done.length-2].ranges?(e.done.pop(),eo(e.done)):void 0}function Ar(e,t,i,n){var r=e.history;r.undone.length=0;var o,s=+new Date;if((r.lastOp==n||r.lastOrigin==t.origin&&t.origin&&("+"==t.origin.charAt(0)&&e.cm&&r.lastModTime>s-e.cm.options.historyEventDelay||"*"==t.origin.charAt(0)))&&(o=kr(r,r.lastOp==n))){var a=eo(o.changes);0==ls(t.from,t.to)&&0==ls(t.from,a.to)?a.to=_s(t):o.changes.push(Hr(e,t))}else{var l=eo(r.done);for(l&&l.ranges||Dr(e.sel,r.done),o={changes:[Hr(e,t)],generation:r.generation},r.done.push(o);r.done.length>r.undoDepth;)r.done.shift(),r.done[0].ranges||r.done.shift()}r.done.push(i),r.generation=++r.maxGeneration,r.lastModTime=r.lastSelTime=s,r.lastOp=n,r.lastOrigin=r.lastSelOrigin=t.origin,a||Zs(e,"historyAdded")}function Pr(e,t,i,n){var r=t.charAt(0);return"*"==r||"+"==r&&i.ranges.length==n.ranges.length&&i.somethingSelected()==n.somethingSelected()&&new Date-e.history.lastSelTime<=(e.cm?e.cm.options.historyEventDelay:500)}function Fr(e,t,i,n){var r=e.history,o=n&&n.origin;i==r.lastOp||o&&r.lastSelOrigin==o&&(r.lastModTime==r.lastSelTime&&r.lastOrigin==o||Pr(e,o,eo(r.done),t))?r.done[r.done.length-1]=t:Dr(t,r.done),r.lastSelTime=+new Date,r.lastSelOrigin=o,r.lastOp=i,n&&n.clearRedo!==!1&&Mr(r.undone)}function Dr(e,t){var i=eo(t);i&&i.ranges&&i.equals(e)||t.push(e)}function Nr(e,t,i,n){var r=t["spans_"+e.id],o=0;e.iter(Math.max(e.first,i),Math.min(e.first+e.size,n),function(i){i.markedSpans&&((r||(r=t["spans_"+e.id]={}))[o]=i.markedSpans),++o})}function zr(e){if(!e)return null;for(var t,i=0;i<e.length;++i)e[i].marker.explicitlyCleared?t||(t=e.slice(0,i)):t&&t.push(e[i]);return t?t.length?t:null:e}function Lr(e,t){var i=t["spans_"+e.id];if(!i)return null;for(var n=0,r=[];n<t.text.length;++n)r.push(zr(i[n]));return r}function Ir(e,t,i){for(var n=0,r=[];n<e.length;++n){var o=e[n];if(o.ranges)r.push(i?G.prototype.deepCopy.call(o):o);else{var s=o.changes,a=[];r.push({changes:a});for(var l=0;l<s.length;++l){var h,c=s[l];if(a.push({from:c.from,to:c.to,text:c.text}),t)for(var u in c)(h=u.match(/^spans_(\d+)$/))&&to(t,Number(h[1]))>-1&&(eo(a)[u]=c[u],delete c[u])}}}return r}function Or(e,t,i,n){i<e.line?e.line+=n:t<e.line&&(e.line=t,e.ch=0)}function Vr(e,t,i,n){for(var r=0;r<e.length;++r){var o=e[r],s=!0;if(o.ranges){o.copied||(o=e[r]=o.deepCopy(),o.copied=!0);for(var a=0;a<o.ranges.length;a++)Or(o.ranges[a].anchor,t,i,n),Or(o.ranges[a].head,t,i,n)}else{for(var a=0;a<o.changes.length;++a){var l=o.changes[a];if(i<l.from.line)l.from=as(l.from.line+n,l.from.ch),l.to=as(l.to.line+n,l.to.ch);else if(t<=l.to.line){s=!1;break}}s||(e.splice(0,r+1),r=0)}}}function Br(e,t){var i=t.from.line,n=t.to.line,r=t.text.length-(n-i)-1;Vr(e.done,i,n,r),Vr(e.undone,i,n,r)}function Ur(e){return null!=e.defaultPrevented?e.defaultPrevented:0==e.returnValue}function jr(e){return e.target||e.srcElement}function Wr(e){var t=e.which;return null==t&&(1&e.button?t=1:2&e.button?t=3:4&e.button&&(t=2)),es&&e.ctrlKey&&1==t&&(t=3),t}function $r(e,t){function i(e){return function(){e.apply(null,r)}}var n=e._handlers&&e._handlers[t];if(n){var r=Array.prototype.slice.call(arguments,2);qs||(++ea,qs=[],setTimeout(Gr,0));for(var o=0;o<n.length;++o)qs.push(i(n[o]))}}function Gr(){--ea;var e=qs;qs=null;for(var t=0;t<e.length;++t)e[t]()}function qr(e,t,i){return Zs(e,i||t.type,e,t),Ur(t)||t.codemirrorIgnore}function Xr(e){var t=e._handlers&&e._handlers.cursorActivity;if(t)for(var i=e.curOp.cursorActivityHandlers||(e.curOp.cursorActivityHandlers=[]),n=0;n<t.length;++n)-1==to(i,t[n])&&i.push(t[n])}function Yr(e,t){var i=e._handlers&&e._handlers[t];return i&&i.length>0}function Kr(e){e.prototype.on=function(e,t){Qs(this,e,t)},e.prototype.off=function(e,t){Js(this,e,t)}}function Qr(){this.id=null}function Jr(e,t,i){for(var n=0,r=0;;){var o=e.indexOf("	",n);-1==o&&(o=e.length);var s=o-n;if(o==e.length||r+s>=t)return n+Math.min(s,t-r);if(r+=o-n,r+=i-r%i,n=o+1,r>=t)return n}}function Zr(e){for(;aa.length<=e;)aa.push(eo(aa)+" ");return aa[e]}function eo(e){return e[e.length-1]}function to(e,t){for(var i=0;i<e.length;++i)if(e[i]==t)return i;return-1}function io(e,t){for(var i=[],n=0;n<e.length;n++)i[n]=t(e[n],n);return i}function no(e,t){var i;if(Object.create)i=Object.create(e);else{var n=function(){};n.prototype=e,i=new n}return t&&ro(t,i),i}function ro(e,t,i){t||(t={});for(var n in e)!e.hasOwnProperty(n)||i===!1&&t.hasOwnProperty(n)||(t[n]=e[n]);return t}function oo(e){var t=Array.prototype.slice.call(arguments,1);return function(){return e.apply(null,t)}}function so(e,t){return t?t.source.indexOf("\\w")>-1&&ua(e)?!0:t.test(e):ua(e)}function ao(e){for(var t in e)if(e.hasOwnProperty(t)&&e[t])return!1;return!0}function lo(e){return e.charCodeAt(0)>=768&&da.test(e)}function ho(e,t,i,n){var r=document.createElement(e);if(i&&(r.className=i),n&&(r.style.cssText=n),"string"==typeof t)r.appendChild(document.createTextNode(t));else if(t)for(var o=0;o<t.length;++o)r.appendChild(t[o]);return r}function co(e){for(var t=e.childNodes.length;t>0;--t)e.removeChild(e.firstChild);return e}function uo(e,t){return co(e).appendChild(t)}function po(e,t){if(e.contains)return e.contains(t);for(;t=t.parentNode;)if(t==e)return!0}function fo(){return document.activeElement}function mo(e){return new RegExp("\\b"+e+"\\b\\s*")}function go(e,t){var i=mo(t);i.test(e.className)&&(e.className=e.className.replace(i,""))}function vo(e,t){mo(t).test(e.className)||(e.className+=" "+t)}function yo(e,t){for(var i=e.split(" "),n=0;n<i.length;n++)i[n]&&!mo(i[n]).test(t)&&(t+=" "+i[n]);return t}function _o(e){if(document.body.getElementsByClassName)for(var t=document.body.getElementsByClassName("CodeMirror"),i=0;i<t.length;i++){var n=t[i].CodeMirror;n&&e(n)}}function bo(){ga||(Eo(),ga=!0)}function Eo(){var e;Qs(window,"resize",function(){null==e&&(e=setTimeout(function(){e=null,pa=null,_o(vi)},100))}),Qs(window,"blur",function(){_o(Vi)})}function xo(e){if(null!=pa)return pa;var t=ho("div",null,null,"width: 50px; height: 50px; overflow-x: scroll");return uo(e,t),t.offsetWidth&&(pa=t.offsetHeight-t.clientHeight),pa||0}function To(e){if(null==fa){var t=ho("span","");uo(e,ho("span",[t,document.createTextNode("x")])),0!=e.firstChild.offsetHeight&&(fa=t.offsetWidth<=1&&t.offsetHeight>2&&!Oo)}return fa?ho("span",""):ho("span","",null,"display: inline-block; width: 1px; margin-right: -1px")}function wo(e){if(null!=ma)return ma;var t=uo(e,document.createTextNode("AA")),i=ha(t,0,1).getBoundingClientRect();if(i.left==i.right)return!1;var n=ha(t,1,2).getBoundingClientRect();return ma=n.right-i.right<3}function Ro(e,t,i,n){if(!e)return n(t,i,"ltr");for(var r=!1,o=0;o<e.length;++o){var s=e[o];(s.from<i&&s.to>t||t==i&&s.to==t)&&(n(Math.max(s.from,t),Math.min(s.to,i),1==s.level?"rtl":"ltr"),r=!0)}r||n(t,i,"ltr")}function So(e){return e.level%2?e.to:e.from}function Co(e){return e.level%2?e.from:e.to}function Ho(e){var t=Sr(e);return t?So(t[0]):0}function Mo(e){var t=Sr(e);return t?Co(eo(t)):e.text.length}function ko(e,t){var i=_r(e.doc,t),n=Bn(i);n!=i&&(t=Tr(n));var r=Sr(n),o=r?r[0].level%2?Mo(n):Ho(n):0;return as(t,o)}function Ao(e,t){for(var i,n=_r(e.doc,t);i=On(n);)n=i.find(1,!0).line,t=null;var r=Sr(n),o=r?r[0].level%2?Ho(n):Mo(n):n.text.length;return as(null==t?Tr(n):t,o)}function Po(e,t,i){var n=e[0].level;return t==n?!0:i==n?!1:i>t}function Fo(e,t){xa=null;for(var i,n=0;n<e.length;++n){var r=e[n];if(r.from<t&&r.to>t)return n;if(r.from==t||r.to==t){if(null!=i)return Po(e,r.level,e[i].level)?(r.from!=r.to&&(xa=i),n):(r.from!=r.to&&(xa=n),i);i=n}}return i}function Do(e,t,i,n){if(!n)return t+i;do t+=i;while(t>0&&lo(e.text.charAt(t)));return t}function No(e,t,i,n){var r=Sr(e);if(!r)return zo(e,t,i,n);for(var o=Fo(r,t),s=r[o],a=Do(e,t,s.level%2?-i:i,n);;){if(a>s.from&&a<s.to)return a;if(a==s.from||a==s.to)return Fo(r,a)==o?a:(s=r[o+=i],i>0==s.level%2?s.to:s.from);if(s=r[o+=i],!s)return null;a=i>0==s.level%2?Do(e,s.to,-1,n):Do(e,s.from,1,n)}}function zo(e,t,i,n){var r=t+i;if(n)for(;r>0&&lo(e.text.charAt(r));)r+=i;return 0>r||r>e.text.length?null:r}var Lo=/gecko\/\d/i.test(navigator.userAgent),Io=/MSIE \d/.test(navigator.userAgent),Oo=Io&&(null==document.documentMode||document.documentMode<8),Vo=Io&&(null==document.documentMode||document.documentMode<9),Bo=Io&&(null==document.documentMode||document.documentMode<10),Uo=/Trident\/([7-9]|\d{2,})\./.test(navigator.userAgent),jo=Io||Uo,Wo=/WebKit\//.test(navigator.userAgent),$o=Wo&&/Qt\/\d+\.\d+/.test(navigator.userAgent),Go=/Chrome\//.test(navigator.userAgent),qo=/Opera\//.test(navigator.userAgent),Xo=/Apple Computer/.test(navigator.vendor),Yo=/KHTML\//.test(navigator.userAgent),Ko=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(navigator.userAgent),Qo=/PhantomJS/.test(navigator.userAgent),Jo=/AppleWebKit/.test(navigator.userAgent)&&/Mobile\/\w+/.test(navigator.userAgent),Zo=Jo||/Android|webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(navigator.userAgent),es=Jo||/Mac/.test(navigator.platform),ts=/win/i.test(navigator.platform),is=qo&&navigator.userAgent.match(/Version\/(\d*\.\d*)/);is&&(is=Number(is[1])),is&&is>=15&&(qo=!1,Wo=!0);var ns=es&&($o||qo&&(null==is||12.11>is)),rs=Lo||jo&&!Vo,os=!1,ss=!1,as=e.Pos=function(e,t){return this instanceof as?(this.line=e,this.ch=t,void 0):new as(e,t)},ls=e.cmpPos=function(e,t){return e.line-t.line||e.ch-t.ch};G.prototype={primary:function(){return this.ranges[this.primIndex]},equals:function(e){if(e==this)return!0;if(e.primIndex!=this.primIndex||e.ranges.length!=this.ranges.length)return!1;for(var t=0;t<this.ranges.length;t++){var i=this.ranges[t],n=e.ranges[t];if(0!=ls(i.anchor,n.anchor)||0!=ls(i.head,n.head))return!1}return!0},deepCopy:function(){for(var e=[],t=0;t<this.ranges.length;t++)e[t]=new q(j(this.ranges[t].anchor),j(this.ranges[t].head));return new G(e,this.primIndex)},somethingSelected:function(){for(var e=0;e<this.ranges.length;e++)if(!this.ranges[e].empty())return!0;return!1},contains:function(e,t){t||(t=e);for(var i=0;i<this.ranges.length;i++){var n=this.ranges[i];if(ls(t,n.from())>=0&&ls(e,n.to())<=0)return i}return-1}},q.prototype={from:function(){return $(this.anchor,this.head)},to:function(){return W(this.anchor,this.head)},empty:function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch}};var hs,cs,us,ds={left:0,right:0,top:0,bottom:0},ps=0,fs=0,ms=0,gs=null;jo?gs=-.53:Lo?gs=15:Go?gs=-.7:Xo&&(gs=-1/3);var vs,ys=null,_s=e.changeEnd=function(e){return e.text?as(e.from.line+e.text.length-1,eo(e.text).length+(1==e.text.length?e.from.ch:0)):e.to};e.prototype={constructor:e,focus:function(){window.focus(),pi(this),ci(this)},setOption:function(e,t){var i=this.options,n=i[e];(i[e]!=t||"mode"==e)&&(i[e]=t,Es.hasOwnProperty(e)&&Qt(this,Es[e])(this,t,n))},getOption:function(e){return this.options[e]},getDoc:function(){return this.doc},addKeyMap:function(e,t){this.state.keyMaps[t?"push":"unshift"](e)},removeKeyMap:function(e){for(var t=this.state.keyMaps,i=0;i<t.length;++i)if(t[i]==e||"string"!=typeof t[i]&&t[i].name==e)return t.splice(i,1),!0},addOverlay:Jt(function(t,i){var n=t.token?t:e.getMode(this.options,t);if(n.startState)throw new Error("Overlays may not be stateful.");this.state.overlays.push({mode:n,modeSpec:t,opaque:i&&i.opaque}),this.state.modeGen++,ii(this)}),removeOverlay:Jt(function(e){for(var t=this.state.overlays,i=0;i<t.length;++i){var n=t[i].modeSpec;if(n==e||"string"==typeof e&&n.name==e)return t.splice(i,1),this.state.modeGen++,ii(this),void 0}}),indentLine:Jt(function(e,t,i){"string"!=typeof t&&"number"!=typeof t&&(t=null==t?this.options.smartIndent?"smart":"prev":t?"add":"subtract"),Z(this.doc,e)&&hn(this,e,t,i)}),indentSelection:Jt(function(e){for(var t=this.doc.sel.ranges,i=-1,n=0;n<t.length;n++){var r=t[n];if(r.empty())r.head.line>i&&(hn(this,r.head.line,e,!0),i=r.head.line,n==this.doc.sel.primIndex&&an(this));else{var o=Math.max(i,r.from().line),s=r.to();i=Math.min(this.lastLine(),s.line-(s.ch?0:1))+1;for(var a=o;i>a;++a)hn(this,a,e)}}}),getTokenAt:function(e,t){var i=this.doc;e=Q(i,e);for(var n=Et(this,e.line,t),r=this.doc.mode,o=_r(i,e.line),s=new Ns(o.text,this.options.tabSize);s.pos<e.ch&&!s.eol();){s.start=s.pos;var a=er(r,s,n)}return{start:s.start,end:s.pos,string:s.current(),type:a||null,state:n}},getTokenTypeAt:function(e){e=Q(this.doc,e);var t,i=nr(this,_r(this.doc,e.line)),n=0,r=(i.length-1)/2,o=e.ch;if(0==o)t=i[2];else for(;;){var s=n+r>>1;if((s?i[2*s-1]:0)>=o)r=s;else{if(!(i[2*s+1]<o)){t=i[2*s+2];break}n=s+1}}var a=t?t.indexOf("cm-overlay "):-1;return 0>a?t:0==a?null:t.slice(0,a-1)},getModeAt:function(t){var i=this.doc.mode;return i.innerMode?e.innerMode(i,this.getTokenAt(t).state).mode:i},getHelper:function(e,t){return this.getHelpers(e,t)[0]},getHelpers:function(e,t){var i=[];if(!Cs.hasOwnProperty(t))return Cs;var n=Cs[t],r=this.getModeAt(e);if("string"==typeof r[t])n[r[t]]&&i.push(n[r[t]]);else if(r[t])for(var o=0;o<r[t].length;o++){var s=n[r[t][o]];s&&i.push(s)}else r.helperType&&n[r.helperType]?i.push(n[r.helperType]):n[r.name]&&i.push(n[r.name]);for(var o=0;o<n._global.length;o++){var a=n._global[o];a.pred(r,this)&&-1==to(i,a.val)&&i.push(a.val)}return i},getStateAfter:function(e,t){var i=this.doc;return e=K(i,null==e?i.first+i.size-1:e),Et(this,e+1,t)},cursorCoords:function(e,t){var i,n=this.doc.sel.primary();return i=null==e?n.head:"object"==typeof e?Q(this.doc,e):e?n.from():n.to(),Bt(this,i,t||"page")},charCoords:function(e,t){return Vt(this,Q(this.doc,e),t||"page")},coordsChar:function(e,t){return e=Ot(this,e,t||"page"),Wt(this,e.left,e.top)},lineAtHeight:function(e,t){return e=Ot(this,{top:e,left:0},t||"page").top,wr(this.doc,e+this.display.viewOffset)},heightAtLine:function(e,t){var i=!1,n=this.doc.first+this.doc.size-1;e<this.doc.first?e=this.doc.first:e>n&&(e=n,i=!0);var r=_r(this.doc,e);return It(this,r,{top:0,left:0},t||"page").top+(i?this.doc.height-Rr(r):0)},defaultTextHeight:function(){return Gt(this.display)},defaultCharWidth:function(){return qt(this.display)},setGutterMarker:Jt(function(e,t,i){return cn(this,e,"gutter",function(e){var n=e.gutterMarkers||(e.gutterMarkers={});return n[t]=i,!i&&ao(n)&&(e.gutterMarkers=null),!0})}),clearGutter:Jt(function(e){var t=this,i=t.doc,n=i.first;i.iter(function(i){i.gutterMarkers&&i.gutterMarkers[e]&&(i.gutterMarkers[e]=null,ni(t,n,"gutter"),ao(i.gutterMarkers)&&(i.gutterMarkers=null)),++n})}),addLineClass:Jt(function(e,t,i){return cn(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass";if(e[n]){if(new RegExp("(?:^|\\s)"+i+"(?:$|\\s)").test(e[n]))return!1;e[n]+=" "+i}else e[n]=i;return!0})}),removeLineClass:Jt(function(e,t,i){return cn(this,e,"class",function(e){var n="text"==t?"textClass":"background"==t?"bgClass":"wrapClass",r=e[n];if(!r)return!1;if(null==i)e[n]=null;else{var o=r.match(new RegExp("(?:^|\\s+)"+i+"(?:$|\\s+)"));if(!o)return!1;var s=o.index+o[0].length;e[n]=r.slice(0,o.index)+(o.index&&s!=r.length?" ":"")+r.slice(s)||null}return!0})}),addLineWidget:Jt(function(e,t,i){return Yn(this,e,t,i)}),removeLineWidget:function(e){e.clear()},lineInfo:function(e){if("number"==typeof e){if(!Z(this.doc,e))return null;var t=e;if(e=_r(this.doc,e),!e)return null}else{var t=Tr(e);if(null==t)return null}return{line:t,handle:e,text:e.text,gutterMarkers:e.gutterMarkers,textClass:e.textClass,bgClass:e.bgClass,wrapClass:e.wrapClass,widgets:e.widgets}},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(e,t,i,n,r){var o=this.display;e=Bt(this,Q(this.doc,e));var s=e.bottom,a=e.left;if(t.style.position="absolute",o.sizer.appendChild(t),"over"==n)s=e.top;else if("above"==n||"near"==n){var l=Math.max(o.wrapper.clientHeight,this.doc.height),h=Math.max(o.sizer.clientWidth,o.lineSpace.clientWidth);("above"==n||e.bottom+t.offsetHeight>l)&&e.top>t.offsetHeight?s=e.top-t.offsetHeight:e.bottom+t.offsetHeight<=l&&(s=e.bottom),a+t.offsetWidth>h&&(a=h-t.offsetWidth)}t.style.top=s+"px",t.style.left=t.style.right="","right"==r?(a=o.sizer.clientWidth-t.offsetWidth,t.style.right="0px"):("left"==r?a=0:"middle"==r&&(a=(o.sizer.clientWidth-t.offsetWidth)/2),t.style.left=a+"px"),i&&rn(this,a,s,a+t.offsetWidth,s+t.offsetHeight)},triggerOnKeyDown:Jt(Ni),triggerOnKeyPress:Jt(Ii),triggerOnKeyUp:Jt(Li),execCommand:function(e){return ks.hasOwnProperty(e)?ks[e](this):void 0},findPosH:function(e,t,i,n){var r=1;0>t&&(r=-1,t=-t);for(var o=0,s=Q(this.doc,e);t>o&&(s=dn(this.doc,s,r,i,n),!s.hitSide);++o);return s},moveH:Jt(function(e,t){var i=this;i.extendSelectionsBy(function(n){return i.display.shift||i.doc.extend||n.empty()?dn(i.doc,n.head,e,t,i.options.rtlMoveVisually):0>e?n.from():n.to()},oa)}),deleteH:Jt(function(e,t){var i=this.doc.sel,n=this.doc;i.somethingSelected()?n.replaceSelection("",null,"+delete"):un(this,function(i){var r=dn(n,i.head,e,t,!1);return 0>e?{from:r,to:i.head}:{from:i.head,to:r}})}),findPosV:function(e,t,i,n){var r=1,o=n;0>t&&(r=-1,t=-t);for(var s=0,a=Q(this.doc,e);t>s;++s){var l=Bt(this,a,"div");if(null==o?o=l.left:l.left=o,a=pn(this,l,r,i),a.hitSide)break}return a},moveV:Jt(function(e,t){var i=this,n=this.doc,r=[],o=!i.display.shift&&!n.extend&&n.sel.somethingSelected();if(n.extendSelectionsBy(function(s){if(o)return 0>e?s.from():s.to();var a=Bt(i,s.head,"div");null!=s.goalColumn&&(a.left=s.goalColumn),r.push(a.left);var l=pn(i,a,e,t);return"page"==t&&s==n.sel.primary()&&sn(i,null,Vt(i,l,"div").top-a.top),l},oa),r.length)for(var s=0;s<n.sel.ranges.length;s++)n.sel.ranges[s].goalColumn=r[s]}),toggleOverwrite:function(e){(null==e||e!=this.state.overwrite)&&((this.state.overwrite=!this.state.overwrite)?vo(this.display.cursorDiv,"CodeMirror-overwrite"):go(this.display.cursorDiv,"CodeMirror-overwrite"),Zs(this,"overwriteToggle",this,this.state.overwrite))},hasFocus:function(){return fo()==this.display.input},scrollTo:Jt(function(e,t){(null!=e||null!=t)&&ln(this),null!=e&&(this.curOp.scrollLeft=e),null!=t&&(this.curOp.scrollTop=t)}),getScrollInfo:function(){var e=this.display.scroller,t=ta;return{left:e.scrollLeft,top:e.scrollTop,height:e.scrollHeight-t,width:e.scrollWidth-t,clientHeight:e.clientHeight-t,clientWidth:e.clientWidth-t}},scrollIntoView:Jt(function(e,t){if(null==e?(e={from:this.doc.sel.primary().head,to:null},null==t&&(t=this.options.cursorScrollMargin)):"number"==typeof e?e={from:as(e,0),to:null}:null==e.from&&(e={from:e,to:null}),e.to||(e.to=e.from),e.margin=t||0,null!=e.from.line)ln(this),this.curOp.scrollToPos=e;
else{var i=on(this,Math.min(e.from.left,e.to.left),Math.min(e.from.top,e.to.top)-e.margin,Math.max(e.from.right,e.to.right),Math.max(e.from.bottom,e.to.bottom)+e.margin);this.scrollTo(i.scrollLeft,i.scrollTop)}}),setSize:Jt(function(e,t){function i(e){return"number"==typeof e||/^\d+$/.test(String(e))?e+"px":e}null!=e&&(this.display.wrapper.style.width=i(e)),null!=t&&(this.display.wrapper.style.height=i(t)),this.options.lineWrapping&&Dt(this),this.curOp.forceUpdate=!0,Zs(this,"refresh",this)}),operation:function(e){return Kt(this,e)},refresh:Jt(function(){var e=this.display.cachedTextHeight;ii(this),this.curOp.forceUpdate=!0,Nt(this),this.scrollTo(this.doc.scrollLeft,this.doc.scrollTop),u(this),(null==e||Math.abs(e-Gt(this.display))>.5)&&s(this),Zs(this,"refresh",this)}),swapDoc:Jt(function(e){var t=this.doc;return t.cm=null,yr(this,e),Nt(this),di(this),this.scrollTo(e.scrollLeft,e.scrollTop),$r(this,"swapDoc",this,t),t}),getInputField:function(){return this.display.input},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}},Kr(e);var bs=e.defaults={},Es=e.optionHandlers={},xs=e.Init={toString:function(){return"CodeMirror.Init"}};mn("value","",function(e,t){e.setValue(t)},!0),mn("mode",null,function(e,t){e.doc.modeOption=t,i(e)},!0),mn("indentUnit",2,i,!0),mn("indentWithTabs",!1),mn("smartIndent",!0),mn("tabSize",4,function(e){n(e),Nt(e),ii(e)},!0),mn("specialChars",/[\t\u0000-\u0019\u00ad\u200b\u2028\u2029\ufeff]/g,function(e,t){e.options.specialChars=new RegExp(t.source+(t.test("	")?"":"|	"),"g"),e.refresh()},!0),mn("specialCharPlaceholder",ar,function(e){e.refresh()},!0),mn("electricChars",!0),mn("rtlMoveVisually",!ts),mn("wholeLineUpdateBefore",!0),mn("theme","default",function(e){l(e),h(e)},!0),mn("keyMap","default",a),mn("extraKeys",null),mn("lineWrapping",!1,r,!0),mn("gutters",[],function(e){f(e.options),h(e)},!0),mn("fixedGutter",!0,function(e,t){e.display.gutters.style.left=t?E(e.display)+"px":"0",e.refresh()},!0),mn("coverGutterNextToScrollbar",!1,g,!0),mn("lineNumbers",!1,function(e){f(e.options),h(e)},!0),mn("firstLineNumber",1,h,!0),mn("lineNumberFormatter",function(e){return e},h,!0),mn("showCursorWhenSelecting",!1,ft,!0),mn("resetSelectionOnContextMenu",!0),mn("readOnly",!1,function(e,t){"nocursor"==t?(Vi(e),e.display.input.blur(),e.display.disabled=!0):(e.display.disabled=!1,t||di(e))}),mn("disableInput",!1,function(e,t){t||di(e)},!0),mn("dragDrop",!0),mn("cursorBlinkRate",530),mn("cursorScrollMargin",0),mn("cursorHeight",1),mn("workTime",100),mn("workDelay",100),mn("flattenSpans",!0,n,!0),mn("addModeClass",!1,n,!0),mn("pollInterval",100),mn("undoDepth",200,function(e,t){e.doc.history.undoDepth=t}),mn("historyEventDelay",1250),mn("viewportMargin",10,function(e){e.refresh()},!0),mn("maxHighlightLength",1e4,n,!0),mn("moveInputWithCursor",!0,function(e,t){t||(e.display.inputDiv.style.top=e.display.inputDiv.style.left=0)}),mn("tabindex",null,function(e,t){e.display.input.tabIndex=t||""}),mn("autofocus",null);var Ts=e.modes={},ws=e.mimeModes={};e.defineMode=function(t,i){if(e.defaults.mode||"null"==t||(e.defaults.mode=t),arguments.length>2){i.dependencies=[];for(var n=2;n<arguments.length;++n)i.dependencies.push(arguments[n])}Ts[t]=i},e.defineMIME=function(e,t){ws[e]=t},e.resolveMode=function(t){if("string"==typeof t&&ws.hasOwnProperty(t))t=ws[t];else if(t&&"string"==typeof t.name&&ws.hasOwnProperty(t.name)){var i=ws[t.name];"string"==typeof i&&(i={name:i}),t=no(i,t),t.name=i.name}else if("string"==typeof t&&/^[\w\-]+\/[\w\-]+\+xml$/.test(t))return e.resolveMode("application/xml");return"string"==typeof t?{name:t}:t||{name:"null"}},e.getMode=function(t,i){var i=e.resolveMode(i),n=Ts[i.name];if(!n)return e.getMode(t,"text/plain");var r=n(t,i);if(Rs.hasOwnProperty(i.name)){var o=Rs[i.name];for(var s in o)o.hasOwnProperty(s)&&(r.hasOwnProperty(s)&&(r["_"+s]=r[s]),r[s]=o[s])}if(r.name=i.name,i.helperType&&(r.helperType=i.helperType),i.modeProps)for(var s in i.modeProps)r[s]=i.modeProps[s];return r},e.defineMode("null",function(){return{token:function(e){e.skipToEnd()}}}),e.defineMIME("text/plain","null");var Rs=e.modeExtensions={};e.extendMode=function(e,t){var i=Rs.hasOwnProperty(e)?Rs[e]:Rs[e]={};ro(t,i)},e.defineExtension=function(t,i){e.prototype[t]=i},e.defineDocExtension=function(e,t){Ws.prototype[e]=t},e.defineOption=mn;var Ss=[];e.defineInitHook=function(e){Ss.push(e)};var Cs=e.helpers={};e.registerHelper=function(t,i,n){Cs.hasOwnProperty(t)||(Cs[t]=e[t]={_global:[]}),Cs[t][i]=n},e.registerGlobalHelper=function(t,i,n,r){e.registerHelper(t,i,r),Cs[t]._global.push({pred:n,val:r})};var Hs=e.copyState=function(e,t){if(t===!0)return t;if(e.copyState)return e.copyState(t);var i={};for(var n in t){var r=t[n];r instanceof Array&&(r=r.concat([])),i[n]=r}return i},Ms=e.startState=function(e,t,i){return e.startState?e.startState(t,i):!0};e.innerMode=function(e,t){for(;e.innerMode;){var i=e.innerMode(t);if(!i||i.mode==e)break;t=i.state,e=i.mode}return i||{mode:e,state:t}};var ks=e.commands={selectAll:function(e){e.setSelection(as(e.firstLine(),0),as(e.lastLine()),na)},singleSelection:function(e){e.setSelection(e.getCursor("anchor"),e.getCursor("head"),na)},killLine:function(e){un(e,function(t){if(t.empty()){var i=_r(e.doc,t.head.line).text.length;return t.head.ch==i&&t.head.line<e.lastLine()?{from:t.head,to:as(t.head.line+1,0)}:{from:t.head,to:as(t.head.line,i)}}return{from:t.from(),to:t.to()}})},deleteLine:function(e){un(e,function(t){return{from:as(t.from().line,0),to:Q(e.doc,as(t.to().line+1,0))}})},delLineLeft:function(e){un(e,function(e){return{from:as(e.from().line,0),to:e.from()}})},undo:function(e){e.undo()},redo:function(e){e.redo()},undoSelection:function(e){e.undoSelection()},redoSelection:function(e){e.redoSelection()},goDocStart:function(e){e.extendSelection(as(e.firstLine(),0))},goDocEnd:function(e){e.extendSelection(as(e.lastLine()))},goLineStart:function(e){e.extendSelectionsBy(function(t){return ko(e,t.head.line)},oa)},goLineStartSmart:function(e){e.extendSelectionsBy(function(t){var i=ko(e,t.head.line),n=e.getLineHandle(i.line),r=Sr(n);if(!r||0==r[0].level){var o=Math.max(0,n.text.search(/\S/)),s=t.head.line==i.line&&t.head.ch<=o&&t.head.ch;return as(i.line,s?0:o)}return i},oa)},goLineEnd:function(e){e.extendSelectionsBy(function(t){return Ao(e,t.head.line)},oa)},goLineRight:function(e){e.extendSelectionsBy(function(t){var i=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:e.display.lineDiv.offsetWidth+100,top:i},"div")},oa)},goLineLeft:function(e){e.extendSelectionsBy(function(t){var i=e.charCoords(t.head,"div").top+5;return e.coordsChar({left:0,top:i},"div")},oa)},goLineUp:function(e){e.moveV(-1,"line")},goLineDown:function(e){e.moveV(1,"line")},goPageUp:function(e){e.moveV(-1,"page")},goPageDown:function(e){e.moveV(1,"page")},goCharLeft:function(e){e.moveH(-1,"char")},goCharRight:function(e){e.moveH(1,"char")},goColumnLeft:function(e){e.moveH(-1,"column")},goColumnRight:function(e){e.moveH(1,"column")},goWordLeft:function(e){e.moveH(-1,"word")},goGroupRight:function(e){e.moveH(1,"group")},goGroupLeft:function(e){e.moveH(-1,"group")},goWordRight:function(e){e.moveH(1,"word")},delCharBefore:function(e){e.deleteH(-1,"char")},delCharAfter:function(e){e.deleteH(1,"char")},delWordBefore:function(e){e.deleteH(-1,"word")},delWordAfter:function(e){e.deleteH(1,"word")},delGroupBefore:function(e){e.deleteH(-1,"group")},delGroupAfter:function(e){e.deleteH(1,"group")},indentAuto:function(e){e.indentSelection("smart")},indentMore:function(e){e.indentSelection("add")},indentLess:function(e){e.indentSelection("subtract")},insertTab:function(e){e.replaceSelection("	")},insertSoftTab:function(e){for(var t=[],i=e.listSelections(),n=e.options.tabSize,r=0;r<i.length;r++){var o=i[r].from(),s=sa(e.getLine(o.line),o.ch,n);t.push(new Array(n-s%n+1).join(" "))}e.replaceSelections(t)},defaultTab:function(e){e.somethingSelected()?e.indentSelection("add"):e.execCommand("insertTab")},transposeChars:function(e){Kt(e,function(){for(var t=e.listSelections(),i=[],n=0;n<t.length;n++){var r=t[n].head,o=_r(e.doc,r.line).text;if(o)if(r.ch==o.length&&(r=new as(r.line,r.ch-1)),r.ch>0)r=new as(r.line,r.ch+1),e.replaceRange(o.charAt(r.ch-1)+o.charAt(r.ch-2),as(r.line,r.ch-2),r,"+transpose");else if(r.line>e.doc.first){var s=_r(e.doc,r.line-1).text;s&&e.replaceRange(o.charAt(0)+"\n"+s.charAt(s.length-1),as(r.line-1,s.length-1),as(r.line,1),"+transpose")}i.push(new q(r,r))}e.setSelections(i)})},newlineAndIndent:function(e){Kt(e,function(){for(var t=e.listSelections().length,i=0;t>i;i++){var n=e.listSelections()[i];e.replaceRange("\n",n.anchor,n.head,"+input"),e.indentLine(n.from().line+1,null,!0),an(e)}})},toggleOverwrite:function(e){e.toggleOverwrite()}},As=e.keyMap={};As.basic={Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},As.pcDefault={"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo","Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-Up":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Down":"goDocEnd","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection","Alt-U":"redoSelection",fallthrough:"basic"},As.macDefault={"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo","Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineStart","Cmd-Right":"goLineEnd","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delLineLeft","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection",fallthrough:["basic","emacsy"]},As.emacsy={"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars"},As["default"]=es?As.macDefault:As.pcDefault;var Ps=e.lookupKey=function(e,t,i){function n(t){t=gn(t);var r=t[e];if(r===!1)return"stop";if(null!=r&&i(r))return!0;if(t.nofallthrough)return"stop";var o=t.fallthrough;if(null==o)return!1;if("[object Array]"!=Object.prototype.toString.call(o))return n(o);for(var s=0;s<o.length;++s){var a=n(o[s]);if(a)return a}return!1}for(var r=0;r<t.length;++r){var o=n(t[r]);if(o)return"stop"!=o}},Fs=e.isModifierKey=function(e){var t=Ea[e.keyCode];return"Ctrl"==t||"Alt"==t||"Shift"==t||"Mod"==t},Ds=e.keyName=function(e,t){if(qo&&34==e.keyCode&&e["char"])return!1;var i=Ea[e.keyCode];return null==i||e.altGraphKey?!1:(e.altKey&&(i="Alt-"+i),(ns?e.metaKey:e.ctrlKey)&&(i="Ctrl-"+i),(ns?e.ctrlKey:e.metaKey)&&(i="Cmd-"+i),!t&&e.shiftKey&&(i="Shift-"+i),i)};e.fromTextArea=function(t,i){function n(){t.value=h.getValue()}if(i||(i={}),i.value=t.value,!i.tabindex&&t.tabindex&&(i.tabindex=t.tabindex),!i.placeholder&&t.placeholder&&(i.placeholder=t.placeholder),null==i.autofocus){var r=fo();i.autofocus=r==t||null!=t.getAttribute("autofocus")&&r==document.body}if(t.form&&(Qs(t.form,"submit",n),!i.leaveSubmitMethodAlone)){var o=t.form,s=o.submit;try{var a=o.submit=function(){n(),o.submit=s,o.submit(),o.submit=a}}catch(l){}}t.style.display="none";var h=e(function(e){t.parentNode.insertBefore(e,t.nextSibling)},i);return h.save=n,h.getTextArea=function(){return t},h.toTextArea=function(){n(),t.parentNode.removeChild(h.getWrapperElement()),t.style.display="",t.form&&(Js(t.form,"submit",n),"function"==typeof t.form.submit&&(t.form.submit=s))},h};var Ns=e.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Ns.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var i=t==e;else var i=t&&(e.test?e.test(t):e(t));return i?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){return this.lastColumnPos<this.start&&(this.lastColumnValue=sa(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start),this.lastColumnValue-(this.lineStart?sa(this.string,this.lineStart,this.tabSize):0)},indentation:function(){return sa(this.string,null,this.tabSize)-(this.lineStart?sa(this.string,this.lineStart,this.tabSize):0)},match:function(e,t,i){if("string"!=typeof e){var n=this.string.slice(this.pos).match(e);return n&&n.index>0?null:(n&&t!==!1&&(this.pos+=n[0].length),n)}var r=function(e){return i?e.toLowerCase():e},o=this.string.substr(this.pos,e.length);return r(o)==r(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}};var zs=e.TextMarker=function(e,t){this.lines=[],this.type=t,this.doc=e};Kr(zs),zs.prototype.clear=function(){if(!this.explicitlyCleared){var e=this.doc.cm,t=e&&!e.curOp;if(t&&Xt(e),Yr(this,"clear")){var i=this.find();i&&$r(this,"clear",i.from,i.to)}for(var n=null,r=null,o=0;o<this.lines.length;++o){var s=this.lines[o],a=Tn(s.markedSpans,this);e&&!this.collapsed?ni(e,Tr(s),"text"):e&&(null!=a.to&&(r=Tr(s)),null!=a.from&&(n=Tr(s))),s.markedSpans=wn(s.markedSpans,a),null==a.from&&this.collapsed&&!$n(this.doc,s)&&e&&xr(s,Gt(e.display))}if(e&&this.collapsed&&!e.options.lineWrapping)for(var o=0;o<this.lines.length;++o){var l=Bn(this.lines[o]),h=d(l);h>e.display.maxLineLength&&(e.display.maxLine=l,e.display.maxLineLength=h,e.display.maxLineChanged=!0)}null!=n&&e&&this.collapsed&&ii(e,n,r+1),this.lines.length=0,this.explicitlyCleared=!0,this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,e&&ut(e.doc)),e&&$r(e,"markerCleared",e,this),t&&Yt(e),this.parent&&this.parent.clear()}},zs.prototype.find=function(e,t){null==e&&"bookmark"==this.type&&(e=1);for(var i,n,r=0;r<this.lines.length;++r){var o=this.lines[r],s=Tn(o.markedSpans,this);if(null!=s.from&&(i=as(t?o:Tr(o),s.from),-1==e))return i;if(null!=s.to&&(n=as(t?o:Tr(o),s.to),1==e))return n}return i&&{from:i,to:n}},zs.prototype.changed=function(){var e=this.find(-1,!0),t=this,i=this.doc.cm;e&&i&&Kt(i,function(){var n=e.line,r=Tr(e.line),o=Mt(i,r);if(o&&(Ft(o),i.curOp.selectionChanged=i.curOp.forceUpdate=!0),i.curOp.updateMaxLine=!0,!$n(t.doc,n)&&null!=t.height){var s=t.height;t.height=null;var a=Xn(t)-s;a&&xr(n,n.height+a)}})},zs.prototype.attachLine=function(e){if(!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;t.maybeHiddenMarkers&&-1!=to(t.maybeHiddenMarkers,this)||(t.maybeUnhiddenMarkers||(t.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(e)},zs.prototype.detachLine=function(e){if(this.lines.splice(to(this.lines,e),1),!this.lines.length&&this.doc.cm){var t=this.doc.cm.curOp;(t.maybeHiddenMarkers||(t.maybeHiddenMarkers=[])).push(this)}};var Ls=0,Is=e.SharedTextMarker=function(e,t){this.markers=e,this.primary=t;for(var i=0;i<e.length;++i)e[i].parent=this};Kr(Is),Is.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var e=0;e<this.markers.length;++e)this.markers[e].clear();$r(this,"clear")}},Is.prototype.find=function(e,t){return this.primary.find(e,t)};var Os=e.LineWidget=function(e,t,i){if(i)for(var n in i)i.hasOwnProperty(n)&&(this[n]=i[n]);this.cm=e,this.node=t};Kr(Os),Os.prototype.clear=function(){var e=this.cm,t=this.line.widgets,i=this.line,n=Tr(i);if(null!=n&&t){for(var r=0;r<t.length;++r)t[r]==this&&t.splice(r--,1);t.length||(i.widgets=null);var o=Xn(this);Kt(e,function(){qn(e,i,-o),ni(e,n,"widget"),xr(i,Math.max(0,i.height-o))})}},Os.prototype.changed=function(){var e=this.height,t=this.cm,i=this.line;this.height=null;var n=Xn(this)-e;n&&Kt(t,function(){t.curOp.forceUpdate=!0,qn(t,i,n),xr(i,i.height+n)})};var Vs=e.Line=function(e,t,i){this.text=e,Fn(this,t),this.height=i?i(this):1};Kr(Vs),Vs.prototype.lineNo=function(){return Tr(this)};var Bs={},Us={};mr.prototype={chunkSize:function(){return this.lines.length},removeInner:function(e,t){for(var i=e,n=e+t;n>i;++i){var r=this.lines[i];this.height-=r.height,Qn(r),$r(r,"delete")}this.lines.splice(e,t)},collapse:function(e){e.push.apply(e,this.lines)},insertInner:function(e,t,i){this.height+=i,this.lines=this.lines.slice(0,e).concat(t).concat(this.lines.slice(e));for(var n=0;n<t.length;++n)t[n].parent=this},iterN:function(e,t,i){for(var n=e+t;n>e;++e)if(i(this.lines[e]))return!0}},gr.prototype={chunkSize:function(){return this.size},removeInner:function(e,t){this.size-=t;for(var i=0;i<this.children.length;++i){var n=this.children[i],r=n.chunkSize();if(r>e){var o=Math.min(t,r-e),s=n.height;if(n.removeInner(e,o),this.height-=s-n.height,r==o&&(this.children.splice(i--,1),n.parent=null),0==(t-=o))break;e=0}else e-=r}if(this.size-t<25&&(this.children.length>1||!(this.children[0]instanceof mr))){var a=[];this.collapse(a),this.children=[new mr(a)],this.children[0].parent=this}},collapse:function(e){for(var t=0;t<this.children.length;++t)this.children[t].collapse(e)},insertInner:function(e,t,i){this.size+=t.length,this.height+=i;for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(o>=e){if(r.insertInner(e,t,i),r.lines&&r.lines.length>50){for(;r.lines.length>50;){var s=r.lines.splice(r.lines.length-25,25),a=new mr(s);r.height-=a.height,this.children.splice(n+1,0,a),a.parent=this}this.maybeSpill()}break}e-=o}},maybeSpill:function(){if(!(this.children.length<=10)){var e=this;do{var t=e.children.splice(e.children.length-5,5),i=new gr(t);if(e.parent){e.size-=i.size,e.height-=i.height;var n=to(e.parent.children,e);e.parent.children.splice(n+1,0,i)}else{var r=new gr(e.children);r.parent=e,e.children=[r,i],e=r}i.parent=e.parent}while(e.children.length>10);e.parent.maybeSpill()}},iterN:function(e,t,i){for(var n=0;n<this.children.length;++n){var r=this.children[n],o=r.chunkSize();if(o>e){var s=Math.min(t,o-e);if(r.iterN(e,s,i))return!0;if(0==(t-=s))break;e=0}else e-=o}}};var js=0,Ws=e.Doc=function(e,t,i){if(!(this instanceof Ws))return new Ws(e,t,i);null==i&&(i=0),gr.call(this,[new mr([new Vs("",null)])]),this.first=i,this.scrollTop=this.scrollLeft=0,this.cantEdit=!1,this.cleanGeneration=1,this.frontier=i;var n=as(i,0);this.sel=Y(n),this.history=new Cr(null),this.id=++js,this.modeOption=t,"string"==typeof e&&(e=ya(e)),fr(this,{from:n,to:n,text:e}),lt(this,Y(n),na)};Ws.prototype=no(gr.prototype,{constructor:Ws,iter:function(e,t,i){i?this.iterN(e-this.first,t-e,i):this.iterN(this.first,this.first+this.size,e)},insert:function(e,t){for(var i=0,n=0;n<t.length;++n)i+=t[n].height;this.insertInner(e-this.first,t,i)},remove:function(e,t){this.removeInner(e-this.first,t)},getValue:function(e){var t=Er(this,this.first,this.first+this.size);return e===!1?t:t.join(e||"\n")},setValue:Zt(function(e){var t=as(this.first,0),i=this.first+this.size-1;Xi(this,{from:t,to:as(i,_r(this,i).text.length),text:ya(e),origin:"setValue"},!0),lt(this,Y(t))}),replaceRange:function(e,t,i,n){t=Q(this,t),i=i?Q(this,i):t,en(this,e,t,i,n)},getRange:function(e,t,i){var n=br(this,Q(this,e),Q(this,t));return i===!1?n:n.join(i||"\n")},getLine:function(e){var t=this.getLineHandle(e);return t&&t.text},getLineHandle:function(e){return Z(this,e)?_r(this,e):void 0},getLineNumber:function(e){return Tr(e)},getLineHandleVisualStart:function(e){return"number"==typeof e&&(e=_r(this,e)),Bn(e)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+this.size-1},clipPos:function(e){return Q(this,e)},getCursor:function(e){var t,i=this.sel.primary();return t=null==e||"head"==e?i.head:"anchor"==e?i.anchor:"end"==e||"to"==e||e===!1?i.to():i.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:Zt(function(e,t,i){ot(this,Q(this,"number"==typeof e?as(e,t||0):e),null,i)}),setSelection:Zt(function(e,t,i){ot(this,Q(this,e),Q(this,t||e),i)}),extendSelection:Zt(function(e,t,i){it(this,Q(this,e),t&&Q(this,t),i)}),extendSelections:Zt(function(e,t){nt(this,et(this,e,t))}),extendSelectionsBy:Zt(function(e,t){nt(this,io(this.sel.ranges,e),t)}),setSelections:Zt(function(e,t,i){if(e.length){for(var n=0,r=[];n<e.length;n++)r[n]=new q(Q(this,e[n].anchor),Q(this,e[n].head));null==t&&(t=Math.min(e.length-1,this.sel.primIndex)),lt(this,X(r,t),i)}}),addSelection:Zt(function(e,t,i){var n=this.sel.ranges.slice(0);n.push(new q(Q(this,e),Q(this,t||e))),lt(this,X(n,n.length-1),i)}),getSelection:function(e){for(var t,i=this.sel.ranges,n=0;n<i.length;n++){var r=br(this,i[n].from(),i[n].to());t=t?t.concat(r):r}return e===!1?t:t.join(e||"\n")},getSelections:function(e){for(var t=[],i=this.sel.ranges,n=0;n<i.length;n++){var r=br(this,i[n].from(),i[n].to());e!==!1&&(r=r.join(e||"\n")),t[n]=r}return t},replaceSelection:function(e,t,i){for(var n=[],r=0;r<this.sel.ranges.length;r++)n[r]=e;this.replaceSelections(n,t,i||"+input")},replaceSelections:Zt(function(e,t,i){for(var n=[],r=this.sel,o=0;o<r.ranges.length;o++){var s=r.ranges[o];n[o]={from:s.from(),to:s.to(),text:ya(e[o]),origin:i}}for(var a=t&&"end"!=t&&Gi(this,n,t),o=n.length-1;o>=0;o--)Xi(this,n[o]);a?at(this,a):this.cm&&an(this.cm)}),undo:Zt(function(){Ki(this,"undo")}),redo:Zt(function(){Ki(this,"redo")}),undoSelection:Zt(function(){Ki(this,"undo",!0)}),redoSelection:Zt(function(){Ki(this,"redo",!0)}),setExtending:function(e){this.extend=e},getExtending:function(){return this.extend},historySize:function(){for(var e=this.history,t=0,i=0,n=0;n<e.done.length;n++)e.done[n].ranges||++t;for(var n=0;n<e.undone.length;n++)e.undone[n].ranges||++i;return{undo:t,redo:i}},clearHistory:function(){this.history=new Cr(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=this.changeGeneration(!0)},changeGeneration:function(e){return e&&(this.history.lastOp=this.history.lastOrigin=null),this.history.generation},isClean:function(e){return this.history.generation==(e||this.cleanGeneration)},getHistory:function(){return{done:Ir(this.history.done),undone:Ir(this.history.undone)}},setHistory:function(e){var t=this.history=new Cr(this.history.maxGeneration);t.done=Ir(e.done.slice(0),null,!0),t.undone=Ir(e.undone.slice(0),null,!0)},markText:function(e,t,i){return vn(this,Q(this,e),Q(this,t),i,"range")},setBookmark:function(e,t){var i={replacedWith:t&&(null==t.nodeType?t.widget:t),insertLeft:t&&t.insertLeft,clearWhenEmpty:!1,shared:t&&t.shared};return e=Q(this,e),vn(this,e,e,i,"bookmark")},findMarksAt:function(e){e=Q(this,e);var t=[],i=_r(this,e.line).markedSpans;if(i)for(var n=0;n<i.length;++n){var r=i[n];(null==r.from||r.from<=e.ch)&&(null==r.to||r.to>=e.ch)&&t.push(r.marker.parent||r.marker)}return t},findMarks:function(e,t,i){e=Q(this,e),t=Q(this,t);var n=[],r=e.line;return this.iter(e.line,t.line+1,function(o){var s=o.markedSpans;if(s)for(var a=0;a<s.length;a++){var l=s[a];r==e.line&&e.ch>l.to||null==l.from&&r!=e.line||r==t.line&&l.from>t.ch||i&&!i(l.marker)||n.push(l.marker.parent||l.marker)}++r}),n},getAllMarks:function(){var e=[];return this.iter(function(t){var i=t.markedSpans;if(i)for(var n=0;n<i.length;++n)null!=i[n].from&&e.push(i[n].marker)}),e},posFromIndex:function(e){var t,i=this.first;return this.iter(function(n){var r=n.text.length+1;return r>e?(t=e,!0):(e-=r,++i,void 0)}),Q(this,as(i,t))},indexFromPos:function(e){e=Q(this,e);var t=e.ch;return e.line<this.first||e.ch<0?0:(this.iter(this.first,e.line,function(e){t+=e.text.length+1}),t)},copy:function(e){var t=new Ws(Er(this,this.first,this.first+this.size),this.modeOption,this.first);return t.scrollTop=this.scrollTop,t.scrollLeft=this.scrollLeft,t.sel=this.sel,t.extend=!1,e&&(t.history.undoDepth=this.history.undoDepth,t.setHistory(this.getHistory())),t},linkedDoc:function(e){e||(e={});var t=this.first,i=this.first+this.size;null!=e.from&&e.from>t&&(t=e.from),null!=e.to&&e.to<i&&(i=e.to);var n=new Ws(Er(this,t,i),e.mode||this.modeOption,t);return e.sharedHist&&(n.history=this.history),(this.linked||(this.linked=[])).push({doc:n,sharedHist:e.sharedHist}),n.linked=[{doc:this,isParent:!0,sharedHist:e.sharedHist}],bn(n,_n(this)),n},unlinkDoc:function(t){if(t instanceof e&&(t=t.doc),this.linked)for(var i=0;i<this.linked.length;++i){var n=this.linked[i];if(n.doc==t){this.linked.splice(i,1),t.unlinkDoc(this),En(_n(this));break}}if(t.history==this.history){var r=[t.id];vr(t,function(e){r.push(e.id)},!0),t.history=new Cr(null),t.history.done=Ir(this.history.done,r),t.history.undone=Ir(this.history.undone,r)}},iterLinkedDocs:function(e){vr(this,e)},getMode:function(){return this.mode},getEditor:function(){return this.cm}}),Ws.prototype.eachLine=Ws.prototype.iter;var $s="iter insert remove copy getEditor".split(" ");for(var Gs in Ws.prototype)Ws.prototype.hasOwnProperty(Gs)&&to($s,Gs)<0&&(e.prototype[Gs]=function(e){return function(){return e.apply(this.doc,arguments)}}(Ws.prototype[Gs]));Kr(Ws);var qs,Xs=e.e_preventDefault=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1},Ys=e.e_stopPropagation=function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0},Ks=e.e_stop=function(e){Xs(e),Ys(e)},Qs=e.on=function(e,t,i){if(e.addEventListener)e.addEventListener(t,i,!1);else if(e.attachEvent)e.attachEvent("on"+t,i);else{var n=e._handlers||(e._handlers={}),r=n[t]||(n[t]=[]);r.push(i)}},Js=e.off=function(e,t,i){if(e.removeEventListener)e.removeEventListener(t,i,!1);else if(e.detachEvent)e.detachEvent("on"+t,i);else{var n=e._handlers&&e._handlers[t];if(!n)return;for(var r=0;r<n.length;++r)if(n[r]==i){n.splice(r,1);break}}},Zs=e.signal=function(e,t){var i=e._handlers&&e._handlers[t];if(i)for(var n=Array.prototype.slice.call(arguments,2),r=0;r<i.length;++r)i[r].apply(null,n)},ea=0,ta=30,ia=e.Pass={toString:function(){return"CodeMirror.Pass"}},na={scroll:!1},ra={origin:"*mouse"},oa={origin:"+move"};Qr.prototype.set=function(e,t){clearTimeout(this.id),this.id=setTimeout(t,e)};var sa=e.countColumn=function(e,t,i,n,r){null==t&&(t=e.search(/[^\s\u00a0]/),-1==t&&(t=e.length));for(var o=n||0,s=r||0;;){var a=e.indexOf("	",o);if(0>a||a>=t)return s+(t-o);s+=a-o,s+=i-s%i,o=a+1}},aa=[""],la=function(e){e.select()};Jo?la=function(e){e.selectionStart=0,e.selectionEnd=e.value.length}:jo&&(la=function(e){try{e.select()}catch(t){}}),[].indexOf&&(to=function(e,t){return e.indexOf(t)}),[].map&&(io=function(e,t){return e.map(t)});var ha,ca=/[\u00df\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,ua=e.isWordChar=function(e){return/\w/.test(e)||e>""&&(e.toUpperCase()!=e.toLowerCase()||ca.test(e))},da=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/;ha=document.createRange?function(e,t,i){var n=document.createRange();return n.setEnd(e,i),n.setStart(e,t),n}:function(e,t,i){var n=document.body.createTextRange();return n.moveToElementText(e.parentNode),n.collapse(!0),n.moveEnd("character",i),n.moveStart("character",t),n},Io&&(fo=function(){try{return document.activeElement}catch(e){return document.body}});var pa,fa,ma,ga=!1,va=function(){if(Vo)return!1;var e=ho("div");return"draggable"in e||"dragDrop"in e}(),ya=e.splitLines=3!="\n\nb".split(/\n/).length?function(e){for(var t=0,i=[],n=e.length;n>=t;){var r=e.indexOf("\n",t);-1==r&&(r=e.length);var o=e.slice(t,"\r"==e.charAt(r-1)?r-1:r),s=o.indexOf("\r");-1!=s?(i.push(o.slice(0,s)),t+=s+1):(i.push(o),t=r+1)}return i}:function(e){return e.split(/\r\n?|\n/)},_a=window.getSelection?function(e){try{return e.selectionStart!=e.selectionEnd}catch(t){return!1}}:function(e){try{var t=e.ownerDocument.selection.createRange()}catch(i){}return t&&t.parentElement()==e?0!=t.compareEndPoints("StartToEnd",t):!1},ba=function(){var e=ho("div");return"oncopy"in e?!0:(e.setAttribute("oncopy","return;"),"function"==typeof e.oncopy)}(),Ea={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",107:"=",109:"-",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"};e.keyNames=Ea,function(){for(var e=0;10>e;e++)Ea[e+48]=Ea[e+96]=String(e);for(var e=65;90>=e;e++)Ea[e]=String.fromCharCode(e);for(var e=1;12>=e;e++)Ea[e+111]=Ea[e+63235]="F"+e}();var xa,Ta=function(){function e(e){return 247>=e?i.charAt(e):e>=1424&&1524>=e?"R":e>=1536&&1773>=e?n.charAt(e-1536):e>=1774&&2220>=e?"r":e>=8192&&8203>=e?"w":8204==e?"b":"L"}function t(e,t,i){this.level=e,this.from=t,this.to=i}var i="bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN",n="rrrrrrrrrrrr,rNNmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmrrrrrrrnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmNmmmm",r=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,o=/[stwN]/,s=/[LRr]/,a=/[Lb1n]/,l=/[1n]/,h="L";
return function(i){if(!r.test(i))return!1;for(var n,c=i.length,u=[],d=0;c>d;++d)u.push(n=e(i.charCodeAt(d)));for(var d=0,p=h;c>d;++d){var n=u[d];"m"==n?u[d]=p:p=n}for(var d=0,f=h;c>d;++d){var n=u[d];"1"==n&&"r"==f?u[d]="n":s.test(n)&&(f=n,"r"==n&&(u[d]="R"))}for(var d=1,p=u[0];c-1>d;++d){var n=u[d];"+"==n&&"1"==p&&"1"==u[d+1]?u[d]="1":","!=n||p!=u[d+1]||"1"!=p&&"n"!=p||(u[d]=p),p=n}for(var d=0;c>d;++d){var n=u[d];if(","==n)u[d]="N";else if("%"==n){for(var m=d+1;c>m&&"%"==u[m];++m);for(var g=d&&"!"==u[d-1]||c>m&&"1"==u[m]?"1":"N",v=d;m>v;++v)u[v]=g;d=m-1}}for(var d=0,f=h;c>d;++d){var n=u[d];"L"==f&&"1"==n?u[d]="L":s.test(n)&&(f=n)}for(var d=0;c>d;++d)if(o.test(u[d])){for(var m=d+1;c>m&&o.test(u[m]);++m);for(var y="L"==(d?u[d-1]:h),_="L"==(c>m?u[m]:h),g=y||_?"L":"R",v=d;m>v;++v)u[v]=g;d=m-1}for(var b,E=[],d=0;c>d;)if(a.test(u[d])){var x=d;for(++d;c>d&&a.test(u[d]);++d);E.push(new t(0,x,d))}else{var T=d,w=E.length;for(++d;c>d&&"L"!=u[d];++d);for(var v=T;d>v;)if(l.test(u[v])){v>T&&E.splice(w,0,new t(1,T,v));var R=v;for(++v;d>v&&l.test(u[v]);++v);E.splice(w,0,new t(2,R,v)),T=v}else++v;d>T&&E.splice(w,0,new t(1,T,d))}return 1==E[0].level&&(b=i.match(/^\s+/))&&(E[0].from=b[0].length,E.unshift(new t(0,0,b[0].length))),1==eo(E).level&&(b=i.match(/\s+$/))&&(eo(E).to-=b[0].length,E.push(new t(0,c-b[0].length,c))),E[0].level!=eo(E).level&&E.push(new t(E[0].level,c,c)),E}}();return e.version="4.2.0",e});var JSHINT=function(){function e(){}function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function i(e,t){void 0===zt[e]&&void 0===Nt[e]&&a("Bad option: '"+e+"'.",t)}function n(e,i){var n;for(n in i)t(i,n)&&(e[n]=i[n])}function r(){pt.couch&&n(ft,Vt),pt.rhino&&n(ft,Yt),pt.prototypejs&&n(ft,Xt),pt.node&&(n(ft,qt),pt.globalstrict=!0),pt.devel&&n(ft,Bt),pt.dojo&&n(ft,Ut),pt.browser&&n(ft,Ot),pt.nonstandard&&n(ft,Qt),pt.jquery&&n(ft,$t),pt.mootools&&n(ft,Gt),pt.wsh&&n(ft,Zt),pt.esnext&&Tt(),pt.globalstrict&&pt.strict!==!1&&(pt.strict=!0)}function o(e,t,i){var n=Math.floor(100*(t/at.length));throw{name:"JSHintError",line:t,character:i,message:e+" ("+n+"% scanned).",raw:e}}function s(e,t,i,n){return JSHINT.undefs.push([e,t,i,n])}function a(e,t,i,n,r,s){var a,l,h;return t=t||ut,"(end)"===t.id&&(t=Et),l=t.line||0,a=t.from||0,h={id:"(error)",raw:e,evidence:at[l-1]||"",line:l,character:a,a:i,b:n,c:r,d:s},h.reason=e.supplant(h),JSHINT.errors.push(h),pt.passfail&&o("Stopping. ",l,a),wt+=1,wt>=pt.maxerr&&o("Too many errors.",l,a),h}function l(e,t,i,n,r,o,s){return a(e,{line:t,from:i},n,r,o,s)}function h(e,t,i,n,r,o){a(e,t,i,n,r,o)}function c(e,t,i,n,r,o,s){return h(e,{line:t,from:i},n,r,o,s)}function u(e,i){"hasOwnProperty"===e&&a("'hasOwnProperty' is a really bad name."),t(et,e)&&!et["(global)"]&&(et[e]===!0?pt.latedef&&a("'{a}' was used before it was defined.",ut,e):pt.shadow||"exception"===i||a("'{a}' is already defined.",ut,e)),et[e]=i,et["(global)"]?(it[e]=et,t(nt,e)&&(pt.latedef&&a("'{a}' was used before it was defined.",ut,e),delete nt[e])):vt[e]=et}function d(){var e,t,n,o,s,a,l=ut.value;switch(l){case"*/":h("Unbegun comment.");break;case"/*members":case"/*member":l="/*members",ct||(ct={}),t=ct;break;case"/*jshint":case"/*jslint":t=pt,n=Nt;break;case"/*global":t=ft;break;default:h("What?")}o=ei.token();e:for(;;){for(;;){if("special"===o.type&&"*/"===o.value)break e;if("(endline)"!==o.id&&","!==o.id)break;o=ei.token()}"(string)"!==o.type&&"(identifier)"!==o.type&&"/*members"!==l&&h("Bad option.",o),a=ei.token(),":"===a.id?(a=ei.token(),t===ct&&h("Expected '{a}' and instead saw '{b}'.",o,"*/",":"),"/*jshint"===l&&i(o.value,o),"indent"!==o.value||"/*jshint"!==l&&"/*jslint"!==l?"maxerr"!==o.value||"/*jshint"!==l&&"/*jslint"!==l?"maxlen"!==o.value||"/*jshint"!==l&&"/*jslint"!==l?"validthis"===o.value?et["(global)"]?h("Option 'validthis' can't be used in a global scope."):"true"===a.value||"false"===a.value?t[o.value]="true"===a.value:h("Bad option value.",a):"true"===a.value||"false"===a.value?"/*jslint"===l?(s=It[o.value]||o.value,t[s]="true"===a.value,void 0!==Lt[s]&&(t[s]=!t[s])):t[o.value]="true"===a.value:h("Bad option value.",a):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&h("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxlen=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&h("Expected a small integer and instead saw '{a}'.",a,a.value),t.maxerr=e):(e=+a.value,("number"!=typeof e||!isFinite(e)||0>=e||Math.floor(e)!==e)&&h("Expected a small integer and instead saw '{a}'.",a,a.value),t.white=!0,t.indent=e),o=ei.token()):(("/*jshint"===l||"/*jslint"===l)&&h("Missing option value.",o),t[o.value]=!1,o=a)}n&&r()}function p(e){for(var t,i=e||0,n=0;i>=n;)t=lt[n],t||(t=lt[n]=ei.token()),n+=1;return t}function f(e,t){switch(Et.id){case"(number)":"."===ut.id&&a("A dot following a number can be confused with a decimal point.",Et);break;case"-":("-"===ut.id||"--"===ut.id)&&a("Confusing minusses.");break;case"+":("+"===ut.id||"++"===ut.id)&&a("Confusing plusses.")}for(("(string)"===Et.type||Et.identifier)&&(Z=Et.value),e&&ut.id!==e&&(t?"(end)"===ut.id?a("Unmatched '{a}'.",t,t.id):a("Expected '{a}' to match '{b}' from line {c} and instead saw '{d}'.",ut,e,t.id,t.line,ut.value):("(identifier)"!==ut.type||ut.value!==e)&&a("Expected '{a}' and instead saw '{b}'.",ut,e,ut.value)),gt=Et,Et=ut;;){if(ut=lt.shift()||ei.token(),"(end)"===ut.id||"(error)"===ut.id)return;if("special"===ut.type)d();else if("(endline)"!==ut.id)break}}function m(e,t){var i,n=!1,r=!1;if("(end)"===ut.id&&h("Unexpected early end of program.",Et),f(),t&&(Z="anonymous",et["(verb)"]=Et.value),t===!0&&Et.fud)i=Et.fud();else{if(Et.nud)i=Et.nud();else{if("(number)"===ut.type&&"."===Et.id)return a("A leading decimal point can be confused with a dot: '.{a}'.",Et,ut.value),f(),Et;h("Expected an identifier and instead saw '{a}'.",Et,Et.id)}for(;e<ut.lbp;)n="Array"===Et.value,r="Object"===Et.value,i&&(i.value||i.first&&i.first.value)&&("new"!==i.value||i.first&&i.first.value&&"."===i.first.value)&&(n=!1,i.value!==Et.value&&(r=!1)),f(),n&&"("===Et.id&&")"===ut.id&&a("Use the array literal notation [].",Et),r&&"("===Et.id&&")"===ut.id&&a("Use the object literal notation {}.",Et),Et.led?i=Et.led(i):h("Expected an operator and instead saw '{a}'.",Et,Et.id)}return i}function g(e,t){e=e||Et,t=t||ut,pt.white&&e.character!==t.from&&e.line===t.line&&(e.from+=e.character-e.from,a("Unexpected space after '{a}'.",e,e.value))}function v(e,t){e=e||Et,t=t||ut,!pt.white||e.character===t.from&&e.line===t.line||a("Unexpected space before '{a}'.",t,t.value)}function y(e,t){e=e||Et,t=t||ut,pt.white&&!e.comment&&e.line===t.line&&g(e,t)}function _(e,t){pt.white&&(e=e||Et,t=t||ut,e.line===t.line&&e.character===t.from&&(e.from+=e.character-e.from,a("Missing space after '{a}'.",e,e.value)))}function b(e,t){e=e||Et,t=t||ut,pt.laxbreak||e.line===t.line?pt.white&&(e=e||Et,t=t||ut,e.character===t.from&&(e.from+=e.character-e.from,a("Missing space after '{a}'.",e,e.value))):a("Bad line breaking before '{a}'.",t,t.id)}function E(e){var t;pt.white&&"(end)"!==ut.id&&(t=ot+(e||0),ut.from!==t&&a("Expected '{a}' to have an indentation at {b} instead at {c}.",ut,ut.value,t,ut.from))}function x(e){e=e||Et,e.line!==ut.line&&a("Line breaking error '{a}'.",e,e.value)}function T(){Et.line!==ut.line?pt.laxcomma||(T.first&&(a("Comma warnings can be turned off with 'laxcomma'"),T.first=!1),a("Bad line breaking before '{a}'.",Et,ut.id)):!Et.comment&&Et.character!==ut.from&&pt.white&&(Et.from+=Et.character-Et.from,a("Unexpected space after '{a}'.",Et,Et.value)),f(","),_(Et,ut)}function w(e,t){var i=Jt[e];return i&&"object"==typeof i||(Jt[e]=i={id:e,lbp:t,value:e}),i}function R(e){return w(e,0)}function S(e,t){var i=R(e);return i.identifier=i.reserved=!0,i.fud=t,i}function C(e,t){var i=S(e,t);return i.block=!0,i}function H(e){var t=e.id.charAt(0);return(t>="a"&&"z">=t||t>="A"&&"Z">=t)&&(e.identifier=e.reserved=!0),e}function M(e,t){var i=w(e,150);return H(i),i.nud="function"==typeof t?t:function(){return this.right=m(150),this.arity="unary",("++"===this.id||"--"===this.id)&&(pt.plusplus?a("Unexpected use of '{a}'.",this,this.id):this.right.identifier&&!this.right.reserved||"."===this.right.id||"["===this.right.id||a("Bad operand.",this)),this},i}function k(e,t){var i=R(e);return i.type=e,i.nud=t,i}function A(e,t){var i=k(e,t);return i.identifier=i.reserved=!0,i}function P(e,t){return A(e,function(){return"function"==typeof t&&t(this),this})}function F(e,t,i,n){var r=w(e,i);return H(r),r.led=function(r){return n||(b(gt,Et),_(Et,ut)),"in"===e&&"!"===r.id&&a("Confusing use of '{a}'.",r,"!"),"function"==typeof t?t(r,this):(this.left=r,this.right=m(i),this)},r}function D(e,t){var i=w(e,100);return i.led=function(e){b(gt,Et),_(Et,ut);var i=m(100);return e&&"NaN"===e.id||i&&"NaN"===i.id?a("Use the isNaN function to compare with NaN.",this):t&&t.apply(this,[e,i]),"!"===e.id&&a("Confusing use of '{a}'.",e,"!"),"!"===i.id&&a("Confusing use of '{a}'.",i,"!"),this.left=e,this.right=i,this},i}function N(e){return e&&("(number)"===e.type&&0===+e.value||"(string)"===e.type&&""===e.value||"null"===e.type&&!pt.eqnull||"true"===e.type||"false"===e.type||"undefined"===e.type)}function z(e){return w(e,20).exps=!0,F(e,function(e,t){if(t.left=e,ft[e.value]===!1&&vt[e.value]["(global)"]===!0?a("Read only.",e):e["function"]&&a("'{a}' is a function.",e,e.value),e){if(pt.esnext&&"const"===et[e.value]&&a("Attempting to override '{a}' which is a constant",e,e.value),"."===e.id||"["===e.id)return e.left&&"arguments"!==e.left.value||a("Bad assignment.",t),t.right=m(19),t;if(e.identifier&&!e.reserved)return"exception"===et[e.value]&&a("Do not assign to the exception parameter.",e),t.right=m(19),t;e===Jt["function"]&&a("Expected an identifier in an assignment and instead saw a function invocation.",Et)}h("Bad assignment.",t)},20)}function L(e,t,i){var n=w(e,i);return H(n),n.led="function"==typeof t?t:function(e){return pt.bitwise&&a("Unexpected use of '{a}'.",this,this.id),this.left=e,this.right=m(i),this},n}function I(e){return w(e,20).exps=!0,F(e,function(e,t){return pt.bitwise&&a("Unexpected use of '{a}'.",t,t.id),_(gt,Et),_(Et,ut),e?"."===e.id||"["===e.id||e.identifier&&!e.reserved?(m(19),t):(e===Jt["function"]&&a("Expected an identifier in an assignment, and instead saw a function invocation.",Et),t):(h("Bad assignment.",t),void 0)},20)}function O(e){var t=w(e,150);return t.led=function(e){return pt.plusplus?a("Unexpected use of '{a}'.",this,this.id):e.identifier&&!e.reserved||"."===e.id||"["===e.id||a("Bad operand.",this),this.left=e,this},t}function V(e){return ut.identifier?(f(),Et.reserved&&!pt.es5&&(e&&"undefined"===Et.value||a("Expected an identifier and instead saw '{a}' (a reserved word).",Et,Et.id)),Et.value):void 0}function B(e){var t=V(e);return t?t:("function"===Et.id&&"("===ut.id?a("Missing name in function declaration."):h("Expected an identifier and instead saw '{a}'.",ut,ut.value),void 0)}function U(e){var t,i=0;if(";"===ut.id&&!dt)for(;;){if(t=p(i),t.reach)return;if("(endline)"!==t.id){if("function"===t.id){if(!pt.latedef)break;a("Inner functions should be listed at the top of the outer function.",t);break}a("Unreachable '{a}' after '{b}'.",t,t.value,e);break}i+=1}}function j(e){var t,i=ot,n=vt,r=ut;if(";"===r.id)return f(";"),void 0;if(r.identifier&&!r.reserved&&":"===p().id&&(f(),f(":"),vt=Object.create(n),u(r.value,"label"),ut.labelled||a("Label '{a}' on {b} statement.",ut,r.value,ut.value),Pt.test(r.value+":")&&a("Label '{a}' looks like a javascript url.",r,r.value),ut.label=r.value,r=ut),e||E(),t=m(0,!0),!r.block){if(pt.expr||t&&t.exps?pt.nonew&&"("===t.id&&"new"===t.left.id&&a("Do not use 'new' for side effects."):a("Expected an assignment or function call and instead saw an expression.",Et),","===ut.id)return T();";"!==ut.id?pt.asi||pt.lastsemic&&"}"===ut.id&&ut.line===Et.line||l("Missing semicolon.",Et.line,Et.character):(g(Et,ut),f(";"),_(Et,ut))}return ot=i,vt=n,t}function W(e){for(var t,i=[];!ut.reach&&"(end)"!==ut.id;)";"===ut.id?(t=p(),t&&"("===t.id||a("Unnecessary semicolon."),f(";")):i.push(j(e===ut.line));return i}function $(){for(var e,t,i;"(string)"===ut.id;){if(t=p(0),"(endline)"===t.id){e=1;do i=p(e),e+=1;while("(endline)"===i.id);if(";"!==i.id){if("(string)"!==i.id&&"(number)"!==i.id&&"(regexp)"!==i.id&&i.identifier!==!0&&"}"!==i.id)break;a("Missing semicolon.",ut)}else t=i}else if("}"===t.id)a("Missing semicolon.",t);else if(";"!==t.id)break;E(),f(),_t[Et.value]&&a('Unnecessary directive "{a}".',Et,Et.value),"use strict"===Et.value&&(pt.newcap=!0,pt.undef=!0),_t[Et.value]=!0,";"===t.id&&f(";")}}function G(e,i,n){var r,o,s,l,c,u=rt,d=ot,p=vt;if(rt=e,e&&pt.funcscope||(vt=Object.create(vt)),_(Et,ut),s=ut,"{"===ut.id){if(f("{"),l=Et.line,"}"!==ut.id){for(ot+=pt.indent;!e&&ut.from>ot;)ot+=pt.indent;if(n){o={};for(c in _t)t(_t,c)&&(o[c]=_t[c]);$(),pt.strict&&et["(context)"]["(global)"]&&(o["use strict"]||_t["use strict"]||a('Missing "use strict" statement.'))}r=W(l),n&&(_t=o),ot-=pt.indent,l!==ut.line&&E()}else l!==ut.line&&E();f("}",s),ot=d}else e?((!i||pt.curly)&&a("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value),dt=!0,ot+=pt.indent,r=[j(ut.line===Et.line)],ot-=pt.indent,dt=!1):h("Expected '{a}' and instead saw '{b}'.",ut,"{",ut.value);return et["(verb)"]=null,e&&pt.funcscope||(vt=p),rt=u,!e||!pt.noempty||r&&0!==r.length||a("Empty block."),r}function q(e){ct&&"boolean"!=typeof ct[e]&&a("Unexpected /*member '{a}'.",Et,e),"number"==typeof ht[e]?ht[e]+=1:ht[e]=1}function X(e){var t=e.value,i=e.line,n=nt[t];"function"==typeof n&&(n=!1),n?n[n.length-1]!==i&&n.push(i):(n=[i],nt[t]=n)}function Y(){var e=V(!0);return e||("(string)"===ut.id?(e=ut.value,f()):"(number)"===ut.id&&(e=ut.value.toString(),f())),e}function K(){var e,t=ut,i=[];if(f("("),y(),")"===ut.id)return f(")"),void 0;for(;;){if(e=B(!0),i.push(e),u(e,"parameter"),","!==ut.id)return f(")",t),y(gt,Et),i;T()}}function Q(e,t){var i,n=pt,r=vt;return pt=Object.create(pt),vt=Object.create(vt),et={"(name)":e||'"'+Z+'"',"(line)":ut.line,"(context)":et,"(breakage)":0,"(loopage)":0,"(scope)":vt,"(statement)":t},i=et,Et.funct=et,tt.push(et),e&&u(e,"function"),et["(params)"]=K(),G(!1,!1,!0),vt=r,pt=n,et["(last)"]=Et.line,et=et["(context)"],i}function J(){function e(){var e={},t=ut;if(f("{"),"}"!==ut.id)for(;;){if("(end)"===ut.id)h("Missing '}' to match '{' from line {a}.",ut,t.line);else{if("}"===ut.id){a("Unexpected comma.",Et);break}","===ut.id?h("Unexpected comma.",ut):"(string)"!==ut.id&&a("Expected a string and instead saw {a}.",ut,ut.value)}if(e[ut.value]===!0?a("Duplicate key '{a}'.",ut,ut.value):"__proto__"===ut.value&&!pt.proto||"__iterator__"===ut.value&&!pt.iterator?a("The '{a}' key may produce unexpected results.",ut,ut.value):e[ut.value]=!0,f(),f(":"),J(),","!==ut.id)break;f(",")}f("}")}function t(){var e=ut;if(f("["),"]"!==ut.id)for(;;){if("(end)"===ut.id)h("Missing ']' to match '[' from line {a}.",ut,e.line);else{if("]"===ut.id){a("Unexpected comma.",Et);break}","===ut.id&&h("Unexpected comma.",ut)}if(J(),","!==ut.id)break;f(",")}f("]")}switch(ut.id){case"{":e();break;case"[":t();break;case"true":case"false":case"null":case"(number)":case"(string)":f();break;case"-":f("-"),Et.character!==ut.from&&a("Unexpected space after '-'.",Et),g(Et,ut),f("(number)");break;default:h("Expected a JSON value.",ut)}}var Z,et,tt,it,nt,rt,ot,st,at,lt,ht,ct,ut,dt,pt,ft,mt,gt,vt,yt,_t,bt,Et,xt,Tt,wt,Rt,St,Ct,Ht,Mt,kt,At,Pt,Ft,Dt={"<":!0,"<=":!0,"==":!0,"===":!0,"!==":!0,"!=":!0,">":!0,">=":!0,"+":!0,"-":!0,"*":!0,"/":!0,"%":!0},Nt={asi:!0,bitwise:!0,boss:!0,browser:!0,couch:!0,curly:!0,debug:!0,devel:!0,dojo:!0,eqeqeq:!0,eqnull:!0,es5:!0,esnext:!0,evil:!0,expr:!0,forin:!0,funcscope:!0,globalstrict:!0,immed:!0,iterator:!0,jquery:!0,lastsemic:!0,latedef:!0,laxbreak:!0,laxcomma:!0,loopfunc:!0,mootools:!0,multistr:!0,newcap:!0,noarg:!0,node:!0,noempty:!0,nonew:!0,nonstandard:!0,nomen:!0,onevar:!0,onecase:!0,passfail:!0,plusplus:!0,proto:!0,prototypejs:!0,regexdash:!0,regexp:!0,rhino:!0,undef:!0,scripturl:!0,shadow:!0,smarttabs:!0,strict:!0,sub:!0,supernew:!0,trailing:!0,validthis:!0,withstmt:!0,white:!0,wsh:!0},zt={maxlen:!1,indent:!1,maxerr:!1,predef:!1},Lt={bitwise:!0,forin:!0,newcap:!0,nomen:!0,plusplus:!0,regexp:!0,undef:!0,white:!0,eqeqeq:!0,onevar:!0},It={eqeq:"eqeqeq",vars:"onevar",windows:"wsh"},Ot={ArrayBuffer:!1,ArrayBufferView:!1,Audio:!1,addEventListener:!1,applicationCache:!1,atob:!1,blur:!1,btoa:!1,clearInterval:!1,clearTimeout:!1,close:!1,closed:!1,DataView:!1,DOMParser:!1,defaultStatus:!1,document:!1,event:!1,FileReader:!1,Float32Array:!1,Float64Array:!1,FormData:!1,focus:!1,frames:!1,getComputedStyle:!1,HTMLElement:!1,HTMLAnchorElement:!1,HTMLBaseElement:!1,HTMLBlockquoteElement:!1,HTMLBodyElement:!1,HTMLBRElement:!1,HTMLButtonElement:!1,HTMLCanvasElement:!1,HTMLDirectoryElement:!1,HTMLDivElement:!1,HTMLDListElement:!1,HTMLFieldSetElement:!1,HTMLFontElement:!1,HTMLFormElement:!1,HTMLFrameElement:!1,HTMLFrameSetElement:!1,HTMLHeadElement:!1,HTMLHeadingElement:!1,HTMLHRElement:!1,HTMLHtmlElement:!1,HTMLIFrameElement:!1,HTMLImageElement:!1,HTMLInputElement:!1,HTMLIsIndexElement:!1,HTMLLabelElement:!1,HTMLLayerElement:!1,HTMLLegendElement:!1,HTMLLIElement:!1,HTMLLinkElement:!1,HTMLMapElement:!1,HTMLMenuElement:!1,HTMLMetaElement:!1,HTMLModElement:!1,HTMLObjectElement:!1,HTMLOListElement:!1,HTMLOptGroupElement:!1,HTMLOptionElement:!1,HTMLParagraphElement:!1,HTMLParamElement:!1,HTMLPreElement:!1,HTMLQuoteElement:!1,HTMLScriptElement:!1,HTMLSelectElement:!1,HTMLStyleElement:!1,HTMLTableCaptionElement:!1,HTMLTableCellElement:!1,HTMLTableColElement:!1,HTMLTableElement:!1,HTMLTableRowElement:!1,HTMLTableSectionElement:!1,HTMLTextAreaElement:!1,HTMLTitleElement:!1,HTMLUListElement:!1,HTMLVideoElement:!1,history:!1,Int16Array:!1,Int32Array:!1,Int8Array:!1,Image:!1,length:!1,localStorage:!1,location:!1,MessageChannel:!1,MessageEvent:!1,MessagePort:!1,moveBy:!1,moveTo:!1,name:!1,navigator:!1,onbeforeunload:!0,onblur:!0,onerror:!0,onfocus:!0,onload:!0,onresize:!0,onunload:!0,open:!1,openDatabase:!1,opener:!1,Option:!1,parent:!1,print:!1,removeEventListener:!1,resizeBy:!1,resizeTo:!1,screen:!1,scroll:!1,scrollBy:!1,scrollTo:!1,sessionStorage:!1,setInterval:!1,setTimeout:!1,SharedWorker:!1,status:!1,top:!1,Uint16Array:!1,Uint32Array:!1,Uint8Array:!1,WebSocket:!1,window:!1,Worker:!1,XMLHttpRequest:!1,XMLSerializer:!1,XPathEvaluator:!1,XPathException:!1,XPathExpression:!1,XPathNamespace:!1,XPathNSResolver:!1,XPathResult:!1},Vt={require:!1,respond:!1,getRow:!1,emit:!1,send:!1,start:!1,sum:!1,log:!1,exports:!1,module:!1,provides:!1},Bt={alert:!1,confirm:!1,console:!1,Debug:!1,opera:!1,prompt:!1},Ut={dojo:!1,dijit:!1,dojox:!1,define:!1,require:!1},jt={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"/":"\\/","\\":"\\\\"},Wt=["closure","exception","global","label","outer","unused","var"],$t={$:!1,jQuery:!1},Gt={$:!1,$$:!1,Assets:!1,Browser:!1,Chain:!1,Class:!1,Color:!1,Cookie:!1,Core:!1,Document:!1,DomReady:!1,DOMReady:!1,Drag:!1,Element:!1,Elements:!1,Event:!1,Events:!1,Fx:!1,Group:!1,Hash:!1,HtmlTable:!1,Iframe:!1,IframeShim:!1,InputValidator:!1,instanceOf:!1,Keyboard:!1,Locale:!1,Mask:!1,MooTools:!1,Native:!1,Options:!1,OverText:!1,Request:!1,Scroller:!1,Slick:!1,Slider:!1,Sortables:!1,Spinner:!1,Swiff:!1,Tips:!1,Type:!1,typeOf:!1,URI:!1,Window:!1},qt={__filename:!1,__dirname:!1,Buffer:!1,console:!1,exports:!1,GLOBAL:!1,global:!1,module:!1,process:!1,require:!1,setTimeout:!1,clearTimeout:!1,setInterval:!1,clearInterval:!1},Xt={$:!1,$$:!1,$A:!1,$F:!1,$H:!1,$R:!1,$break:!1,$continue:!1,$w:!1,Abstract:!1,Ajax:!1,Class:!1,Enumerable:!1,Element:!1,Event:!1,Field:!1,Form:!1,Hash:!1,Insertion:!1,ObjectRange:!1,PeriodicalExecuter:!1,Position:!1,Prototype:!1,Selector:!1,Template:!1,Toggle:!1,Try:!1,Autocompleter:!1,Builder:!1,Control:!1,Draggable:!1,Draggables:!1,Droppables:!1,Effect:!1,Sortable:!1,SortableObserver:!1,Sound:!1,Scriptaculous:!1},Yt={defineClass:!1,deserialize:!1,gc:!1,help:!1,importPackage:!1,java:!1,load:!1,loadClass:!1,print:!1,quit:!1,readFile:!1,readUrl:!1,runCommand:!1,seal:!1,serialize:!1,spawn:!1,sync:!1,toint32:!1,version:!1},Kt={Array:!1,Boolean:!1,Date:!1,decodeURI:!1,decodeURIComponent:!1,encodeURI:!1,encodeURIComponent:!1,Error:!1,eval:!1,EvalError:!1,Function:!1,hasOwnProperty:!1,isFinite:!1,isNaN:!1,JSON:!1,Math:!1,Number:!1,Object:!1,parseInt:!1,parseFloat:!1,RangeError:!1,ReferenceError:!1,RegExp:!1,String:!1,SyntaxError:!1,TypeError:!1,URIError:!1},Qt={escape:!1,unescape:!1},Jt={},Zt={ActiveXObject:!0,Enumerator:!0,GetObject:!0,ScriptEngine:!0,ScriptEngineBuildVersion:!0,ScriptEngineMajorVersion:!0,ScriptEngineMinorVersion:!0,VBArray:!0,WSH:!0,WScript:!0,XDomainRequest:!0};!function(){Rt=/@cc|<\/?|script|\]\s*\]|<\s*!|&lt/i,St=/[\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Ct=/^\s*([(){}\[.,:;'"~\?\]#@]|==?=?|\/(\*(jshint|jslint|members?|global)?|=|\/)?|\*[\/=]?|\+(?:=|\++)?|-(?:=|-+)?|%=?|&[&=]?|\|[|=]?|>>?>?=?|<([\/=!]|\!(\[|--)?|<=?)?|\^=?|\!=?=?|[a-zA-Z_$][a-zA-Z0-9_$]*|[0-9]+([xX][0-9a-fA-F]+|\.[0-9]*)?([eE][+\-]?[0-9]+)?)/,Ht=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/,Mt=/[\u0000-\u001f&<"\/\\\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,kt=/\*\/|\/\*/,At=/^([a-zA-Z_$][a-zA-Z0-9_$]*)$/,Pt=/^(?:javascript|jscript|ecmascript|vbscript|mocha|livescript)\s*:/i,Ft=/^\s*\/\*\s*falls\sthrough\s*\*\/\s*$/}(),"function"!=typeof Array.isArray&&(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.apply(e)}),"function"!=typeof Object.create&&(Object.create=function(t){return e.prototype=t,new e}),"function"!=typeof Object.keys&&(Object.keys=function(e){var i,n=[];for(i in e)t(e,i)&&n.push(i);return n}),"function"!=typeof String.prototype.entityify&&(String.prototype.entityify=function(){return this.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}),"function"!=typeof String.prototype.isAlpha&&(String.prototype.isAlpha=function(){return this>="a"&&"z">=this||this>="A"&&"Z">=this}),"function"!=typeof String.prototype.isDigit&&(String.prototype.isDigit=function(){return this>="0"&&"9">=this}),"function"!=typeof String.prototype.supplant&&(String.prototype.supplant=function(e){return this.replace(/\{([^{}]*)\}/g,function(t,i){var n=e[i];return"string"==typeof n||"number"==typeof n?n:t})}),"function"!=typeof String.prototype.name&&(String.prototype.name=function(){return At.test(this)?this:Ht.test(this)?'"'+this.replace(Mt,function(e){var t=jt[e];return t?t:"\\u"+("0000"+e.charCodeAt().toString(16)).slice(-4)})+'"':'"'+this+'"'});var ei=function(){function e(){var e,t;return s>=at.length?!1:(n=1,a=at[s],s+=1,e=pt.smarttabs?a.search(/ \t/):a.search(/ \t|\t /),e>=0&&l("Mixed spaces and tabs.",s,e+1),a=a.replace(/\t/g,bt),e=a.search(St),e>=0&&l("Unsafe character.",s,e),pt.maxlen&&pt.maxlen<a.length&&l("Line too long.",s,a.length),t=pt.trailing&&a.match(/^(.*?)\s+$/),t&&!/^\s+$/.test(a)&&l("Trailing whitespace.",s,t[1].length+1),!0)}function i(e,i){var o,a;return a="(color)"===e||"(range)"===e?{type:e}:"(punctuator)"===e||"(identifier)"===e&&t(Jt,i)?Jt[i]||Jt["(error)"]:Jt[e],a=Object.create(a),("(string)"===e||"(range)"===e)&&!pt.scripturl&&Pt.test(i)&&l("Script URL.",s,r),"(identifier)"===e&&(a.identifier=!0,"__proto__"!==i||pt.proto?"__iterator__"!==i||pt.iterator?!pt.nomen||"_"!==i.charAt(0)&&"_"!==i.charAt(i.length-1)||(!pt.node||"."===Et.id||"__dirname"!==i&&"__filename"!==i)&&l("Unexpected {a} in '{b}'.",s,r,"dangling '_'",i):l("'{a}' is only available in JavaScript 1.7.",s,r,i):l("The '{a}' property is deprecated.",s,r,i)),a.value=i,a.line=s,a.character=n,a.from=r,o=a.id,"(endline)"!==o&&(mt=o&&("(,=:[!&|?{};".indexOf(o.charAt(o.length-1))>=0||"return"===o||"case"===o)),a}var n,r,s,a;return{init:function(t){at="string"==typeof t?t.replace(/\r\n/g,"\n").replace(/\r/g,"\n").split("\n"):t,at[0]&&"#!"===at[0].substr(0,2)&&(at[0]=""),s=0,e(),r=1},range:function(e,t){var o,h="";for(r=n,a.charAt(0)!==e&&c("Expected '{a}' and instead saw '{b}'.",s,n,e,a.charAt(0));;){switch(a=a.slice(1),n+=1,o=a.charAt(0)){case"":c("Missing '{a}'.",s,n,o);break;case t:return a=a.slice(1),n+=1,i("(range)",h);case"\\":l("Unexpected '{a}'.",s,n,o)}h+=o}},token:function(){function t(e){var t,i=e.exec(a);return i?(y=i[0].length,t=i[1],d=t.charAt(0),a=a.substr(y),r=n+y-t.length,n+=y,t):void 0}function h(t){function o(e){var t=parseInt(a.substr(u+1,e),16);u+=e,t>=32&&126>=t&&34!==t&&92!==t&&39!==t&&l("Unnecessary escapement.",s,n),n+=e,h=String.fromCharCode(t)}var h,u,d="",p=!1;st&&'"'!==t&&l("Strings must use doublequote.",s,n),u=0;e:for(;;){for(;u>=a.length;){u=0;var f=s,m=r;if(!e()){c("Unclosed string.",f,m);break e}p?p=!1:l("Unclosed string.",f,m)}if(h=a.charAt(u),h===t)return n+=1,a=a.substr(u+1),i("(string)",d,t);if(" ">h){if("\n"===h||"\r"===h)break;l("Control character in string: {a}.",s,n+u,a.slice(0,u))}else if("\\"===h)switch(u+=1,n+=1,h=a.charAt(u),w=a.charAt(u+1),h){case"\\":case'"':case"/":break;case"'":st&&l("Avoid \\'.",s,n);break;case"b":h="\b";break;case"f":h="\f";break;case"n":h="\n";break;case"r":h="\r";break;case"t":h="	";break;case"0":h="\0",w>=0&&7>=w&&_t["use strict"]&&l("Octal literals are not allowed in strict mode.",s,n);break;case"u":o(4);break;case"v":st&&l("Avoid \\v.",s,n),h="";break;case"x":st&&l("Avoid \\x-.",s,n),o(2);break;case"":if(p=!0,pt.multistr){st&&l("Avoid EOL escapement.",s,n),h="",n-=1;break}l("Bad escapement of EOL. Use option multistr if needed.",s,n);break;default:l("Bad escapement.",s,n)}d+=h,n+=1,u+=1}}for(var u,d,p,f,m,g,v,y,_,b,E,x,T,w;;){if(!a)return i(e()?"(endline)":"(end)","");if(E=t(Ct)){if(d.isAlpha()||"_"===d||"$"===d)return i("(identifier)",E);if(d.isDigit())return isFinite(Number(E))||l("Bad number '{a}'.",s,n,E),a.substr(0,1).isAlpha()&&l("Missing space after '{a}'.",s,n,E),"0"===d&&(f=E.substr(1,1),f.isDigit()?"."!==Et.id&&l("Don't use extra leading zeros '{a}'.",s,n,E):!st||"x"!==f&&"X"!==f||l("Avoid 0x-. '{a}'.",s,n,E)),"."===E.substr(E.length-1)&&l("A trailing decimal point can be confused with a dot '{a}'.",s,n,E),i("(number)",E);switch(E){case'"':case"'":return h(E);case"//":a="",Et.comment=!0;break;case"/*":for(;v=a.search(kt),!(v>=0);)e()||c("Unclosed comment.",s,n);n+=v+2,"/"===a.substr(v,1)&&c("Nested comment.",s,n),a=a.substr(v+2),Et.comment=!0;break;case"/*members":case"/*member":case"/*jshint":case"/*jslint":case"/*global":case"*/":return{value:E,type:"special",line:s,character:n,from:r};case"":break;case"/":if("/="===Et.id&&c("A regular expression literal can be confused with '/='.",s,r),mt){for(m=0,p=0,y=0;;){switch(u=!0,d=a.charAt(y),y+=1,d){case"":return c("Unclosed regular expression.",s,r),o("Stopping.",s,r);case"/":for(m>0&&l("{a} unterminated regular expression group(s).",s,r+y,m),d=a.substr(0,y-1),b={g:!0,i:!0,m:!0};b[a.charAt(y)]===!0;)b[a.charAt(y)]=!1,y+=1;return n+=y,a=a.substr(y),b=a.charAt(0),("/"===b||"*"===b)&&c("Confusing regular expression.",s,r),i("(regexp)",d);case"\\":d=a.charAt(y)," ">d?l("Unexpected control character in regular expression.",s,r+y):"<"===d&&l("Unexpected escaped character '{a}' in regular expression.",s,r+y,d),y+=1;break;case"(":if(m+=1,u=!1,"?"===a.charAt(y))switch(y+=1,a.charAt(y)){case":":case"=":case"!":y+=1;break;default:l("Expected '{a}' and instead saw '{b}'.",s,r+y,":",a.charAt(y))}else p+=1;break;case"|":u=!1;break;case")":0===m?l("Unescaped '{a}'.",s,r+y,")"):m-=1;break;case" ":for(b=1;" "===a.charAt(y);)y+=1,b+=1;b>1&&l("Spaces are hard to count. Use {{a}}.",s,r+y,b);break;case"[":d=a.charAt(y),"^"===d&&(y+=1,pt.regexp?l("Insecure '{a}'.",s,r+y,d):"]"===a.charAt(y)&&c("Unescaped '{a}'.",s,r+y,"^")),"]"===d&&l("Empty class.",s,r+y-1),x=!1,T=!1;e:do switch(d=a.charAt(y),y+=1,d){case"[":case"^":l("Unescaped '{a}'.",s,r+y,d),T?T=!1:x=!0;break;case"-":x&&!T?(x=!1,T=!0):T?T=!1:"]"===a.charAt(y)?T=!0:(pt.regexdash!==(2===y||3===y&&"^"===a.charAt(1))&&l("Unescaped '{a}'.",s,r+y-1,"-"),x=!0);break;case"]":T&&!pt.regexdash&&l("Unescaped '{a}'.",s,r+y-1,"-");break e;case"\\":d=a.charAt(y)," ">d?l("Unexpected control character in regular expression.",s,r+y):"<"===d&&l("Unexpected escaped character '{a}' in regular expression.",s,r+y,d),y+=1,/[wsd]/i.test(d)?(T&&(l("Unescaped '{a}'.",s,r+y,"-"),T=!1),x=!1):T?T=!1:x=!0;break;case"/":l("Unescaped '{a}'.",s,r+y-1,"/"),T?T=!1:x=!0;break;case"<":T?T=!1:x=!0;break;default:T?T=!1:x=!0}while(d);break;case".":pt.regexp&&l("Insecure '{a}'.",s,r+y,d);break;case"]":case"?":case"{":case"}":case"+":case"*":l("Unescaped '{a}'.",s,r+y,d)}if(u)switch(a.charAt(y)){case"?":case"+":case"*":y+=1,"?"===a.charAt(y)&&(y+=1);break;case"{":for(y+=1,d=a.charAt(y),("0">d||d>"9")&&l("Expected a number and instead saw '{a}'.",s,r+y,d),y+=1,_=+d;d=a.charAt(y),!("0">d||d>"9");)y+=1,_=+d+10*_;if(g=_,","===d&&(y+=1,g=1/0,d=a.charAt(y),d>="0"&&"9">=d))for(y+=1,g=+d;d=a.charAt(y),!("0">d||d>"9");)y+=1,g=+d+10*g;"}"!==a.charAt(y)?l("Expected '{a}' and instead saw '{b}'.",s,r+y,"}",d):y+=1,"?"===a.charAt(y)&&(y+=1),_>g&&l("'{a}' should not be greater than '{b}'.",s,r+y,_,g)}}return d=a.substr(0,y-1),n+=y,a=a.substr(y),i("(regexp)",d)}return i("(punctuator)",E);case"#":return i("(punctuator)",E);default:return i("(punctuator)",E)}}else{for(E="",d="";a&&"!">a;)a=a.substr(1);a&&(c("Unexpected '{a}'.",s,n,a.substr(0,1)),a="")}}}}}();k("(number)",function(){return this}),k("(string)",function(){return this}),Jt["(identifier)"]={type:"(identifier)",lbp:0,identifier:!0,nud:function(){var e,t=this.value,i=vt[t];if("function"==typeof i?i=void 0:"boolean"==typeof i&&(e=et,et=tt[0],u(t,"var"),i=et,et=e),et===i)switch(et[t]){case"unused":et[t]="var";break;case"unction":et[t]="function",this["function"]=!0;break;case"function":this["function"]=!0;break;case"label":a("'{a}' is a statement label.",Et,t)}else if(et["(global)"])pt.undef&&"boolean"!=typeof ft[t]&&("typeof"!==Z&&"delete"!==Z||ut&&("."===ut.value||"["===ut.value))&&s(et,"'{a}' is not defined.",Et,t),X(Et);else switch(et[t]){case"closure":case"function":case"var":case"unused":a("'{a}' used out of scope.",Et,t);break;case"label":a("'{a}' is a statement label.",Et,t);break;case"outer":case"global":break;default:if(i===!0)et[t]=!0;else if(null===i)a("'{a}' is not allowed.",Et,t),X(Et);else if("object"!=typeof i)pt.undef&&("typeof"!==Z&&"delete"!==Z||ut&&("."===ut.value||"["===ut.value))&&s(et,"'{a}' is not defined.",Et,t),et[t]=!0,X(Et);else switch(i[t]){case"function":case"unction":this["function"]=!0,i[t]="closure",et[t]=i["(global)"]?"global":"outer";break;case"var":case"unused":i[t]="closure",et[t]=i["(global)"]?"global":"outer";break;case"closure":case"parameter":et[t]=i["(global)"]?"global":"outer";break;case"label":a("'{a}' is a statement label.",Et,t)}}return this},led:function(){h("Expected an operator and instead saw '{a}'.",ut,ut.value)}},k("(regexp)",function(){return this}),R("(endline)"),R("(begin)"),R("(end)").reach=!0,R("</").reach=!0,R("<!"),R("<!--"),R("-->"),R("(error)").reach=!0,R("}").reach=!0,R(")"),R("]"),R('"').reach=!0,R("'").reach=!0,R(";"),R(":").reach=!0,R(","),R("#"),R("@"),A("else"),A("case").reach=!0,A("catch"),A("default").reach=!0,A("finally"),P("arguments",function(e){_t["use strict"]&&et["(global)"]&&a("Strict violation.",e)}),P("eval"),P("false"),P("Infinity"),P("NaN"),P("null"),P("this",function(e){_t["use strict"]&&!pt.validthis&&(et["(statement)"]&&et["(name)"].charAt(0)>"Z"||et["(global)"])&&a("Possible strict violation.",e)}),P("true"),P("undefined"),z("=","assign",20),z("+=","assignadd",20),z("-=","assignsub",20),z("*=","assignmult",20),z("/=","assigndiv",20).nud=function(){h("A regular expression literal can be confused with '/='.")},z("%=","assignmod",20),I("&=","assignbitand",20),I("|=","assignbitor",20),I("^=","assignbitxor",20),I("<<=","assignshiftleft",20),I(">>=","assignshiftright",20),I(">>>=","assignshiftrightunsigned",20),F("?",function(e,t){return t.left=e,t.right=m(10),f(":"),t["else"]=m(10),t
},30),F("||","or",40),F("&&","and",50),L("|","bitor",70),L("^","bitxor",80),L("&","bitand",90),D("==",function(e,t){var i=pt.eqnull&&("null"===e.value||"null"===t.value);return!i&&pt.eqeqeq?a("Expected '{a}' and instead saw '{b}'.",this,"===","=="):N(e)?a("Use '{a}' to compare with '{b}'.",this,"===",e.value):N(t)&&a("Use '{a}' to compare with '{b}'.",this,"===",t.value),this}),D("==="),D("!=",function(e,t){var i=pt.eqnull&&("null"===e.value||"null"===t.value);return!i&&pt.eqeqeq?a("Expected '{a}' and instead saw '{b}'.",this,"!==","!="):N(e)?a("Use '{a}' to compare with '{b}'.",this,"!==",e.value):N(t)&&a("Use '{a}' to compare with '{b}'.",this,"!==",t.value),this}),D("!=="),D("<"),D(">"),D("<="),D(">="),L("<<","shiftleft",120),L(">>","shiftright",120),L(">>>","shiftrightunsigned",120),F("in","in",120),F("instanceof","instanceof",120),F("+",function(e,t){var i=m(130);return e&&i&&"(string)"===e.id&&"(string)"===i.id?(e.value+=i.value,e.character=i.character,!pt.scripturl&&Pt.test(e.value)&&a("JavaScript URL.",e),e):(t.left=e,t.right=i,t)},130),M("+","num"),M("+++",function(){return a("Confusing pluses."),this.right=m(150),this.arity="unary",this}),F("+++",function(e){return a("Confusing pluses."),this.left=e,this.right=m(130),this},130),F("-","sub",130),M("-","neg"),M("---",function(){return a("Confusing minuses."),this.right=m(150),this.arity="unary",this}),F("---",function(e){return a("Confusing minuses."),this.left=e,this.right=m(130),this},130),F("*","mult",140),F("/","div",140),F("%","mod",140),O("++","postinc"),M("++","preinc"),Jt["++"].exps=!0,O("--","postdec"),M("--","predec"),Jt["--"].exps=!0,M("delete",function(){var e=m(0);return(!e||"."!==e.id&&"["!==e.id)&&a("Variables should not be deleted."),this.first=e,this}).exps=!0,M("~",function(){return pt.bitwise&&a("Unexpected '{a}'.",this,"~"),m(150),this}),M("!",function(){return this.right=m(150),this.arity="unary",Dt[this.right.id]===!0&&a("Confusing use of '{a}'.",this,"!"),this}),M("typeof","typeof"),M("new",function(){var e,t=m(155);if(t&&"function"!==t.id)if(t.identifier)switch(t["new"]=!0,t.value){case"Number":case"String":case"Boolean":case"Math":case"JSON":a("Do not use {a} as a constructor.",Et,t.value);break;case"Function":pt.evil||a("The Function constructor is eval.");break;case"Date":case"RegExp":break;default:"function"!==t.id&&(e=t.value.substr(0,1),pt.newcap&&("A">e||e>"Z")&&a("A constructor name should start with an uppercase letter.",Et))}else"."!==t.id&&"["!==t.id&&"("!==t.id&&a("Bad constructor.",Et);else pt.supernew||a("Weird construction. Delete 'new'.",this);return g(Et,ut),"("===ut.id||pt.supernew||a("Missing '()' invoking a constructor."),this.first=t,this}),Jt["new"].exps=!0,M("void").exps=!0,F(".",function(e,t){g(gt,Et),v();var i=B();return"string"==typeof i&&q(i),t.left=e,t.right=i,!e||"arguments"!==e.value||"callee"!==i&&"caller"!==i?pt.evil||!e||"document"!==e.value||"write"!==i&&"writeln"!==i||a("document.write can be a form of eval.",e):pt.noarg?a("Avoid arguments.{a}.",e,i):_t["use strict"]&&h("Strict violation."),pt.evil||"eval"!==i&&"execScript"!==i||a("eval is evil."),t},160,!0),F("(",function(e,t){"}"!==gt.id&&")"!==gt.id&&v(gt,Et),y(),pt.immed&&!e.immed&&"function"===e.id&&a("Wrap an immediate function invocation in parentheses to assist the reader in understanding that the expression is the result of a function, and not the function itself.");var i=0,n=[];if(e&&"(identifier)"===e.type&&e.value.match(/^[A-Z]([A-Z0-9_$]*[a-z][A-Za-z0-9_$]*)?$/)&&"Number"!==e.value&&"String"!==e.value&&"Boolean"!==e.value&&"Date"!==e.value&&("Math"===e.value?a("Math is not a function.",e):pt.newcap&&a("Missing 'new' prefix when invoking a constructor.",e)),")"!==ut.id)for(;n[n.length]=m(10),i+=1,","===ut.id;)T();return f(")"),y(gt,Et),"object"==typeof e&&("parseInt"===e.value&&1===i&&a("Missing radix parameter.",e),pt.evil||("eval"===e.value||"Function"===e.value||"execScript"===e.value?a("eval is evil.",e):!n[0]||"(string)"!==n[0].id||"setTimeout"!==e.value&&"setInterval"!==e.value||a("Implied eval is evil. Pass a function instead of a string.",e)),e.identifier||"."===e.id||"["===e.id||"("===e.id||"&&"===e.id||"||"===e.id||"?"===e.id||a("Bad invocation.",e)),t.left=e,t},155,!0).exps=!0,M("(",function(){y(),"function"===ut.id&&(ut.immed=!0);var e=m(0);return f(")",this),y(gt,Et),pt.immed&&"function"===e.id&&("("===ut.id||"."===ut.id&&("call"===p().value||"apply"===p().value)?a("Move the invocation into the parens that contain the function.",ut):a("Do not wrap function literals in parens unless they are to be immediately invoked.",this)),e}),F("[",function(e,t){v(gt,Et),y();var i,n=m(0);return n&&"(string)"===n.type&&(pt.evil||"eval"!==n.value&&"execScript"!==n.value||a("eval is evil.",t),q(n.value),!pt.sub&&At.test(n.value)&&(i=Jt[n.value],i&&i.reserved||a("['{a}'] is better written in dot notation.",n,n.value))),f("]",t),y(gt,Et),t.left=e,t.right=n,t},160,!0),M("[",function(){var e=Et.line!==ut.line;for(this.first=[],e&&(ot+=pt.indent,ut.from===ot+pt.indent&&(ot+=pt.indent));"(end)"!==ut.id;){for(;","===ut.id;)a("Extra comma."),f(",");if("]"===ut.id)break;if(e&&Et.line!==ut.line&&E(),this.first.push(m(10)),","!==ut.id)break;if(T(),"]"===ut.id&&!pt.es5){a("Extra comma.",Et);break}}return e&&(ot-=pt.indent,E()),f("]",this),this},160),function(e){e.nud=function(){function e(e,i){u[e]&&t(u,e)?a("Duplicate member '{a}'.",ut,s):u[e]={},u[e].basic=!0,u[e].basicToken=i}function i(e,i){u[e]&&t(u,e)?(u[e].basic||u[e].setter)&&a("Duplicate member '{a}'.",ut,s):u[e]={},u[e].setter=!0,u[e].setterToken=i}function n(e){u[e]&&t(u,e)?(u[e].basic||u[e].getter)&&a("Duplicate member '{a}'.",ut,s):u[e]={},u[e].getter=!0,u[e].getterToken=Et}var r,o,s,l,c,u={};for(r=Et.line!==ut.line,r&&(ot+=pt.indent,ut.from===ot+pt.indent&&(ot+=pt.indent));"}"!==ut.id;){if(r&&E(),"get"===ut.value&&":"!==p().id)f("get"),pt.es5||h("get/set are ES5 features."),s=Y(),s||h("Missing property name."),n(s),c=ut,g(Et,ut),o=Q(),l=o["(params)"],l&&a("Unexpected parameter '{a}' in get {b} function.",c,l[0],s),g(Et,ut);else if("set"===ut.value&&":"!==p().id)f("set"),pt.es5||h("get/set are ES5 features."),s=Y(),s||h("Missing property name."),i(s,ut),c=ut,g(Et,ut),o=Q(),l=o["(params)"],l&&1===l.length||a("Expected a single parameter in set {a} function.",c,s);else{if(s=Y(),e(s,ut),"string"!=typeof s)break;f(":"),_(Et,ut),m(10)}if(q(s),","!==ut.id)break;T(),","===ut.id?a("Extra comma.",Et):"}"!==ut.id||pt.es5||a("Extra comma.",Et)}if(r&&(ot-=pt.indent,E()),f("}",this),pt.es5)for(var d in u)t(u,d)&&u[d].setter&&!u[d].getter&&a("Setter is defined without getter.",u[d].setterToken);return this},e.fud=function(){h("Expected to see a statement and instead saw a block.",Et)}}(R("{")),Tt=function(){var e=S("const",function(e){var t,i,n;for(this.first=[];(_(Et,ut),t=B(),"const"===et[t]&&a("const '"+t+"' has already been declared"),et["(global)"]&&ft[t]===!1&&a("Redefinition of '{a}'.",Et,t),u(t,"const"),!e)&&(i=Et,this.first.push(Et),"="!==ut.id&&a("const '{a}' is initialized to 'undefined'.",Et,t),"="===ut.id&&(_(Et,ut),f("="),_(Et,ut),"undefined"===ut.id&&a("It is not necessary to initialize '{a}' to 'undefined'.",Et,t),"="===p(0).id&&ut.identifier&&h("Constant {a} was not declared correctly.",ut,ut.value),n=m(0),i.first=n),","===ut.id);)T();return this});e.exps=!0};var ti=S("var",function(e){var t,i,n;for(et["(onevar)"]&&pt.onevar?a("Too many var statements."):et["(global)"]||(et["(onevar)"]=!0),this.first=[];(_(Et,ut),t=B(),pt.esnext&&"const"===et[t]&&a("const '"+t+"' has already been declared"),et["(global)"]&&ft[t]===!1&&a("Redefinition of '{a}'.",Et,t),u(t,"unused"),!e)&&(i=Et,this.first.push(Et),"="===ut.id&&(_(Et,ut),f("="),_(Et,ut),"undefined"===ut.id&&a("It is not necessary to initialize '{a}' to 'undefined'.",Et,t),"="===p(0).id&&ut.identifier&&h("Variable {a} was not declared correctly.",ut,ut.value),n=m(0),i.first=n),","===ut.id);)T();return this});ti.exps=!0,C("function",function(){rt&&a("Function declarations should not be placed in blocks. Use a function expression or move the statement to the top of the outer function.",Et);var e=B();return pt.esnext&&"const"===et[e]&&a("const '"+e+"' has already been declared"),g(Et,ut),u(e,"unction"),Q(e,!0),"("===ut.id&&ut.line===Et.line&&h("Function declarations are not invocable. Wrap the whole function invocation in parens."),this}),M("function",function(){var e=V();return e?g(Et,ut):_(Et,ut),Q(e),!pt.loopfunc&&et["(loopage)"]&&a("Don't make functions within a loop."),this}),C("if",function(){var e=ut;return f("("),_(this,e),y(),m(20),"="===ut.id&&(pt.boss||a("Expected a conditional expression and instead saw an assignment."),f("="),m(20)),f(")",e),y(gt,Et),G(!0,!0),"else"===ut.id&&(_(Et,ut),f("else"),"if"===ut.id||"switch"===ut.id?j(!0):G(!0,!0)),this}),C("try",function(){var e,t,i;return G(!1),"catch"===ut.id&&(f("catch"),_(Et,ut),f("("),i=vt,vt=Object.create(i),t=ut.value,"(identifier)"!==ut.type?a("Expected an identifier and instead saw '{a}'.",ut,t):u(t,"exception"),f(),f(")"),G(!1),e=!0,vt=i),"finally"===ut.id?(f("finally"),G(!1),void 0):(e||h("Expected '{a}' and instead saw '{b}'.",ut,"catch",ut.value),this)}),C("while",function(){var e=ut;return et["(breakage)"]+=1,et["(loopage)"]+=1,f("("),_(this,e),y(),m(20),"="===ut.id&&(pt.boss||a("Expected a conditional expression and instead saw an assignment."),f("="),m(20)),f(")",e),y(gt,Et),G(!0,!0),et["(breakage)"]-=1,et["(loopage)"]-=1,this}).labelled=!0,C("with",function(){var e=ut;return _t["use strict"]?h("'with' is not allowed in strict mode.",Et):pt.withstmt||a("Don't use 'with'.",Et),f("("),_(this,e),y(),m(0),f(")",e),y(gt,Et),G(!0,!0),this}),C("switch",function(){var e=ut,t=!1;for(et["(breakage)"]+=1,f("("),_(this,e),y(),this.condition=m(20),f(")",e),y(gt,Et),_(Et,ut),e=ut,f("{"),_(Et,ut),ot+=pt.indent,this.cases=[];;)switch(ut.id){case"case":switch(et["(verb)"]){case"break":case"case":case"continue":case"return":case"switch":case"throw":break;default:Ft.test(at[ut.line-2])||a("Expected a 'break' statement before 'case'.",Et)}E(-pt.indent),f("case"),this.cases.push(m(20)),t=!0,f(":"),et["(verb)"]="case";break;case"default":switch(et["(verb)"]){case"break":case"continue":case"return":case"throw":break;default:Ft.test(at[ut.line-2])||a("Expected a 'break' statement before 'default'.",Et)}E(-pt.indent),f("default"),t=!0,f(":");break;case"}":return ot-=pt.indent,E(),f("}",e),(1===this.cases.length||"true"===this.condition.id||"false"===this.condition.id)&&(pt.onecase||a("This 'switch' should be an 'if'.",this)),et["(breakage)"]-=1,et["(verb)"]=void 0,void 0;case"(end)":return h("Missing '{a}'.",ut,"}"),void 0;default:if(t)switch(Et.id){case",":return h("Each value should have its own case label."),void 0;case":":t=!1,W();break;default:return h("Missing ':' on a case clause.",Et),void 0}else{if(":"!==Et.id)return h("Expected '{a}' and instead saw '{b}'.",ut,"case",ut.value),void 0;f(":"),h("Unexpected '{a}'.",Et,":"),W()}}}).labelled=!0,S("debugger",function(){return pt.debug||a("All 'debugger' statements should be removed."),this}).exps=!0,function(){var e=S("do",function(){et["(breakage)"]+=1,et["(loopage)"]+=1,this.first=G(!0),f("while");var e=ut;return _(Et,e),f("("),y(),m(20),"="===ut.id&&(pt.boss||a("Expected a conditional expression and instead saw an assignment."),f("="),m(20)),f(")",e),y(gt,Et),et["(breakage)"]-=1,et["(loopage)"]-=1,this});e.labelled=!0,e.exps=!0}(),C("for",function(){var e,t=ut;if(et["(breakage)"]+=1,et["(loopage)"]+=1,f("("),_(this,t),y(),"in"===p("var"===ut.id?1:0).id){if("var"===ut.id)f("var"),ti.fud.call(ti,!0);else{switch(et[ut.value]){case"unused":et[ut.value]="var";break;case"var":break;default:a("Bad for in variable '{a}'.",ut,ut.value)}f()}return f("in"),m(20),f(")",t),e=G(!0,!0),pt.forin&&e&&(e.length>1||"object"!=typeof e[0]||"if"!==e[0].value)&&a("The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype.",this),et["(breakage)"]-=1,et["(loopage)"]-=1,this}if(";"!==ut.id)if("var"===ut.id)f("var"),ti.fud.call(ti);else for(;m(0,"for"),","===ut.id;)T();if(x(Et),f(";"),";"!==ut.id&&(m(20),"="===ut.id&&(pt.boss||a("Expected a conditional expression and instead saw an assignment."),f("="),m(20))),x(Et),f(";"),";"===ut.id&&h("Expected '{a}' and instead saw '{b}'.",ut,")",";"),")"!==ut.id)for(;m(0,"for"),","===ut.id;)T();return f(")",t),y(gt,Et),G(!0,!0),et["(breakage)"]-=1,et["(loopage)"]-=1,this}).labelled=!0,S("break",function(){var e=ut.value;return 0===et["(breakage)"]&&a("Unexpected '{a}'.",ut,this.value),pt.asi||x(this),";"!==ut.id&&Et.line===ut.line&&("label"!==et[e]?a("'{a}' is not a statement label.",ut,e):vt[e]!==et&&a("'{a}' is out of scope.",ut,e),this.first=ut,f()),U("break"),this}).exps=!0,S("continue",function(){var e=ut.value;return 0===et["(breakage)"]&&a("Unexpected '{a}'.",ut,this.value),pt.asi||x(this),";"!==ut.id?Et.line===ut.line&&("label"!==et[e]?a("'{a}' is not a statement label.",ut,e):vt[e]!==et&&a("'{a}' is out of scope.",ut,e),this.first=ut,f()):et["(loopage)"]||a("Unexpected '{a}'.",ut,this.value),U("continue"),this}).exps=!0,S("return",function(){return this.line===ut.line?("(regexp)"===ut.id&&a("Wrap the /regexp/ literal in parens to disambiguate the slash operator."),";"===ut.id||ut.reach||(_(Et,ut),"="!==p().value||pt.boss||l("Did you mean to return a conditional instead of an assignment?",Et.line,Et.character+1),this.first=m(0))):pt.asi||x(this),U("return"),this}).exps=!0,S("throw",function(){return x(this),_(Et,ut),this.first=m(20),U("throw"),this}).exps=!0,A("class"),A("const"),A("enum"),A("export"),A("extends"),A("import"),A("super"),A("let"),A("yield"),A("implements"),A("interface"),A("package"),A("private"),A("protected"),A("public"),A("static");var ii=function(e,o,s){var l,h,c,u,d,p={};if(JSHINT.errors=[],JSHINT.undefs=[],ft=Object.create(Kt),n(ft,s||{}),o){if(l=o.predef)if(Array.isArray(l))for(h=0;h<l.length;h+=1)ft[l[h]]=!0;else if("object"==typeof l)for(c=Object.keys(l),h=0;h<c.length;h+=1)ft[c[h]]=!!l[c[h]];for(d=Object.keys(o),u=0;u<d.length;u++)p[d[u]]=o[d[u]]}for(pt=p,pt.indent=pt.indent||4,pt.maxerr=pt.maxerr||50,bt="",h=0;h<pt.indent;h+=1)bt+=" ";ot=1,it=Object.create(ft),vt=it,et={"(global)":!0,"(name)":"(global)","(scope)":vt,"(breakage)":0,"(loopage)":0},tt=[et],xt=[],yt=null,ht={},ct=null,nt={},rt=!1,lt=[],st=!1,wt=0,ei.init(e),mt=!0,_t={},gt=Et=ut=Jt["(begin)"];for(var m in o)t(o,m)&&i(m,Et);r(),n(ft,s||{}),T.first=!0;try{switch(f(),ut.id){case"{":case"[":pt.laxbreak=!0,st=!0,J();break;default:$(),_t["use strict"]&&!pt.globalstrict&&a('Use the function form of "use strict".',gt),W()}f("(end)");var g=function(e,t){do{if("string"==typeof t[e])return"unused"===t[e]?t[e]="var":"unction"===t[e]&&(t[e]="closure"),!0;t=t["(context)"]}while(t);return!1},v=function(e,t){if(nt[e]){for(var i=[],n=0;n<nt[e].length;n+=1)nt[e][n]!==t&&i.push(nt[e][n]);0===i.length?delete nt[e]:nt[e]=i}};for(h=0;h<JSHINT.undefs.length;h+=1)c=JSHINT.undefs[h].slice(0),g(c[2].value,c[0])?v(c[2].value,c[2].line):a.apply(a,c.slice(1))}catch(y){if(y){var _=ut||{};JSHINT.errors.push({raw:y.raw,reason:y.message,line:y.line||_.line,character:y.character||_.from},null)}}return 0===JSHINT.errors.length};return ii.data=function(){var e,i,n,r,o,s,a,l={functions:[],options:pt},h=[],c=[],u=[];ii.errors.length&&(l.errors=ii.errors),st&&(l.json=!0);for(s in nt)t(nt,s)&&h.push({name:s,line:nt[s]});for(h.length>0&&(l.implieds=h),xt.length>0&&(l.urls=xt),i=Object.keys(vt),i.length>0&&(l.globals=i),r=1;r<tt.length;r+=1){for(n=tt[r],e={},o=0;o<Wt.length;o+=1)e[Wt[o]]=[];for(s in n)t(n,s)&&"("!==s.charAt(0)&&(a=n[s],"unction"===a&&(a="unused"),Array.isArray(e[a])&&(e[a].push(s),"unused"===a&&u.push({name:s,line:n["(line)"],"function":n["(name)"]})));for(o=0;o<Wt.length;o+=1)0===e[Wt[o]].length&&delete e[Wt[o]];e.name=n["(name)"],e.param=n["(params)"],e.line=n["(line)"],e.last=n["(last)"],l.functions.push(e)}u.length>0&&(l.unused=u),c=[];for(s in ht)if("number"==typeof ht[s]){l.member=ht;break}return l},ii.report=function(e){function t(e,t){var i,n,r;if(t){for(f.push("<div><i>"+e+"</i> "),t=t.sort(),n=0;n<t.length;n+=1)t[n]!==r&&(r=t[n],f.push((i?", ":"")+r),i=!0);f.push("</div>")}}var i,n,r,o,s,a,l,h,c,u=ii.data(),d=[],p="",f=[];if(u.errors||u.implieds||u.unused){if(r=!0,f.push("<div id=errors><i>Error:</i>"),u.errors)for(s=0;s<u.errors.length;s+=1)i=u.errors[s],i&&(n=i.evidence||"",f.push("<p>Problem"+(isFinite(i.line)?" at line "+i.line+" character "+i.character:"")+": "+i.reason.entityify()+"</p><p class=evidence>"+(n&&(n.length>80?n.slice(0,77)+"...":n).entityify())+"</p>"));if(u.implieds){for(c=[],s=0;s<u.implieds.length;s+=1)c[s]="<code>"+u.implieds[s].name+"</code>&nbsp;<i>"+u.implieds[s].line+"</i>";f.push("<p><i>Implied global:</i> "+c.join(", ")+"</p>")}if(u.unused){for(c=[],s=0;s<u.unused.length;s+=1)c[s]="<code><u>"+u.unused[s].name+"</u></code>&nbsp;<i>"+u.unused[s].line+"</i> <code>"+u.unused[s]["function"]+"</code>";f.push("<p><i>Unused variable:</i> "+c.join(", ")+"</p>")}u.json&&f.push("<p>JSON: bad.</p>"),f.push("</div>")}if(!e){for(f.push("<br><div id=functions>"),u.urls&&t("URLs<br>",u.urls,"<br>"),u.json&&!r?f.push("<p>JSON: good.</p>"):u.globals?f.push("<div><i>Global</i> "+u.globals.sort().join(", ")+"</div>"):f.push("<div><i>No new global variables introduced.</i></div>"),s=0;s<u.functions.length;s+=1)o=u.functions[s],f.push("<br><div class=function><i>"+o.line+"-"+o.last+"</i> "+(o.name||"")+"("+(o.param?o.param.join(", "):"")+")</div>"),t("<big><b>Unused</b></big>",o.unused),t("Closure",o.closure),t("Variable",o["var"]),t("Exception",o.exception),t("Outer",o.outer),t("Global",o.global),t("Label",o.label);if(u.member){if(d=Object.keys(u.member),d.length){for(d=d.sort(),p="<br><pre id=members>/*members ",l=10,s=0;s<d.length;s+=1)a=d[s],h=a.name(),l+h.length>72&&(f.push(p+"<br>"),p="    ",l=1),l+=h.length+2,1===u.member[a]&&(h="<i>"+h+"</i>"),s<d.length-1&&(h+=", "),p+=h;f.push(p+"<br>*/</pre>")}f.push("</div>")}}return f.join("")},ii.jshint=ii,ii}();"object"==typeof exports&&exports&&(exports.JSHINT=JSHINT),define("libs/jshint",function(){}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("bower_components/codemirror/mode/javascript/javascript",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){e.defineMode("javascript",function(t,i){function n(e){for(var t,i=!1,n=!1;null!=(t=e.next());){if(!i){if("/"==t&&!n)return;"["==t?n=!0:n&&"]"==t&&(n=!1)}i=!i&&"\\"==t}}function r(e,t,i){return pt=e,ft=i,t}function o(e,t){var i=e.next();if('"'==i||"'"==i)return t.tokenize=s(i),t.tokenize(e,t);if("."==i&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return r("number","number");if("."==i&&e.match(".."))return r("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(i))return r(i);if("="==i&&e.eat(">"))return r("=>","operator");if("0"==i&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),r("number","number");if(/\d/.test(i))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),r("number","number");if("/"==i)return e.eat("*")?(t.tokenize=a,a(e,t)):e.eat("/")?(e.skipToEnd(),r("comment","comment")):"operator"==t.lastType||"keyword c"==t.lastType||"sof"==t.lastType||/^[\[{}\(,;:]$/.test(t.lastType)?(n(e),e.eatWhile(/[gimy]/),r("regexp","string-2")):(e.eatWhile(Et),r("operator","operator",e.current()));if("`"==i)return t.tokenize=l,l(e,t);if("#"==i)return e.skipToEnd(),r("error","error");if(Et.test(i))return e.eatWhile(Et),r("operator","operator",e.current());e.eatWhile(/[\w\$_]/);var o=e.current(),h=bt.propertyIsEnumerable(o)&&bt[o];return h&&"."!=t.lastType?r(h.type,h.style,o):r("variable","variable",o)}function s(e){return function(t,i){var n,s=!1;if(vt&&"@"==t.peek()&&t.match(xt))return i.tokenize=o,r("jsonld-keyword","meta");for(;null!=(n=t.next())&&(n!=e||s);)s=!s&&"\\"==n;return s||(i.tokenize=o),r("string","string")}}function a(e,t){for(var i,n=!1;i=e.next();){if("/"==i&&n){t.tokenize=o;break}n="*"==i}return r("comment","comment")}function l(e,t){for(var i,n=!1;null!=(i=e.next());){if(!n&&("`"==i||"$"==i&&e.eat("{"))){t.tokenize=o;break}n=!n&&"\\"==i}return r("quasi","string-2",e.current())}function h(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var i=e.string.indexOf("=>",e.start);if(!(0>i)){for(var n=0,r=!1,o=i-1;o>=0;--o){var s=e.string.charAt(o),a=Tt.indexOf(s);if(a>=0&&3>a){if(!n){++o;break}if(0==--n)break}else if(a>=3&&6>a)++n;else if(/[$\w]/.test(s))r=!0;else if(r&&!n){++o;break}}r&&!n&&(t.fatArrowAt=o)}}function c(e,t,i,n,r,o){this.indented=e,this.column=t,this.type=i,this.prev=r,this.info=o,null!=n&&(this.align=n)}function u(e,t){for(var i=e.localVars;i;i=i.next)if(i.name==t)return!0;for(var n=e.context;n;n=n.prev)for(var i=n.vars;i;i=i.next)if(i.name==t)return!0}function d(e,t,i,n,r){var o=e.cc;for(Rt.state=e,Rt.stream=r,Rt.marked=null,Rt.cc=o,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);;){var s=o.length?o.pop():yt?x:E;if(s(i,n)){for(;o.length&&o[o.length-1].lex;)o.pop()();return Rt.marked?Rt.marked:"variable"==i&&u(e,n)?"variable-2":t}}}function p(){for(var e=arguments.length-1;e>=0;e--)Rt.cc.push(arguments[e])}function f(){return p.apply(null,arguments),!0}function m(e){function t(t){for(var i=t;i;i=i.next)if(i.name==e)return!0;return!1}var n=Rt.state;if(n.context){if(Rt.marked="def",t(n.localVars))return;n.localVars={name:e,next:n.localVars}}else{if(t(n.globalVars))return;i.globalVars&&(n.globalVars={name:e,next:n.globalVars})}}function g(){Rt.state.context={prev:Rt.state.context,vars:Rt.state.localVars},Rt.state.localVars=St}function v(){Rt.state.localVars=Rt.state.context.vars,Rt.state.context=Rt.state.context.prev}function y(e,t){var i=function(){var i=Rt.state,n=i.indented;"stat"==i.lexical.type&&(n=i.lexical.indented),i.lexical=new c(n,Rt.stream.column(),e,null,i.lexical,t)};return i.lex=!0,i}function _(){var e=Rt.state;e.lexical.prev&&(")"==e.lexical.type&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function b(e){function t(i){return i==e?f():";"==e?p():f(t)}return t}function E(e,t){return"var"==e?f(y("vardef",t.length),j,b(";"),_):"keyword a"==e?f(y("form"),x,E,_):"keyword b"==e?f(y("form"),E,_):"{"==e?f(y("}"),V,_):";"==e?f():"if"==e?("else"==Rt.state.lexical.info&&Rt.state.cc[Rt.state.cc.length-1]==_&&Rt.state.cc.pop()(),f(y("form"),x,E,_,X)):"function"==e?f(et):"for"==e?f(y("form"),Y,E,_):"variable"==e?f(y("stat"),F):"switch"==e?f(y("form"),x,y("}","switch"),b("{"),V,_,_):"case"==e?f(x,b(":")):"default"==e?f(b(":")):"catch"==e?f(y("form"),g,b("("),tt,b(")"),E,_,v):"module"==e?f(y("form"),g,ot,v,_):"class"==e?f(y("form"),it,rt,_):"export"==e?f(y("form"),st,_):"import"==e?f(y("form"),at,_):p(y("stat"),x,b(";"),_)}function x(e){return w(e,!1)}function T(e){return w(e,!0)}function w(e,t){if(Rt.state.fatArrowAt==Rt.stream.start){var i=t?P:A;if("("==e)return f(g,y(")"),I(W,")"),_,b("=>"),i,v);if("variable"==e)return p(g,W,b("=>"),i,v)}var n=t?H:C;return wt.hasOwnProperty(e)?f(n):"function"==e?f(et,n):"keyword c"==e?f(t?S:R):"("==e?f(y(")"),R,dt,b(")"),_,n):"operator"==e||"spread"==e?f(t?T:x):"["==e?f(y("]"),ct,_,n):"{"==e?O(N,"}",null,n):"quasi"==e?p(M,n):f()}function R(e){return e.match(/[;\}\)\],]/)?p():p(x)}function S(e){return e.match(/[;\}\)\],]/)?p():p(T)}function C(e,t){return","==e?f(x):H(e,t,!1)}function H(e,t,i){var n=0==i?C:H,r=0==i?x:T;return"=>"==t?f(g,i?P:A,v):"operator"==e?/\+\+|--/.test(t)?f(n):"?"==t?f(x,b(":"),r):f(r):"quasi"==e?p(M,n):";"!=e?"("==e?O(T,")","call",n):"."==e?f(D,n):"["==e?f(y("]"),R,b("]"),_,n):void 0:void 0}function M(e,t){return"quasi"!=e?p():"${"!=t.slice(t.length-2)?f(M):f(x,k)}function k(e){return"}"==e?(Rt.marked="string-2",Rt.state.tokenize=l,f(M)):void 0}function A(e){return h(Rt.stream,Rt.state),"{"==e?p(E):p(x)}function P(e){return h(Rt.stream,Rt.state),"{"==e?p(E):p(T)}function F(e){return":"==e?f(_,E):p(C,b(";"),_)}function D(e){return"variable"==e?(Rt.marked="property",f()):void 0}function N(e,t){if("variable"==e){if(Rt.marked="property","get"==t||"set"==t)return f(z)}else if("number"==e||"string"==e)Rt.marked=vt?"property":e+" property";else if("["==e)return f(x,b("]"),L);return wt.hasOwnProperty(e)?f(L):void 0}function z(e){return"variable"!=e?p(L):(Rt.marked="property",f(et))}function L(e){return":"==e?f(T):"("==e?p(et):void 0}function I(e,t){function i(n){if(","==n){var r=Rt.state.lexical;return"call"==r.info&&(r.pos=(r.pos||0)+1),f(e,i)}return n==t?f():f(b(t))}return function(n){return n==t?f():p(e,i)}}function O(e,t,i){for(var n=3;n<arguments.length;n++)Rt.cc.push(arguments[n]);return f(y(t,i),I(e,t),_)}function V(e){return"}"==e?f():p(E,V)}function B(e){return _t&&":"==e?f(U):void 0}function U(e){return"variable"==e?(Rt.marked="variable-3",f()):void 0}function j(){return p(W,B,G,q)}function W(e,t){return"variable"==e?(m(t),f()):"["==e?O(W,"]"):"{"==e?O($,"}"):void 0}function $(e,t){return"variable"!=e||Rt.stream.match(/^\s*:/,!1)?("variable"==e&&(Rt.marked="property"),f(b(":"),W,G)):(m(t),f(G))}function G(e,t){return"="==t?f(T):void 0}function q(e){return","==e?f(j):void 0}function X(e,t){return"keyword b"==e&&"else"==t?f(y("form","else"),E,_):void 0}function Y(e){return"("==e?f(y(")"),K,b(")"),_):void 0}function K(e){return"var"==e?f(j,b(";"),J):";"==e?f(J):"variable"==e?f(Q):p(x,b(";"),J)}function Q(e,t){return"in"==t||"of"==t?(Rt.marked="keyword",f(x)):f(C,J)}function J(e,t){return";"==e?f(Z):"in"==t||"of"==t?(Rt.marked="keyword",f(x)):p(x,b(";"),Z)}function Z(e){")"!=e&&f(x)}function et(e,t){return"*"==t?(Rt.marked="keyword",f(et)):"variable"==e?(m(t),f(et)):"("==e?f(g,y(")"),I(tt,")"),_,E,v):void 0}function tt(e){return"spread"==e?f(tt):p(W,B)}function it(e,t){return"variable"==e?(m(t),f(nt)):void 0}function nt(e,t){return"extends"==t?f(x):void 0}function rt(e){return"{"==e?O(N,"}"):void 0}function ot(e,t){return"string"==e?f(E):"variable"==e?(m(t),f(ht)):void 0}function st(e,t){return"*"==t?(Rt.marked="keyword",f(ht,b(";"))):"default"==t?(Rt.marked="keyword",f(x,b(";"))):p(E)}function at(e){return"string"==e?f():p(lt,ht)}function lt(e,t){return"{"==e?O(lt,"}"):("variable"==e&&m(t),f())}function ht(e,t){return"from"==t?(Rt.marked="keyword",f(x)):void 0}function ct(e){return"]"==e?f():p(T,ut)}function ut(e){return"for"==e?p(dt,b("]")):","==e?f(I(T,"]")):p(I(T,"]"))}function dt(e){return"for"==e?f(Y,dt):"if"==e?f(x,dt):void 0}var pt,ft,mt=t.indentUnit,gt=i.statementIndent,vt=i.jsonld,yt=i.json||vt,_t=i.typescript,bt=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),i=e("keyword b"),n=e("keyword c"),r=e("operator"),o={type:"atom",style:"atom"},s={"if":e("if"),"while":t,"with":t,"else":i,"do":i,"try":i,"finally":i,"return":n,"break":n,"continue":n,"new":n,"delete":n,"throw":n,"debugger":n,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":r,"typeof":r,"instanceof":r,"true":o,"false":o,"null":o,undefined:o,NaN:o,Infinity:o,"this":e("this"),module:e("module"),"class":e("class"),"super":e("atom"),yield:n,"export":e("export"),"import":e("import"),"extends":n};if(_t){var a={type:"variable",style:"variable-3"},l={"interface":e("interface"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),string:a,number:a,bool:a,any:a};for(var h in l)s[h]=l[h]}return s}(),Et=/[+\-*&%=<>!?|~^]/,xt=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,Tt="([{}])",wt={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},Rt={state:null,column:null,marked:null,cc:null},St={name:"this",next:{name:"arguments"}};return _.lex=!0,{startState:function(e){var t={tokenize:o,lastType:"sof",cc:[],lexical:new c((e||0)-mt,0,"block",!1),localVars:i.localVars,context:i.localVars&&{vars:i.localVars},indented:0};return i.globalVars&&"object"==typeof i.globalVars&&(t.globalVars=i.globalVars),t},token:function(e,t){if(e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),h(e,t)),t.tokenize!=a&&e.eatSpace())return null;var i=t.tokenize(e,t);return"comment"==pt?i:(t.lastType="operator"!=pt||"++"!=ft&&"--"!=ft?pt:"incdec",d(t,i,pt,ft,e))},indent:function(t,n){if(t.tokenize==a)return e.Pass;if(t.tokenize!=o)return 0;var r=n&&n.charAt(0),s=t.lexical;if(!/^\s*else\b/.test(n))for(var l=t.cc.length-1;l>=0;--l){var h=t.cc[l];if(h==_)s=s.prev;else if(h!=X)break}"stat"==s.type&&"}"==r&&(s=s.prev),gt&&")"==s.type&&"stat"==s.prev.type&&(s=s.prev);var c=s.type,u=r==c;return"vardef"==c?s.indented+("operator"==t.lastType||","==t.lastType?s.info+1:0):"form"==c&&"{"==r?s.indented:"form"==c?s.indented+mt:"stat"==c?s.indented+("operator"==t.lastType||","==t.lastType?gt||mt:0):"switch"!=s.info||u||0==i.doubleIndentSwitch?s.align?s.column+(u?0:1):s.indented+(u?0:mt):s.indented+(/^(?:case|default)\b/.test(n)?mt:2*mt)},electricChars:":{}",blockCommentStart:yt?null:"/*",blockCommentEnd:yt?null:"*/",lineComment:yt?null:"//",fold:"brace",helperType:yt?"json":"javascript",jsonldMode:vt,jsonMode:yt}}),e.registerHelper("wordChars","javascript",/[\\w$]/),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("bower_components/codemirror/addon/lint/lint",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(t,i){function n(t){return r.parentNode?(r.style.top=Math.max(0,t.clientY-r.offsetHeight-5)+"px",r.style.left=t.clientX+5+"px",void 0):e.off(document,"mousemove",n)}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",r.appendChild(i.cloneNode(!0)),document.body.appendChild(r),e.on(document,"mousemove",n),n(t),null!=r.style.opacity&&(r.style.opacity=1),r}function i(e){e.parentNode&&e.parentNode.removeChild(e)}function n(e){e.parentNode&&(null==e.style.opacity&&i(e),e.style.opacity=0,setTimeout(function(){i(e)},600))}function r(i,r,o){function s(){e.off(o,"mouseout",s),a&&(n(a),a=null)}var a=t(i,r),l=setInterval(function(){if(a)for(var e=o;;e=e.parentNode){if(e==document.body)return;if(!e){s();break}}return a?void 0:clearInterval(l)},400);e.on(o,"mouseout",s)}function o(e,t,i){this.marked=[],this.options=t,this.timeout=null,this.hasGutter=i,this.onMouseOver=function(t){g(e,t)}}function s(t,i){if(i instanceof Function)return{getAnnotations:i};if(i&&i!==!0||(i={}),i.getAnnotations||(i.getAnnotations=t.getHelper(e.Pos(0,0),"lint")),!i.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return i}function a(e){var t=e.state.lint;t.hasGutter&&e.clearGutter(v);for(var i=0;i<t.marked.length;++i)t.marked[i].clear();t.marked.length=0}function l(t,i,n,o){var s=document.createElement("div"),a=s;return s.className="CodeMirror-lint-marker-"+i,n&&(a=s.appendChild(document.createElement("div")),a.className="CodeMirror-lint-marker-multiple"),0!=o&&e.on(a,"mouseover",function(e){r(e,t,a)}),s}function h(e,t){return"error"==e?e:t}function c(e){for(var t=[],i=0;i<e.length;++i){var n=e[i],r=n.from.line;(t[r]||(t[r]=[])).push(n)}return t}function u(e){var t=e.severity;y.test(t)||(t="error");var i=document.createElement("div");return i.className="CodeMirror-lint-message-"+t,i.appendChild(document.createTextNode(e.message)),i}function d(e){var t=e.state.lint,i=t.options;i.async?i.getAnnotations(e,p,i):p(e,i.getAnnotations(e.getValue(),i.options))}function p(e,t){a(e);for(var i=e.state.lint,n=i.options,r=c(t),o=0;o<r.length;++o){var s=r[o];
if(s){for(var d=null,p=i.hasGutter&&document.createDocumentFragment(),f=0;f<s.length;++f){var m=s[f],g=m.severity;y.test(g)||(g="error"),d=h(d,g),n.formatAnnotation&&(m=n.formatAnnotation(m)),i.hasGutter&&p.appendChild(u(m)),m.to&&i.marked.push(e.markText(m.from,m.to,{className:"CodeMirror-lint-mark-"+g,__annotation:m}))}i.hasGutter&&e.setGutterMarker(o,v,l(p,d,s.length>1,i.options.tooltips))}}n.onUpdateLinting&&n.onUpdateLinting(t,r,e)}function f(e){var t=e.state.lint;clearTimeout(t.timeout),t.timeout=setTimeout(function(){d(e)},t.options.delay||500)}function m(e,t){var i=t.target||t.srcElement;r(t,u(e),i)}function g(e,t){if(/\bCodeMirror-lint-mark-/.test((t.target||t.srcElement).className))for(var i=0;i<_.length;i+=2)for(var n=e.findMarksAt(e.coordsChar({left:t.clientX+_[i],top:t.clientY+_[i+1]},"client")),r=0;r<n.length;++r){var o=n[r],s=o.__annotation;if(s)return m(s,t)}}var v="CodeMirror-lint-markers",y=/^(?:error|warning)$/,_=[0,0,0,5,0,-5,5,0,-5,0];e.defineOption("lint",!1,function(t,i,n){if(n&&n!=e.Init&&(a(t),t.off("change",f),e.off(t.getWrapperElement(),"mouseover",t.state.lint.onMouseOver),delete t.state.lint),i){for(var r=t.getOption("gutters"),l=!1,h=0;h<r.length;++h)r[h]==v&&(l=!0);var c=t.state.lint=new o(t,s(t,i),l);t.on("change",f),0!=c.options.tooltips&&e.on(t.getWrapperElement(),"mouseover",c.onMouseOver),d(t)}})}),function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define("bower_components/codemirror/addon/lint/javascript-lint",["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){if(!window.JSHINT)return[];JSHINT(e,t);var i=JSHINT.data().errors,n=[];return i&&o(i,n),n}function i(e){return n(e,a,"warning",!0),n(e,l,"error"),r(e)?null:e}function n(e,t,i,n){var r,o,s,a,l;r=e.description;for(var h=0;h<t.length;h++)o=t[h],s="string"==typeof o?o:o[0],a="string"==typeof o?null:o[1],l=-1!==r.indexOf(s),(n||l)&&(e.severity=i),l&&a&&(e.description=a)}function r(e){for(var t=e.description,i=0;i<s.length;i++)if(-1!==t.indexOf(s[i]))return!0;return!1}function o(t,n){for(var r=0;r<t.length;r++){var o=t[r];if(o){var s,a;if(s=[],o.evidence){var l=s[o.line];if(!l){var h=o.evidence;l=[],Array.prototype.forEach.call(h,function(e,t){"	"===e&&l.push(t+1)}),s[o.line]=l}if(l.length>0){var c=o.character;l.forEach(function(e){c>e&&(c-=1)}),o.character=c}}var u=o.character-1,d=u+1;o.evidence&&(a=o.evidence.substring(u).search(/.\b/),a>-1&&(d+=a)),o.description=o.reason,o.start=o.character,o.end=d,o=i(o),o&&n.push({message:o.description,severity:o.severity,from:e.Pos(o.line-1,u),to:e.Pos(o.line-1,d)})}}}var s=["Dangerous comment"],a=[["Expected '{'","Statement body should be inside '{ }' braces."]],l=["Missing semicolon","Extra comma","Missing property name","Unmatched "," and instead saw"," is not defined","Unclosed string","Stopping, unable to continue"];e.registerHelper("lint","javascript",t)}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/NodeCodeView",["require","Underscore","Backbone","bower_components/codemirror/lib/codemirror","libs/jshint","bower_components/codemirror/mode/javascript/javascript","bower_components/codemirror/addon/lint/lint","bower_components/codemirror/addon/lint/javascript-lint","cs!../models/Node","cs!./NodeView"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("bower_components/codemirror/lib/codemirror"),t("libs/jshint"),t("bower_components/codemirror/mode/javascript/javascript"),t("bower_components/codemirror/addon/lint/lint"),t("bower_components/codemirror/addon/lint/javascript-lint"),t("cs!../models/Node"),t("cs!./NodeView"),o=function(t){function n(){return this.getCenterField=e(this.getCenterField,this),this.render=e(this.render,this),this.initialize=e(this.initialize,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){var e,t,i,o,s,a;return n.__super__.initialize.apply(this,arguments),s=this.getCenterField(),t=$("<div><textarea data-fid='"+s.get("fid")+"' spellcheck='false'></textarea></div>"),t.insertAfter($(".options",this.$el)),o=$("textarea",t),s.on_value_update_hooks.update_center_textfield=function(e){return null!==e?o.val(e.toString()):void 0},o.val(s.getValue()),i=r.fromTextArea(o.get(0),{mode:"javascript",theme:"monokai",tabSize:2,lineNumbers:!0,gutters:["CodeMirror-lint-markers"],lint:!0}),a=this,this.$el.resizable({minHeight:50,minWidth:220,ghost:!0,resize:function(e,t){var n,r;return r=t.size,i.setSize(null,r.height-37),n=a.model,n.set("width",r.width-13),n.set("height",r.height-13),a.renderConnections()}}),i.on("change",function(){return s.setValue(i.getValue())}),e=this.$el.find(".CodeMirror"),e.parent().on("mousemove click mouseup mousedown",function(e){return e.stopPropagation()}),this.model.get("height")&&i.setSize(null,this.model.get("height")),s.get("is_output")===!0?(o.attr("disabled","disabled"),i.setOption("readOnly",!0)):o.keyup(function(){return s.setValue($(this).val())}),this},n.prototype.render=function(){return n.__super__.render.apply(this,arguments),this.model.get("width")&&this.$el.css("width",this.model.get("width")),this.model.get("height")?this.$el.css("height",this.model.get("height")):void 0},n.prototype.getCenterField=function(){return this.model.fields.getField("code")},n}(ThreeNodes.NodeView)})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t},i=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/nodes/models/components/Code",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node","cs!threenodes/nodes/views/NodeCodeView"],function(e){var n,r,o,s,a,l,h,c,u,d;return l=e("Underscore"),n=e("Backbone"),s=e("cs!threenodes/nodes/models/Node"),a=e("cs!threenodes/nodes/views/NodeCodeView"),namespace("ThreeNodes.nodes.views",{Code:r=function(e){function i(){return h=i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(a),Expression:o=function(e){function i(){return c=i.__super__.constructor.apply(this,arguments)}return t(i,e),i}(a)}),namespace("ThreeNodes.nodes.models",{Expression:o=function(e){function n(){return this.compute=i(this.compute,this),this.getFields=i(this.getFields,this),this.toJSON=i(this.toJSON,this),this.addCustomField=i(this.addCustomField,this),this.onCodeUpdate=i(this.onCodeUpdate,this),this.loadCustomFields=i(this.loadCustomFields,this),this.initialize=i(this.initialize,this),u=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Expression",n.group_name="Code",n.prototype.initialize=function(e){var t;return this.custom_fields={inputs:{},outputs:{}},this.loadCustomFields(e),n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.out=null,this.onCodeUpdate(),t=this.fields.getField("code"),t.on("value_updated",this.onCodeUpdate)},n.prototype.loadCustomFields=function(e){return e.custom_fields?this.custom_fields=$.extend(!0,this.custom_fields,e.custom_fields):void 0},n.prototype.onCodeUpdate=function(e){var t;null==e&&(e=""),console.log(e);try{return this["function"]=new Function(e)}catch(i){return t=i,console.warn(t),this["function"]=!1}},n.prototype.addCustomField=function(e,t,i){var n,r;return null==i&&(i="inputs"),n={key:e,type:t},this.custom_fields[i][e]=n,r=!1,this.fields.addField(e,{value:r,type:t,"default":!1},i)},n.prototype.toJSON=function(){var e;return e=n.__super__.toJSON.apply(this,arguments),e.custom_fields=this.custom_fields,e},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{code:""},outputs:{out:{type:"Any",val:null}}},t=$.extend(!0,t,this.custom_fields),$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i;if(e=this.fields.getField("code").getValue(),i=this.out,this["function"]!==!1)try{i=this["function"]()}catch(n){t=n}return this.out=i,this.fields.setField("out",this.out)},n}(s),Code:r=function(e){function n(){return this.getFields=i(this.getFields,this),this.getDynamicFields=i(this.getDynamicFields,this),this.initialize=i(this.initialize,this),d=n.__super__.constructor.apply(this,arguments)}return t(n,e),n.node_name="Code",n.group_name="Code",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments)},n.prototype.getDynamicFields=function(){return{}},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t=this.getDynamicFields(),$.extend(!0,e,t)},n}(o)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Geometry",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E;return f=t("Underscore"),n=t("Backbone"),p=t("cs!threenodes/utils/Utils"),s=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes.nodes.models",{PlaneGeometry:l=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),m=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Plane",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.PlaneGeometry(100,100,1,1,1),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{width:100,height:100,segments_width:1,segments_height:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("width").getValue(),this.fields.getField("height").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.PlaneGeometry(this.fields.getField("width").getValue(),this.fields.getField("height").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue())),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),CubeGeometry:r=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),g=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Cube",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.CubeGeometry(100,100,100,1,1,1),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{flip:-1,width:100,height:100,depth:100,segments_width:1,segments_height:1,segments_depth:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("width").getValue(),this.fields.getField("height").getValue(),this.fields.getField("depth").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue(),this.fields.getField("segments_depth").getValue(),this.fields.getField("flip").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.CubeGeometry(this.fields.getField("width").getValue(),this.fields.getField("height").getValue(),this.fields.getField("depth").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue(),this.fields.getField("segments_depth").getValue(),this.fields.getField("flip").getValue())),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),SphereGeometry:h=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),v=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Sphere",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.SphereGeometry(100,20,20),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{radius:100,segments_width:1,segments_height:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radius").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.SphereGeometry(this.fields.getField("radius").getValue(),this.fields.getField("segments_width").getValue(),this.fields.getField("segments_height").getValue()),this.cached=e),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),CylinderGeometry:o=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),y=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Cylinder",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.CylinderGeometry(100,100,20,30,1,!1),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{radiusTop:100,radiusBottom:100,height:20,segmentsRadius:30,segmentsHeight:1,openEnded:!1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radiusTop").getValue(),this.fields.getField("radiusBottom").getValue(),this.fields.getField("height").getValue(),this.fields.getField("segmentsRadius").getValue(),this.fields.getField("segmentsHeight").getValue(),this.fields.getField("openEnded").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.CylinderGeometry(this.fields.getField("radiusTop").getValue(),this.fields.getField("radiusBottom").getValue(),this.fields.getField("height").getValue(),this.fields.getField("segmentsRadius").getValue(),this.fields.getField("segmentsHeight").getValue(),this.fields.getField("openEnded").getValue()),this.cached=e),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),TorusGeometry:u=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),_=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Torus",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.TorusGeometry(100,40,8,6,2*Math.PI),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{radius:100,tube:40,segmentsR:8,segmentsT:6,arc:2*Math.PI},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radius").getValue(),this.fields.getField("tube").getValue(),this.fields.getField("segmentsR").getValue(),this.fields.getField("segmentsT").getValue(),this.fields.getField("arc").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.TorusGeometry(this.fields.getField("radius").getValue(),this.fields.getField("tube").getValue(),this.fields.getField("segmentsR").getValue(),this.fields.getField("segmentsT").getValue(),this.fields.getField("arc").getValue()),this.cached=e),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),TorusKnotGeometry:d=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),b=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="TorusKnot",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.TorusKnotGeometry(200,40,64,8,2,3,1),this.cached=this.get_cache_array()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{radius:200,tube:40,segmentsR:64,segmentsT:8,p:2,q:3,heightScale:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radius").getValue(),this.fields.getField("tube").getValue(),this.fields.getField("segmentsR").getValue(),this.fields.getField("segmentsT").getValue(),this.fields.getField("p").getValue(),this.fields.getField("q").getValue(),this.fields.getField("heightScale").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.TorusKnotGeometry(this.fields.getField("radius").getValue(),this.fields.getField("tube").getValue(),this.fields.getField("segmentsR").getValue(),this.fields.getField("segmentsT").getValue(),this.fields.getField("p").getValue(),this.fields.getField("q").getValue(),this.fields.getField("heightScale").getValue()),this.cached=e),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),OctahedronGeometry:a=function(t){function n(){this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),n.__super__.constructor.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.OctahedronGeometry(100,0),this.cached=this.get_cache_array()}return i(n,t),n.node_name="Octahedron",n.group_name="Geometry",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{radius:100,detail:0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radius").getValue(),this.fields.getField("detail").getValue()]},n.prototype.compute=function(){var e;return e=this.get_cache_array(),p.flatArraysAreEquals(e,this.cached)===!1&&(this.ob=new THREE.OctahedronGeometry(this.fields.getField("radius").getValue(),this.fields.getField("detail").getValue()),this.cached=e),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),TextGeometry:c=function(t){function n(){return this.compute=e(this.compute,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),E=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Text",n.group_name="Geometry",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=!1,this.cached=[]},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{text:"Example",font:{type:"Any",val:{}},size:100,height:20,curveSegments:4,bevelEnabled:!1,bevelThickness:0,bevelSize:0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("font").getValue(),this.fields.getField("text").getValue(),this.fields.getField("size").getValue(),this.fields.getField("height").getValue(),this.fields.getField("curveSegments").getValue(),this.fields.getField("bevelEnabled").getValue(),this.fields.getField("bevelThickness").getValue(),this.fields.getField("bevelSize").getValue()]},n.prototype.compute=function(){var e,t,i;return i=this.get_cache_array(),e=this.fields.getField("font").getValue(),t=function(){return e.font&&e.weight?!0:!1},t(e)&&""!==this.fields.getField("text").getValue()?(p.flatArraysAreEquals(i,this.cached)===!1&&(console.log("building text "+e.font+" / "+e.weight),this.ob=new THREE.TextGeometry(this.fields.getField("text").getValue(),{size:this.fields.getField("size").getValue(),height:this.fields.getField("height").getValue(),font:e.font,weight:e.weight,curveSegments:this.fields.getField("curveSegments").getValue()}),this.ob.computeBoundingBox(),this.ob.computeVertexNormals(),this.cached=i),this.fields.setField("out",this.ob)):(this.ob=!1,this.fields.setField("out",this.ob),!1)},n}(s)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Lights",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h,c,u,d,p;return h=t("Underscore"),r=t("Backbone"),s=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes.nodes.models",{PointLight:a=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),c=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="PointLight",n.group_name="Lights",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.PointLight(16777215)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},position:{type:"Vector3",val:new THREE.Vector3(0,300,0)},intensity:1,distance:0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),SpotLight:l=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),u=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="SpotLight",n.group_name="Lights",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.SpotLight(16777215)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},position:{type:"Vector3",val:new THREE.Vector3(0,300,0)},target:{type:"Any",val:new THREE.Object3D},intensity:1,distance:0,castShadow:!1,shadowCameraNear:50,shadowCameraFar:5e3,shadowCameraFov:50,shadowBias:0,shadowDarkness:.5,shadowMapWidth:512,shadowMapHeight:512},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.fields.getField("castShadow").getValue()!==this.ob.castShadow&&this.trigger("RebuildAllShaders"),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),DirectionalLight:o=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),d=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="DirectionalLight",n.group_name="Lights",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.DirectionalLight(16777215)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},position:{type:"Vector3",val:new THREE.Vector3(0,300,0)},intensity:1,distance:0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s),AmbientLight:n=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),p=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="AmbientLight",n.group_name="Lights",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.AmbientLight(16777215)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},position:{type:"Vector3",val:new THREE.Vector3(0,300,0)}},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(s)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Materials",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m;return c=t("Underscore"),n=t("Backbone"),l=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes",{NodeMaterialBase:h=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.rebuildShader=e(this.rebuildShader,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),u=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=!1,this.auto_evaluate=!0,this.material_class=!1,this.last_slice_count=-1,this.is_material=!0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{opacity:1,transparent:!1,side:{type:"Float",val:THREE.FrontSide,values:{Front:THREE.FrontSide,Back:THREE.BackSide,Both:THREE.DoubleSide}},depthTest:!0,alphaTest:0,polygonOffset:!1,polygonOffsetFactor:0,polygonOffsetUnits:0,blending:{type:"Float",val:THREE.NormalBlending,values:{Normal:THREE.NormalBlending,Additive:THREE.AdditiveBlending,Subtractive:THREE.SubtractiveBlending,Multiply:THREE.MultiplyBlending,AdditiveAlpha:THREE.AdditiveAlphaBlending}}}},$.extend(!0,e,t)},n.prototype.rebuildShader=function(){var e,t,i,n;if(!this.ob)return this;if("array"===$.type(this.ob))for(n=this.ob,t=0,i=n.length;i>t;t++)e=n[t],console.log("rebuilding submaterial"),e.needsUpdate=!0;else this.ob.needsUpdate=!0;return this},n.prototype.remove=function(){return delete this.ob,delete this.material_cache,delete this.material_class,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r;if(t=!1,i=this.fields.getMaxInputSliceCount(),(this.inputValueHasChanged(this.vars_rebuild_shader_on_change)||this.last_slice_count!==i)&&(t=!0),t===!0)for(this.ob=[],e=n=0;i>=0?i>=n:n>=i;e=i>=0?++n:--n)this.ob[e]=new this.material_class;for(e=r=0;i>=0?i>=r:r>=i;e=i>=0?++r:--r)this.applyFieldsToVal(this.fields.inputs,this.ob[e],[],e);return this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change),this.last_slice_count=i,this.fields.setField("out",this.ob)},n}(l)}),namespace("ThreeNodes.nodes.models",{MeshBasicMaterial:o=function(t){function n(){return this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),d=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="MeshBasic",n.group_name="Materials",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[],this.material_class=THREE.MeshBasicMaterial,this.vars_rebuild_shader_on_change=["transparent","depthTest","map"],this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16711680)},map:{type:"Any",val:!1},reflectivity:1,refractionRatio:.98,wireframe:!1,wireframeLinecap:1,vertexColors:!1,skinning:!1,fog:!0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n}(ThreeNodes.NodeMaterialBase),LineBasicMaterial:r=function(t){function n(){return this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),p=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="LineBasic",n.group_name="Materials",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[],this.material_class=THREE.LineBasicMaterial,this.vars_rebuild_shader_on_change=["transparent","depthTest"],this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16711680)},linewidth:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n}(ThreeNodes.NodeMaterialBase),MeshLambertMaterial:s=function(t){function n(){return this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),f=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="MeshLambert",n.group_name="Materials",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[],this.material_class=THREE.MeshLambertMaterial,this.vars_rebuild_shader_on_change=["transparent","depthTest","map"],this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change)
},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16711680)},ambient:{type:"Color",val:new THREE.Color(328965)},map:{type:"Any",val:!1},reflectivity:1,refractionRatio:.98,wireframe:!1,vertexColors:{type:"Any",val:!1},skinning:!1,fog:!0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n}(ThreeNodes.NodeMaterialBase),MeshPhongMaterial:a=function(t){function n(){return this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),m=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="MeshPhong",n.group_name="Materials",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[],this.material_class=THREE.MeshPhongMaterial,this.vars_rebuild_shader_on_change=["transparent","depthTest","map"],this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16711680)},map:{type:"Any",val:!1},ambient:{type:"Color",val:new THREE.Color(328965)},specular:{type:"Color",val:new THREE.Color(1118481)},shininess:30,reflectivity:1,refractionRatio:.98,wireframe:!1,vertexColors:{type:"Any",val:!1},skinning:!1,fog:!0},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n}(ThreeNodes.NodeMaterialBase)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Math",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node","cs!threenodes/nodes/models/NodeNumberSimple"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z;return E=t("Underscore"),n=t("Backbone"),y=t("cs!threenodes/nodes/models/Node"),b=t("cs!threenodes/nodes/models/NodeNumberSimple"),namespace("ThreeNodes.nodes.models",{MathSin:m=function(t){function n(){return this.process_val=e(this.process_val,this),x=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Sin",n.group_name="Math",n.prototype.process_val=function(e){return Math.sin(e)},n}(b),MathCos:a=function(t){function n(){return this.process_val=e(this.process_val,this),T=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Cos",n.group_name="Math",n.prototype.process_val=function(e){return Math.cos(e)},n}(b),MathTan:v=function(t){function n(){return this.process_val=e(this.process_val,this),M=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Tan",n.group_name="Math",n.prototype.process_val=function(e){return Math.tan(e)},n}(b),MathRound:f=function(t){function n(){return this.process_val=e(this.process_val,this),k=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Round",n.group_name="Math",n.prototype.process_val=function(e){return Math.round(e)},n}(b),MathCeil:s=function(t){function n(){return this.process_val=e(this.process_val,this),A=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Ceil",n.group_name="Math",n.prototype.process_val=function(e){return Math.ceil(e)},n}(b),MathFloor:h=function(t){function n(){return this.process_val=e(this.process_val,this),P=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Floor",n.group_name="Math",n.prototype.process_val=function(e){return Math.floor(e)},n}(b),NodeNumberParam1:_=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.apply_num_to_vec3=e(this.apply_num_to_vec3,this),this.apply_num_to_vec2=e(this.apply_num_to_vec2,this),this.process_val=e(this.process_val,this),F=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.process_val=function(e,t){return e+t},n.prototype.apply_num_to_vec2=function(e,t,i){switch($.type(e)){case"number":return new THREE.Vector2(this.process_val(e,t.x,i),this.process_val(e,t.y,i));case"object":return new THREE.Vector2(this.process_val(e.x,t,i),this.process_val(e.y,t,i))}},n.prototype.apply_num_to_vec3=function(e,t,i){switch($.type(e)){case"number":return new THREE.Vector3(this.process_val(e,t.x,i),this.process_val(e,t.y,i),this.process_val(e,t.z,i));case"object":return new THREE.Vector3(this.process_val(e.x,t,i),this.process_val(e.y,t,i),this.process_val(e.z,t,i))}},n.prototype.remove=function(){return delete this.v_factor,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r,o;for(r=[],t=this.fields.getMaxInputSliceCount(),e=o=0;t>=0?t>=o:o>=t;e=t>=0?++o:--o)switch(i=this.v_in.getValue(e),n=this.v_factor.getValue(e),$.type(i)){case"number":switch($.type(n)){case"number":r[e]=this.process_val(i,n,e);break;case"object":switch(n.constructor){case THREE.Vector2:r[e]=this.apply_num_to_vec2(i,n,e);break;case THREE.Vector3:r[e]=this.apply_num_to_vec3(i,n,e)}}break;case"object":switch(i.constructor){case THREE.Vector2:switch($.type(n)){case"number":r[e]=this.apply_num_to_vec2(i,n,e);break;case"object":r[e]=new THREE.Vector2(this.process_val(i.x,n.x,e),this.process_val(i.y,n.y,e))}break;case THREE.Vector3:switch($.type(n)){case"number":r[e]=this.apply_num_to_vec3(i,n,e);break;case"object":r[e]=new THREE.Vector3(this.process_val(i.x,n.x,e),this.process_val(i.y,n.y,e),this.process_val(i.z,n.z,e))}}}return this.v_out.setValue(r),!0},n}(b),MathMod:d=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),D=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Mod",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{y:{type:"Float",val:2}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("y")},n.prototype.process_val=function(e,t){return e%t},n}(_),MathAdd:r=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),N=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Add",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{y:{type:"Float",val:1}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("y")},n.prototype.process_val=function(e,t){return e+t},n}(_),MathSubtract:g=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),z=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Subtract",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{y:{type:"Float",val:1}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("y")},n.prototype.process_val=function(e,t){return e-t},n}(_),MathMult:p=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),w=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Mult",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{factor:{type:"Float",val:2}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("factor")},n.prototype.process_val=function(e,t){return e*t},n}(_),MathDivide:l=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),R=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Divide",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{y:{type:"Float",val:2}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("y")},n.prototype.process_val=function(e,t){return e/t},n}(_),MathMin:u=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),S=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Min",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{in2:{type:"Float",val:0}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("in2")},n.prototype.process_val=function(e,t){return Math.min(e,t)},n}(_),MathMax:c=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),C=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Max",n.group_name="Math",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{in2:{type:"Float",val:0}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.v_factor=this.fields.getField("in2")},n.prototype.process_val=function(e,t){return Math.max(e,t)},n}(_),MathAttenuation:o=function(t){function n(){return this.process_val=e(this.process_val,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),H=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Attenuation",n.group_name="Math",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.val=0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{"default":0,reset:!1,factor:.8}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return n.__super__.onFieldsCreated.apply(this,arguments),this.def_val=this.fields.getField("default"),this.reset_val=this.fields.getField("reset"),this.v_factor=this.fields.getField("factor"),this.val=this.def_val.getValue()},n.prototype.process_val=function(e,t,i){return this.reset_val.getValue(i)===!0&&(this.val=this.def_val.getValue(i)),this.val=this.val+(this.v_in.getValue(i)-this.val)*this.v_factor.getValue(i),this.val},n}(_)})})}.call(this);var THREE={REVISION:"64"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},String.prototype.trim=String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")},THREE.extend=function(e,t){if(Object.keys)for(var i=Object.keys(t),n=0,r=i.length;r>n;n++){var o=i[n];Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}else{var s={}.hasOwnProperty;for(var o in t)s.call(t,o)&&(e[o]=t[o])}return e},function(){for(var e=0,t=["ms","moz","webkit","o"],i=0;i<t.length&&!self.requestAnimationFrame;++i)self.requestAnimationFrame=self[t[i]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[i]+"CancelAnimationFrame"]||self[t[i]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var i=Date.now(),n=Math.max(0,16-(i-e)),r=self.setTimeout(function(){t(i+n)},n);return e=i+n,r}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return void 0!==e&&this.set(e),this},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(255&e>>16)/255,this.g=(255&e>>8)/255,this.b=(255&e)/255,this},setRGB:function(e,t,i){return this.r=e,this.g=t,this.b=i,this},setHSL:function(e,t,i){if(0===t)this.r=this.g=this.b=i;else{var n=function(e,t,i){return 0>i&&(i+=1),i>1&&(i-=1),1/6>i?e+6*(t-e)*i:.5>i?t:2/3>i?e+6*(t-e)*(2/3-i):e},r=.5>=i?i*(1+t):i+t-i*t,o=2*i-r;this.r=n(o,r,e+1/3),this.g=n(o,r,e),this.b=n(o,r,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e)){var t=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e);return this.r=Math.min(255,parseInt(t[1],10))/255,this.g=Math.min(255,parseInt(t[2],10))/255,this.b=Math.min(255,parseInt(t[3],10))/255,this}if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e)){var t=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e);return this.r=Math.min(100,parseInt(t[1],10))/100,this.g=Math.min(100,parseInt(t[2],10))/100,this.b=Math.min(100,parseInt(t[3],10))/100,this}if(/^\#([0-9a-f]{6})$/i.test(e)){var t=/^\#([0-9a-f]{6})$/i.exec(e);return this.setHex(parseInt(t[1],16)),this}if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e)){var t=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e);return this.setHex(parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3],16)),this}return/^(\w+)$/i.test(e)?(this.setHex(THREE.ColorKeywords[e]),this):void 0},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,i=this.b;return this.r=e*e,this.g=t*t,this.b=i*i,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){var t,i,n=e||{h:0,s:0,l:0},r=this.r,o=this.g,s=this.b,a=Math.max(r,o,s),l=Math.min(r,o,s),h=(l+a)/2;if(l===a)t=0,i=0;else{var c=a-l;switch(i=.5>=h?c/(a+l):c/(2-a-l),a){case r:t=(o-s)/c+(s>o?6:0);break;case o:t=(s-r)/c+2;break;case s:t=(r-o)/c+4}t/=6}return n.h=t,n.s=i,n.l=h,n},getStyle:function(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function(e,t,i){var n=this.getHSL();return n.h+=e,n.s+=t,n.l+=i,this.setHSL(n.h,n.s,n.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._w=void 0!==n?n:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._w=n,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(e instanceof THREE.Euler==!1)throw new Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var i=Math.cos(e._x/2),n=Math.cos(e._y/2),r=Math.cos(e._z/2),o=Math.sin(e._x/2),s=Math.sin(e._y/2),a=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"YXZ"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"ZXY"===e.order?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r-o*s*a):"ZYX"===e.order?(this._x=o*n*r-i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r+o*s*a):"YZX"===e.order?(this._x=o*n*r+i*s*a,this._y=i*s*r+o*n*a,this._z=i*n*a-o*s*r,this._w=i*n*r-o*s*a):"XZY"===e.order&&(this._x=o*n*r-i*s*a,this._y=i*s*r-o*n*a,this._z=i*n*a+o*s*r,this._w=i*n*r+o*s*a),t!==!1&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var i=t/2,n=Math.sin(i);return this._x=e.x*n,this._y=e.y*n,this._z=e.z*n,this._w=Math.cos(i),this._updateEuler(),this},setFromRotationMatrix:function(e){var t,i=e.elements,n=i[0],r=i[4],o=i[8],s=i[1],a=i[5],l=i[9],h=i[2],c=i[6],u=i[10],d=n+a+u;return d>0?(t=.5/Math.sqrt(d+1),this._w=.25/t,this._x=(c-l)*t,this._y=(o-h)*t,this._z=(s-r)*t):n>a&&n>u?(t=2*Math.sqrt(1+n-a-u),this._w=(c-l)/t,this._x=.25*t,this._y=(r+s)/t,this._z=(o+h)/t):a>u?(t=2*Math.sqrt(1+a-n-u),this._w=(o-h)/t,this._x=(r+s)/t,this._y=.25*t,this._z=(l+c)/t):(t=2*Math.sqrt(1+u-n-a),this._w=(s-r)/t,this._x=(o+h)/t,this._y=(l+c)/t,this._z=.25*t),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var i=e._x,n=e._y,r=e._z,o=e._w,s=t._x,a=t._y,l=t._z,h=t._w;return this._x=i*h+o*s+n*l-r*a,this._y=n*h+o*a+r*s-i*l,this._z=r*h+o*l+i*a-n*s,this._w=o*h-i*s-n*a-r*l,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var i=this._x,n=this._y,r=this._z,o=this._w,s=o*e._w+i*e._x+n*e._y+r*e._z;if(0>s?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,s=-s):this.copy(e),s>=1)return this._w=o,this._x=i,this._y=n,this._z=r,this;var a=Math.acos(s),l=Math.sqrt(1-s*s);if(Math.abs(l)<.001)return this._w=.5*(o+this._w),this._x=.5*(i+this._x),this._y=.5*(n+this._y),this._z=.5*(r+this._z),this;var h=Math.sin((1-t)*a)/l,c=Math.sin(t*a)/l;return this._w=o*h+this._w*c,this._x=i*h+this._x*c,this._y=n*h+this._y*c,this._z=r*h+this._z*c,this._updateEuler(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,i,n){return i.copy(e).slerp(t,n)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t}else this.x=0,this.y=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y;return t*t+i*i},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,i){this.x=e||0,this.y=t||0,this.z=i||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,i){return this.x=e,this.y=t,this.z=i,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyMatrix3:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6]*n,this.y=r[1]*t+r[4]*i+r[7]*n,this.z=r[2]*t+r[5]*i+r[8]*n,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},applyProjection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements,o=1/(r[3]*t+r[7]*i+r[11]*n+r[15]);return this.x=(r[0]*t+r[4]*i+r[8]*n+r[12])*o,this.y=(r[1]*t+r[5]*i+r[9]*n+r[13])*o,this.z=(r[2]*t+r[6]*i+r[10]*n+r[14])*o,this},applyQuaternion:function(e){var t=this.x,i=this.y,n=this.z,r=e.x,o=e.y,s=e.z,a=e.w,l=a*t+o*n-s*i,h=a*i+s*t-r*n,c=a*n+r*i-o*t,u=-r*t-o*i-s*n;return this.x=l*a+u*-r+h*-s-c*-o,this.y=h*a+u*-o+c*-r-l*-s,this.z=c*a+u*-s+l*-o-h*-r,this},transformDirection:function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n,this.y=r[1]*t+r[5]*i+r[9]*n,this.z=r[2]*t+r[6]*i+r[10]*n,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t}else this.x=0,this.y=0,this.z=0;return this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var i=this.x,n=this.y,r=this.z;return this.x=n*e.z-r*e.y,this.y=r*e.x-i*e.z,this.z=i*e.y-n*e.x,this},crossVectors:function(e,t){var i=e.x,n=e.y,r=e.z,o=t.x,s=t.y,a=t.z;return this.x=n*a-r*s,this.y=r*o-i*a,this.z=i*s-n*o,this},angleTo:function(e){var t=this.dot(e)/(this.length()*e.length());return Math.acos(THREE.Math.clamp(t,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,i=this.y-e.y,n=this.z-e.z;return t*t+i*i+n*n},setEulerFromRotationMatrix:function(){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)
},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),i=this.set(e.elements[4],e.elements[5],e.elements[6]).length(),n=this.set(e.elements[8],e.elements[9],e.elements[10]).length();return this.x=t,this.y=i,this.z=n,this},setFromMatrixColumn:function(e,t){var i=4*e,n=t.elements;return this.x=n[i],this.y=n[i+1],this.z=n[i+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.extend(THREE.Vector3.prototype,{applyEuler:function(){var e=new THREE.Quaternion;return function(t){return t instanceof THREE.Euler==!1&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e=new THREE.Quaternion;return function(t,i){return this.applyQuaternion(e.setFromAxisAngle(t,i)),this}}(),projectOnVector:function(){var e=new THREE.Vector3;return function(t){e.copy(t).normalize();var i=this.dot(e);return this.copy(e).multiplyScalar(i)}}(),projectOnPlane:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e=new THREE.Vector3;return function(t){return e.copy(this).projectOnVector(t).multiplyScalar(2),this.subVectors(e,this)}}()}),THREE.Vector4=function(e,t,i,n){this.x=e||0,this.y=t||0,this.z=i||0,this.w=void 0!==n?n:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,i,n){return this.x=e,this.y=t,this.z=i,this.w=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,i=this.y,n=this.z,r=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*n+o[12]*r,this.y=o[1]*t+o[5]*i+o[9]*n+o[13]*r,this.z=o[2]*t+o[6]*i+o[10]*n+o[14]*r,this.w=o[3]*t+o[7]*i+o[11]*n+o[15]*r,this},divideScalar:function(e){if(0!==e){var t=1/e;this.x*=t,this.y*=t,this.z*=t,this.w*=t}else this.x=0,this.y=0,this.z=0,this.w=1;return this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,i,n,r,o=.01,s=.1,a=e.elements,l=a[0],h=a[4],c=a[8],u=a[1],d=a[5],p=a[9],f=a[2],m=a[6],g=a[10];if(Math.abs(h-u)<o&&Math.abs(c-f)<o&&Math.abs(p-m)<o){if(Math.abs(h+u)<s&&Math.abs(c+f)<s&&Math.abs(p+m)<s&&Math.abs(l+d+g-3)<s)return this.set(1,0,0,0),this;t=Math.PI;var v=(l+1)/2,y=(d+1)/2,_=(g+1)/2,b=(h+u)/4,E=(c+f)/4,x=(p+m)/4;return v>y&&v>_?o>v?(i=0,n=.707106781,r=.707106781):(i=Math.sqrt(v),n=b/i,r=E/i):y>_?o>y?(i=.707106781,n=0,r=.707106781):(n=Math.sqrt(y),i=b/n,r=x/n):o>_?(i=.707106781,n=.707106781,r=0):(r=Math.sqrt(_),i=E/r,n=x/r),this.set(i,n,r,t),this}var T=Math.sqrt((m-p)*(m-p)+(c-f)*(c-f)+(u-h)*(u-h));return Math.abs(T)<.001&&(T=1),this.x=(m-p)/T,this.y=(c-f)/T,this.z=(u-h)/T,this.w=Math.acos((l+d+g-1)/2),this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,i,n){this._x=e||0,this._y=t||0,this._z=i||0,this._order=n||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,i,n){return this._x=e,this._y=t,this._z=i,this._order=n||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function i(e){return Math.min(Math.max(e,-1),1)}var n=e.elements,r=n[0],o=n[4],s=n[8],a=n[1],l=n[5],h=n[9],c=n[2],u=n[6],d=n[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(i(s)),Math.abs(s)<.99999?(this._x=Math.atan2(-h,d),this._z=Math.atan2(-o,r)):(this._x=Math.atan2(u,l),this._z=0)):"YXZ"===t?(this._x=Math.asin(-i(h)),Math.abs(h)<.99999?(this._y=Math.atan2(s,d),this._z=Math.atan2(a,l)):(this._y=Math.atan2(-c,r),this._z=0)):"ZXY"===t?(this._x=Math.asin(i(u)),Math.abs(u)<.99999?(this._y=Math.atan2(-c,d),this._z=Math.atan2(-o,l)):(this._y=0,this._z=Math.atan2(a,r))):"ZYX"===t?(this._y=Math.asin(-i(c)),Math.abs(c)<.99999?(this._x=Math.atan2(u,d),this._z=Math.atan2(a,r)):(this._x=0,this._z=Math.atan2(-o,l))):"YZX"===t?(this._z=Math.asin(i(a)),Math.abs(a)<.99999?(this._x=Math.atan2(-h,l),this._y=Math.atan2(-c,r)):(this._x=0,this._y=Math.atan2(s,d))):"XZY"===t?(this._z=Math.asin(-i(o)),Math.abs(o)<.99999?(this._x=Math.atan2(u,l),this._y=Math.atan2(s,r)):(this._x=Math.atan2(-h,d),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,i){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.x*e.x,o=e.y*e.y,s=e.z*e.z,a=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),a-r-o+s),this._y=Math.asin(n(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),a+r-o-s)):"YXZ"===t?(this._x=Math.asin(n(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),a-r-o+s),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),a-r+o-s)):"ZXY"===t?(this._x=Math.asin(n(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),a-r-o+s),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),a-r+o-s)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),a-r-o+s),this._y=Math.asin(n(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),a+r-o-s)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),a-r+o-s),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),a+r-o-s),this._z=Math.asin(n(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),a-r+o-s),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),a+r-o-s),this._z=Math.asin(n(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,i!==!1&&this._updateQuaternion(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var i=t||new THREE.Vector3;return this.delta(i).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n){e.subVectors(i,this.start),t.subVectors(this.end,this.start);var r=t.dot(t),o=t.dot(e),s=o/r;return n&&(s=THREE.Math.clamp(s,0,1)),s}}(),closestPointToPoint:function(e,t,i){var n=this.closestPointToPointParameter(e,t),r=i||new THREE.Vector3;return this.delta(r).multiplyScalar(n).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(1/0,1/0),this.max=void 0!==t?t:new THREE.Vector2(-1/0,-1/0)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)t=e[i],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){var t=e||new THREE.Vector2;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector2;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){var i=t||new THREE.Vector2;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){var i=t||new THREE.Vector2;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(1/0,1/0,1/0),this.max=void 0!==t?t:new THREE.Vector3(-1/0,-1/0,-1/0)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(e.length>0){var t=e[0];this.min.copy(t),this.max.copy(t);for(var i=1,n=e.length;n>i;i++)this.addPoint(e[i])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,i){var n=e.copy(i).multiplyScalar(.5);return this.min.copy(t).sub(n),this.max.copy(t).add(n),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var i=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var n=t.geometry.vertices,r=0,o=n.length;o>r;r++)e.copy(n[r]),e.applyMatrix4(t.matrixWorld),i.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){var t=e||new THREE.Vector3;return t.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){var i=t||new THREE.Vector3;return i.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){var i=t||new THREE.Vector3;return i.copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.copy(t).clamp(this.min,this.max);return i.sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){var i=t||new THREE.Sphere;return i.center=this.center(),i.radius=.5*this.size(e).length(),i}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,i,n,r,o,s,a,l){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,i||0,n||0,void 0!==r?r:1,o||0,s||0,a||0,void 0!==l?l:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,i,n,r,o,s,a,l){var h=this.elements;return h[0]=e,h[3]=t,h[6]=i,h[1]=n,h[4]=r,h[7]=o,h[2]=s,h[5]=a,h[8]=l,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],t[1],t[4],t[7],t[2],t[5],t[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyMatrix3(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],i=e[1],n=e[2],r=e[3],o=e[4],s=e[5],a=e[6],l=e[7],h=e[8];return t*o*h-t*s*l-i*r*h+i*s*a+n*r*l-n*o*a},getInverse:function(e,t){var i=e.elements,n=this.elements;n[0]=i[10]*i[5]-i[6]*i[9],n[1]=-i[10]*i[1]+i[2]*i[9],n[2]=i[6]*i[1]-i[2]*i[5],n[3]=-i[10]*i[4]+i[6]*i[8],n[4]=i[10]*i[0]-i[2]*i[8],n[5]=-i[6]*i[0]+i[2]*i[4],n[6]=i[9]*i[4]-i[5]*i[8],n[7]=-i[9]*i[0]+i[1]*i[8],n[8]=i[5]*i[0]-i[1]*i[4];var r=i[0]*n[0]+i[1]*n[3]+i[2]*n[6];if(0===r){var o="Matrix3.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(o);return console.warn(o),this.identity(),this}return this.multiplyScalar(1/r),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,i,n,r,o,s,a,l,h,c,u,d,p,f,m){this.elements=new Float32Array(16);var g=this.elements;g[0]=void 0!==e?e:1,g[4]=t||0,g[8]=i||0,g[12]=n||0,g[1]=r||0,g[5]=void 0!==o?o:1,g[9]=s||0,g[13]=a||0,g[2]=l||0,g[6]=h||0,g[10]=void 0!==c?c:1,g[14]=u||0,g[3]=d||0,g[7]=p||0,g[11]=f||0,g[15]=void 0!==m?m:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,i,n,r,o,s,a,l,h,c,u,d,p,f,m){var g=this.elements;return g[0]=e,g[4]=t,g[8]=i,g[12]=n,g[1]=r,g[5]=o,g[9]=s,g[13]=a,g[2]=l,g[6]=h,g[10]=c,g[14]=u,g[3]=d,g[7]=p,g[11]=f,g[15]=m,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var i=this.elements,n=t.elements,r=1/e.set(n[0],n[1],n[2]).length(),o=1/e.set(n[4],n[5],n[6]).length(),s=1/e.set(n[8],n[9],n[10]).length();return i[0]=n[0]*r,i[1]=n[1]*r,i[2]=n[2]*r,i[4]=n[4]*o,i[5]=n[5]*o,i[6]=n[6]*o,i[8]=n[8]*s,i[9]=n[9]*s,i[10]=n[10]*s,this}}(),makeRotationFromEuler:function(e){e instanceof THREE.Euler==!1&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,i=e.x,n=e.y,r=e.z,o=Math.cos(i),s=Math.sin(i),a=Math.cos(n),l=Math.sin(n),h=Math.cos(r),c=Math.sin(r);if("XYZ"===e.order){var u=o*h,d=o*c,p=s*h,f=s*c;t[0]=a*h,t[4]=-a*c,t[8]=l,t[1]=d+p*l,t[5]=u-f*l,t[9]=-s*a,t[2]=f-u*l,t[6]=p+d*l,t[10]=o*a}else if("YXZ"===e.order){var m=a*h,g=a*c,v=l*h,y=l*c;t[0]=m+y*s,t[4]=v*s-g,t[8]=o*l,t[1]=o*c,t[5]=o*h,t[9]=-s,t[2]=g*s-v,t[6]=y+m*s,t[10]=o*a}else if("ZXY"===e.order){var m=a*h,g=a*c,v=l*h,y=l*c;t[0]=m-y*s,t[4]=-o*c,t[8]=v+g*s,t[1]=g+v*s,t[5]=o*h,t[9]=y-m*s,t[2]=-o*l,t[6]=s,t[10]=o*a}else if("ZYX"===e.order){var u=o*h,d=o*c,p=s*h,f=s*c;t[0]=a*h,t[4]=p*l-d,t[8]=u*l+f,t[1]=a*c,t[5]=f*l+u,t[9]=d*l-p,t[2]=-l,t[6]=s*a,t[10]=o*a}else if("YZX"===e.order){var _=o*a,b=o*l,E=s*a,x=s*l;t[0]=a*h,t[4]=x-_*c,t[8]=E*c+b,t[1]=c,t[5]=o*h,t[9]=-s*h,t[2]=-l*h,t[6]=b*c+E,t[10]=_-x*c}else if("XZY"===e.order){var _=o*a,b=o*l,E=s*a,x=s*l;t[0]=a*h,t[4]=-c,t[8]=l*h,t[1]=_*c+x,t[5]=o*h,t[9]=b*c-E,t[2]=E*c-b,t[6]=s*h,t[10]=x*c+_}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z,o=e.w,s=i+i,a=n+n,l=r+r,h=i*s,c=i*a,u=i*l,d=n*a,p=n*l,f=r*l,m=o*s,g=o*a,v=o*l;return t[0]=1-(d+f),t[4]=c-v,t[8]=u+g,t[1]=c+v,t[5]=1-(h+f),t[9]=p-m,t[2]=u-g,t[6]=p+m,t[10]=1-(h+d),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o){var s=this.elements;return i.subVectors(n,r).normalize(),0===i.length()&&(i.z=1),e.crossVectors(o,i).normalize(),0===e.length()&&(i.x+=1e-4,e.crossVectors(o,i).normalize()),t.crossVectors(i,e),s[0]=e.x,s[4]=t.x,s[8]=i.x,s[1]=e.y,s[5]=t.y,s[9]=i.y,s[2]=e.z,s[6]=t.z,s[10]=i.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var i=e.elements,n=t.elements,r=this.elements,o=i[0],s=i[4],a=i[8],l=i[12],h=i[1],c=i[5],u=i[9],d=i[13],p=i[2],f=i[6],m=i[10],g=i[14],v=i[3],y=i[7],_=i[11],b=i[15],E=n[0],x=n[4],T=n[8],w=n[12],R=n[1],S=n[5],C=n[9],H=n[13],M=n[2],k=n[6],A=n[10],P=n[14],F=n[3],D=n[7],N=n[11],z=n[15];return r[0]=o*E+s*R+a*M+l*F,r[4]=o*x+s*S+a*k+l*D,r[8]=o*T+s*C+a*A+l*N,r[12]=o*w+s*H+a*P+l*z,r[1]=h*E+c*R+u*M+d*F,r[5]=h*x+c*S+u*k+d*D,r[9]=h*T+c*C+u*A+d*N,r[13]=h*w+c*H+u*P+d*z,r[2]=p*E+f*R+m*M+g*F,r[6]=p*x+f*S+m*k+g*D,r[10]=p*T+f*C+m*A+g*N,r[14]=p*w+f*H+m*P+g*z,r[3]=v*E+y*R+_*M+b*F,r[7]=v*x+y*S+_*k+b*D,r[11]=v*T+y*C+_*A+b*N,r[15]=v*w+y*H+_*P+b*z,this},multiplyToArray:function(e,t,i){var n=this.elements;return this.multiplyMatrices(e,t),i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var i=0,n=t.length;n>i;i+=3)e.x=t[i],e.y=t[i+1],e.z=t[i+2],e.applyProjection(this),t[i]=e.x,t[i+1]=e.y,t[i+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],i=e[4],n=e[8],r=e[12],o=e[1],s=e[5],a=e[9],l=e[13],h=e[2],c=e[6],u=e[10],d=e[14],p=e[3],f=e[7],m=e[11],g=e[15];return p*(+r*a*c-n*l*c-r*s*u+i*l*u+n*s*d-i*a*d)+f*(+t*a*d-t*l*u+r*o*u-n*o*d+n*l*h-r*a*h)+m*(+t*l*c-t*s*d-r*o*c+i*o*d+r*s*h-i*l*h)+g*(-n*s*h-t*a*c+t*s*u+n*o*c-i*o*u+i*a*h)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var i=this.elements,n=e.elements,r=n[0],o=n[4],s=n[8],a=n[12],l=n[1],h=n[5],c=n[9],u=n[13],d=n[2],p=n[6],f=n[10],m=n[14],g=n[3],v=n[7],y=n[11],_=n[15];i[0]=c*m*v-u*f*v+u*p*y-h*m*y-c*p*_+h*f*_,i[4]=a*f*v-s*m*v-a*p*y+o*m*y+s*p*_-o*f*_,i[8]=s*u*v-a*c*v+a*h*y-o*u*y-s*h*_+o*c*_,i[12]=a*c*p-s*u*p-a*h*f+o*u*f+s*h*m-o*c*m,i[1]=u*f*g-c*m*g-u*d*y+l*m*y+c*d*_-l*f*_,i[5]=s*m*g-a*f*g+a*d*y-r*m*y-s*d*_+r*f*_,i[9]=a*c*g-s*u*g-a*l*y+r*u*y+s*l*_-r*c*_,i[13]=s*u*d-a*c*d+a*l*f-r*u*f-s*l*m+r*c*m,i[2]=h*m*g-u*p*g+u*d*v-l*m*v-h*d*_+l*p*_,i[6]=a*p*g-o*m*g-a*d*v+r*m*v+o*d*_-r*p*_,i[10]=o*u*g-a*h*g+a*l*v-r*u*v-o*l*_+r*h*_,i[14]=a*h*d-o*u*d-a*l*p+r*u*p+o*l*m-r*h*m,i[3]=c*p*g-h*f*g-c*d*v+l*f*v+h*d*y-l*p*y,i[7]=o*f*g-s*p*g+s*d*v-r*f*v-o*d*y+r*p*y,i[11]=s*h*g-o*c*g-s*l*v+r*c*v+o*l*y-r*h*y,i[15]=o*c*d-s*h*d+s*l*p-r*c*p-o*l*f+r*h*f;var b=r*i[0]+l*i[4]+d*i[8]+g*i[12];if(0==b){var E="Matrix4.getInverse(): can't invert matrix, determinant is 0";if(t)throw new Error(E);return console.warn(E),this.identity(),this}return this.multiplyScalar(1/b),this},translate:function(){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,i=e.x,n=e.y,r=e.z;return t[0]*=i,t[4]*=n,t[8]*=r,t[1]*=i,t[5]*=n,t[9]*=r,t[2]*=i,t[6]*=n,t[10]*=r,t[3]*=i,t[7]*=n,t[11]*=r,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],n=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,Math.max(i,n)))},makeTranslation:function(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var i=Math.cos(t),n=Math.sin(t),r=1-i,o=e.x,s=e.y,a=e.z,l=r*o,h=r*s;return this.set(l*o+i,l*s-n*a,l*a+n*s,0,l*s+n*a,h*s+i,h*a-n*o,0,l*a-n*s,h*a+n*o,r*a*a+i,0,0,0,0,1),this},makeScale:function(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this},compose:function(e,t,i){return this.makeRotationFromQuaternion(t),this.scale(i),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(i,n,r){var o=this.elements,s=e.set(o[0],o[1],o[2]).length(),a=e.set(o[4],o[5],o[6]).length(),l=e.set(o[8],o[9],o[10]).length();i.x=o[12],i.y=o[13],i.z=o[14],t.elements.set(this.elements);var h=1/s,c=1/a,u=1/l;return t.elements[0]*=h,t.elements[1]*=h,t.elements[2]*=h,t.elements[4]*=c,t.elements[5]*=c,t.elements[6]*=c,t.elements[8]*=u,t.elements[9]*=u,t.elements[10]*=u,n.setFromRotationMatrix(t),r.x=s,r.y=a,r.z=l,this}}(),makeFrustum:function(e,t,i,n,r,o){var s=this.elements,a=2*r/(t-e),l=2*r/(n-i),h=(t+e)/(t-e),c=(n+i)/(n-i),u=-(o+r)/(o-r),d=-2*o*r/(o-r);return s[0]=a,s[4]=0,s[8]=h,s[12]=0,s[1]=0,s[5]=l,s[9]=c,s[13]=0,s[2]=0,s[6]=0,s[10]=u,s[14]=d,s[3]=0,s[7]=0,s[11]=-1,s[15]=0,this},makePerspective:function(e,t,i,n){var r=i*Math.tan(THREE.Math.degToRad(.5*e)),o=-r,s=o*t,a=r*t;return this.makeFrustum(s,a,o,r,i,n)},makeOrthographic:function(e,t,i,n,r,o){var s=this.elements,a=t-e,l=i-n,h=o-r,c=(t+e)/a,u=(i+n)/l,d=(o+r)/h;return s[0]=2/a,s[4]=0,s[8]=0,s[12]=-c,s[1]=0,s[5]=2/l,s[9]=0,s[13]=-u,s[2]=0,s[6]=0,s[10]=-2/h,s[14]=-d,s[3]=0,s[7]=0,s[11]=0,s[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){var i=t||new THREE.Vector3;return i.copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var i=t||new THREE.Vector3;i.subVectors(e,this.origin);var n=i.dot(this.direction);
return 0>n?i.copy(this.origin):i.copy(this.direction).multiplyScalar(n).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var i=e.subVectors(t,this.origin).dot(this.direction);return 0>i?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(i).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,i,n){var r,o,s,a,l=e.clone().add(t).multiplyScalar(.5),h=t.clone().sub(e).normalize(),c=.5*e.distanceTo(t),u=this.origin.clone().sub(l),d=-this.direction.dot(h),p=u.dot(this.direction),f=-u.dot(h),m=u.lengthSq(),g=Math.abs(1-d*d);if(g>=0)if(r=d*f-p,o=d*p-f,a=c*g,r>=0)if(o>=-a)if(a>=o){var v=1/g;r*=v,o*=v,s=r*(r+d*o+2*p)+o*(d*r+o+2*f)+m}else o=c,r=Math.max(0,-(d*o+p)),s=-r*r+o*(o+2*f)+m;else o=-c,r=Math.max(0,-(d*o+p)),s=-r*r+o*(o+2*f)+m;else-a>=o?(r=Math.max(0,-(-d*c+p)),o=r>0?-c:Math.min(Math.max(-c,-f),c),s=-r*r+o*(o+2*f)+m):a>=o?(r=0,o=Math.min(Math.max(-c,-f),c),s=o*(o+2*f)+m):(r=Math.max(0,-(d*c+p)),o=r>0?c:Math.min(Math.max(-c,-f),c),s=-r*r+o*(o+2*f)+m);else o=d>0?-c:c,r=Math.max(0,-(d*o+p)),s=-r*r+o*(o+2*f)+m;return i&&i.copy(this.direction.clone().multiplyScalar(r).add(this.origin)),n&&n.copy(h.clone().multiplyScalar(o).add(l)),s},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);if(0===t)return!0;var i=e.normal.dot(this.direction);return 0>i*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(0==t)return 0==e.distanceToPoint(this.origin)?0:null;var i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null},intersectPlane:function(e,t){var i=this.distanceToPlane(e);return null===i?null:this.at(i,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var i,n,r,o,s,a,l=1/this.direction.x,h=1/this.direction.y,c=1/this.direction.z,u=this.origin;return l>=0?(i=(e.min.x-u.x)*l,n=(e.max.x-u.x)*l):(i=(e.max.x-u.x)*l,n=(e.min.x-u.x)*l),h>=0?(r=(e.min.y-u.y)*h,o=(e.max.y-u.y)*h):(r=(e.max.y-u.y)*h,o=(e.min.y-u.y)*h),i>o||r>n?null:((r>i||i!==i)&&(i=r),(n>o||n!==n)&&(n=o),c>=0?(s=(e.min.z-u.z)*c,a=(e.max.z-u.z)*c):(s=(e.max.z-u.z)*c,a=(e.min.z-u.z)*c),i>a||s>n?null:((s>i||i!==i)&&(i=s),(n>a||n!==n)&&(n=a),0>n?null:this.at(i>=0?i:n,t)))},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3,n=new THREE.Vector3;return function(r,o,s,a,l){t.subVectors(o,r),i.subVectors(s,r),n.crossVectors(t,i);var h,c=this.direction.dot(n);if(c>0){if(a)return null;h=1}else{if(!(0>c))return null;h=-1,c=-c}e.subVectors(this.origin,r);var u=h*this.direction.dot(i.crossVectors(e,i));if(0>u)return null;var d=h*this.direction.dot(t.cross(e));if(0>d)return null;if(u+d>c)return null;var p=-h*e.dot(n);return 0>p?null:this.at(p/c,l)}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,i){var n=this.center;void 0!==i?n.copy(i):e.setFromPoints(t).center(n);for(var r=0,o=0,s=t.length;s>o;o++)r=Math.max(r,n.distanceToSquared(t[o]));return this.radius=Math.sqrt(r),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var i=this.center.distanceToSquared(e),n=t||new THREE.Vector3;return n.copy(e),i>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n},getBoundingBox:function(e){var t=e||new THREE.Box3;return t.set(this.center,this.center),t.expandByScalar(this.radius),t},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,i,n,r,o){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==o?o:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,i,n,r,o){var s=this.planes;return s[0].copy(e),s[1].copy(t),s[2].copy(i),s[3].copy(n),s[4].copy(r),s[5].copy(o),this},copy:function(e){for(var t=this.planes,i=0;6>i;i++)t[i].copy(e.planes[i]);return this},setFromMatrix:function(e){var t=this.planes,i=e.elements,n=i[0],r=i[1],o=i[2],s=i[3],a=i[4],l=i[5],h=i[6],c=i[7],u=i[8],d=i[9],p=i[10],f=i[11],m=i[12],g=i[13],v=i[14],y=i[15];return t[0].setComponents(s-n,c-a,f-u,y-m).normalize(),t[1].setComponents(s+n,c+a,f+u,y+m).normalize(),t[2].setComponents(s+r,c+l,f+d,y+g).normalize(),t[3].setComponents(s-r,c-l,f-d,y-g).normalize(),t[4].setComponents(s-o,c-h,f-p,y-v).normalize(),t[5].setComponents(s+o,c+h,f+p,y+v).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var i=t.geometry;return null===i.boundingSphere&&i.computeBoundingSphere(),e.copy(i.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){for(var t=this.planes,i=e.center,n=-e.radius,r=0;6>r;r++){var o=t[r].distanceToPoint(i);if(n>o)return!1}return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){for(var n=this.planes,r=0;6>r;r++){var o=n[r];e.x=o.normal.x>0?i.min.x:i.max.x,t.x=o.normal.x>0?i.max.x:i.min.x,e.y=o.normal.y>0?i.min.y:i.max.y,t.y=o.normal.y>0?i.max.y:i.min.y,e.z=o.normal.z>0?i.min.z:i.max.z,t.z=o.normal.z>0?i.max.z:i.min.z;var s=o.distanceToPoint(e),a=o.distanceToPoint(t);if(0>s&&0>a)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,i=0;6>i;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,i,n){return this.normal.set(e,t,i),this.constant=n,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n,r){var o=e.subVectors(r,n).cross(t.subVectors(i,n)).normalize();return this.setFromNormalAndCoplanarPoint(o,i),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var i=this.distanceToPoint(e),n=t||new THREE.Vector3;return n.copy(this.normal).multiplyScalar(i)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return 0>t&&i>0||0>i&&t>0},intersectLine:function(){var e=new THREE.Vector3;return function(t,i){var n=i||new THREE.Vector3,r=t.delta(e),o=this.normal.dot(r);if(0==o)return 0==this.distanceToPoint(t.start)?n.copy(t.start):void 0;var s=-(t.start.dot(this.normal)+this.constant)/o;return 0>s||s>1?void 0:n.copy(r).multiplyScalar(s).add(t.start)}}(),coplanarPoint:function(e){var t=e||new THREE.Vector3;return t.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Matrix3;return function(n,r){var o=r||i.getNormalMatrix(n),s=e.copy(this.normal).applyMatrix3(o),a=this.coplanarPoint(t);return a.applyMatrix4(n),this.setFromNormalAndCoplanarPoint(s,a),this}}(),translate:function(e){return this.constant=this.constant-e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={PI2:2*Math.PI,generateUUID:function(){var e,t="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),i=new Array(36),n=0;return function(){for(var r=0;36>r;r++)8==r||13==r||18==r||23==r?i[r]="-":14==r?i[r]="4":(2>=n&&(n=0|33554432+16777216*Math.random()),e=15&n,n>>=4,i[r]=t[19==r?8|3&e:e]);return i.join("")}}(),clamp:function(e,t,i){return t>e?t:e>i?i:e},clampBottom:function(e,t){return t>e?t:e},mapLinear:function(e,t,i,n,r){return n+(e-t)*(r-n)/(i-t)},smoothstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*(3-2*e))},smootherstep:function(e,t,i){return t>=e?0:e>=i?1:(e=(e-t)/(i-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:e>0?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}()},THREE.Spline=function(e){function t(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t}this.points=e;var i,n,r,o,s,a,l,h,c,u=[],d={x:0,y:0,z:0};this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,n=Math.floor(i),r=i-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>this.points.length-2?this.points.length-1:n+1,u[3]=n>this.points.length-3?this.points.length-1:n+2,a=this.points[u[0]],l=this.points[u[1]],h=this.points[u[2]],c=this.points[u[3]],o=r*r,s=r*o,d.x=t(a.x,l.x,h.x,c.x,r,o,s),d.y=t(a.y,l.y,h.y,c.y,r,o,s),d.z=t(a.z,l.z,h.z,c.z,r,o,s),d},this.getControlPointsArray=function(){var e,t,i=this.points.length,n=[];for(e=0;i>e;e++)t=this.points[e],n[e]=[t.x,t.y,t.z];return n},this.getLength=function(e){var t,i,n,r,o=0,s=0,a=0,l=new THREE.Vector3,h=new THREE.Vector3,c=[],u=0;for(c[0]=0,e||(e=100),n=this.points.length*e,l.copy(this.points[0]),t=1;n>t;t++)i=t/n,r=this.getPoint(i),h.copy(r),u+=h.distanceTo(l),l.copy(r),o=(this.points.length-1)*i,s=Math.floor(o),s!=a&&(c[s]=u,a=s);return c[c.length]=u,{chunks:c,total:u}},this.reparametrizeByArcLength=function(e){var t,i,n,r,o,s,a,l,h=[],c=new THREE.Vector3,u=this.getLength();for(h.push(c.copy(this.points[0]).clone()),t=1;t<this.points.length;t++){for(s=u.chunks[t]-u.chunks[t-1],a=Math.ceil(e*s/u.total),r=(t-1)/(this.points.length-1),o=t/(this.points.length-1),i=1;a-1>i;i++)n=r+i*(1/a)*(o-r),l=this.getPoint(n),h.push(c.copy(l).clone());h.push(c.copy(this.points[t]).clone())}this.points=h}},THREE.Triangle=function(e,t,i){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==i?i:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,i,n,r){var o=r||new THREE.Vector3;o.subVectors(n,i),e.subVectors(t,i),o.cross(e);var s=o.lengthSq();return s>0?o.multiplyScalar(1/Math.sqrt(s)):o.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(n,r,o,s,a){e.subVectors(s,r),t.subVectors(o,r),i.subVectors(n,r);var l=e.dot(e),h=e.dot(t),c=e.dot(i),u=t.dot(t),d=t.dot(i),p=l*u-h*h,f=a||new THREE.Vector3;if(0==p)return f.set(-2,-1,-1);var m=1/p,g=(u*c-h*d)*m,v=(l*d-h*c)*m;return f.set(1-g-v,v,g)}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,i,n,r){var o=THREE.Triangle.barycoordFromPoint(t,i,n,r,e);return o.x>=0&&o.y>=0&&o.x+o.y<=1}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this},setFromPointsAndIndices:function(e,t,i,n){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[n]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){var t=e||new THREE.Vector3;return t.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){var t=e||new THREE.Plane;return t.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.oldTime=this.startTime,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running&&this.start(),this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now();e=.001*(t-this.oldTime),this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var i=this._listeners,n=i[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(){var e=[];return function(t){if(void 0!==this._listeners){var i=this._listeners,n=i[t.type];if(void 0!==n){t.target=this;for(var r=n.length,o=0;r>o;o++)e[o]=n[o];for(var o=0;r>o;o++)e[o].call(this,t)}}}}()},function(e){e.Raycaster=function(t,i,n,r){this.ray=new e.Ray(t,i),this.near=n||0,this.far=r||1/0};var t=new e.Sphere,i=new e.Ray;new e.Plane,new e.Vector3;var n=new e.Vector3,r=new e.Matrix4,o=function(e,t){return e.distance-t.distance},s=new e.Vector3,a=new e.Vector3,l=new e.Vector3,h=function(o,c,u){if(o instanceof e.Sprite){n.setFromMatrixPosition(o.matrixWorld);var d=c.ray.distanceToPoint(n);if(d>o.scale.x)return u;u.push({distance:d,point:o.position,face:null,object:o})}else if(o instanceof e.LOD){n.setFromMatrixPosition(o.matrixWorld);var d=c.ray.origin.distanceTo(n);h(o.getObjectForDistance(d),c,u)}else if(o instanceof e.Mesh){var p=o.geometry;if(null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),c.ray.isIntersectionSphere(t)===!1)return u;if(r.getInverse(o.matrixWorld),i.copy(c.ray).applyMatrix4(r),null!==p.boundingBox&&i.isIntersectionBox(p.boundingBox)===!1)return u;if(p instanceof e.BufferGeometry){var f=o.material;if(void 0===f)return u;if(p.dynamic===!1)return u;var m,g,v,y=c.precision;if(void 0!==p.attributes.index)for(var _=p.offsets,b=p.attributes.index.array,E=p.attributes.position.array,x=p.offsets.length,T=p.attributes.index.array.length/3,w=0;x>w;++w)for(var R=_[w].start,S=_[w].count,C=_[w].index,H=R,M=R+S;M>H;H+=3){if(m=C+b[H],g=C+b[H+1],v=C+b[H+2],s.set(E[3*m],E[3*m+1],E[3*m+2]),a.set(E[3*g],E[3*g+1],E[3*g+2]),l.set(E[3*v],E[3*v+1],E[3*v+2]),f.side===e.BackSide)var k=i.intersectTriangle(l,a,s,!0);else var k=i.intersectTriangle(s,a,l,f.side!==e.DoubleSide);if(null!==k){k.applyMatrix4(o.matrixWorld);var d=c.ray.origin.distanceTo(k);y>d||d<c.near||d>c.far||u.push({distance:d,point:k,face:null,faceIndex:null,object:o})}}else for(var _=p.offsets,E=p.attributes.position.array,x=p.offsets.length,T=p.attributes.position.array.length,H=0;T>H;H+=3){if(m=H,g=H+1,v=H+2,s.set(E[3*m],E[3*m+1],E[3*m+2]),a.set(E[3*g],E[3*g+1],E[3*g+2]),l.set(E[3*v],E[3*v+1],E[3*v+2]),f.side===e.BackSide)var k=i.intersectTriangle(l,a,s,!0);else var k=i.intersectTriangle(s,a,l,f.side!==e.DoubleSide);if(null!==k){k.applyMatrix4(o.matrixWorld);var d=c.ray.origin.distanceTo(k);y>d||d<c.near||d>c.far||u.push({distance:d,point:k,face:null,faceIndex:null,object:o})}}}else if(p instanceof e.Geometry)for(var m,g,v,A=o.material instanceof e.MeshFaceMaterial,P=A===!0?o.material.materials:null,y=c.precision,F=p.vertices,D=0,T=p.faces.length;T>D;D++){var N=p.faces[D],f=A===!0?P[N.materialIndex]:o.material;if(void 0!==f){if(m=F[N.a],g=F[N.b],v=F[N.c],f.side===e.BackSide)var k=i.intersectTriangle(v,g,m,!0);else var k=i.intersectTriangle(m,g,v,f.side!==e.DoubleSide);if(null!==k){k.applyMatrix4(o.matrixWorld);var d=c.ray.origin.distanceTo(k);y>d||d<c.near||d>c.far||u.push({distance:d,point:k,face:N,faceIndex:D,object:o})}}}}else if(o instanceof e.Line){var y=c.linePrecision,z=y*y,p=o.geometry;if(null===p.boundingSphere&&p.computeBoundingSphere(),t.copy(p.boundingSphere),t.applyMatrix4(o.matrixWorld),c.ray.isIntersectionSphere(t)===!1)return u;if(r.getInverse(o.matrixWorld),i.copy(c.ray).applyMatrix4(r),p instanceof e.Geometry)for(var F=p.vertices,L=F.length,I=new e.Vector3,O=new e.Vector3,V=o.type===e.LineStrip?1:2,H=0;L-1>H;H+=V){var B=i.distanceSqToSegment(F[H],F[H+1],O,I);if(!(B>z)){var d=i.origin.distanceTo(O);d<c.near||d>c.far||u.push({distance:d,point:I.clone().applyMatrix4(o.matrixWorld),face:null,faceIndex:null,object:o})}}}},c=function(e,t,i){for(var n=e.getDescendants(),r=0,o=n.length;o>r;r++)h(n[r],t,i)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var i=[];return t===!0&&c(e,this,i),h(e,this,i),i.sort(o),i},e.Raycaster.prototype.intersectObjects=function(e,t){for(var i=[],n=0,r=e.length;r>n;n++)h(e[n],this,i),t===!0&&c(e[n],this,i);return i.sort(o),i}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this._rotation=new THREE.Euler,this._quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.matrixAutoUpdate=!0,this.matrixWorldNeedsUpdate=!0,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(){var e=new THREE.Matrix4;return function(t){this.matrix.multiplyMatrices(t,this.matrix),this.position.setFromMatrixPosition(this.matrix),this.scale.setFromMatrixScale(this.matrix),e.extractRotation(this.matrix),this.quaternion.setFromRotationMatrix(e)}}(),setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,i){return e.setFromAxisAngle(t,i),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,i){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(i)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)return console.warn("THREE.Object3D.add: An object can't be added as a child of itself."),void 0;if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(var i=this;void 0!==i.parent;)i=i.parent;void 0!==i&&i instanceof THREE.Scene&&i.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,i=this.children.length;i>t;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.id===e)return r;if(t===!0&&(r=r.getObjectById(e,t),void 0!==r))return r}return void 0},getObjectByName:function(e,t){for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];if(r.name===e)return r;if(t===!0&&(r=r.getObjectByName(e,t),void 0!==r))return r}return void 0},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,i=this.children.length;i>t;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate===!0&&this.updateMatrix(),(this.matrixWorldNeedsUpdate===!0||e===!0)&&(void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){if(void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData)),t===!0)for(var i=0;i<this.children.length;i++){var n=this.children[i];e.add(n.clone())}return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===_){var e=new THREE.RenderableObject;return y.push(e),_++,l++,e}return y[l++]}function t(){if(c===E){var e=new THREE.RenderableVertex;return b.push(e),E++,c++,e}return b[c++]}function i(){if(d===T){var e=new THREE.RenderableFace3;return x.push(e),T++,d++,e}return x[d++]}function n(){if(f===R){var e=new THREE.RenderableLine;return w.push(e),R++,f++,e}return w[f++]}function r(){if(g===C){var e=new THREE.RenderableSprite;return S.push(e),C++,g++,e}return S[g++]}function o(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function s(e,t){var i=0,n=1,r=e.z+e.w,o=t.z+t.w,s=-e.z+e.w,a=-t.z+t.w;return r>=0&&o>=0&&s>=0&&a>=0?!0:0>r&&0>o||0>s&&0>a?!1:(0>r?i=Math.max(i,r/(r-o)):0>o&&(n=Math.min(n,r/(r-o))),0>s?i=Math.max(i,s/(s-a)):0>a&&(n=Math.min(n,s/(s-a))),i>n?!1:(e.lerp(t,i),t.lerp(e,1-n),!0))}var a,l,h,c,u,d,p,f,m,g,v,y=[],_=0,b=[],E=0,x=[],T=0,w=[],R=0,S=[],C=0,H={objects:[],sprites:[],lights:[],elements:[]},M=new THREE.Vector3,k=new THREE.Vector4,A=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),P=new THREE.Box3,F=new Array(3),D=(new Array(4),new THREE.Matrix4),N=new THREE.Matrix4,z=new THREE.Matrix4,L=new THREE.Matrix3,I=new THREE.Matrix3,O=new THREE.Vector3,V=new THREE.Frustum,B=new THREE.Vector4,U=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),N.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(N)},this.unprojectVector=function(e,t){return t.projectionMatrixInverse.getInverse(t.projectionMatrix),N.multiplyMatrices(t.matrixWorld,t.projectionMatrixInverse),e.applyProjection(N)},this.pickingRay=function(e,t){e.z=-1;var i=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(i,t),i.sub(e).normalize(),new THREE.Raycaster(e,i)};var j=function(t){return a=e(),a.id=t.id,a.object=t,null!==t.renderDepth?a.z=t.renderDepth:(M.setFromMatrixPosition(t.matrixWorld),M.applyProjection(N),a.z=M.z),a},W=function(e){if(e.visible!==!1){e instanceof THREE.Light?H.lights.push(e):e instanceof THREE.Mesh||e instanceof THREE.Line?(e.frustumCulled===!1||V.intersectsObject(e)===!0)&&H.objects.push(j(e)):e instanceof THREE.Sprite&&H.sprites.push(j(e));for(var t=0,i=e.children.length;i>t;t++)W(e.children[t])}},$=function(e,t){l=0,H.objects.length=0,H.sprites.length=0,H.lights.length=0,W(e),t===!0&&H.objects.sort(o)};this.projectScene=function(e,a,l,y){var _,E,x,T,w,R,S,C,M,j,W,G,q,X,Y,K,Q,J,Z,et,tt,it,nt,rt,ot,st=!1;for(d=0,f=0,g=0,H.elements.length=0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===a.parent&&a.updateMatrixWorld(),D.copy(a.matrixWorldInverse.getInverse(a.matrixWorld)),N.multiplyMatrices(a.projectionMatrix,D),I.getNormalMatrix(D),V.setFromMatrix(N),$(e,l),_=0,E=H.objects.length;E>_;_++)if(q=H.objects[_].object,v=q.matrixWorld,c=0,q instanceof THREE.Mesh){for(X=q.geometry,Y=X.vertices,K=X.faces,Z=X.faceVertexUvs,L.getNormalMatrix(v),rt=q.material instanceof THREE.MeshFaceMaterial,ot=rt===!0?q.material:null,x=0,T=Y.length;T>x;x++){h=t(),h.positionWorld.copy(Y[x]).applyMatrix4(v),h.positionScreen.copy(h.positionWorld).applyMatrix4(N);var at=1/h.positionScreen.w;h.positionScreen.x*=at,h.positionScreen.y*=at,h.positionScreen.z*=at,h.visible=!(h.positionScreen.x<-1||h.positionScreen.x>1||h.positionScreen.y<-1||h.positionScreen.y>1||h.positionScreen.z<-1||h.positionScreen.z>1)}for(w=0,R=K.length;R>w;w++){Q=K[w];var lt=rt===!0?ot.materials[Q.materialIndex]:q.material;if(void 0!==lt){var ht=lt.side;if(tt=b[Q.a],it=b[Q.b],nt=b[Q.c],F[0]=tt.positionScreen,F[1]=it.positionScreen,F[2]=nt.positionScreen,(tt.visible===!0||it.visible===!0||nt.visible===!0||A.isIntersectionBox(P.setFromPoints(F)))&&(st=(nt.positionScreen.x-tt.positionScreen.x)*(it.positionScreen.y-tt.positionScreen.y)-(nt.positionScreen.y-tt.positionScreen.y)*(it.positionScreen.x-tt.positionScreen.x)<0,ht===THREE.DoubleSide||st===(ht===THREE.FrontSide))){for(u=i(),u.id=q.id,u.v1.copy(tt),u.v2.copy(it),u.v3.copy(nt),u.normalModel.copy(Q.normal),st!==!1||ht!==THREE.BackSide&&ht!==THREE.DoubleSide||u.normalModel.negate(),u.normalModel.applyMatrix3(L).normalize(),u.normalModelView.copy(u.normalModel).applyMatrix3(I),u.centroidModel.copy(Q.centroid).applyMatrix4(v),J=Q.vertexNormals,S=0,C=Math.min(J.length,3);C>S;S++){var ct=u.vertexNormalsModel[S];ct.copy(J[S]),st!==!1||ht!==THREE.BackSide&&ht!==THREE.DoubleSide||ct.negate(),ct.applyMatrix3(L).normalize();var ut=u.vertexNormalsModelView[S];ut.copy(ct).applyMatrix3(I)}for(u.vertexNormalsLength=J.length,M=0,j=Math.min(Z.length,3);j>M;M++)if(et=Z[M][w],void 0!==et)for(W=0,G=et.length;G>W;W++)u.uvs[M][W]=et[W];u.color=Q.color,u.material=lt,O.copy(u.centroidModel).applyProjection(N),u.z=O.z,H.elements.push(u)}}}}else if(q instanceof THREE.Line){z.multiplyMatrices(N,v),Y=q.geometry.vertices,tt=t(),tt.positionScreen.copy(Y[0]).applyMatrix4(z);var dt=q.type===THREE.LinePieces?2:1;for(x=1,T=Y.length;T>x;x++)tt=t(),tt.positionScreen.copy(Y[x]).applyMatrix4(z),(x+1)%dt>0||(it=b[c-2],B.copy(tt.positionScreen),U.copy(it.positionScreen),s(B,U)===!0&&(B.multiplyScalar(1/B.w),U.multiplyScalar(1/U.w),p=n(),p.id=q.id,p.v1.positionScreen.copy(B),p.v2.positionScreen.copy(U),p.z=Math.max(B.z,U.z),p.material=q.material,q.material.vertexColors===THREE.VertexColors&&(p.vertexColors[0].copy(q.geometry.colors[x]),p.vertexColors[1].copy(q.geometry.colors[x-1])),H.elements.push(p)))}for(_=0,E=H.sprites.length;E>_;_++){q=H.sprites[_].object,v=q.matrixWorld,k.set(v.elements[12],v.elements[13],v.elements[14],1),k.applyMatrix4(N);var at=1/k.w;k.z*=at,k.z>=-1&&k.z<=1&&(m=r(),m.id=q.id,m.x=k.x*at,m.y=k.y*at,m.z=k.z,m.object=q,m.rotation=q.rotation,m.scale.x=q.scale.x*Math.abs(m.x-(k.x+a.projectionMatrix.elements[0])/(k.w+a.projectionMatrix.elements[12])),m.scale.y=q.scale.y*Math.abs(m.y-(k.y+a.projectionMatrix.elements[5])/(k.w+a.projectionMatrix.elements[13])),m.material=q.material,H.elements.push(m))}return y===!0&&H.elements.sort(o),H}},THREE.Face3=function(e,t,i,n,r,o){this.a=e,this.b=t,this.c=i,this.normal=n instanceof THREE.Vector3?n:new THREE.Vector3,this.vertexNormals=n instanceof Array?n:[],this.color=r instanceof THREE.Color?r:new THREE.Color,this.vertexColors=r instanceof Array?r:[],this.vertexTangents=[],this.materialIndex=void 0!==o?o:0,this.centroid=new THREE.Vector3
},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,i;for(t=0,i=this.vertexNormals.length;i>t;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();for(t=0,i=this.vertexColors.length;i>t;t++)e.vertexColors[t]=this.vertexColors[t].clone();for(t=0,i=this.vertexTangents.length;i>t;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,i,n,r,o,s){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,i,r,o,s)},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.dynamic=!0,this.verticesNeedUpdate=!1,this.elementsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.tangentsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.buffersNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),i=0,n=this.vertices.length;n>i;i++){var r=this.vertices[i];r.applyMatrix4(e)}for(var i=0,n=this.faces.length;n>i;i++){var o=this.faces[i];o.normal.applyMatrix3(t).normalize();for(var s=0,a=o.vertexNormals.length;a>s;s++)o.vertexNormals[s].applyMatrix3(t).normalize();o.centroid.applyMatrix4(e)}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,i;for(e=0,t=this.faces.length;t>e;e++)i=this.faces[e],i.centroid.set(0,0,0),i.centroid.add(this.vertices[i.a]),i.centroid.add(this.vertices[i.b]),i.centroid.add(this.vertices[i.c]),i.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,i=0,n=this.faces.length;n>i;i++){var r=this.faces[i],o=this.vertices[r.a],s=this.vertices[r.b],a=this.vertices[r.c];e.subVectors(a,s),t.subVectors(o,s),e.cross(t),e.normalize(),r.normal.copy(e)}},computeVertexNormals:function(e){var t,i,n,r,o,s;if(void 0===this.__tmpVertices){for(this.__tmpVertices=new Array(this.vertices.length),s=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)s[t]=new THREE.Vector3;for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.vertexNormals=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3]}else for(s=this.__tmpVertices,t=0,i=this.vertices.length;i>t;t++)s[t].set(0,0,0);if(e){var a,l,h,c=new THREE.Vector3,u=new THREE.Vector3;for(new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,n=0,r=this.faces.length;r>n;n++)o=this.faces[n],a=this.vertices[o.a],l=this.vertices[o.b],h=this.vertices[o.c],c.subVectors(h,l),u.subVectors(a,l),c.cross(u),s[o.a].add(c),s[o.b].add(c),s[o.c].add(c)}else for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],s[o.a].add(o.normal),s[o.b].add(o.normal),s[o.c].add(o.normal);for(t=0,i=this.vertices.length;i>t;t++)s[t].normalize();for(n=0,r=this.faces.length;r>n;n++)o=this.faces[n],o.vertexNormals[0].copy(s[o.a]),o.vertexNormals[1].copy(s[o.b]),o.vertexNormals[2].copy(s[o.c])},computeMorphNormals:function(){var e,t,i,n,r;for(i=0,n=this.faces.length;n>i;i++)for(r=this.faces[i],r.__originalFaceNormal?r.__originalFaceNormal.copy(r.normal):r.__originalFaceNormal=r.normal.clone(),r.__originalVertexNormals||(r.__originalVertexNormals=[]),e=0,t=r.vertexNormals.length;t>e;e++)r.__originalVertexNormals[e]?r.__originalVertexNormals[e].copy(r.vertexNormals[e]):r.__originalVertexNormals[e]=r.vertexNormals[e].clone();var o=new THREE.Geometry;for(o.faces=this.faces,e=0,t=this.morphTargets.length;t>e;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var s,a,l=this.morphNormals[e].faceNormals,h=this.morphNormals[e].vertexNormals;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],s=new THREE.Vector3,a={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},l.push(s),h.push(a)}var c=this.morphNormals[e];o.vertices=this.morphTargets[e].vertices,o.computeFaceNormals(),o.computeVertexNormals();var s,a;for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],s=c.faceNormals[i],a=c.vertexNormals[i],s.copy(r.normal),a.a.copy(r.vertexNormals[0]),a.b.copy(r.vertexNormals[1]),a.c.copy(r.vertexNormals[2])}for(i=0,n=this.faces.length;n>i;i++)r=this.faces[i],r.normal=r.__originalFaceNormal,r.vertexNormals=r.__originalVertexNormals},computeTangents:function(){function e(e,t,i,n,r,o,s){h=e.vertices[t],c=e.vertices[i],u=e.vertices[n],d=l[r],p=l[o],f=l[s],m=c.x-h.x,g=u.x-h.x,v=c.y-h.y,y=u.y-h.y,_=c.z-h.z,b=u.z-h.z,E=p.x-d.x,x=f.x-d.x,T=p.y-d.y,w=f.y-d.y,R=1/(E*w-x*T),A.set((w*m-T*g)*R,(w*v-T*y)*R,(w*_-T*b)*R),P.set((E*g-x*m)*R,(E*y-x*v)*R,(E*b-x*_)*R),M[t].add(A),M[i].add(A),M[n].add(A),k[t].add(P),k[i].add(P),k[n].add(P)}var t,i,n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M=[],k=[],A=new THREE.Vector3,P=new THREE.Vector3,F=new THREE.Vector3,D=new THREE.Vector3,N=new THREE.Vector3;for(n=0,r=this.vertices.length;r>n;n++)M[n]=new THREE.Vector3,k[n]=new THREE.Vector3;for(t=0,i=this.faces.length;i>t;t++)a=this.faces[t],l=this.faceVertexUvs[0][t],e(this,a.a,a.b,a.c,0,1,2);var z=["a","b","c","d"];for(t=0,i=this.faces.length;i>t;t++)for(a=this.faces[t],o=0;o<Math.min(a.vertexNormals.length,3);o++)N.copy(a.vertexNormals[o]),s=a[z[o]],S=M[s],F.copy(S),F.sub(N.multiplyScalar(N.dot(S))).normalize(),D.crossVectors(a.vertexNormals[o],S),C=D.dot(k[s]),H=0>C?-1:1,a.vertexTangents[o]=new THREE.Vector4(F.x,F.y,F.z,H);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,i=0,n=t.length;n>i;i++)i>0&&(e+=t[i].distanceTo(t[i-1])),this.lineDistances[i]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e,t,i,n,r,o,s,a,l={},h=[],c=[],u=4,d=Math.pow(10,u);for(this.__tmpVertices=void 0,i=0,n=this.vertices.length;n>i;i++)e=this.vertices[i],t=Math.round(e.x*d)+"_"+Math.round(e.y*d)+"_"+Math.round(e.z*d),void 0===l[t]?(l[t]=i,h.push(this.vertices[i]),c[i]=h.length-1):c[i]=c[l[t]];var p=[];for(i=0,n=this.faces.length;n>i;i++){r=this.faces[i],r.a=c[r.a],r.b=c[r.b],r.c=c[r.c],o=[r.a,r.b,r.c];for(var f=-1,m=0;3>m;m++)if(o[m]==o[(m+1)%3]){f=m,p.push(i);break}}for(i=p.length-1;i>=0;i--){var g=p[i];for(this.faces.splice(g,1),s=0,a=this.faceVertexUvs.length;a>s;s++)this.faceVertexUvs[s].splice(g,1)}var v=this.vertices.length-h.length;return this.vertices=h,v},clone:function(){for(var e=new THREE.Geometry,t=this.vertices,i=0,n=t.length;n>i;i++)e.vertices.push(t[i].clone());for(var r=this.faces,i=0,n=r.length;n>i;i++)e.faces.push(r[i].clone());for(var o=this.faceVertexUvs[0],i=0,n=o.length;n>i;i++){for(var s=o[i],a=[],l=0,h=s.length;h>l;l++)a.push(new THREE.Vector2(s[l].x,s[l].y));e.faceVertexUvs[0].push(a)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.dynamic=!0,this.offsets=[],this.boundingBox=null,this.boundingSphere=null,this.hasTangents=!1,this.morphTargets=[]},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t,i,n){this.attributes[e]={itemSize:n,array:new t(i*n)}},applyMatrix:function(e){var t,i;if(this.attributes.position&&(t=this.attributes.position.array),this.attributes.normal&&(i=this.attributes.normal.array),void 0!==t&&(e.multiplyVector3Array(t),this.verticesNeedUpdate=!0),void 0!==i){var n=(new THREE.Matrix3).getNormalMatrix(e);n.multiplyVector3Array(i),this.normalizeNormals(),this.normalsNeedUpdate=!0}},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t,i,n,r=this.boundingBox;e.length>=3&&(r.min.x=r.max.x=e[0],r.min.y=r.max.y=e[1],r.min.z=r.max.z=e[2]);for(var o=3,s=e.length;s>o;o+=3)t=e[o],i=e[o+1],n=e[o+2],t<r.min.x?r.min.x=t:t>r.max.x&&(r.max.x=t),i<r.min.y?r.min.y=i:i>r.max.y&&(r.max.y=i),n<r.min.z?r.min.z=n:n>r.max.z&&(r.max.z=n)}(void 0===e||0===e.length)&&(this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0))},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var i=this.attributes.position.array;if(i){for(var n=this.boundingSphere.center,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),e.addPoint(t);e.center(n);for(var s=0,r=0,o=i.length;o>r;r+=3)t.set(i[r],i[r+1],i[r+2]),s=Math.max(s,n.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(s)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,i,n,r=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(r)};else for(e=0,t=this.attributes.normal.array.length;t>e;e++)this.attributes.normal.array[e]=0;var o,s,a,l,h,c,u=this.attributes.position.array,d=this.attributes.normal.array,p=new THREE.Vector3,f=new THREE.Vector3,m=new THREE.Vector3,g=new THREE.Vector3,v=new THREE.Vector3;if(this.attributes.index){var y=this.attributes.index.array,_=this.offsets;for(i=0,n=_.length;n>i;++i){var b=_[i].start,E=_[i].count,x=_[i].index;for(e=b,t=b+E;t>e;e+=3)o=x+y[e],s=x+y[e+1],a=x+y[e+2],l=u[3*o],h=u[3*o+1],c=u[3*o+2],p.set(l,h,c),l=u[3*s],h=u[3*s+1],c=u[3*s+2],f.set(l,h,c),l=u[3*a],h=u[3*a+1],c=u[3*a+2],m.set(l,h,c),g.subVectors(m,f),v.subVectors(p,f),g.cross(v),d[3*o]+=g.x,d[3*o+1]+=g.y,d[3*o+2]+=g.z,d[3*s]+=g.x,d[3*s+1]+=g.y,d[3*s+2]+=g.z,d[3*a]+=g.x,d[3*a+1]+=g.y,d[3*a+2]+=g.z}}else for(e=0,t=u.length;t>e;e+=9)l=u[e],h=u[e+1],c=u[e+2],p.set(l,h,c),l=u[e+3],h=u[e+4],c=u[e+5],f.set(l,h,c),l=u[e+6],h=u[e+7],c=u[e+8],m.set(l,h,c),g.subVectors(m,f),v.subVectors(p,f),g.cross(v),d[e]=g.x,d[e+1]=g.y,d[e+2]=g.z,d[e+3]=g.x,d[e+4]=g.y,d[e+5]=g.z,d[e+6]=g.x,d[e+7]=g.y,d[e+8]=g.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e,t,i,n,r=this.attributes.normal.array,o=0,s=r.length;s>o;o+=3)e=r[o],t=r[o+1],i=r[o+2],n=1/Math.sqrt(e*e+t*t+i*i),r[o]*=n,r[o+1]*=n,r[o+2]*=n},computeTangents:function(){function e(e,t,i){d=n[3*e],p=n[3*e+1],f=n[3*e+2],m=n[3*t],g=n[3*t+1],v=n[3*t+2],y=n[3*i],_=n[3*i+1],b=n[3*i+2],E=o[2*e],x=o[2*e+1],T=o[2*t],w=o[2*t+1],R=o[2*i],S=o[2*i+1],C=m-d,H=y-d,M=g-p,k=_-p,A=v-f,P=b-f,F=T-E,D=R-E,N=w-x,z=S-x,L=1/(F*z-D*N),$.set((z*C-N*H)*L,(z*M-N*k)*L,(z*A-N*P)*L),G.set((F*H-D*C)*L,(F*k-D*M)*L,(F*P-D*A)*L),h[e].add($),h[t].add($),h[i].add($),c[e].add(G),c[t].add(G),c[i].add(G)}function t(e){it.x=r[3*e],it.y=r[3*e+1],it.z=r[3*e+2],nt.copy(it),J=h[e],et.copy(J),et.sub(it.multiplyScalar(it.dot(J))).normalize(),tt.crossVectors(nt,J),Z=tt.dot(c[e]),Q=0>Z?-1:1,l[4*e]=et.x,l[4*e+1]=et.y,l[4*e+2]=et.z,l[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)return console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()"),void 0;var i=this.attributes.index.array,n=this.attributes.position.array,r=this.attributes.normal.array,o=this.attributes.uv.array,s=n.length/3;if(void 0===this.attributes.tangent){var a=4*s;this.attributes.tangent={itemSize:4,array:new Float32Array(a)}}for(var l=this.attributes.tangent.array,h=[],c=[],u=0;s>u;u++)h[u]=new THREE.Vector3,c[u]=new THREE.Vector3;var d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V,B,U,j,W,$=new THREE.Vector3,G=new THREE.Vector3,q=this.offsets;for(V=0,B=q.length;B>V;++V){var X=q[V].start,Y=q[V].count,K=q[V].index;for(I=X,O=X+Y;O>I;I+=3)U=K+i[I],j=K+i[I+1],W=K+i[I+2],e(U,j,W)}var Q,J,Z,et=new THREE.Vector3,tt=new THREE.Vector3,it=new THREE.Vector3,nt=new THREE.Vector3;for(V=0,B=q.length;B>V;++V){var X=q[V].start,Y=q[V].count,K=q[V].index;for(I=X,O=X+Y;O>I;I+=3)U=K+i[I],j=K+i[I+1],W=K+i[I+2],t(U),t(j),t(W)}this.hasTangents=!0,this.tangentsNeedUpdate=!0},clone:function(){var e=new THREE.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];for(var i in this.attributes){for(var n=this.attributes[i],r=n.array,o={itemSize:n.itemSize,numItems:n.numItems,array:null},s=0,a=t.length;a>s;s++){var l=t[s];if(r instanceof l){o.array=new l(r);break}}e.attributes[i]=o}for(var s=0,a=this.offsets.length;a>s;s++){var h=this.offsets[s];e.offsets.push({start:h.start,index:h.index,count:h.count})}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4,this.projectionMatrixInverse=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e.projectionMatrixInverse.copy(this.projectionMatrixInverse),e},THREE.OrthographicCamera=function(e,t,i,n,r,o){THREE.Camera.call(this),this.left=e,this.right=t,this.top=i,this.bottom=n,this.near=void 0!==r?r:.1,this.far=void 0!==o?o:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},THREE.PerspectiveCamera=function(e,t,i,n){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==i?i:.1,this.far=void 0!==n?n:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,i,n,r,o){this.fullWidth=e,this.fullHeight=t,this.x=i,this.y=n,this.width=r,this.height=o,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,i=-t,n=e*i,r=e*t,o=Math.abs(r-n),s=Math.abs(t-i);this.projectionMatrix.makeFrustum(n+this.x*o/this.fullWidth,n+(this.x+this.width)*o/this.fullWidth,t-(this.y+this.height)*s/this.fullHeight,t-this.y*s/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.width=1,this.height=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraRight=500,this.shadowCameraTop=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,i){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==i?i:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,i){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,i,n,r){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==i?i:0,this.angle=void 0!==n?n:Math.PI/3,this.exponent=void 0!==r?r:10,this.castShadow=!1,this.onlyShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapWidth=512,this.shadowMapHeight=512,this.shadowMap=null,this.shadowMapSize=null,this.shadowCamera=null,this.shadowMatrix=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.showStatus=e,this.statusDomElement=e?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:"anonymous",addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ";t+=e.total?(100*e.loaded/e.total).toFixed(0)+"%":(e.loaded/1e3).toFixed(2)+" KB",this.statusDomElement.innerHTML=t},extractUrlBase:function(e){var t=e.split("/");return t.pop(),(t.length<1?".":t.join("/"))+"/"},initMaterials:function(e,t){for(var i=[],n=0;n<e.length;++n)i[n]=THREE.Loader.prototype.createMaterial(e[n],t);return i},needsTangents:function(e){for(var t=0,i=e.length;i>t;t++){var n=e[t];if(n instanceof THREE.ShaderMaterial)return!0}return!1},createMaterial:function(e,t){function i(e){var t=Math.log(e)/Math.LN2;return Math.floor(t)==t}function n(e){var t=Math.log(e)/Math.LN2;return Math.pow(2,Math.round(t))}function r(e,t){var r=new Image;r.onload=function(){if(i(this.width)&&i(this.height))e.image=this;else{var t=n(this.width),r=n(this.height);e.image.width=t,e.image.height=r,e.image.getContext("2d").drawImage(this,0,0,t,r)}e.needsUpdate=!0},r.crossOrigin=a.crossOrigin,r.src=t}function o(e,i,n,o,s,a,l){var h=/\.dds$/i.test(n),c=t+"/"+n;if(h){var u=THREE.ImageUtils.loadCompressedTexture(c);e[i]=u}else{var u=document.createElement("canvas");e[i]=new THREE.Texture(u)}if(e[i].sourceFile=n,o&&(e[i].repeat.set(o[0],o[1]),1!==o[0]&&(e[i].wrapS=THREE.RepeatWrapping),1!==o[1]&&(e[i].wrapT=THREE.RepeatWrapping)),s&&e[i].offset.set(s[0],s[1]),a){var d={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==d[a[0]]&&(e[i].wrapS=d[a[0]]),void 0!==d[a[1]]&&(e[i].wrapT=d[a[1]])}l&&(e[i].anisotropy=l),h||r(e[i],c)}function s(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var a=this,l="MeshLambertMaterial",h={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var c=e.shading.toLowerCase();"phong"===c?l="MeshPhongMaterial":"basic"===c&&(l="MeshBasicMaterial")}if(void 0!==e.blending&&void 0!==THREE[e.blending]&&(h.blending=THREE[e.blending]),(void 0!==e.transparent||e.opacity<1)&&(h.transparent=e.transparent),void 0!==e.depthTest&&(h.depthTest=e.depthTest),void 0!==e.depthWrite&&(h.depthWrite=e.depthWrite),void 0!==e.visible&&(h.visible=e.visible),void 0!==e.flipSided&&(h.side=THREE.BackSide),void 0!==e.doubleSided&&(h.side=THREE.DoubleSide),void 0!==e.wireframe&&(h.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?h.vertexColors=THREE.FaceColors:e.vertexColors&&(h.vertexColors=THREE.VertexColors)),e.colorDiffuse?h.color=s(e.colorDiffuse):e.DbgColor&&(h.color=e.DbgColor),e.colorSpecular&&(h.specular=s(e.colorSpecular)),e.colorAmbient&&(h.ambient=s(e.colorAmbient)),e.transparency&&(h.opacity=e.transparency),e.specularCoef&&(h.shininess=e.specularCoef),e.mapDiffuse&&t&&o(h,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&o(h,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&o(h,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&o(h,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&o(h,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(h.bumpScale=e.mapBumpScale),e.mapNormal){var u=THREE.ShaderLib.normalmap,d=THREE.UniformsUtils.clone(u.uniforms);d.tNormal.value=h.normalMap,e.mapNormalFactor&&d.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),h.map&&(d.tDiffuse.value=h.map,d.enableDiffuse.value=!0),h.specularMap&&(d.tSpecular.value=h.specularMap,d.enableSpecular.value=!0),h.lightMap&&(d.tAO.value=h.lightMap,d.enableAO.value=!0),d.uDiffuseColor.value.setHex(h.color),d.uSpecularColor.value.setHex(h.specular),d.uAmbientColor.value.setHex(h.ambient),d.uShininess.value=h.shininess,void 0!==h.opacity&&(d.uOpacity.value=h.opacity);var p={fragmentShader:u.fragmentShader,vertexShader:u.vertexShader,uniforms:d,lights:!0,fog:!0},f=new THREE.ShaderMaterial(p);h.transparent&&(f.transparent=!0)}else var f=new THREE[l](h);return void 0!==e.DbgName&&(f.name=e.DbgName),f}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,i,n){var r=this,o=new XMLHttpRequest;void 0!==t&&o.addEventListener("load",function(i){t(i.target.responseText),r.manager.itemEnd(e)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.open("GET",e,!0),o.send(null),r.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,i,n){var r=this,o=document.createElement("img");return void 0!==t&&o.addEventListener("load",function(){r.manager.itemEnd(e),t(this)},!1),void 0!==i&&o.addEventListener("progress",function(e){i(e)},!1),void 0!==n&&o.addEventListener("error",function(e){n(e)},!1),void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),o.src=e,r.manager.itemStart(e),o},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,i){i=i&&"string"==typeof i?i:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,i)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,i,n,r){var o=new XMLHttpRequest,s=0;o.onreadystatechange=function(){if(o.readyState===o.DONE)if(200===o.status||0===o.status){if(o.responseText){var a=JSON.parse(o.responseText),l=e.parse(a,n);i(l.geometry,l.materials)}else console.warn("THREE.JSONLoader: ["+t+"] seems to be unreachable or file there is empty");e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load ["+t+"] ["+o.status+"]");else o.readyState===o.LOADING?r&&(0===s&&(s=o.getResponseHeader("Content-Length")),r({total:s,loaded:o.responseText.length})):o.readyState===o.HEADERS_RECEIVED&&void 0!==r&&(s=o.getResponseHeader("Content-Length"))},o.open("GET",t,!0),o.withCredentials=this.withCredentials,o.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){function i(t){function i(e,t){return e&1<<t}var n,r,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A=e.faces,P=e.vertices,F=e.normals,D=e.colors,N=0;if(void 0!==e.uvs){for(n=0;n<e.uvs.length;n++)e.uvs[n].length&&N++;for(n=0;N>n;n++)o.faceVertexUvs[n]=[]}for(a=0,l=P.length;l>a;)E=new THREE.Vector3,E.x=P[a++]*t,E.y=P[a++]*t,E.z=P[a++]*t,o.vertices.push(E);for(a=0,l=A.length;l>a;)if(p=A[a++],f=i(p,0),m=i(p,1),g=i(p,3),v=i(p,4),y=i(p,5),_=i(p,6),b=i(p,7),f){if(T=new THREE.Face3,T.a=A[a],T.b=A[a+1],T.c=A[a+3],w=new THREE.Face3,w.a=A[a+1],w.b=A[a+2],w.c=A[a+3],a+=4,m&&(d=A[a++],T.materialIndex=d,w.materialIndex=d),s=o.faces.length,g)for(n=0;N>n;n++)for(C=e.uvs[n],o.faceVertexUvs[n][s]=[],o.faceVertexUvs[n][s+1]=[],r=0;4>r;r++)u=A[a++],M=C[2*u],k=C[2*u+1],H=new THREE.Vector2(M,k),2!==r&&o.faceVertexUvs[n][s].push(H),0!==r&&o.faceVertexUvs[n][s+1].push(H);if(v&&(c=3*A[a++],T.normal.set(F[c++],F[c++],F[c]),w.normal.copy(T.normal)),y)for(n=0;4>n;n++)c=3*A[a++],S=new THREE.Vector3(F[c++],F[c++],F[c]),2!==n&&T.vertexNormals.push(S),0!==n&&w.vertexNormals.push(S);if(_&&(h=A[a++],R=D[h],T.color.setHex(R),w.color.setHex(R)),b)for(n=0;4>n;n++)h=A[a++],R=D[h],2!==n&&T.vertexColors.push(new THREE.Color(R)),0!==n&&w.vertexColors.push(new THREE.Color(R));o.faces.push(T),o.faces.push(w)}else{if(x=new THREE.Face3,x.a=A[a++],x.b=A[a++],x.c=A[a++],m&&(d=A[a++],x.materialIndex=d),s=o.faces.length,g)for(n=0;N>n;n++)for(C=e.uvs[n],o.faceVertexUvs[n][s]=[],r=0;3>r;r++)u=A[a++],M=C[2*u],k=C[2*u+1],H=new THREE.Vector2(M,k),o.faceVertexUvs[n][s].push(H);if(v&&(c=3*A[a++],x.normal.set(F[c++],F[c++],F[c])),y)for(n=0;3>n;n++)c=3*A[a++],S=new THREE.Vector3(F[c++],F[c++],F[c]),x.vertexNormals.push(S);if(_&&(h=A[a++],x.color.setHex(D[h])),b)for(n=0;3>n;n++)h=A[a++],x.vertexColors.push(new THREE.Color(D[h]));o.faces.push(x)}}function n(){var t,i,n,r,s,a,l,h,c,u;if(e.skinWeights)for(t=0,i=e.skinWeights.length;i>t;t+=2)n=e.skinWeights[t],r=e.skinWeights[t+1],s=0,a=0,o.skinWeights.push(new THREE.Vector4(n,r,s,a));if(e.skinIndices)for(t=0,i=e.skinIndices.length;i>t;t+=2)l=e.skinIndices[t],h=e.skinIndices[t+1],c=0,u=0,o.skinIndices.push(new THREE.Vector4(l,h,c,u));o.bones=e.bones,o.animation=e.animation,o.animations=e.animations}function r(t){if(void 0!==e.morphTargets){var i,n,r,s,a,l;for(i=0,n=e.morphTargets.length;n>i;i++)for(o.morphTargets[i]={},o.morphTargets[i].name=e.morphTargets[i].name,o.morphTargets[i].vertices=[],a=o.morphTargets[i].vertices,l=e.morphTargets[i].vertices,r=0,s=l.length;s>r;r+=3){var h=new THREE.Vector3;h.x=l[r]*t,h.y=l[r+1]*t,h.z=l[r+2]*t,a.push(h)}}if(void 0!==e.morphColors){var i,n,c,u,d,p,f;for(i=0,n=e.morphColors.length;n>i;i++)for(o.morphColors[i]={},o.morphColors[i].name=e.morphColors[i].name,o.morphColors[i].colors=[],d=o.morphColors[i].colors,p=e.morphColors[i].colors,c=0,u=p.length;u>c;c+=3)f=new THREE.Color(16755200),f.setRGB(p[c],p[c+1],p[c+2]),d.push(f)}}var o=new THREE.Geometry,s=void 0!==e.scale?1/e.scale:1;if(i(s),n(),r(s),o.computeCentroids(),o.computeFaceNormals(),o.computeBoundingSphere(),void 0===e.materials)return{geometry:o};var a=this.initMaterials(e.materials,t);return this.needsTangents(a)&&o.computeTangents(),{geometry:o,materials:a}},THREE.LoadingManager=function(e,t,i){var n=this,r=0,o=0;this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(){o++},this.itemEnd=function(e){r++,void 0!==n.onProgress&&n.onProgress(e,r,o),r===o&&void 0!==n.onLoad&&n.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,i=e.attributes,n=e.offsets,r=e.boundingSphere;for(var o in i){var s=i[o];t.attributes[o]={itemSize:s.itemSize,array:new self[s.type](s.array)}}return void 0!==n&&(t.offsets=JSON.parse(JSON.stringify(n))),void 0!==r&&(t.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==r.center?r.center:[0,0,0]),r.radius)),t}},THREE.GeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.GeometryLoader.prototype={constructor:THREE.GeometryLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(){}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader;n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];if(void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe),void 0!==e.materials)for(var i=0,n=e.materials.length;n>i;i++)t.materials.push(this.parse(e.materials[i]));
return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),i=this.parseMaterials(e.materials),n=this.parseObject(e.object,t,i);return n},parseGeometries:function(e){var t={};if(void 0!==e)for(var i=new THREE.JSONLoader,n=new THREE.BufferGeometryLoader,r=0,o=e.length;o>r;r++){var s,a=e[r];switch(a.type){case"PlaneGeometry":s=new THREE.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments);break;case"CircleGeometry":s=new THREE.CircleGeometry(a.radius,a.segments);break;case"CubeGeometry":s=new THREE.CubeGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CylinderGeometry":s=new THREE.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":s=new THREE.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":s=new THREE.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":s=new THREE.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":s=new THREE.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":s=n.parse(a.data);break;case"Geometry":s=i.parse(a.data).geometry}s.uuid=a.uuid,void 0!==a.name&&(s.name=a.name),t[a.uuid]=s}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var i=new THREE.MaterialLoader,n=0,r=e.length;r>n;n++){var o=e[n],s=i.parse(o);s.uuid=o.uuid,void 0!==o.name&&(s.name=o.name),t[o.uuid]=s}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,i,n){var r;switch(t.type){case"Scene":r=new THREE.Scene;break;case"PerspectiveCamera":r=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":r=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":r=new THREE.AmbientLight(t.color);break;case"DirectionalLight":r=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":r=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":r=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":r=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":var o=i[t.geometry],s=n[t.material];void 0===o&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),r=new THREE.Mesh(o,s);break;case"Sprite":var s=n[t.material];void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),r=new THREE.Sprite(s);break;default:r=new THREE.Object3D}if(r.uuid=t.uuid,void 0!==t.name&&(r.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(r.position,r.quaternion,r.scale)):(void 0!==t.position&&r.position.fromArray(t.position),void 0!==t.rotation&&r.rotation.fromArray(t.rotation),void 0!==t.scale&&r.scale.fromArray(t.scale)),void 0!==t.visible&&(r.visible=t.visible),void 0!==t.userData&&(r.userData=t.userData),void 0!==t.children)for(var a in t.children)r.add(this.parseObject(t.children[a],i,n));return r}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,t){var i=this,n=new THREE.XHRLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(n){i.parse(JSON.parse(n),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,i){function n(e,t){return"relativeToHTML"==t?e:C+"/"+e}function r(){o(R.scene,M.objects)}function o(e,t){var i,r,s,a,l;for(var c in t){var u=R.objects[c],d=t[c];if(void 0===u){if(d.type&&d.type in S.hierarchyHandlers){if(void 0===d.loading){var p={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1},v={};for(var y in d)y in p||(v[y]=d[y]);m=R.materials[d.material],d.loading=!0;var _=S.hierarchyHandlers[d.type].loaderObject;_.options?_.load(n(d.url,M.urlBaseType),h(c,e,m,d)):_.load(n(d.url,M.urlBaseType),h(c,e,m,d),v)}}else if(void 0!==d.geometry){if(f=R.geometries[d.geometry]){var E=!1;if(m=R.materials[d.material],E=m instanceof THREE.ShaderMaterial,r=d.position,s=d.rotation,a=d.scale,i=d.matrix,l=d.quaternion,d.material||(m=new THREE.MeshFaceMaterial(R.face_materials[d.geometry])),m instanceof THREE.MeshFaceMaterial&&0===m.materials.length&&(m=new THREE.MeshFaceMaterial(R.face_materials[d.geometry])),m instanceof THREE.MeshFaceMaterial)for(var x=0;x<m.materials.length;x++)E=E||m.materials[x]instanceof THREE.ShaderMaterial;E&&f.computeTangents(),d.skin?u=new THREE.SkinnedMesh(f,m):d.morph?(u=new THREE.MorphAnimMesh(f,m),void 0!==d.duration&&(u.duration=d.duration),void 0!==d.time&&(u.time=d.time),void 0!==d.mirroredLoop&&(u.mirroredLoop=d.mirroredLoop),m.morphNormals&&f.computeMorphNormals()):u=new THREE.Mesh(f,m),u.name=c,i?(u.matrixAutoUpdate=!1,u.matrix.set(i[0],i[1],i[2],i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11],i[12],i[13],i[14],i[15])):(u.position.fromArray(r),l?u.quaternion.fromArray(l):u.rotation.fromArray(s),u.scale.fromArray(a)),u.visible=d.visible,u.castShadow=d.castShadow,u.receiveShadow=d.receiveShadow,e.add(u),R.objects[c]=u}}else if("AmbientLight"===d.type||"PointLight"===d.type||"DirectionalLight"===d.type||"SpotLight"===d.type||"HemisphereLight"===d.type||"AreaLight"===d.type){var T=d.color,w=d.intensity,C=d.distance,H=d.position,k=d.rotation;switch(d.type){case"AmbientLight":b=new THREE.AmbientLight(T);break;case"PointLight":b=new THREE.PointLight(T,w,C),b.position.fromArray(H);break;case"DirectionalLight":b=new THREE.DirectionalLight(T,w),b.position.fromArray(d.direction);break;case"SpotLight":b=new THREE.SpotLight(T,w,C,1),b.angle=d.angle,b.position.fromArray(H),b.target.set(H[0],H[1]-C,H[2]),b.target.applyEuler(new THREE.Euler(k[0],k[1],k[2],"XYZ"));break;case"HemisphereLight":b=new THREE.DirectionalLight(T,w,C),b.target.set(H[0],H[1]-C,H[2]),b.target.applyEuler(new THREE.Euler(k[0],k[1],k[2],"XYZ"));break;case"AreaLight":b=new THREE.AreaLight(T,w),b.position.fromArray(H),b.width=d.size,b.height=d.size_y}e.add(b),b.name=c,R.lights[c]=b,R.objects[c]=b}else"PerspectiveCamera"===d.type||"OrthographicCamera"===d.type?(r=d.position,s=d.rotation,l=d.quaternion,"PerspectiveCamera"===d.type?g=new THREE.PerspectiveCamera(d.fov,d.aspect,d.near,d.far):"OrthographicCamera"===d.type&&(g=new THREE.OrthographicCamera(d.left,d.right,d.top,d.bottom,d.near,d.far)),g.name=c,g.position.fromArray(r),void 0!==l?g.quaternion.fromArray(l):void 0!==s&&g.rotation.fromArray(s),e.add(g),R.cameras[c]=g,R.objects[c]=g):(r=d.position,s=d.rotation,a=d.scale,l=d.quaternion,u=new THREE.Object3D,u.name=c,u.position.fromArray(r),l?u.quaternion.fromArray(l):u.rotation.fromArray(s),u.scale.fromArray(a),u.visible=void 0!==d.visible?d.visible:!1,e.add(u),R.objects[c]=u,R.empties[c]=u);if(u){if(void 0!==d.userData)for(var A in d.userData){var P=d.userData[A];u.userData[A]=P}if(void 0!==d.groups)for(var x=0;x<d.groups.length;x++){var F=d.groups[x];void 0===R.groups[F]&&(R.groups[F]=[]),R.groups[F].push(c)}}}void 0!==u&&void 0!==d.children&&o(u,d.children)}}function s(e,t,i){R.geometries[i]=e,R.face_materials[i]=t,r()}function a(e,t,i,n,o){var s=o.position,a=o.rotation,l=o.quaternion,h=o.scale;e.position.fromArray(s),l?e.quaternion.fromArray(l):e.rotation.fromArray(a),e.scale.fromArray(h),n&&e.traverse(function(e){e.material=n});var c=void 0!==o.visible?o.visible:!0;e.traverse(function(e){e.visible=c}),i.add(e),e.name=t,R.objects[t]=e,r()}function l(e){return function(t,i){t.name=e,s(t,i,e),E-=1,S.onLoadComplete(),u()}}function h(e,t,i,n){return function(r){var o;o=r.content?r.content:r.dae?r.scene:r,a(o,e,t,i,n),E-=1,S.onLoadComplete(),u()}}function c(e){return function(t,i){t.name=e,R.geometries[e]=t,R.face_materials[e]=i}}function u(){var e={totalModels:T,totalTextures:w,loadedModels:T-E,loadedTextures:w-x};S.callbackProgress(e,R),S.onLoadProgress(),0===E&&0===x&&(d(),t(R))}function d(){for(var e=0;e<H.length;e++){var t=H[e],i=R.objects[t.targetName];i?t.object.target=i:(t.object.target=new THREE.Object3D,R.scene.add(t.object.target)),t.object.target.userData.targetInverse=t.object}}function p(e,t){if(t(e),void 0!==e.children)for(var i in e.children)p(e.children[i],t)}var f,m,g,v,y,_,b,E,x,T,w,R,S=this,C=THREE.Loader.prototype.extractUrlBase(i),H=[],M=e;for(var k in this.geometryHandlers){var A=this.geometryHandlers[k].loaderClass;this.geometryHandlers[k].loaderObject=new A}for(var k in this.hierarchyHandlers){var A=this.hierarchyHandlers[k].loaderClass;this.hierarchyHandlers[k].loaderObject=new A}if(E=0,x=0,R={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},M.transform){var P=M.transform.position,F=M.transform.rotation,D=M.transform.scale;P&&R.scene.position.fromArray(P),F&&R.scene.rotation.fromArray(F),D&&R.scene.scale.fromArray(D),(P||F||D)&&(R.scene.updateMatrix(),R.scene.updateMatrixWorld())}var N,z,L=function(e){x-=e,u(),S.onLoadComplete()},I=function(e){return function(){L(e)}};for(N in M.fogs)z=M.fogs[N],"linear"===z.type?v=new THREE.Fog(0,z.near,z.far):"exp2"===z.type&&(v=new THREE.FogExp2(0,z.density)),_=z.color,v.color.setRGB(_[0],_[1],_[2]),R.fogs[N]=v;var O,V;for(O in M.geometries)V=M.geometries[O],V.type in this.geometryHandlers&&(E+=1,S.onLoadStart());for(var B in M.objects)p(M.objects[B],function(e){e.type&&e.type in S.hierarchyHandlers&&(E+=1,S.onLoadStart())});T=E;for(O in M.geometries)if(V=M.geometries[O],"cube"===V.type)f=new THREE.CubeGeometry(V.width,V.height,V.depth,V.widthSegments,V.heightSegments,V.depthSegments),f.name=O,R.geometries[O]=f;else if("plane"===V.type)f=new THREE.PlaneGeometry(V.width,V.height,V.widthSegments,V.heightSegments),f.name=O,R.geometries[O]=f;else if("sphere"===V.type)f=new THREE.SphereGeometry(V.radius,V.widthSegments,V.heightSegments),f.name=O,R.geometries[O]=f;else if("cylinder"===V.type)f=new THREE.CylinderGeometry(V.topRad,V.botRad,V.height,V.radSegs,V.heightSegs),f.name=O,R.geometries[O]=f;else if("torus"===V.type)f=new THREE.TorusGeometry(V.radius,V.tube,V.segmentsR,V.segmentsT),f.name=O,R.geometries[O]=f;else if("icosahedron"===V.type)f=new THREE.IcosahedronGeometry(V.radius,V.subdivisions),f.name=O,R.geometries[O]=f;else if(V.type in this.geometryHandlers){var U={};for(var j in V)"type"!==j&&"url"!==j&&(U[j]=V[j]);var W=this.geometryHandlers[V.type].loaderObject;W.load(n(V.url,M.urlBaseType),l(O),U)}else if("embedded"===V.type){var $=M.embeds[V.id],G="";if($.metadata=M.metadata,$){var q=this.geometryHandlers.ascii.loaderObject,X=q.parse($,G);c(O)(X.geometry,X.materials)}}var Y,K;for(Y in M.textures)if(K=M.textures[Y],K.url instanceof Array){x+=K.url.length;for(var Q=0;Q<K.url.length;Q++)S.onLoadStart()}else x+=1,S.onLoadStart();w=x;for(Y in M.textures){if(K=M.textures[Y],void 0!==K.mapping&&void 0!==THREE[K.mapping]&&(K.mapping=new THREE[K.mapping]),K.url instanceof Array){for(var J=K.url.length,Z=[],et=0;J>et;et++)Z[et]=n(K.url[et],M.urlBaseType);var tt=/\.dds$/i.test(Z[0]);y=tt?THREE.ImageUtils.loadCompressedTextureCube(Z,K.mapping,I(J)):THREE.ImageUtils.loadTextureCube(Z,K.mapping,I(J))}else{var tt=/\.dds$/i.test(K.url),it=n(K.url,M.urlBaseType),nt=I(1);if(y=tt?THREE.ImageUtils.loadCompressedTexture(it,K.mapping,nt):THREE.ImageUtils.loadTexture(it,K.mapping,nt),void 0!==THREE[K.minFilter]&&(y.minFilter=THREE[K.minFilter]),void 0!==THREE[K.magFilter]&&(y.magFilter=THREE[K.magFilter]),K.anisotropy&&(y.anisotropy=K.anisotropy),K.repeat&&(y.repeat.set(K.repeat[0],K.repeat[1]),1!==K.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==K.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),K.offset&&y.offset.set(K.offset[0],K.offset[1]),K.wrap){var rt={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping};void 0!==rt[K.wrap[0]]&&(y.wrapS=rt[K.wrap[0]]),void 0!==rt[K.wrap[1]]&&(y.wrapT=rt[K.wrap[1]])}}R.textures[Y]=y}var ot,st,at;for(ot in M.materials){st=M.materials[ot];for(at in st.parameters)if("envMap"===at||"map"===at||"lightMap"===at||"bumpMap"===at)st.parameters[at]=R.textures[st.parameters[at]];else if("shading"===at)st.parameters[at]="flat"===st.parameters[at]?THREE.FlatShading:THREE.SmoothShading;else if("side"===at)st.parameters[at]="double"==st.parameters[at]?THREE.DoubleSide:"back"==st.parameters[at]?THREE.BackSide:THREE.FrontSide;else if("blending"===at)st.parameters[at]=st.parameters[at]in THREE?THREE[st.parameters[at]]:THREE.NormalBlending;else if("combine"===at)st.parameters[at]=st.parameters[at]in THREE?THREE[st.parameters[at]]:THREE.MultiplyOperation;else if("vertexColors"===at)"face"==st.parameters[at]?st.parameters[at]=THREE.FaceColors:st.parameters[at]&&(st.parameters[at]=THREE.VertexColors);else if("wrapRGB"===at){var lt=st.parameters[at];st.parameters[at]=new THREE.Vector3(lt[0],lt[1],lt[2])}if(void 0!==st.parameters.opacity&&st.parameters.opacity<1&&(st.parameters.transparent=!0),st.parameters.normalMap){var ht=THREE.ShaderLib.normalmap,ct=THREE.UniformsUtils.clone(ht.uniforms),ut=st.parameters.color,dt=st.parameters.specular,pt=st.parameters.ambient,ft=st.parameters.shininess;ct.tNormal.value=R.textures[st.parameters.normalMap],st.parameters.normalScale&&ct.uNormalScale.value.set(st.parameters.normalScale[0],st.parameters.normalScale[1]),st.parameters.map&&(ct.tDiffuse.value=st.parameters.map,ct.enableDiffuse.value=!0),st.parameters.envMap&&(ct.tCube.value=st.parameters.envMap,ct.enableReflection.value=!0,ct.uReflectivity.value=st.parameters.reflectivity),st.parameters.lightMap&&(ct.tAO.value=st.parameters.lightMap,ct.enableAO.value=!0),st.parameters.specularMap&&(ct.tSpecular.value=R.textures[st.parameters.specularMap],ct.enableSpecular.value=!0),st.parameters.displacementMap&&(ct.tDisplacement.value=R.textures[st.parameters.displacementMap],ct.enableDisplacement.value=!0,ct.uDisplacementBias.value=st.parameters.displacementBias,ct.uDisplacementScale.value=st.parameters.displacementScale),ct.uDiffuseColor.value.setHex(ut),ct.uSpecularColor.value.setHex(dt),ct.uAmbientColor.value.setHex(pt),ct.uShininess.value=ft,st.parameters.opacity&&(ct.uOpacity.value=st.parameters.opacity);var mt={fragmentShader:ht.fragmentShader,vertexShader:ht.vertexShader,uniforms:ct,lights:!0,fog:!0};m=new THREE.ShaderMaterial(mt)}else m=new THREE[st.type](st.parameters);m.name=ot,R.materials[ot]=m}for(ot in M.materials)if(st=M.materials[ot],st.parameters.materials){for(var gt=[],et=0;et<st.parameters.materials.length;et++){var vt=st.parameters.materials[et];gt.push(R.materials[vt])}R.materials[ot].materials=gt}r(),R.cameras&&M.defaults.camera&&(R.currentCamera=R.cameras[M.defaults.camera]),R.fogs&&M.defaults.fog&&(R.scene.fog=R.fogs[M.defaults.fog]),S.callbackSync(R),u()}},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t){var i=this,n=new THREE.ImageLoader(i.manager);n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){var i=new THREE.Texture(e);i.needsUpdate=!0,void 0!==t&&t(i)})},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthTest=!0,this.depthWrite=!0,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.alphaTest=0,this.overdraw=0,this.visible=!0,this.needsUpdate=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var i=e[t];if(void 0!==i){if(t in this){var n=this[t];n instanceof THREE.Color?n.set(i):n instanceof THREE.Vector3&&i instanceof THREE.Vector3?n.copy(i):this[t]="overdraw"==t?Number(i):i}}else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.scale=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.metal=!1,this.perPixel=!0,this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.map=null,this.lightMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.specularMap=null,this.envMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.perPixel=this.perPixel,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},THREE.ParticleSystemMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleSystemMaterial.prototype.clone=function(){var e=new THREE.ParticleSystemMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial,THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.fragmentShader="void main() {}",this.vertexShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.vertexColors=THREE.NoColors,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.uvOffset=new THREE.Vector2(0,0),this.uvScale=new THREE.Vector2(1,1),this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.uvOffset.copy(this.uvOffset),e.uvScale.copy(this.uvScale),e.fog=this.fog,e},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(e,t,i,n,r,o,s,a,l){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==i?i:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n?n:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==r?r:THREE.LinearFilter,this.minFilter=void 0!==o?o:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==l?l:1,this.format=void 0!==s?s:THREE.RGBAFormat,this.type=void 0!==a?a:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,i,n,r,o,s,a,l,h,c){THREE.Texture.call(this,null,o,s,a,l,h,n,r,c),this.image={width:t,height:i},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,i,n,r,o,s,a,l,h,c){THREE.Texture.call(this,null,o,s,a,l,h,n,r,c),this.image={data:e,width:t,height:i}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.ParticleSystemMaterial({color:16777215*Math.random()}),this.sortParticles=!1,this.frustumCulled=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,i){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==i?i:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(this.geometry.morphTargets.length>0){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;t>e;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix()),(t||this.matrixWorldNeedsUpdate)&&(e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);var i,n=this.children.length;for(i=0;n>i;i++)this.children[i].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,i){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==i?i:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];
var n,r,o,s,a,l;if(this.geometry&&void 0!==this.geometry.bones){for(n=0;n<this.geometry.bones.length;n++)o=this.geometry.bones[n],s=o.pos,a=o.rotq,l=o.scl,r=this.addBone(),r.name=o.name,r.position.set(s[0],s[1],s[2]),r.quaternion.set(a[0],a[1],a[2],a[3]),void 0!==l?r.scale.set(l[0],l[1],l[2]):r.scale.set(1,1,1);for(n=0;n<this.bones.length;n++)o=this.geometry.bones[n],r=this.bones[n],-1===o.parent?this.add(r):this.bones[o.parent].add(r);var h=this.bones.length;if(this.useVertexTexture){var c;c=h>256?64:h>64?32:h>16?16:8,this.boneTextureWidth=c,this.boneTextureHeight=c,this.boneMatrices=new Float32Array(4*this.boneTextureWidth*this.boneTextureHeight),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1}else this.boneMatrices=new Float32Array(16*h);this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new THREE.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);for(var i=0,n=this.children.length;n>i;i++){var r=this.children[i];r instanceof THREE.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses){this.boneInverses=[];for(var o=0,s=this.bones.length;s>o;o++){var a=new THREE.Matrix4;a.getInverse(this.bones[o].skinMatrix),this.boneInverses.push(a)}}for(var o=0,s=this.bones.length;s>o;o++)e.multiplyMatrices(this.bones[o].skinMatrix,this.boneInverses[o]),e.flattenToArrayOffset(this.boneMatrices,16*o);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],i=1/t.lengthManhattan();1/0!==i?t.multiplyScalar(i):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.time=0,this.lastKeyframe=0,this.currentKeyframe=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,i=e.animations,n=/([a-z]+)(\d+)/,r=0,o=e.morphTargets.length;o>r;r++){var s=e.morphTargets[r],a=s.name.match(n);if(a&&a.length>1){var l=a[1];a[2],i[l]||(i[l]={start:1/0,end:-1/0});var h=i[l];r<h.start&&(h.start=r),r>h.end&&(h.end=r),t||(t=l)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,i){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:i}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var i=this.geometry.animations[e];i?(this.setFrameRange(i.start,i.end),this.duration=1e3*((i.end-i.start)/t),this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e,this.mirroredLoop?(this.time>this.duration||this.time<0)&&(this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),this.time<0&&(this.time=0,this.directionBackwards=!1)):(this.time=this.time%this.duration,this.time<0&&(this.time+=this.duration));var i=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1);i!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[i]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=i);var n=this.time%t/t;this.directionBackwards&&(n=1-n),this.morphTargetInfluences[this.currentKeyframe]=n,this.morphTargetInfluences[this.lastKeyframe]=1-n},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var i=0;i<this.objects.length&&!(t<this.objects[i].distance);i++);this.objects.splice(i,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,i=this.objects.length;i>t&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i){if(this.objects.length>1){e.setFromMatrixPosition(i.matrixWorld),t.setFromMatrixPosition(this.matrixWorld);var n=e.distanceTo(t);this.objects[0].object.visible=!0;for(var r=1,o=this.objects.length;o>r&&n>=this.objects[r].distance;r++)this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0;for(;o>r;r++)this.objects[r].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(){},THREE.Sprite=function(e){THREE.Object3D.call(this),this.material=void 0!==e?e:new THREE.SpriteMaterial},THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}for(var i=0;i<e.children.length;i++)this.__addObject(e.children[i])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);if(-1!==t&&this.__lights.splice(t,1),e.shadowCascadeArray)for(var i=0;i<e.shadowCascadeArray.length;i++)this.__removeObject(e.shadowCascadeArray[i])}else if(!(e instanceof THREE.Camera)){this.__objectsRemoved.push(e);var t=this.__objectsAdded.indexOf(e);-1!==t&&this.__objectsAdded.splice(t,1)}for(var n=0;n<e.children.length;n++)this.__removeObject(e.children[n])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,i){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==i?i:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(){Mt.setRGB(0,0,0),kt.setRGB(0,0,0),At.setRGB(0,0,0);for(var e=0,t=w.length;t>e;e++){var i=w[e],n=i.color;i instanceof THREE.AmbientLight?Mt.add(n):i instanceof THREE.DirectionalLight?kt.add(n):i instanceof THREE.PointLight&&At.add(n)}}function i(e,t,i){for(var n=0,r=w.length;r>n;n++){var o=w[n];if(Tt.copy(o.color),o instanceof THREE.DirectionalLight){var s=Pt.setFromMatrixPosition(o.matrixWorld).normalize(),a=t.dot(s);if(0>=a)continue;a*=o.intensity,i.add(Tt.multiplyScalar(a))}else if(o instanceof THREE.PointLight){var s=Pt.setFromMatrixPosition(o.matrixWorld),a=t.dot(Pt.subVectors(s,e).normalize());if(0>=a)continue;if(a*=0==o.distance?1:1-Math.min(e.distanceTo(s)/o.distance,1),0==a)continue;a*=o.intensity,i.add(Tt.multiplyScalar(a))}}}function n(e,t,i){p(i.opacity),f(i.blending);var n=t.scale.x*it,r=t.scale.y*nt,o=.5*Math.sqrt(n*n+r*r);if(Ht.min.set(e.x-o,e.y-o),Ht.max.set(e.x+o,e.y+o),St.isIntersectionBox(Ht)===!1)return Ht.makeEmpty(),void 0;if(i instanceof THREE.SpriteMaterial||i instanceof THREE.ParticleSystemMaterial)if(null!==i.map){var s=i.map.image;rt.save(),rt.translate(e.x,e.y),rt.rotate(i.rotation),rt.scale(n,-r),rt.drawImage(s,0,0,s.width,s.height,-.5,-.5,1,1),rt.restore()}else _(i.color.getStyle()),rt.save(),rt.translate(e.x,e.y),rt.rotate(i.rotation),rt.scale(n,-r),rt.fillRect(-.5,-.5,1,1),rt.restore();else i instanceof THREE.SpriteCanvasMaterial&&(y(i.color.getStyle()),_(i.color.getStyle()),rt.save(),rt.translate(e.x,e.y),rt.rotate(-t.rotation),rt.scale(n,r),i.program(rt),rt.restore())}function r(e,t,i,n){if(p(n.opacity),f(n.blending),rt.beginPath(),rt.moveTo(e.positionScreen.x,e.positionScreen.y),rt.lineTo(t.positionScreen.x,t.positionScreen.y),n instanceof THREE.LineBasicMaterial){if(m(n.linewidth),g(n.linecap),v(n.linejoin),n.vertexColors!==THREE.VertexColors)y(n.color.getStyle());else{var r=i.vertexColors[0].getStyle(),o=i.vertexColors[1].getStyle();if(r===o)y(r);else{try{var s=rt.createLinearGradient(e.positionScreen.x,e.positionScreen.y,t.positionScreen.x,t.positionScreen.y);s.addColorStop(0,r),s.addColorStop(1,o)}catch(a){s=r}y(s)}}rt.stroke(),Ht.expandByScalar(2*n.linewidth)}else n instanceof THREE.LineDashedMaterial&&(m(n.linewidth),g(n.linecap),v(n.linejoin),y(n.color.getStyle()),b(n.dashSize,n.gapSize),rt.stroke(),Ht.expandByScalar(2*n.linewidth),b(null,null))}function o(e,t,n,r,o,d,m,g){if(Q.info.render.vertices+=3,Q.info.render.faces++,p(g.opacity),f(g.blending),M=e.positionScreen.x,k=e.positionScreen.y,A=t.positionScreen.x,P=t.positionScreen.y,F=n.positionScreen.x,D=n.positionScreen.y,s(M,k,A,P,F,D),(g instanceof THREE.MeshLambertMaterial||g instanceof THREE.MeshPhongMaterial)&&null===g.map)Et.copy(g.color),xt.copy(g.emissive),g.vertexColors===THREE.FaceColors&&Et.multiply(m.color),g.wireframe===!1&&g.shading===THREE.SmoothShading&&3===m.vertexNormalsLength?(vt.copy(Mt),yt.copy(Mt),_t.copy(Mt),i(m.v1.positionWorld,m.vertexNormalsModel[0],vt),i(m.v2.positionWorld,m.vertexNormalsModel[1],yt),i(m.v3.positionWorld,m.vertexNormalsModel[2],_t),vt.multiply(Et).add(xt),yt.multiply(Et).add(xt),_t.multiply(Et).add(xt),bt.addColors(yt,_t).multiplyScalar(.5),L=u(vt,yt,_t,bt),c(M,k,A,P,F,D,0,0,1,0,0,1,L)):(gt.copy(Mt),i(m.centroidModel,m.normalModel,gt),gt.multiply(Et).add(xt),g.wireframe===!0?a(gt,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):l(gt));else if(g instanceof THREE.MeshBasicMaterial||g instanceof THREE.MeshLambertMaterial||g instanceof THREE.MeshPhongMaterial)null!==g.map?g.map.mapping instanceof THREE.UVMapping&&(I=m.uvs[0],h(M,k,A,P,F,D,I[r].x,I[r].y,I[o].x,I[o].y,I[d].x,I[d].y,g.map)):null!==g.envMap?g.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(Pt.copy(m.vertexNormalsModelView[r]),O=.5*Pt.x+.5,V=.5*Pt.y+.5,Pt.copy(m.vertexNormalsModelView[o]),B=.5*Pt.x+.5,U=.5*Pt.y+.5,Pt.copy(m.vertexNormalsModelView[d]),j=.5*Pt.x+.5,W=.5*Pt.y+.5,h(M,k,A,P,F,D,O,V,B,U,j,W,g.envMap)):(gt.copy(g.color),g.vertexColors===THREE.FaceColors&&gt.multiply(m.color),g.wireframe===!0?a(gt,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):l(gt));else if(g instanceof THREE.MeshDepthMaterial)N=R.near,z=R.far,vt.r=vt.g=vt.b=1-E(e.positionScreen.z*e.positionScreen.w,N,z),yt.r=yt.g=yt.b=1-E(t.positionScreen.z*t.positionScreen.w,N,z),_t.r=_t.g=_t.b=1-E(n.positionScreen.z*n.positionScreen.w,N,z),bt.addColors(yt,_t).multiplyScalar(.5),L=u(vt,yt,_t,bt),c(M,k,A,P,F,D,0,0,1,0,0,1,L);else if(g instanceof THREE.MeshNormalMaterial){var v;g.shading===THREE.FlatShading?(v=m.normalModelView,gt.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),g.wireframe===!0?a(gt,g.wireframeLinewidth,g.wireframeLinecap,g.wireframeLinejoin):l(gt)):g.shading===THREE.SmoothShading&&(v=m.vertexNormalsModelView[r],vt.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),v=m.vertexNormalsModelView[o],yt.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),v=m.vertexNormalsModelView[d],_t.setRGB(v.x,v.y,v.z).multiplyScalar(.5).addScalar(.5),bt.addColors(yt,_t).multiplyScalar(.5),L=u(vt,yt,_t,bt),c(M,k,A,P,F,D,0,0,1,0,0,1,L))}}function s(e,t,i,n,r,o){rt.beginPath(),rt.moveTo(e,t),rt.lineTo(i,n),rt.lineTo(r,o),rt.closePath()}function a(e,t,i,n){m(t),g(i),v(n),y(e.getStyle()),rt.stroke(),Ht.expandByScalar(2*t)}function l(e){_(e.getStyle()),rt.fill()}function h(e,t,i,n,r,o,s,a,h,c,u,d,p){if(!(p instanceof THREE.DataTexture||void 0===p.image||0===p.image.width)){if(p.needsUpdate===!0){var f=p.wrapS===THREE.RepeatWrapping,m=p.wrapT===THREE.RepeatWrapping;wt[p.id]=rt.createPattern(p.image,f===!0&&m===!0?"repeat":f===!0&&m===!1?"repeat-x":f===!1&&m===!0?"repeat-y":"no-repeat"),p.needsUpdate=!1}void 0===wt[p.id]?_("rgba(0,0,0,1)"):_(wt[p.id]);var g,v,y,b,E,x,T,w,R=p.offset.x/p.repeat.x,S=p.offset.y/p.repeat.y,C=p.image.width*p.repeat.x,H=p.image.height*p.repeat.y;if(s=(s+R)*C,a=(1-a+S)*H,h=(h+R)*C,c=(1-c+S)*H,u=(u+R)*C,d=(1-d+S)*H,i-=e,n-=t,r-=e,o-=t,h-=s,c-=a,u-=s,d-=a,T=h*d-u*c,0===T){if(void 0===Rt[p.id]){var M=document.createElement("canvas");M.width=p.image.width,M.height=p.image.height;var k=M.getContext("2d");k.drawImage(p.image,0,0),Rt[p.id]=k.getImageData(0,0,p.image.width,p.image.height).data}var A=Rt[p.id],P=4*(Math.floor(s)+Math.floor(a)*p.image.width);return gt.setRGB(A[P]/255,A[P+1]/255,A[P+2]/255),l(gt),void 0}w=1/T,g=(d*i-c*r)*w,v=(d*n-c*o)*w,y=(h*r-u*i)*w,b=(h*o-u*n)*w,E=e-g*s-y*a,x=t-v*s-b*a,rt.save(),rt.transform(g,v,y,b,E,x),rt.fill(),rt.restore()}}function c(e,t,i,n,r,o,s,a,l,h,c,u,d){var p,f,m,g,v,y,_,b,E=d.width-1,x=d.height-1;s*=E,a*=x,l*=E,h*=x,c*=E,u*=x,i-=e,n-=t,r-=e,o-=t,l-=s,h-=a,c-=s,u-=a,_=l*u-c*h,b=1/_,p=(u*i-h*r)*b,f=(u*n-h*o)*b,m=(l*r-c*i)*b,g=(l*o-c*n)*b,v=e-p*s-m*a,y=t-f*s-g*a,rt.save(),rt.transform(p,f,m,g,v,y),rt.clip(),rt.drawImage(d,0,0),rt.restore()}function u(e,t,i,n){return X[0]=0|255*e.r,X[1]=0|255*e.g,X[2]=0|255*e.b,X[4]=0|255*t.r,X[5]=0|255*t.g,X[6]=0|255*t.b,X[8]=0|255*i.r,X[9]=0|255*i.g,X[10]=0|255*i.b,X[12]=0|255*n.r,X[13]=0|255*n.g,X[14]=0|255*n.b,G.putImageData(q,0,0),K.drawImage($,0,0),Y}function d(e,t,i){var n,r=t.x-e.x,o=t.y-e.y,s=r*r+o*o;0!==s&&(n=i/Math.sqrt(s),r*=n,o*=n,t.x+=r,t.y+=o,e.x-=r,e.y-=o)}function p(e){at!==e&&(rt.globalAlpha=e,at=e)}function f(e){lt!==e&&(e===THREE.NormalBlending?rt.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?rt.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(rt.globalCompositeOperation="darker"),lt=e)}function m(e){ut!==e&&(rt.lineWidth=e,ut=e)}function g(e){dt!==e&&(rt.lineCap=e,dt=e)}function v(e){pt!==e&&(rt.lineJoin=e,pt=e)}function y(e){ht!==e&&(rt.strokeStyle=e,ht=e)}function _(e){ct!==e&&(rt.fillStyle=e,ct=e)}function b(e,t){(ft!==e||mt!==t)&&(rt.setLineDash([e,t]),ft=e,mt=t)}console.log("THREE.CanvasRenderer",THREE.REVISION);var E=THREE.Math.smoothstep;e=e||{};var x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V,B,U,j,W,$,G,q,X,Y,K,Q=this,J=new THREE.Projector,Z=void 0!==e.canvas?e.canvas:document.createElement("canvas"),et=Z.width,tt=Z.height,it=Math.floor(et/2),nt=Math.floor(tt/2),rt=Z.getContext("2d"),ot=new THREE.Color(0),st=0,at=1,lt=0,ht=null,ct=null,ut=null,dt=null,pt=null,ft=null,mt=0,gt=(new THREE.RenderableVertex,new THREE.RenderableVertex,new THREE.Color),vt=new THREE.Color,yt=new THREE.Color,_t=new THREE.Color,bt=new THREE.Color,Et=new THREE.Color,xt=new THREE.Color,Tt=new THREE.Color,wt={},Rt={},St=new THREE.Box2,Ct=new THREE.Box2,Ht=new THREE.Box2,Mt=new THREE.Color,kt=new THREE.Color,At=new THREE.Color,Pt=new THREE.Vector3,Ft=16;$=document.createElement("canvas"),$.width=$.height=2,G=$.getContext("2d"),G.fillStyle="rgba(0,0,0,1)",G.fillRect(0,0,2,2),q=G.getImageData(0,0,2,2),X=q.data,Y=document.createElement("canvas"),Y.width=Y.height=Ft,K=Y.getContext("2d"),K.translate(-Ft/2,-Ft/2),K.scale(Ft,Ft),Ft--,void 0===rt.setLineDash&&(rt.setLineDash=void 0!==rt.mozDash?function(e){rt.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=Z,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.sortObjects=!0,this.sortElements=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,i){et=e*this.devicePixelRatio,tt=t*this.devicePixelRatio,it=Math.floor(et/2),nt=Math.floor(tt/2),Z.width=et,Z.height=tt,1!==this.devicePixelRatio&&i!==!1&&(Z.style.width=e+"px",Z.style.height=t+"px"),St.set(new THREE.Vector2(-it,-nt),new THREE.Vector2(it,nt)),Ct.set(new THREE.Vector2(-it,-nt),new THREE.Vector2(it,nt)),at=1,lt=0,ht=null,ct=null,ut=null,dt=null,pt=null},this.setClearColor=function(e,t){ot.set(e),st=void 0!==t?t:1,Ct.set(new THREE.Vector2(-it,-nt),new THREE.Vector2(it,nt))},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){rt.setTransform(1,0,0,-1,it,nt),Ct.empty()===!1&&(Ct.intersect(St),Ct.expandByScalar(2),1>st&&rt.clearRect(0|Ct.min.x,0|Ct.min.y,0|Ct.max.x-Ct.min.x,0|Ct.max.y-Ct.min.y),st>0&&(f(THREE.NormalBlending),p(1),_("rgba("+Math.floor(255*ot.r)+","+Math.floor(255*ot.g)+","+Math.floor(255*ot.b)+","+st+")"),rt.fillRect(0|Ct.min.x,0|Ct.min.y,0|Ct.max.x-Ct.min.x,0|Ct.max.y-Ct.min.y)),Ct.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,i){if(i instanceof THREE.Camera==!1)return console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera."),void 0;this.autoClear===!0&&this.clear(),rt.setTransform(1,0,0,-1,it,nt),Q.info.render.vertices=0,Q.info.render.faces=0,x=J.projectScene(e,i,this.sortObjects,this.sortElements),T=x.elements,w=x.lights,R=i,t();for(var s=0,a=T.length;a>s;s++){var l=T[s],h=l.material;if(void 0!==h&&h.visible!==!1){if(Ht.makeEmpty(),l instanceof THREE.RenderableSprite)S=l,S.x*=it,S.y*=nt,n(S,l,h);else if(l instanceof THREE.RenderableLine)S=l.v1,C=l.v2,S.positionScreen.x*=it,S.positionScreen.y*=nt,C.positionScreen.x*=it,C.positionScreen.y*=nt,Ht.setFromPoints([S.positionScreen,C.positionScreen]),St.isIntersectionBox(Ht)===!0&&r(S,C,l,h);else if(l instanceof THREE.RenderableFace3){if(S=l.v1,C=l.v2,H=l.v3,S.positionScreen.z<-1||S.positionScreen.z>1)continue;if(C.positionScreen.z<-1||C.positionScreen.z>1)continue;if(H.positionScreen.z<-1||H.positionScreen.z>1)continue;S.positionScreen.x*=it,S.positionScreen.y*=nt,C.positionScreen.x*=it,C.positionScreen.y*=nt,H.positionScreen.x*=it,H.positionScreen.y*=nt,h.overdraw>0&&(d(S.positionScreen,C.positionScreen,h.overdraw),d(C.positionScreen,H.positionScreen,h.overdraw),d(H.positionScreen,S.positionScreen,h.overdraw)),Ht.setFromPoints([S.positionScreen,C.positionScreen,H.positionScreen]),St.isIntersectionBox(Ht)===!0&&o(S,C,H,0,1,2,l,h)}Ct.union(Ht)}}rt.setTransform(1,0,0,1,0,0)}},THREE.ShaderChunk={fog_pars_fragment:["#ifdef USE_FOG","uniform vec3 fogColor;","#ifdef FOG_EXP2","uniform float fogDensity;","#else","uniform float fogNear;","uniform float fogFar;","#endif","#endif"].join("\n"),fog_fragment:["#ifdef USE_FOG","float depth = gl_FragCoord.z / gl_FragCoord.w;","#ifdef FOG_EXP2","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","#else","float fogFactor = smoothstep( fogNear, fogFar, depth );","#endif","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","#endif"].join("\n"),envmap_pars_fragment:["#ifdef USE_ENVMAP","uniform float reflectivity;","uniform samplerCube envMap;","uniform float flipEnvMap;","uniform int combine;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","uniform bool useRefract;","uniform float refractionRatio;","#else","varying vec3 vReflect;","#endif","#endif"].join("\n"),envmap_fragment:["#ifdef USE_ENVMAP","vec3 reflectVec;","#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","reflectVec = refract( cameraToVertex, normal, refractionRatio );","} else { ","reflectVec = reflect( cameraToVertex, normal );","}","#else","reflectVec = vReflect;","#endif","#ifdef DOUBLE_SIDED","float flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );","vec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#else","vec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );","#endif","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","if ( combine == 1 ) {","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );","} else if ( combine == 2 ) {","gl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;","} else {","gl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );","}","#endif"].join("\n"),envmap_pars_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","varying vec3 vReflect;","uniform float refractionRatio;","uniform bool useRefract;","#endif"].join("\n"),worldpos_vertex:["#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )","#ifdef USE_SKINNING","vec4 worldPosition = modelMatrix * skinned;","#endif","#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );","#endif","#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","#endif","#endif"].join("\n"),envmap_vertex:["#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )","vec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;","worldNormal = normalize( worldNormal );","vec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, worldNormal, refractionRatio );","} else {","vReflect = reflect( cameraToVertex, worldNormal );","}","#endif"].join("\n"),map_particle_pars_fragment:["#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_particle_fragment:["#ifdef USE_MAP","gl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );","#endif"].join("\n"),map_pars_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","uniform vec4 offsetRepeat;","#endif"].join("\n"),map_pars_fragment:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","varying vec2 vUv;","#endif","#ifdef USE_MAP","uniform sampler2D map;","#endif"].join("\n"),map_vertex:["#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )","vUv = uv * offsetRepeat.zw + offsetRepeat.xy;","#endif"].join("\n"),map_fragment:["#ifdef USE_MAP","vec4 texelColor = texture2D( map, vUv );","#ifdef GAMMA_INPUT","texelColor.xyz *= texelColor.xyz;","#endif","gl_FragColor = gl_FragColor * texelColor;","#endif"].join("\n"),lightmap_pars_fragment:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","uniform sampler2D lightMap;","#endif"].join("\n"),lightmap_pars_vertex:["#ifdef USE_LIGHTMAP","varying vec2 vUv2;","#endif"].join("\n"),lightmap_fragment:["#ifdef USE_LIGHTMAP","gl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );","#endif"].join("\n"),lightmap_vertex:["#ifdef USE_LIGHTMAP","vUv2 = uv2;","#endif"].join("\n"),bumpmap_pars_fragment:["#ifdef USE_BUMPMAP","uniform sampler2D bumpMap;","uniform float bumpScale;","vec2 dHdxy_fwd() {","vec2 dSTdx = dFdx( vUv );","vec2 dSTdy = dFdy( vUv );","float Hll = bumpScale * texture2D( bumpMap, vUv ).x;","float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;","float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;","return vec2( dBx, dBy );","}","vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {","vec3 vSigmaX = dFdx( surf_pos );","vec3 vSigmaY = dFdy( surf_pos );","vec3 vN = surf_norm;","vec3 R1 = cross( vSigmaY, vN );","vec3 R2 = cross( vN, vSigmaX );","float fDet = dot( vSigmaX, R1 );","vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );","return normalize( abs( fDet ) * surf_norm - vGrad );","}","#endif"].join("\n"),normalmap_pars_fragment:["#ifdef USE_NORMALMAP","uniform sampler2D normalMap;","uniform vec2 normalScale;","vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {","vec3 q0 = dFdx( eye_pos.xyz );","vec3 q1 = dFdy( eye_pos.xyz );","vec2 st0 = dFdx( vUv.st );","vec2 st1 = dFdy( vUv.st );","vec3 S = normalize(  q0 * st1.t - q1 * st0.t );","vec3 T = normalize( -q0 * st1.s + q1 * st0.s );","vec3 N = normalize( surf_norm );","vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;","mapN.xy = normalScale * mapN.xy;","mat3 tsn = mat3( S, T, N );","return normalize( tsn * mapN );","}","#endif"].join("\n"),specularmap_pars_fragment:["#ifdef USE_SPECULARMAP","uniform sampler2D specularMap;","#endif"].join("\n"),specularmap_fragment:["float specularStrength;","#ifdef USE_SPECULARMAP","vec4 texelSpecular = texture2D( specularMap, vUv );","specularStrength = texelSpecular.r;","#else","specularStrength = 1.0;","#endif"].join("\n"),lights_lambert_pars_vertex:["uniform vec3 ambient;","uniform vec3 diffuse;","uniform vec3 emissive;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif"].join("\n"),lights_lambert_vertex:["vLightFront = vec3( 0.0 );","#ifdef DOUBLE_SIDED","vLightBack = vec3( 0.0 );","#endif","transformedNormal = normalize( transformedNormal );","#if MAX_DIR_LIGHTS > 0","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, dirVector );","vec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","directionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","directionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += directionalLightColor[ i ] * directionalLightWeighting;","#ifdef DOUBLE_SIDED","vLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;","#endif","}","#endif","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","pointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","pointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;","#ifdef DOUBLE_SIDED","vLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","float dotProduct = dot( transformedNormal, lVector );","vec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );","#ifdef DOUBLE_SIDED","vec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );","#endif","#endif","#ifdef WRAP_AROUND","vec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );","spotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );","#ifdef DOUBLE_SIDED","spotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );","#endif","#endif","vLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;","#ifdef DOUBLE_SIDED","vLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_HEMI_LIGHTS > 0","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( transformedNormal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","float hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;","vLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","#ifdef DOUBLE_SIDED","vLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );","#endif","}","#endif","vLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;","#ifdef DOUBLE_SIDED","vLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;","#endif"].join("\n"),lights_phong_pars_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif"].join("\n"),lights_phong_vertex:["#ifndef PHONG_PER_PIXEL","#if MAX_POINT_LIGHTS > 0","for( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","vPointLight[ i ] = vec4( lVector, lDistance );","}","#endif","#if MAX_SPOT_LIGHTS > 0","for( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz - mvPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","vSpotLight[ i ] = vec4( lVector, lDistance );","}","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","vWorldPosition = worldPosition.xyz;","#endif"].join("\n"),lights_phong_pars_fragment:["uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#else","varying vec4 vPointLight[ MAX_POINT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","#ifdef PHONG_PER_PIXEL","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#else","varying vec4 vSpotLight[ MAX_SPOT_LIGHTS ];","#endif","#endif","#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )","varying vec3 vWorldPosition;","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vViewPosition;","varying vec3 vNormal;"].join("\n"),lights_phong_fragment:["vec3 normal = normalize( vNormal );","vec3 viewPosition = normalize( vViewPosition );","#ifdef DOUBLE_SIDED","normal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );","#endif","#ifdef USE_NORMALMAP","normal = perturbNormal2Arb( -vViewPosition, normal );","#elif defined( USE_BUMPMAP )","normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );","#endif","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse  = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vPointLight[ i ].xyz );","float lDistance = vPointLight[ i ].w;","#endif","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dotProduct, 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dotProduct, 0.0 );","#endif","pointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;","vec3 pointHalfVector = normalize( lVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;","#else","pointSpecular += specular * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse  = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","#ifdef PHONG_PER_PIXEL","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 lVector = lPosition.xyz + vViewPosition.xyz;","float lDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","lDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );","lVector = normalize( lVector );","#else","vec3 lVector = normalize( vSpotLight[ i ].xyz );","float lDistance = vSpotLight[ i ].w;","#endif","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","float dotProduct = dot( normal, lVector );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dotProduct, 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dotProduct, 0.0 );","#endif","spotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;","vec3 spotHalfVector = normalize( lVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;","#else","spotSpecular += specular * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse  = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, dirVector );","#ifdef WRAP_AROUND","float dirDiffuseWeightFull = max( dotProduct, 0.0 );","float dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dotProduct, 0.0 );","#endif","dirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += specular * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += diffuse * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( shininess + 2.0001 ) / 8.0;","vec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += specular * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;","#endif"].join("\n"),color_pars_fragment:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_fragment:["#ifdef USE_COLOR","gl_FragColor = gl_FragColor * vec4( vColor, 1.0 );","#endif"].join("\n"),color_pars_vertex:["#ifdef USE_COLOR","varying vec3 vColor;","#endif"].join("\n"),color_vertex:["#ifdef USE_COLOR","#ifdef GAMMA_INPUT","vColor = color * color;","#else","vColor = color;","#endif","#endif"].join("\n"),skinning_pars_vertex:["#ifdef USE_SKINNING","#ifdef BONE_TEXTURE","uniform sampler2D boneTexture;","uniform int boneTextureWidth;","uniform int boneTextureHeight;","mat4 getBoneMatrix( const in float i ) {","float j = i * 4.0;","float x = mod( j, float( boneTextureWidth ) );","float y = floor( j / float( boneTextureWidth ) );","float dx = 1.0 / float( boneTextureWidth );","float dy = 1.0 / float( boneTextureHeight );","y = dy * ( y + 0.5 );","vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );","vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );","vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );","vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );","mat4 bone = mat4( v1, v2, v3, v4 );","return bone;","}","#else","uniform mat4 boneGlobalMatrices[ MAX_BONES ];","mat4 getBoneMatrix( const in float i ) {","mat4 bone = boneGlobalMatrices[ int(i) ];","return bone;","}","#endif","#endif"].join("\n"),skinbase_vertex:["#ifdef USE_SKINNING","mat4 boneMatX = getBoneMatrix( skinIndex.x );","mat4 boneMatY = getBoneMatrix( skinIndex.y );","#endif"].join("\n"),skinning_vertex:["#ifdef USE_SKINNING","#ifdef USE_MORPHTARGETS","vec4 skinVertex = vec4( morphed, 1.0 );","#else","vec4 skinVertex = vec4( position, 1.0 );","#endif","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","#endif"].join("\n"),morphtarget_pars_vertex:["#ifdef USE_MORPHTARGETS","#ifndef USE_MORPHNORMALS","uniform float morphTargetInfluences[ 8 ];","#else","uniform float morphTargetInfluences[ 4 ];","#endif","#endif"].join("\n"),morphtarget_vertex:["#ifdef USE_MORPHTARGETS","vec3 morphed = vec3( 0.0 );","morphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];","morphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];","morphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];","morphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];","#ifndef USE_MORPHNORMALS","morphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];","morphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];","morphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];","morphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];","#endif","morphed += position;","#endif"].join("\n"),default_vertex:["vec4 mvPosition;","#ifdef USE_SKINNING","mvPosition = modelViewMatrix * skinned;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( morphed, 1.0 );","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )","mvPosition = modelViewMatrix * vec4( position, 1.0 );","#endif","gl_Position = projectionMatrix * mvPosition;"].join("\n"),morphnormal_vertex:["#ifdef USE_MORPHNORMALS","vec3 morphedNormal = vec3( 0.0 );","morphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];","morphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];","morphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];","morphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];","morphedNormal += normal;","#endif"].join("\n"),skinnormal_vertex:["#ifdef USE_SKINNING","mat4 skinMatrix = skinWeight.x * boneMatX;","skinMatrix 	+= skinWeight.y * boneMatY;","#ifdef USE_MORPHNORMALS","vec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );","#else","vec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );","#endif","#endif"].join("\n"),defaultnormal_vertex:["vec3 objectNormal;","#ifdef USE_SKINNING","objectNormal = skinnedNormal.xyz;","#endif","#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )","objectNormal = morphedNormal;","#endif","#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )","objectNormal = normal;","#endif","#ifdef FLIP_SIDED","objectNormal = -objectNormal;","#endif","vec3 transformedNormal = normalMatrix * objectNormal;"].join("\n"),shadowmap_pars_fragment:["#ifdef USE_SHADOWMAP","uniform sampler2D shadowMap[ MAX_SHADOWS ];","uniform vec2 shadowMapSize[ MAX_SHADOWS ];","uniform float shadowDarkness[ MAX_SHADOWS ];","uniform float shadowBias[ MAX_SHADOWS ];","varying vec4 vShadowCoord[ MAX_SHADOWS ];","float unpackDepth( const in vec4 rgba_depth ) {","const vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );","float depth = dot( rgba_depth, bit_shift );","return depth;","}","#endif"].join("\n"),shadowmap_fragment:["#ifdef USE_SHADOWMAP","#ifdef SHADOWMAP_DEBUG","vec3 frustumColors[3];","frustumColors[0] = vec3( 1.0, 0.5, 0.0 );","frustumColors[1] = vec3( 0.0, 1.0, 0.8 );","frustumColors[2] = vec3( 0.0, 0.5, 1.0 );","#endif","#ifdef SHADOWMAP_CASCADE","int inFrustumCount = 0;","#endif","float fDepth;","vec3 shadowColor = vec3( 1.0 );","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;","bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );","bool inFrustum = all( inFrustumVec );","#ifdef SHADOWMAP_CASCADE","inFrustumCount += int( inFrustum );","bvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );","#else","bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );","#endif","bool frustumTest = all( frustumTestVec );","if ( frustumTest ) {","shadowCoord.z += shadowBias[ i ];","#if defined( SHADOWMAP_TYPE_PCF )","float shadow = 0.0;","const float shadowDelta = 1.0 / 9.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.25 * xPixelOffset;","float dy0 = -1.25 * yPixelOffset;","float dx1 = 1.25 * xPixelOffset;","float dy1 = 1.25 * yPixelOffset;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","fDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","if ( fDepth < shadowCoord.z ) shadow += shadowDelta;","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#elif defined( SHADOWMAP_TYPE_PCF_SOFT )","float shadow = 0.0;","float xPixelOffset = 1.0 / shadowMapSize[ i ].x;","float yPixelOffset = 1.0 / shadowMapSize[ i ].y;","float dx0 = -1.0 * xPixelOffset;","float dy0 = -1.0 * yPixelOffset;","float dx1 = 1.0 * xPixelOffset;","float dy1 = 1.0 * yPixelOffset;","mat3 shadowKernel;","mat3 depthKernel;","depthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );","depthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );","depthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );","depthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );","depthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );","depthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );","depthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );","depthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );","depthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );","vec3 shadowZ = vec3( shadowCoord.z );","shadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));","shadowKernel[0] *= vec3(0.25);","shadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));","shadowKernel[1] *= vec3(0.25);","shadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));","shadowKernel[2] *= vec3(0.25);","vec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );","shadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );","shadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );","vec4 shadowValues;","shadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );","shadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );","shadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );","shadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );","shadow = dot( shadowValues, vec4( 1.0 ) );","shadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );","#else","vec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );","float fDepth = unpackDepth( rgbaDepth );","if ( fDepth < shadowCoord.z )","shadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );","#endif","}","#ifdef SHADOWMAP_DEBUG","#ifdef SHADOWMAP_CASCADE","if ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];","#else","if ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];","#endif","#endif","}","#ifdef GAMMA_OUTPUT","shadowColor *= shadowColor;","#endif","gl_FragColor.xyz = gl_FragColor.xyz * shadowColor;","#endif"].join("\n"),shadowmap_pars_vertex:["#ifdef USE_SHADOWMAP","varying vec4 vShadowCoord[ MAX_SHADOWS ];","uniform mat4 shadowMatrix[ MAX_SHADOWS ];","#endif"].join("\n"),shadowmap_vertex:["#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif"].join("\n"),alphatest_fragment:["#ifdef ALPHATEST","if ( gl_FragColor.a < ALPHATEST ) discard;","#endif"].join("\n"),linear_to_gamma_fragment:["#ifdef GAMMA_OUTPUT","gl_FragColor.xyz = sqrt( gl_FragColor.xyz );","#endif"].join("\n")},THREE.UniformsUtils={merge:function(e){var t,i,n,r={};
for(t=0;t<e.length;t++){n=this.clone(e[t]);for(i in n)r[i]=n[i]}return r},clone:function(e){var t,i,n,r={};for(t in e){r[t]={};for(i in e[t])n=e[t][i],r[t][i]=n instanceof THREE.Color||n instanceof THREE.Vector2||n instanceof THREE.Vector3||n instanceof THREE.Vector4||n instanceof THREE.Matrix4||n instanceof THREE.Texture?n.clone():n instanceof Array?n.slice():n}return r}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vLightFront;","#ifdef DOUBLE_SIDED","varying vec3 vLightBack;","#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED","if ( gl_FrontFacing )","gl_FragColor.xyz *= vLightFront;","else","gl_FragColor.xyz *= vLightBack;","#else","gl_FragColor.xyz *= vLightFront;","#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG","varying vec3 vViewPosition;","varying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform vec3 ambient;","uniform vec3 emissive;","uniform vec3 specular;","uniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {","gl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;","uniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","#ifdef USE_SIZEATTENUATION","gl_PointSize = size * ( scale / length( mvPosition.xyz ) );","#else","gl_PointSize = size;","#endif","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;","uniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {","gl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;","attribute float lineDistance;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","gl_Position = projectionMatrix * mvPosition;","}"].join("\n"),fragmentShader:["uniform vec3 diffuse;","uniform float opacity;","uniform float dashSize;","uniform float totalSize;","varying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","if ( mod( vLineDistance, totalSize ) > dashSize ) {","discard;","}","gl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:["void main() {","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float mNear;","uniform float mFar;","uniform float opacity;","void main() {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float color = 1.0 - smoothstep( mNear, mFar, depth );","gl_FragColor = vec4( vec3( color ), opacity );","}"].join("\n")},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {","vNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;","varying vec3 vNormal;","void main() {","gl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );","}"].join("\n")},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},uDiffuseColor:{type:"c",value:new THREE.Color(16777215)},uSpecularColor:{type:"c",value:new THREE.Color(1118481)},uAmbientColor:{type:"c",value:new THREE.Color(16777215)},uShininess:{type:"f",value:30},uOpacity:{type:"f",value:1},useRefract:{type:"i",value:0},uRefractionRatio:{type:"f",value:.98},uReflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 uAmbientColor;","uniform vec3 uDiffuseColor;","uniform vec3 uSpecularColor;","uniform float uShininess;","uniform float uOpacity;","uniform bool enableDiffuse;","uniform bool enableSpecular;","uniform bool enableAO;","uniform bool enableReflection;","uniform sampler2D tDiffuse;","uniform sampler2D tNormal;","uniform sampler2D tSpecular;","uniform sampler2D tAO;","uniform samplerCube tCube;","uniform vec2 uNormalScale;","uniform bool useRefract;","uniform float uRefractionRatio;","uniform float uReflectivity;","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","uniform vec3 ambientLightColor;","#if MAX_DIR_LIGHTS > 0","uniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];","uniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];","#endif","#if MAX_HEMI_LIGHTS > 0","uniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];","uniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];","#endif","#if MAX_POINT_LIGHTS > 0","uniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];","uniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];","uniform float pointLightDistance[ MAX_POINT_LIGHTS ];","#endif","#if MAX_SPOT_LIGHTS > 0","uniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];","uniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];","uniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];","uniform float spotLightExponent[ MAX_SPOT_LIGHTS ];","uniform float spotLightDistance[ MAX_SPOT_LIGHTS ];","#endif","#ifdef WRAP_AROUND","uniform vec3 wrapRGB;","#endif","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {","gl_FragColor = vec4( vec3( 1.0 ), uOpacity );","vec3 specularTex = vec3( 1.0 );","vec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;","normalTex.xy *= uNormalScale;","normalTex = normalize( normalTex );","if( enableDiffuse ) {","#ifdef GAMMA_INPUT","vec4 texelColor = texture2D( tDiffuse, vUv );","texelColor.xyz *= texelColor.xyz;","gl_FragColor = gl_FragColor * texelColor;","#else","gl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );","#endif","}","if( enableAO ) {","#ifdef GAMMA_INPUT","vec4 aoColor = texture2D( tAO, vUv );","aoColor.xyz *= aoColor.xyz;","gl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;","#else","gl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;","#endif","}","if( enableSpecular )","specularTex = texture2D( tSpecular, vUv ).xyz;","mat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );","vec3 finalNormal = tsb * normalTex;","#ifdef FLIP_SIDED","finalNormal = -finalNormal;","#endif","vec3 normal = normalize( finalNormal );","vec3 viewPosition = normalize( vViewPosition );","#if MAX_POINT_LIGHTS > 0","vec3 pointDiffuse = vec3( 0.0 );","vec3 pointSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );","vec3 pointVector = lPosition.xyz + vViewPosition.xyz;","float pointDistance = 1.0;","if ( pointLightDistance[ i ] > 0.0 )","pointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );","pointVector = normalize( pointVector );","#ifdef WRAP_AROUND","float pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );","float pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );","vec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );","#else","float pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );","#endif","pointDiffuse += pointDistance * pointLightColor[ i ] * uDiffuseColor * pointDiffuseWeight;","vec3 pointHalfVector = normalize( pointVector + viewPosition );","float pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );","float pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );","pointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;","#else","pointSpecular += pointDistance * pointLightColor[ i ] * uSpecularColor * pointSpecularWeight * pointDiffuseWeight;","#endif","}","#endif","#if MAX_SPOT_LIGHTS > 0","vec3 spotDiffuse = vec3( 0.0 );","vec3 spotSpecular = vec3( 0.0 );","for ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {","vec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );","vec3 spotVector = lPosition.xyz + vViewPosition.xyz;","float spotDistance = 1.0;","if ( spotLightDistance[ i ] > 0.0 )","spotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );","spotVector = normalize( spotVector );","float spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );","if ( spotEffect > spotLightAngleCos[ i ] ) {","spotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );","#ifdef WRAP_AROUND","float spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );","float spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );","vec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );","#else","float spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );","#endif","spotDiffuse += spotDistance * spotLightColor[ i ] * uDiffuseColor * spotDiffuseWeight * spotEffect;","vec3 spotHalfVector = normalize( spotVector + viewPosition );","float spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );","float spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );","spotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;","#else","spotSpecular += spotDistance * spotLightColor[ i ] * uSpecularColor * spotSpecularWeight * spotDiffuseWeight * spotEffect;","#endif","}","}","#endif","#if MAX_DIR_LIGHTS > 0","vec3 dirDiffuse = vec3( 0.0 );","vec3 dirSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {","vec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );","vec3 dirVector = normalize( lDirection.xyz );","#ifdef WRAP_AROUND","float directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );","float directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );","vec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );","#else","float dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );","#endif","dirDiffuse += directionalLightColor[ i ] * uDiffuseColor * dirDiffuseWeight;","vec3 dirHalfVector = normalize( dirVector + viewPosition );","float dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );","float dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlick = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );","dirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;","#else","dirSpecular += directionalLightColor[ i ] * uSpecularColor * dirSpecularWeight * dirDiffuseWeight;","#endif","}","#endif","#if MAX_HEMI_LIGHTS > 0","vec3 hemiDiffuse  = vec3( 0.0 );","vec3 hemiSpecular = vec3( 0.0 );","for( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {","vec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );","vec3 lVector = normalize( lDirection.xyz );","float dotProduct = dot( normal, lVector );","float hemiDiffuseWeight = 0.5 * dotProduct + 0.5;","vec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );","hemiDiffuse += uDiffuseColor * hemiColor;","vec3 hemiHalfVectorSky = normalize( lVector + viewPosition );","float hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;","float hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, uShininess ), 0.0 );","vec3 lVectorGround = -lVector;","vec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );","float hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;","float hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, uShininess ), 0.0 );","#ifdef PHYSICALLY_BASED_SHADING","float dotProductGround = dot( normal, lVectorGround );","float specularNormalization = ( uShininess + 2.0001 ) / 8.0;","vec3 schlickSky = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );","vec3 schlickGround = uSpecularColor + vec3( 1.0 - uSpecularColor ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );","hemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );","#else","hemiSpecular += uSpecularColor * hemiColor * ( hemiSpecularWeightSky + hemiSpecularWeightGround ) * hemiDiffuseWeight;","#endif","}","#endif","vec3 totalDiffuse = vec3( 0.0 );","vec3 totalSpecular = vec3( 0.0 );","#if MAX_DIR_LIGHTS > 0","totalDiffuse += dirDiffuse;","totalSpecular += dirSpecular;","#endif","#if MAX_HEMI_LIGHTS > 0","totalDiffuse += hemiDiffuse;","totalSpecular += hemiSpecular;","#endif","#if MAX_POINT_LIGHTS > 0","totalDiffuse += pointDiffuse;","totalSpecular += pointSpecular;","#endif","#if MAX_SPOT_LIGHTS > 0","totalDiffuse += spotDiffuse;","totalSpecular += spotSpecular;","#endif","#ifdef METAL","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor + totalSpecular );","#else","gl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * uAmbientColor ) + totalSpecular;","#endif","if ( enableReflection ) {","vec3 vReflect;","vec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );","if ( useRefract ) {","vReflect = refract( cameraToVertex, normal, uRefractionRatio );","} else {","vReflect = reflect( cameraToVertex, normal );","}","vec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );","#ifdef GAMMA_INPUT","cubeColor.xyz *= cubeColor.xyz;","#endif","gl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * uReflectivity );","}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;","uniform vec2 uOffset;","uniform vec2 uRepeat;","uniform bool enableDisplacement;","#ifdef VERTEX_TEXTURES","uniform sampler2D tDisplacement;","uniform float uDisplacementScale;","uniform float uDisplacementBias;","#endif","varying vec3 vTangent;","varying vec3 vBinormal;","varying vec3 vNormal;","varying vec2 vUv;","varying vec3 vWorldPosition;","varying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING","vNormal = normalize( normalMatrix * skinnedNormal.xyz );","vec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );","vTangent = normalize( normalMatrix * skinnedTangent.xyz );","#else","vNormal = normalize( normalMatrix * normal );","vTangent = normalize( normalMatrix * tangent.xyz );","#endif","vBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );","vUv = uv * uRepeat + uOffset;","vec3 displacedPosition;","#ifdef VERTEX_TEXTURES","if ( enableDisplacement ) {","vec3 dv = texture2D( tDisplacement, uv ).xyz;","float df = uDisplacementScale * dv.x + uDisplacementBias;","displacedPosition = position + normalize( normal ) * df;","} else {","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","}","#else","#ifdef USE_SKINNING","vec4 skinVertex = vec4( position, 1.0 );","vec4 skinned  = boneMatX * skinVertex * skinWeight.x;","skinned 	  += boneMatY * skinVertex * skinWeight.y;","displacedPosition  = skinned.xyz;","#else","displacedPosition = position;","#endif","#endif","vec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );","vec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );","gl_Position = projectionMatrix * mvPosition;","vWorldPosition = worldPosition.xyz;","vViewPosition = -mvPosition.xyz;","#ifdef USE_SHADOWMAP","for( int i = 0; i < MAX_SHADOWS; i ++ ) {","vShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;","}","#endif","}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:["varying vec3 vWorldPosition;","void main() {","vec4 worldPosition = modelMatrix * vec4( position, 1.0 );","vWorldPosition = worldPosition.xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform samplerCube tCube;","uniform float tFlip;","varying vec3 vWorldPosition;","void main() {","gl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );","}"].join("\n")},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:["vec4 pack_depth( const in float depth ) {","const vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );","const vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );","vec4 res = fract( depth * bit_shift );","res -= res.xxyz * bit_mask;","return res;","}","void main() {","gl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );","}"].join("\n")}},THREE.WebGLRenderer=function(e){function t(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),Vt.info.memory.geometries++}function i(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),e.__webglLineDistanceBuffer=Dt.createBuffer(),Vt.info.memory.geometries++}function n(e){e.__webglVertexBuffer=Dt.createBuffer(),e.__webglNormalBuffer=Dt.createBuffer(),e.__webglTangentBuffer=Dt.createBuffer(),e.__webglColorBuffer=Dt.createBuffer(),e.__webglUVBuffer=Dt.createBuffer(),e.__webglUV2Buffer=Dt.createBuffer(),e.__webglSkinIndicesBuffer=Dt.createBuffer(),e.__webglSkinWeightsBuffer=Dt.createBuffer(),e.__webglFaceBuffer=Dt.createBuffer(),e.__webglLineBuffer=Dt.createBuffer();var t,i;if(e.numMorphTargets)for(e.__webglMorphTargetsBuffers=[],t=0,i=e.numMorphTargets;i>t;t++)e.__webglMorphTargetsBuffers.push(Dt.createBuffer());if(e.numMorphNormals)for(e.__webglMorphNormalsBuffers=[],t=0,i=e.numMorphNormals;i>t;t++)e.__webglMorphNormalsBuffers.push(Dt.createBuffer());Vt.info.memory.geometries++}function r(e,t){var i=e.vertices.length,n=t.material;if(n.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var r in n.attributes){var o=n.attributes[r];if(!o.__webglInitialized||o.createUniqueBuffers){o.__webglInitialized=!0;var s=1;"v2"===o.type?s=2:"v3"===o.type?s=3:"v4"===o.type?s=4:"c"===o.type&&(s=3),o.size=s,o.array=new Float32Array(i*s),o.buffer=Dt.createBuffer(),o.buffer.belongsToAttribute=r,o.needsUpdate=!0}e.__webglCustomAttributesList.push(o)}}}function o(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__sortArray=[],e.__webglParticleCount=i,r(e,t)}function s(e,t){var i=e.vertices.length;e.__vertexArray=new Float32Array(3*i),e.__colorArray=new Float32Array(3*i),e.__lineDistanceArray=new Float32Array(1*i),e.__webglLineCount=i,r(e,t)}function a(e,t){var i=t.geometry,n=e.faces3,r=3*n.length,o=1*n.length,s=3*n.length,a=l(t,e),h=d(a),p=c(a),f=u(a);e.__vertexArray=new Float32Array(3*r),p&&(e.__normalArray=new Float32Array(3*r)),i.hasTangents&&(e.__tangentArray=new Float32Array(4*r)),f&&(e.__colorArray=new Float32Array(3*r)),h&&(i.faceVertexUvs.length>0&&(e.__uvArray=new Float32Array(2*r)),i.faceVertexUvs.length>1&&(e.__uv2Array=new Float32Array(2*r))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*r),e.__skinWeightArray=new Float32Array(4*r)),e.__faceArray=new Uint16Array(3*o),e.__lineArray=new Uint16Array(2*s);var m,g;if(e.numMorphTargets)for(e.__morphTargetsArrays=[],m=0,g=e.numMorphTargets;g>m;m++)e.__morphTargetsArrays.push(new Float32Array(3*r));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],m=0,g=e.numMorphNormals;g>m;m++)e.__morphNormalsArrays.push(new Float32Array(3*r));if(e.__webglFaceCount=3*o,e.__webglLineCount=2*s,a.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var v in a.attributes){var y=a.attributes[v],_={};for(var b in y)_[b]=y[b];if(!_.__webglInitialized||_.createUniqueBuffers){_.__webglInitialized=!0;var E=1;"v2"===_.type?E=2:"v3"===_.type?E=3:"v4"===_.type?E=4:"c"===_.type&&(E=3),_.size=E,_.array=new Float32Array(r*E),_.buffer=Dt.createBuffer(),_.buffer.belongsToAttribute=v,y.needsUpdate=!0,_.__original=y}e.__webglCustomAttributesList.push(_)}}e.__inittedArrays=!0}function l(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function h(e){return e&&void 0!==e.shading&&e.shading===THREE.SmoothShading}function c(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:h(e)?THREE.SmoothShading:THREE.FlatShading}function u(e){return e.vertexColors?e.vertexColors:!1}function d(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function p(e){var t,i,n;for(t in e.attributes)n="index"===t?Dt.ELEMENT_ARRAY_BUFFER:Dt.ARRAY_BUFFER,i=e.attributes[t],void 0===i.numItems&&(i.numItems=i.array.length),i.buffer=Dt.createBuffer(),Dt.bindBuffer(n,i.buffer),Dt.bufferData(n,i.array,Dt.STATIC_DRAW)}function f(e,t,i){var n,r,o,s,a,l,h,c,u,d,p,f,m=e.vertices,g=m.length,v=e.colors,y=v.length,_=e.__vertexArray,b=e.__colorArray,E=e.__sortArray,T=e.verticesNeedUpdate,w=(e.elementsNeedUpdate,e.colorsNeedUpdate),R=e.__webglCustomAttributesList;if(i.sortParticles){for(vi.copy(gi),vi.multiply(i.matrixWorld),n=0;g>n;n++)o=m[n],yi.copy(o),yi.applyProjection(vi),E[n]=[yi.z,n];for(E.sort(x),n=0;g>n;n++)o=m[E[n][1]],s=3*n,_[s]=o.x,_[s+1]=o.y,_[s+2]=o.z;for(r=0;y>r;r++)s=3*r,l=v[E[r][1]],b[s]=l.r,b[s+1]=l.g,b[s+2]=l.b;if(R)for(h=0,c=R.length;c>h;h++)if(f=R[h],void 0===f.boundTo||"vertices"===f.boundTo)if(s=0,d=f.value.length,1===f.size)for(u=0;d>u;u++)a=E[u][1],f.array[u]=f.value[a];else if(2===f.size)for(u=0;d>u;u++)a=E[u][1],p=f.value[a],f.array[s]=p.x,f.array[s+1]=p.y,s+=2;
else if(3===f.size)if("c"===f.type)for(u=0;d>u;u++)a=E[u][1],p=f.value[a],f.array[s]=p.r,f.array[s+1]=p.g,f.array[s+2]=p.b,s+=3;else for(u=0;d>u;u++)a=E[u][1],p=f.value[a],f.array[s]=p.x,f.array[s+1]=p.y,f.array[s+2]=p.z,s+=3;else if(4===f.size)for(u=0;d>u;u++)a=E[u][1],p=f.value[a],f.array[s]=p.x,f.array[s+1]=p.y,f.array[s+2]=p.z,f.array[s+3]=p.w,s+=4}else{if(T)for(n=0;g>n;n++)o=m[n],s=3*n,_[s]=o.x,_[s+1]=o.y,_[s+2]=o.z;if(w)for(r=0;y>r;r++)l=v[r],s=3*r,b[s]=l.r,b[s+1]=l.g,b[s+2]=l.b;if(R)for(h=0,c=R.length;c>h;h++)if(f=R[h],f.needsUpdate&&(void 0===f.boundTo||"vertices"===f.boundTo))if(d=f.value.length,s=0,1===f.size)for(u=0;d>u;u++)f.array[u]=f.value[u];else if(2===f.size)for(u=0;d>u;u++)p=f.value[u],f.array[s]=p.x,f.array[s+1]=p.y,s+=2;else if(3===f.size)if("c"===f.type)for(u=0;d>u;u++)p=f.value[u],f.array[s]=p.r,f.array[s+1]=p.g,f.array[s+2]=p.b,s+=3;else for(u=0;d>u;u++)p=f.value[u],f.array[s]=p.x,f.array[s+1]=p.y,f.array[s+2]=p.z,s+=3;else if(4===f.size)for(u=0;d>u;u++)p=f.value[u],f.array[s]=p.x,f.array[s+1]=p.y,f.array[s+2]=p.z,f.array[s+3]=p.w,s+=4}if((T||i.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,_,t)),(w||i.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,b,t)),R)for(h=0,c=R.length;c>h;h++)f=R[h],(f.needsUpdate||i.sortParticles)&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,f.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,f.array,t))}function m(e,t){var i,n,r,o,s,a,l,h,c,u,d,p,f=e.vertices,m=e.colors,g=e.lineDistances,v=f.length,y=m.length,_=g.length,b=e.__vertexArray,E=e.__colorArray,x=e.__lineDistanceArray,T=e.verticesNeedUpdate,w=e.colorsNeedUpdate,R=e.lineDistancesNeedUpdate,S=e.__webglCustomAttributesList;if(T){for(i=0;v>i;i++)o=f[i],s=3*i,b[s]=o.x,b[s+1]=o.y,b[s+2]=o.z;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,b,t)}if(w){for(n=0;y>n;n++)a=m[n],s=3*n,E[s]=a.r,E[s+1]=a.g,E[s+2]=a.b;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,E,t)}if(R){for(r=0;_>r;r++)x[r]=g[r];Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglLineDistanceBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,x,t)}if(S)for(l=0,h=S.length;h>l;l++)if(p=S[l],p.needsUpdate&&(void 0===p.boundTo||"vertices"===p.boundTo)){if(s=0,u=p.value.length,1===p.size)for(c=0;u>c;c++)p.array[c]=p.value[c];else if(2===p.size)for(c=0;u>c;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,s+=2;else if(3===p.size)if("c"===p.type)for(c=0;u>c;c++)d=p.value[c],p.array[s]=d.r,p.array[s+1]=d.g,p.array[s+2]=d.b,s+=3;else for(c=0;u>c;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,s+=3;else if(4===p.size)for(c=0;u>c;c++)d=p.value[c],p.array[s]=d.x,p.array[s+1]=d.y,p.array[s+2]=d.z,p.array[s+3]=d.w,s+=4;Dt.bindBuffer(Dt.ARRAY_BUFFER,p.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,p.array,t)}}function g(e,t,i,n,r){if(e.__inittedArrays){var o,s,a,l,h,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V,B,U,j,W,$,G,q,X,Y,K=c(r),Q=u(r),J=d(r),Z=K===THREE.SmoothShading,et=0,tt=0,it=0,nt=0,rt=0,ot=0,st=0,at=0,lt=0,ht=0,ct=0,ut=0,dt=0,pt=e.__vertexArray,ft=e.__uvArray,mt=e.__uv2Array,gt=e.__normalArray,vt=e.__tangentArray,yt=e.__colorArray,_t=e.__skinIndexArray,bt=e.__skinWeightArray,Et=e.__morphTargetsArrays,xt=e.__morphNormalsArrays,Tt=e.__webglCustomAttributesList,wt=e.__faceArray,Rt=e.__lineArray,St=t.geometry,Ct=St.verticesNeedUpdate,Ht=St.elementsNeedUpdate,Mt=St.uvsNeedUpdate,kt=St.normalsNeedUpdate,At=St.tangentsNeedUpdate,Pt=St.colorsNeedUpdate,Ft=St.morphTargetsNeedUpdate,Nt=St.vertices,zt=e.faces3,Lt=St.faces,It=St.faceVertexUvs[0],Ot=St.faceVertexUvs[1],Vt=(St.colors,St.skinIndices),Bt=St.skinWeights,Ut=St.morphTargets,jt=St.morphNormals;if(Ct){for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],_=Nt[l.a],b=Nt[l.b],E=Nt[l.c],pt[tt]=_.x,pt[tt+1]=_.y,pt[tt+2]=_.z,pt[tt+3]=b.x,pt[tt+4]=b.y,pt[tt+5]=b.z,pt[tt+6]=E.x,pt[tt+7]=E.y,pt[tt+8]=E.z,tt+=9;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,pt,i)}if(Ft)for(U=0,j=Ut.length;j>U;U++){for(ct=0,o=0,s=zt.length;s>o;o++)G=zt[o],l=Lt[G],_=Ut[U].vertices[l.a],b=Ut[U].vertices[l.b],E=Ut[U].vertices[l.c],W=Et[U],W[ct]=_.x,W[ct+1]=_.y,W[ct+2]=_.z,W[ct+3]=b.x,W[ct+4]=b.y,W[ct+5]=b.z,W[ct+6]=E.x,W[ct+7]=E.y,W[ct+8]=E.z,r.morphNormals&&(Z?(q=jt[U].vertexNormals[G],R=q.a,S=q.b,C=q.c):(R=jt[U].faceNormals[G],S=R,C=R),$=xt[U],$[ct]=R.x,$[ct+1]=R.y,$[ct+2]=R.z,$[ct+3]=S.x,$[ct+4]=S.y,$[ct+5]=S.z,$[ct+6]=C.x,$[ct+7]=C.y,$[ct+8]=C.z),ct+=9;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglMorphTargetsBuffers[U]),Dt.bufferData(Dt.ARRAY_BUFFER,Et[U],i),r.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglMorphNormalsBuffers[U]),Dt.bufferData(Dt.ARRAY_BUFFER,xt[U],i))}if(Bt.length){for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],A=Bt[l.a],P=Bt[l.b],F=Bt[l.c],bt[ht]=A.x,bt[ht+1]=A.y,bt[ht+2]=A.z,bt[ht+3]=A.w,bt[ht+4]=P.x,bt[ht+5]=P.y,bt[ht+6]=P.z,bt[ht+7]=P.w,bt[ht+8]=F.x,bt[ht+9]=F.y,bt[ht+10]=F.z,bt[ht+11]=F.w,D=Vt[l.a],N=Vt[l.b],z=Vt[l.c],_t[ht]=D.x,_t[ht+1]=D.y,_t[ht+2]=D.z,_t[ht+3]=D.w,_t[ht+4]=N.x,_t[ht+5]=N.y,_t[ht+6]=N.z,_t[ht+7]=N.w,_t[ht+8]=z.x,_t[ht+9]=z.y,_t[ht+10]=z.z,_t[ht+11]=z.w,ht+=12;ht>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglSkinIndicesBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,_t,i),Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglSkinWeightsBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,bt,i))}if(Pt&&Q){for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],f=l.vertexColors,m=l.color,3===f.length&&Q===THREE.VertexColors?(H=f[0],M=f[1],k=f[2]):(H=m,M=m,k=m),yt[lt]=H.r,yt[lt+1]=H.g,yt[lt+2]=H.b,yt[lt+3]=M.r,yt[lt+4]=M.g,yt[lt+5]=M.b,yt[lt+6]=k.r,yt[lt+7]=k.g,yt[lt+8]=k.b,lt+=9;lt>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,yt,i))}if(At&&St.hasTangents){for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],g=l.vertexTangents,x=g[0],T=g[1],w=g[2],vt[st]=x.x,vt[st+1]=x.y,vt[st+2]=x.z,vt[st+3]=x.w,vt[st+4]=T.x,vt[st+5]=T.y,vt[st+6]=T.z,vt[st+7]=T.w,vt[st+8]=w.x,vt[st+9]=w.y,vt[st+10]=w.z,vt[st+11]=w.w,st+=12;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglTangentBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,vt,i)}if(kt&&K){for(o=0,s=zt.length;s>o;o++)if(l=Lt[zt[o]],h=l.vertexNormals,p=l.normal,3===h.length&&Z)for(L=0;3>L;L++)O=h[L],gt[ot]=O.x,gt[ot+1]=O.y,gt[ot+2]=O.z,ot+=3;else for(L=0;3>L;L++)gt[ot]=p.x,gt[ot+1]=p.y,gt[ot+2]=p.z,ot+=3;Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglNormalBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,gt,i)}if(Mt&&It&&J){for(o=0,s=zt.length;s>o;o++)if(a=zt[o],v=It[a],void 0!==v)for(L=0;3>L;L++)V=v[L],ft[it]=V.x,ft[it+1]=V.y,it+=2;it>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUVBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,ft,i))}if(Mt&&Ot&&J){for(o=0,s=zt.length;s>o;o++)if(a=zt[o],y=Ot[a],void 0!==y)for(L=0;3>L;L++)B=y[L],mt[nt]=B.x,mt[nt+1]=B.y,nt+=2;nt>0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUV2Buffer),Dt.bufferData(Dt.ARRAY_BUFFER,mt,i))}if(Ht){for(o=0,s=zt.length;s>o;o++)wt[rt]=et,wt[rt+1]=et+1,wt[rt+2]=et+2,rt+=3,Rt[at]=et,Rt[at+1]=et+1,Rt[at+2]=et,Rt[at+3]=et+2,Rt[at+4]=et+1,Rt[at+5]=et+2,at+=6,et+=3;Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,e.__webglFaceBuffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,wt,i),Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,e.__webglLineBuffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,Rt,i)}if(Tt)for(L=0,I=Tt.length;I>L;L++)if(Y=Tt[L],Y.__original.needsUpdate){if(ut=0,dt=0,1===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],Y.array[ut]=Y.value[l.a],Y.array[ut+1]=Y.value[l.b],Y.array[ut+2]=Y.value[l.c],ut+=3;else if("faces"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],Y.array[ut]=X,Y.array[ut+1]=X,Y.array[ut+2]=X,ut+=3}else if(2===Y.size){if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],_=Y.value[l.a],b=Y.value[l.b],E=Y.value[l.c],Y.array[ut]=_.x,Y.array[ut+1]=_.y,Y.array[ut+2]=b.x,Y.array[ut+3]=b.y,Y.array[ut+4]=E.x,Y.array[ut+5]=E.y,ut+=6;else if("faces"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],_=X,b=X,E=X,Y.array[ut]=_.x,Y.array[ut+1]=_.y,Y.array[ut+2]=b.x,Y.array[ut+3]=b.y,Y.array[ut+4]=E.x,Y.array[ut+5]=E.y,ut+=6}else if(3===Y.size){var Wt;if(Wt="c"===Y.type?["r","g","b"]:["x","y","z"],void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],_=Y.value[l.a],b=Y.value[l.b],E=Y.value[l.c],Y.array[ut]=_[Wt[0]],Y.array[ut+1]=_[Wt[1]],Y.array[ut+2]=_[Wt[2]],Y.array[ut+3]=b[Wt[0]],Y.array[ut+4]=b[Wt[1]],Y.array[ut+5]=b[Wt[2]],Y.array[ut+6]=E[Wt[0]],Y.array[ut+7]=E[Wt[1]],Y.array[ut+8]=E[Wt[2]],ut+=9;else if("faces"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],_=X,b=X,E=X,Y.array[ut]=_[Wt[0]],Y.array[ut+1]=_[Wt[1]],Y.array[ut+2]=_[Wt[2]],Y.array[ut+3]=b[Wt[0]],Y.array[ut+4]=b[Wt[1]],Y.array[ut+5]=b[Wt[2]],Y.array[ut+6]=E[Wt[0]],Y.array[ut+7]=E[Wt[1]],Y.array[ut+8]=E[Wt[2]],ut+=9;else if("faceVertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],_=X[0],b=X[1],E=X[2],Y.array[ut]=_[Wt[0]],Y.array[ut+1]=_[Wt[1]],Y.array[ut+2]=_[Wt[2]],Y.array[ut+3]=b[Wt[0]],Y.array[ut+4]=b[Wt[1]],Y.array[ut+5]=b[Wt[2]],Y.array[ut+6]=E[Wt[0]],Y.array[ut+7]=E[Wt[1]],Y.array[ut+8]=E[Wt[2]],ut+=9}else if(4===Y.size)if(void 0===Y.boundTo||"vertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)l=Lt[zt[o]],_=Y.value[l.a],b=Y.value[l.b],E=Y.value[l.c],Y.array[ut]=_.x,Y.array[ut+1]=_.y,Y.array[ut+2]=_.z,Y.array[ut+3]=_.w,Y.array[ut+4]=b.x,Y.array[ut+5]=b.y,Y.array[ut+6]=b.z,Y.array[ut+7]=b.w,Y.array[ut+8]=E.x,Y.array[ut+9]=E.y,Y.array[ut+10]=E.z,Y.array[ut+11]=E.w,ut+=12;else if("faces"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],_=X,b=X,E=X,Y.array[ut]=_.x,Y.array[ut+1]=_.y,Y.array[ut+2]=_.z,Y.array[ut+3]=_.w,Y.array[ut+4]=b.x,Y.array[ut+5]=b.y,Y.array[ut+6]=b.z,Y.array[ut+7]=b.w,Y.array[ut+8]=E.x,Y.array[ut+9]=E.y,Y.array[ut+10]=E.z,Y.array[ut+11]=E.w,ut+=12;else if("faceVertices"===Y.boundTo)for(o=0,s=zt.length;s>o;o++)X=Y.value[zt[o]],_=X[0],b=X[1],E=X[2],Y.array[ut]=_.x,Y.array[ut+1]=_.y,Y.array[ut+2]=_.z,Y.array[ut+3]=_.w,Y.array[ut+4]=b.x,Y.array[ut+5]=b.y,Y.array[ut+6]=b.z,Y.array[ut+7]=b.w,Y.array[ut+8]=E.x,Y.array[ut+9]=E.y,Y.array[ut+10]=E.z,Y.array[ut+11]=E.w,ut+=12;Dt.bindBuffer(Dt.ARRAY_BUFFER,Y.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,Y.array,i)}n&&(delete e.__inittedArrays,delete e.__colorArray,delete e.__normalArray,delete e.__tangentArray,delete e.__uvArray,delete e.__uv2Array,delete e.__faceArray,delete e.__vertexArray,delete e.__lineArray,delete e.__skinIndexArray,delete e.__skinWeightArray)}}function v(e,t,i){var n,r,o=e.attributes;for(n in o)r=o[n],r.needsUpdate&&("index"===n?(Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,r.buffer),Dt.bufferData(Dt.ELEMENT_ARRAY_BUFFER,r.array,t)):(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.buffer),Dt.bufferData(Dt.ARRAY_BUFFER,r.array,t)),r.needsUpdate=!1),i&&!r.dynamic&&(r.array=null)}function y(e){fi[e]||(Dt.enableVertexAttribArray(e),fi[e]=!0)}function _(){for(var e in fi)fi[e]&&(Dt.disableVertexAttribArray(e),fi[e]=!1)}function b(e,t,i){var n=e.program.attributes;if(-1!==i.morphTargetBase&&n.position>=0?(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[i.morphTargetBase]),y(n.position),Dt.vertexAttribPointer(n.position,3,Dt.FLOAT,!1,0,0)):n.position>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglVertexBuffer),y(n.position),Dt.vertexAttribPointer(n.position,3,Dt.FLOAT,!1,0,0)),i.morphTargetForcedOrder.length)for(var r=0,o=i.morphTargetForcedOrder,s=i.morphTargetInfluences;r<e.numSupportedMorphTargets&&r<o.length;)n["morphTarget"+r]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[o[r]]),y(n["morphTarget"+r]),Dt.vertexAttribPointer(n["morphTarget"+r],3,Dt.FLOAT,!1,0,0)),n["morphNormal"+r]>=0&&e.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[o[r]]),y(n["morphNormal"+r]),Dt.vertexAttribPointer(n["morphNormal"+r],3,Dt.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=s[o[r]],r++;else{var a,l,h=[],s=i.morphTargetInfluences,c=s.length;for(l=0;c>l;l++)a=s[l],a>0&&h.push([a,l]);h.length>e.numSupportedMorphTargets?(h.sort(x),h.length=e.numSupportedMorphTargets):h.length>e.numSupportedMorphNormals?h.sort(x):0===h.length&&h.push([0,0]);for(var u,r=0;r<e.numSupportedMorphTargets;)h[r]?(u=h[r][1],n["morphTarget"+r]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphTargetsBuffers[u]),y(n["morphTarget"+r]),Dt.vertexAttribPointer(n["morphTarget"+r],3,Dt.FLOAT,!1,0,0)),n["morphNormal"+r]>=0&&e.morphNormals&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,t.__webglMorphNormalsBuffers[u]),y(n["morphNormal"+r]),Dt.vertexAttribPointer(n["morphNormal"+r],3,Dt.FLOAT,!1,0,0)),i.__webglMorphTargetInfluences[r]=s[u]):i.__webglMorphTargetInfluences[r]=0,r++}null!==e.program.uniforms.morphTargetInfluences&&Dt.uniform1fv(e.program.uniforms.morphTargetInfluences,i.__webglMorphTargetInfluences)}function E(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function x(e,t){return t[0]-e[0]}function T(e,t,i){if(e.length)for(var n=0,r=e.length;r>n;n++)jt=null,qt=null,Jt=-1,ii=-1,ni=-1,Kt=-1,Qt=-1,Gt=-1,$t=-1,bi=!0,e[n].render(t,i,di,pi),jt=null,qt=null,Jt=-1,ii=-1,ni=-1,Kt=-1,Qt=-1,Gt=-1,$t=-1,bi=!0}function w(e,t,i,n,r,o,s,a){var l,h,c,u,d,p,f;t?(d=e.length-1,p=-1,f=-1):(d=0,p=e.length,f=1);for(var m=d;m!==p;m+=f)if(l=e[m],l.render){if(h=l.object,c=l.buffer,a)u=a;else{if(u=l[i],!u)continue;s&&Vt.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),Vt.setDepthTest(u.depthTest),Vt.setDepthWrite(u.depthWrite),nt(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}Vt.setMaterialFaces(u),c instanceof THREE.BufferGeometry?Vt.renderBufferDirect(n,r,o,u,c,h):Vt.renderBuffer(n,r,o,u,c,h)}}function R(e,t,i,n,r,o,s){for(var a,l,h,c=0,u=e.length;u>c;c++)if(a=e[c],l=a.object,l.visible){if(s)h=s;else{if(h=a[t],!h)continue;o&&Vt.setBlending(h.blending,h.blendEquation,h.blendSrc,h.blendDst),Vt.setDepthTest(h.depthTest),Vt.setDepthWrite(h.depthWrite),nt(h.polygonOffset,h.polygonOffsetFactor,h.polygonOffsetUnits)}Vt.renderImmediateObject(i,n,r,h,l)}}function S(e){var t=e.object,i=t.material;i.transparent?(e.transparent=i,e.opaque=null):(e.opaque=i,e.transparent=null)}function C(e){var t,i,n,r=e.object,o=e.buffer;n=r.material,n instanceof THREE.MeshFaceMaterial?(i=o.materialIndex,t=n.materials[i],t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)):(t=n,t&&(t.transparent?(e.transparent=t,e.opaque=null):(e.opaque=t,e.transparent=null)))}function H(e,t){var i,n,r,o,s,a,l={},h=e.morphTargets.length,c=e.morphNormals.length,u=t instanceof THREE.MeshFaceMaterial;for(e.geometryGroups={},i=0,n=e.faces.length;n>i;i++)r=e.faces[i],o=u?r.materialIndex:0,void 0===l[o]&&(l[o]={hash:o,counter:0}),a=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[a]&&(e.geometryGroups[a]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c}),s=3,e.geometryGroups[a].vertices+s>65535&&(l[o].counter+=1,a=l[o].hash+"_"+l[o].counter,void 0===e.geometryGroups[a]&&(e.geometryGroups[a]={faces3:[],materialIndex:o,vertices:0,numMorphTargets:h,numMorphNormals:c})),e.geometryGroups[a].faces3.push(i),e.geometryGroups[a].vertices+=s;e.geometryGroupsList=[];for(var d in e.geometryGroups)e.geometryGroups[d].id=Xt++,e.geometryGroupsList.push(e.geometryGroups[d])}function M(e,r){var l,h,c,u;if(void 0===e.__webglInit)if(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Di)),h=e.geometry,void 0===h);else if(h instanceof THREE.BufferGeometry)p(h);else if(e instanceof THREE.Mesh){c=e.material,void 0===h.geometryGroups&&H(h,c);for(l in h.geometryGroups)u=h.geometryGroups[l],u.__webglVertexBuffer||(n(u),a(u,e),h.verticesNeedUpdate=!0,h.morphTargetsNeedUpdate=!0,h.elementsNeedUpdate=!0,h.uvsNeedUpdate=!0,h.normalsNeedUpdate=!0,h.tangentsNeedUpdate=!0,h.colorsNeedUpdate=!0)}else e instanceof THREE.Line?h.__webglVertexBuffer||(i(h),s(h,e),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0,h.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&(h.__webglVertexBuffer||(t(h),o(h,e),h.verticesNeedUpdate=!0,h.colorsNeedUpdate=!0));if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(h=e.geometry,h instanceof THREE.BufferGeometry)k(r.__webglObjects,h,e);else if(h instanceof THREE.Geometry)for(l in h.geometryGroups)u=h.geometryGroups[l],k(r.__webglObjects,u,e)}else e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(h=e.geometry,k(r.__webglObjects,h,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?A(r.__webglObjectsImmediate,e):e instanceof THREE.Sprite?r.__webglSprites.push(e):e instanceof THREE.LensFlare&&r.__webglFlares.push(e);e.__webglActive=!0}}function k(e,t,i){e.push({id:null,buffer:t,object:i,opaque:null,transparent:null,z:0})}function A(e,t){e.push({id:null,object:t,opaque:null,transparent:null,z:0})}function P(e){var t,i,n,r=e.geometry;if(r instanceof THREE.BufferGeometry)v(r,Dt.DYNAMIC_DRAW,!r.dynamic);else if(e instanceof THREE.Mesh){for(var o=0,s=r.geometryGroupsList.length;s>o;o++)t=r.geometryGroupsList[o],n=l(e,t),r.buffersNeedUpdate&&a(t,e),i=n.attributes&&F(n),(r.verticesNeedUpdate||r.morphTargetsNeedUpdate||r.elementsNeedUpdate||r.uvsNeedUpdate||r.normalsNeedUpdate||r.colorsNeedUpdate||r.tangentsNeedUpdate||i)&&g(t,e,Dt.DYNAMIC_DRAW,!r.dynamic,n);r.verticesNeedUpdate=!1,r.morphTargetsNeedUpdate=!1,r.elementsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.tangentsNeedUpdate=!1,r.buffersNeedUpdate=!1,n.attributes&&D(n)}else e instanceof THREE.Line?(n=l(e,r),i=n.attributes&&F(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||r.lineDistancesNeedUpdate||i)&&m(r,Dt.DYNAMIC_DRAW),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,r.lineDistancesNeedUpdate=!1,n.attributes&&D(n)):e instanceof THREE.ParticleSystem&&(n=l(e,r),i=n.attributes&&F(n),(r.verticesNeedUpdate||r.colorsNeedUpdate||e.sortParticles||i)&&f(r,Dt.DYNAMIC_DRAW,e),r.verticesNeedUpdate=!1,r.colorsNeedUpdate=!1,n.attributes&&D(n))}function F(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function D(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function N(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Line?z(t.__webglObjects,e):e instanceof THREE.Sprite?L(t.__webglSprites,e):e instanceof THREE.LensFlare?L(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&z(t.__webglObjectsImmediate,e),delete e.__webglActive}function z(e,t){for(var i=e.length-1;i>=0;i--)e[i].object===t&&e.splice(i,1)}function L(e,t){for(var i=e.length-1;i>=0;i--)e[i]===t&&e.splice(i,1)}function I(e,t){e.uniforms=THREE.UniformsUtils.clone(t.uniforms),e.vertexShader=t.vertexShader,e.fragmentShader=t.fragmentShader}function O(e,t,i,n,r){Yt=0,n.needsUpdate&&(n.program&&Ui(n),Vt.initMaterial(n,t,i,r),n.needsUpdate=!1),n.morphTargets&&(r.__webglMorphTargetInfluences||(r.__webglMorphTargetInfluences=new Float32Array(Vt.maxMorphTargets)));var o=!1,s=n.program,a=s.uniforms,l=n.uniforms;if(s!==jt&&(Dt.useProgram(s),jt=s,o=!0),n.id!==$t&&($t=n.id,o=!0),(o||e!==qt)&&(Dt.uniformMatrix4fv(a.projectionMatrix,!1,e.projectionMatrix.elements),e!==qt&&(qt=e)),n.skinning)if(Ci&&r.useVertexTexture){if(null!==a.boneTexture){var h=K();Dt.uniform1i(a.boneTexture,h),Vt.setTexture(r.boneTexture,h)}null!==a.boneTextureWidth&&Dt.uniform1i(a.boneTextureWidth,r.boneTextureWidth),null!==a.boneTextureHeight&&Dt.uniform1i(a.boneTextureHeight,r.boneTextureHeight)}else null!==a.boneGlobalMatrices&&Dt.uniformMatrix4fv(a.boneGlobalMatrices,!1,r.boneMatrices);return o&&(i&&n.fog&&W(l,i),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n.lights)&&(bi&&(tt(s,t),bi=!1),q(l,Ei)),(n instanceof THREE.MeshBasicMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.MeshPhongMaterial)&&V(l,n),n instanceof THREE.LineBasicMaterial?B(l,n):n instanceof THREE.LineDashedMaterial?(B(l,n),U(l,n)):n instanceof THREE.ParticleSystemMaterial?j(l,n):n instanceof THREE.MeshPhongMaterial?$(l,n):n instanceof THREE.MeshLambertMaterial?G(l,n):n instanceof THREE.MeshDepthMaterial?(l.mNear.value=e.near,l.mFar.value=e.far,l.opacity.value=n.opacity):n instanceof THREE.MeshNormalMaterial&&(l.opacity.value=n.opacity),r.receiveShadow&&!n._shadowPass&&X(l,t),Q(s,n.uniformsList),(n instanceof THREE.ShaderMaterial||n instanceof THREE.MeshPhongMaterial||n.envMap)&&null!==a.cameraPosition&&(yi.setFromMatrixPosition(e.matrixWorld),Dt.uniform3f(a.cameraPosition,yi.x,yi.y,yi.z)),(n instanceof THREE.MeshPhongMaterial||n instanceof THREE.MeshLambertMaterial||n instanceof THREE.ShaderMaterial||n.skinning)&&null!==a.viewMatrix&&Dt.uniformMatrix4fv(a.viewMatrix,!1,e.matrixWorldInverse.elements)),Y(a,r),null!==a.modelMatrix&&Dt.uniformMatrix4fv(a.modelMatrix,!1,r.matrixWorld.elements),s}function V(e,t){e.opacity.value=t.opacity,Vt.gammaInput?e.diffuse.value.copyGammaToLinear(t.color):e.diffuse.value=t.color,e.map.value=t.map,e.lightMap.value=t.lightMap,e.specularMap.value=t.specularMap,t.bumpMap&&(e.bumpMap.value=t.bumpMap,e.bumpScale.value=t.bumpScale),t.normalMap&&(e.normalMap.value=t.normalMap,e.normalScale.value.copy(t.normalScale));var i;if(t.map?i=t.map:t.specularMap?i=t.specularMap:t.normalMap?i=t.normalMap:t.bumpMap&&(i=t.bumpMap),void 0!==i){var n=i.offset,r=i.repeat;e.offsetRepeat.value.set(n.x,n.y,r.x,r.y)}e.envMap.value=t.envMap,e.flipEnvMap.value=t.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,e.reflectivity.value=Vt.gammaInput?t.reflectivity:t.reflectivity,e.refractionRatio.value=t.refractionRatio,e.combine.value=t.combine,e.useRefract.value=t.envMap&&t.envMap.mapping instanceof THREE.CubeRefractionMapping}function B(e,t){e.diffuse.value=t.color,e.opacity.value=t.opacity}function U(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}function j(e,t){e.psColor.value=t.color,e.opacity.value=t.opacity,e.size.value=t.size,e.scale.value=Rt.height/2,e.map.value=t.map}function W(e,t){e.fogColor.value=t.color,t instanceof THREE.Fog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t instanceof THREE.FogExp2&&(e.fogDensity.value=t.density)}function $(e,t){e.shininess.value=t.shininess,Vt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive),e.specular.value.copyGammaToLinear(t.specular)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive,e.specular.value=t.specular),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function G(e,t){Vt.gammaInput?(e.ambient.value.copyGammaToLinear(t.ambient),e.emissive.value.copyGammaToLinear(t.emissive)):(e.ambient.value=t.ambient,e.emissive.value=t.emissive),t.wrapAround&&e.wrapRGB.value.copy(t.wrapRGB)}function q(e,t){e.ambientLightColor.value=t.ambient,e.directionalLightColor.value=t.directional.colors,e.directionalLightDirection.value=t.directional.positions,e.pointLightColor.value=t.point.colors,e.pointLightPosition.value=t.point.positions,e.pointLightDistance.value=t.point.distances,e.spotLightColor.value=t.spot.colors,e.spotLightPosition.value=t.spot.positions,e.spotLightDistance.value=t.spot.distances,e.spotLightDirection.value=t.spot.directions,e.spotLightAngleCos.value=t.spot.anglesCos,e.spotLightExponent.value=t.spot.exponents,e.hemisphereLightSkyColor.value=t.hemi.skyColors,e.hemisphereLightGroundColor.value=t.hemi.groundColors,e.hemisphereLightDirection.value=t.hemi.positions}function X(e,t){if(e.shadowMatrix)for(var i=0,n=0,r=t.length;r>n;n++){var o=t[n];o.castShadow&&(o instanceof THREE.SpotLight||o instanceof THREE.DirectionalLight&&!o.shadowCascade)&&(e.shadowMap.value[i]=o.shadowMap,e.shadowMapSize.value[i]=o.shadowMapSize,e.shadowMatrix.value[i]=o.shadowMatrix,e.shadowDarkness.value[i]=o.shadowDarkness,e.shadowBias.value[i]=o.shadowBias,i++)}}function Y(e,t){Dt.uniformMatrix4fv(e.modelViewMatrix,!1,t._modelViewMatrix.elements),e.normalMatrix&&Dt.uniformMatrix3fv(e.normalMatrix,!1,t._normalMatrix.elements)}function K(){var e=Yt;return e>=xi&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+xi),Yt+=1,e}function Q(e,t){var i,n,r,o,s,a,l,h,c,u,d;for(c=0,u=t.length;u>c;c++)if(o=e.uniforms[t[c][1]])if(i=t[c][0],r=i.type,n=i.value,"i"===r)Dt.uniform1i(o,n);else if("f"===r)Dt.uniform1f(o,n);else if("v2"===r)Dt.uniform2f(o,n.x,n.y);else if("v3"===r)Dt.uniform3f(o,n.x,n.y,n.z);else if("v4"===r)Dt.uniform4f(o,n.x,n.y,n.z,n.w);else if("c"===r)Dt.uniform3f(o,n.r,n.g,n.b);else if("iv1"===r)Dt.uniform1iv(o,n);else if("iv"===r)Dt.uniform3iv(o,n);else if("fv1"===r)Dt.uniform1fv(o,n);else if("fv"===r)Dt.uniform3fv(o,n);else if("v2v"===r){for(void 0===i._array&&(i._array=new Float32Array(2*n.length)),l=0,h=n.length;h>l;l++)d=2*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y;Dt.uniform2fv(o,i._array)}else if("v3v"===r){for(void 0===i._array&&(i._array=new Float32Array(3*n.length)),l=0,h=n.length;h>l;l++)d=3*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y,i._array[d+2]=n[l].z;Dt.uniform3fv(o,i._array)}else if("v4v"===r){for(void 0===i._array&&(i._array=new Float32Array(4*n.length)),l=0,h=n.length;h>l;l++)d=4*l,i._array[d]=n[l].x,i._array[d+1]=n[l].y,i._array[d+2]=n[l].z,i._array[d+3]=n[l].w;Dt.uniform4fv(o,i._array)}else if("m4"===r)void 0===i._array&&(i._array=new Float32Array(16)),n.flattenToArray(i._array),Dt.uniformMatrix4fv(o,!1,i._array);else if("m4v"===r){for(void 0===i._array&&(i._array=new Float32Array(16*n.length)),l=0,h=n.length;h>l;l++)n[l].flattenToArrayOffset(i._array,16*l);Dt.uniformMatrix4fv(o,!1,i._array)}else if("t"===r){if(s=n,a=K(),Dt.uniform1i(o,a),!s)continue;s.image instanceof Array&&6===s.image.length?pt(s,a):s instanceof THREE.WebGLRenderTargetCube?ft(s,a):Vt.setTexture(s,a)}else if("tv"===r){for(void 0===i._array&&(i._array=[]),l=0,h=i.value.length;h>l;l++)i._array[l]=K();for(Dt.uniform1iv(o,i._array),l=0,h=i.value.length;h>l;l++)s=i.value[l],a=i._array[l],s&&Vt.setTexture(s,a)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+r)}function J(e,t){e._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld),e._normalMatrix.getNormalMatrix(e._modelViewMatrix)}function Z(e,t,i,n){e[t]=i.r*i.r*n,e[t+1]=i.g*i.g*n,e[t+2]=i.b*i.b*n}function et(e,t,i,n){e[t]=i.r*n,e[t+1]=i.g*n,e[t+2]=i.b*n}function tt(e,t){var i,n,r,o,s,a,l,h,c,u=0,d=0,p=0,f=Ei,m=f.directional.colors,g=f.directional.positions,v=f.point.colors,y=f.point.positions,_=f.point.distances,b=f.spot.colors,E=f.spot.positions,x=f.spot.distances,T=f.spot.directions,w=f.spot.anglesCos,R=f.spot.exponents,S=f.hemi.skyColors,C=f.hemi.groundColors,H=f.hemi.positions,M=0,k=0,A=0,P=0,F=0,D=0,N=0,z=0,L=0,I=0,O=0,V=0;for(i=0,n=t.length;n>i;i++)if(r=t[i],!r.onlyShadow)if(o=r.color,l=r.intensity,c=r.distance,r instanceof THREE.AmbientLight){if(!r.visible)continue;Vt.gammaInput?(u+=o.r*o.r,d+=o.g*o.g,p+=o.b*o.b):(u+=o.r,d+=o.g,p+=o.b)}else if(r instanceof THREE.DirectionalLight){if(F+=1,!r.visible)continue;if(_i.setFromMatrixPosition(r.matrixWorld),yi.setFromMatrixPosition(r.target.matrixWorld),_i.sub(yi),_i.normalize(),0===_i.x&&0===_i.y&&0===_i.z)continue;L=3*M,g[L]=_i.x,g[L+1]=_i.y,g[L+2]=_i.z,Vt.gammaInput?Z(m,L,o,l*l):et(m,L,o,l),M+=1}else if(r instanceof THREE.PointLight){if(D+=1,!r.visible)continue;I=3*k,Vt.gammaInput?Z(v,I,o,l*l):et(v,I,o,l),yi.setFromMatrixPosition(r.matrixWorld),y[I]=yi.x,y[I+1]=yi.y,y[I+2]=yi.z,_[k]=c,k+=1}else if(r instanceof THREE.SpotLight){if(N+=1,!r.visible)continue;O=3*A,Vt.gammaInput?Z(b,O,o,l*l):et(b,O,o,l),yi.setFromMatrixPosition(r.matrixWorld),E[O]=yi.x,E[O+1]=yi.y,E[O+2]=yi.z,x[A]=c,_i.copy(yi),yi.setFromMatrixPosition(r.target.matrixWorld),_i.sub(yi),_i.normalize(),T[O]=_i.x,T[O+1]=_i.y,T[O+2]=_i.z,w[A]=Math.cos(r.angle),R[A]=r.exponent,A+=1}else if(r instanceof THREE.HemisphereLight){if(z+=1,!r.visible)continue;if(_i.setFromMatrixPosition(r.matrixWorld),_i.normalize(),0===_i.x&&0===_i.y&&0===_i.z)continue;V=3*P,H[V]=_i.x,H[V+1]=_i.y,H[V+2]=_i.z,s=r.color,a=r.groundColor,Vt.gammaInput?(h=l*l,Z(S,V,s,h),Z(C,V,a,h)):(et(S,V,s,l),et(C,V,a,l)),P+=1}for(i=3*M,n=Math.max(m.length,3*F);n>i;i++)m[i]=0;for(i=3*k,n=Math.max(v.length,3*D);n>i;i++)v[i]=0;for(i=3*A,n=Math.max(b.length,3*N);n>i;i++)b[i]=0;for(i=3*P,n=Math.max(S.length,3*z);n>i;i++)S[i]=0;for(i=3*P,n=Math.max(C.length,3*z);n>i;i++)C[i]=0;f.directional.length=M,f.point.length=k,f.spot.length=A,f.hemi.length=P,f.ambient[0]=u,f.ambient[1]=d,f.ambient[2]=p}function it(e){e!==ai&&(Dt.lineWidth(e),ai=e)}function nt(e,t,i){ri!==e&&(e?Dt.enable(Dt.POLYGON_OFFSET_FILL):Dt.disable(Dt.POLYGON_OFFSET_FILL),ri=e),!e||oi===t&&si===i||(Dt.polygonOffset(t,i),oi=t,si=i)}function rt(e){var t,i,n=[];for(var r in e)t=e[r],t!==!1&&(i="#define "+r+" "+t,n.push(i));return n.join("\n")}function ot(e,t,i,n,r,o,s,a){var l,h,c,u,d,p=[];e?p.push(e):(p.push(t),p.push(i));for(c in o)p.push(c),p.push(o[c]);for(l in s)p.push(l),p.push(s[l]);for(d=p.join(),l=0,h=Bt.length;h>l;l++){var f=Bt[l];if(f.code===d)return f.usedTimes++,f.program}var m="SHADOWMAP_TYPE_BASIC";s.shadowMapType===THREE.PCFShadowMap?m="SHADOWMAP_TYPE_PCF":s.shadowMapType===THREE.PCFSoftShadowMap&&(m="SHADOWMAP_TYPE_PCF_SOFT");var g=rt(o);u=Dt.createProgram();var v=["precision "+St+" float;","precision "+St+" int;",g,Si?"#define VERTEX_TEXTURES":"",Vt.gammaInput?"#define GAMMA_INPUT":"",Vt.gammaOutput?"#define GAMMA_OUTPUT":"",Vt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"","#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,"#define MAX_BONES "+s.maxBones,s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.skinning?"#define USE_SKINNING":"",s.useVertexTexture?"#define BONE_TEXTURE":"",s.morphTargets?"#define USE_MORPHTARGETS":"",s.morphNormals?"#define USE_MORPHNORMALS":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+m:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",s.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","attribute vec2 uv2;","#ifdef USE_COLOR","attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","attribute vec3 morphTarget0;","attribute vec3 morphTarget1;","attribute vec3 morphTarget2;","attribute vec3 morphTarget3;","#ifdef USE_MORPHNORMALS","attribute vec3 morphNormal0;","attribute vec3 morphNormal1;","attribute vec3 morphNormal2;","attribute vec3 morphNormal3;","#else","attribute vec3 morphTarget4;","attribute vec3 morphTarget5;","attribute vec3 morphTarget6;","attribute vec3 morphTarget7;","#endif","#endif","#ifdef USE_SKINNING","attribute vec4 skinIndex;","attribute vec4 skinWeight;","#endif",""].join("\n"),y=["precision "+St+" float;","precision "+St+" int;",s.bumpMap||s.normalMap?"#extension GL_OES_standard_derivatives : enable":"",g,"#define MAX_DIR_LIGHTS "+s.maxDirLights,"#define MAX_POINT_LIGHTS "+s.maxPointLights,"#define MAX_SPOT_LIGHTS "+s.maxSpotLights,"#define MAX_HEMI_LIGHTS "+s.maxHemiLights,"#define MAX_SHADOWS "+s.maxShadows,s.alphaTest?"#define ALPHATEST "+s.alphaTest:"",Vt.gammaInput?"#define GAMMA_INPUT":"",Vt.gammaOutput?"#define GAMMA_OUTPUT":"",Vt.physicallyBasedShading?"#define PHYSICALLY_BASED_SHADING":"",s.useFog&&s.fog?"#define USE_FOG":"",s.useFog&&s.fogExp?"#define FOG_EXP2":"",s.map?"#define USE_MAP":"",s.envMap?"#define USE_ENVMAP":"",s.lightMap?"#define USE_LIGHTMAP":"",s.bumpMap?"#define USE_BUMPMAP":"",s.normalMap?"#define USE_NORMALMAP":"",s.specularMap?"#define USE_SPECULARMAP":"",s.vertexColors?"#define USE_COLOR":"",s.metal?"#define METAL":"",s.perPixel?"#define PHONG_PER_PIXEL":"",s.wrapAround?"#define WRAP_AROUND":"",s.doubleSided?"#define DOUBLE_SIDED":"",s.flipSided?"#define FLIP_SIDED":"",s.shadowMapEnabled?"#define USE_SHADOWMAP":"",s.shadowMapEnabled?"#define "+m:"",s.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",s.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",""].join("\n"),_=ht("vertex",v+i),b=ht("fragment",y+t);
Dt.attachShader(u,_),Dt.attachShader(u,b),a&&Dt.bindAttribLocation(u,0,a),Dt.linkProgram(u),Dt.getProgramParameter(u,Dt.LINK_STATUS)||(console.error("Could not initialise shader\nVALIDATE_STATUS: "+Dt.getProgramParameter(u,Dt.VALIDATE_STATUS)+", gl error ["+Dt.getError()+"]"),console.error("Program Info Log: "+Dt.getProgramInfoLog(u))),Dt.deleteShader(b),Dt.deleteShader(_),u.uniforms={},u.attributes={};var E,x,T,w;E=["viewMatrix","modelViewMatrix","projectionMatrix","normalMatrix","modelMatrix","cameraPosition","morphTargetInfluences"],s.useVertexTexture?(E.push("boneTexture"),E.push("boneTextureWidth"),E.push("boneTextureHeight")):E.push("boneGlobalMatrices");for(x in n)E.push(x);for(st(u,E),E=["position","normal","uv","uv2","tangent","color","skinIndex","skinWeight","lineDistance"],w=0;w<s.maxMorphTargets;w++)E.push("morphTarget"+w);for(w=0;w<s.maxMorphNormals;w++)E.push("morphNormal"+w);for(T in r)E.push(T);return at(u,E),u.id=Ut++,Bt.push({program:u,code:d,usedTimes:1}),Vt.info.memory.programs=Bt.length,u}function st(e,t){var i,n,r;for(i=0,n=t.length;n>i;i++)r=t[i],e.uniforms[r]=Dt.getUniformLocation(e,r)}function at(e,t){var i,n,r;for(i=0,n=t.length;n>i;i++)r=t[i],e.attributes[r]=Dt.getAttribLocation(e,r)}function lt(e){for(var t=e.split("\n"),i=0,n=t.length;n>i;i++)t[i]=i+1+": "+t[i];return t.join("\n")}function ht(e,t){var i;return"fragment"===e?i=Dt.createShader(Dt.FRAGMENT_SHADER):"vertex"===e&&(i=Dt.createShader(Dt.VERTEX_SHADER)),Dt.shaderSource(i,t),Dt.compileShader(i),Dt.getShaderParameter(i,Dt.COMPILE_STATUS)?i:(console.error(Dt.getShaderInfoLog(i)),console.error(lt(t)),null)}function ct(e){return 0===(e&e-1)}function ut(e,t,i){i?(Dt.texParameteri(e,Dt.TEXTURE_WRAP_S,_t(t.wrapS)),Dt.texParameteri(e,Dt.TEXTURE_WRAP_T,_t(t.wrapT)),Dt.texParameteri(e,Dt.TEXTURE_MAG_FILTER,_t(t.magFilter)),Dt.texParameteri(e,Dt.TEXTURE_MIN_FILTER,_t(t.minFilter))):(Dt.texParameteri(e,Dt.TEXTURE_WRAP_S,Dt.CLAMP_TO_EDGE),Dt.texParameteri(e,Dt.TEXTURE_WRAP_T,Dt.CLAMP_TO_EDGE),Dt.texParameteri(e,Dt.TEXTURE_MAG_FILTER,yt(t.magFilter)),Dt.texParameteri(e,Dt.TEXTURE_MIN_FILTER,yt(t.minFilter))),It&&t.type!==THREE.FloatType&&(t.anisotropy>1||t.__oldAnisotropy)&&(Dt.texParameterf(e,It.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Ri)),t.__oldAnisotropy=t.anisotropy)}function dt(e,t){if(e.width<=t&&e.height<=t)return e;var i=Math.max(e.width,e.height),n=Math.floor(e.width*t/i),r=Math.floor(e.height*t/i),o=document.createElement("canvas");o.width=n,o.height=r;var s=o.getContext("2d");return s.drawImage(e,0,0,e.width,e.height,0,0,n,r),o}function pt(e,t){if(6===e.image.length)if(e.needsUpdate){e.image.__webglTextureCube||(e.addEventListener("dispose",Ni),e.image.__webglTextureCube=Dt.createTexture(),Vt.info.memory.textures++),Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,e.flipY);for(var i=e instanceof THREE.CompressedTexture,n=[],r=0;6>r;r++)n[r]=Vt.autoScaleCubemaps&&!i?dt(e.image[r],wi):e.image[r];var o=n[0],s=ct(o.width)&&ct(o.height),a=_t(e.format),l=_t(e.type);ut(Dt.TEXTURE_CUBE_MAP,e,s);for(var r=0;6>r;r++)if(i)for(var h,c=n[r].mipmaps,u=0,d=c.length;d>u;u++)h=c[u],e.format!==THREE.RGBAFormat?Dt.compressedTexImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+r,u,a,h.width,h.height,0,h.data):Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+r,u,a,h.width,h.height,0,a,l,h.data);else Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,a,a,l,n[r]);e.generateMipmaps&&s&&Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.image.__webglTextureCube)}function ft(e,t){Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture)}function mt(e,t,i){Dt.bindFramebuffer(Dt.FRAMEBUFFER,e),Dt.framebufferTexture2D(Dt.FRAMEBUFFER,Dt.COLOR_ATTACHMENT0,i,t.__webglTexture,0)}function gt(e,t){Dt.bindRenderbuffer(Dt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.DEPTH_COMPONENT16,t.width,t.height),Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_ATTACHMENT,Dt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.DEPTH_STENCIL,t.width,t.height),Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_STENCIL_ATTACHMENT,Dt.RENDERBUFFER,e)):Dt.renderbufferStorage(Dt.RENDERBUFFER,Dt.RGBA4,t.width,t.height)}function vt(e){e instanceof THREE.WebGLRenderTargetCube?(Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture),Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP),Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,null)):(Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),Dt.generateMipmap(Dt.TEXTURE_2D),Dt.bindTexture(Dt.TEXTURE_2D,null))}function yt(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Dt.NEAREST:Dt.LINEAR}function _t(e){if(e===THREE.RepeatWrapping)return Dt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Dt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Dt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Dt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Dt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Dt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Dt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Dt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Dt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Dt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Dt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Dt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Dt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Dt.BYTE;if(e===THREE.ShortType)return Dt.SHORT;if(e===THREE.UnsignedShortType)return Dt.UNSIGNED_SHORT;if(e===THREE.IntType)return Dt.INT;if(e===THREE.UnsignedIntType)return Dt.UNSIGNED_INT;if(e===THREE.FloatType)return Dt.FLOAT;if(e===THREE.AlphaFormat)return Dt.ALPHA;if(e===THREE.RGBFormat)return Dt.RGB;if(e===THREE.RGBAFormat)return Dt.RGBA;if(e===THREE.LuminanceFormat)return Dt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Dt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Dt.FUNC_ADD;if(e===THREE.SubtractEquation)return Dt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Dt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Dt.ZERO;if(e===THREE.OneFactor)return Dt.ONE;if(e===THREE.SrcColorFactor)return Dt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Dt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Dt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Dt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Dt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Dt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Dt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Dt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Dt.SRC_ALPHA_SATURATE;if(void 0!==Ot){if(e===THREE.RGB_S3TC_DXT1_Format)return Ot.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return Ot.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}function bt(e){if(Ci&&e&&e.useVertexTexture)return 1024;var t=Dt.getParameter(Dt.MAX_VERTEX_UNIFORM_VECTORS),i=Math.floor((t-20)/4),n=i;return void 0!==e&&e instanceof THREE.SkinnedMesh&&(n=Math.min(e.bones.length,n),n<e.bones.length&&console.warn("WebGLRenderer: too many bones - "+e.bones.length+", this GPU supports just "+n+" (try OpenGL instead of ANGLE)")),n}function Et(e){for(var t=0,i=0,n=0,r=0,o=0,s=e.length;s>o;o++){var a=e[o];a.onlyShadow||(a instanceof THREE.DirectionalLight&&t++,a instanceof THREE.PointLight&&i++,a instanceof THREE.SpotLight&&n++,a instanceof THREE.HemisphereLight&&r++)}return{directional:t,point:i,spot:n,hemi:r}}function xt(e){for(var t=0,i=0,n=e.length;n>i;i++){var r=e[i];r.castShadow&&(r instanceof THREE.SpotLight&&t++,r instanceof THREE.DirectionalLight&&!r.shadowCascade&&t++)}return t}function Tt(){try{var e={alpha:Ct,premultipliedAlpha:Ht,antialias:Mt,stencil:kt,preserveDrawingBuffer:At};if(Dt=Rt.getContext("webgl",e)||Rt.getContext("experimental-webgl",e),null===Dt)throw"Error creating WebGL context."}catch(t){console.error(t)}Nt=Dt.getExtension("OES_texture_float"),zt=Dt.getExtension("OES_texture_float_linear"),Lt=Dt.getExtension("OES_standard_derivatives"),It=Dt.getExtension("EXT_texture_filter_anisotropic")||Dt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Dt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),Ot=Dt.getExtension("WEBGL_compressed_texture_s3tc")||Dt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Dt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Nt||console.log("THREE.WebGLRenderer: Float textures not supported."),Lt||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),It||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),Ot||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Dt.getShaderPrecisionFormat&&(Dt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}function wt(){Dt.clearColor(0,0,0,1),Dt.clearDepth(1),Dt.clearStencil(0),Dt.enable(Dt.DEPTH_TEST),Dt.depthFunc(Dt.LEQUAL),Dt.frontFace(Dt.CCW),Dt.cullFace(Dt.BACK),Dt.enable(Dt.CULL_FACE),Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.SRC_ALPHA,Dt.ONE_MINUS_SRC_ALPHA),Dt.viewport(li,hi,ci,ui),Dt.clearColor(Pt.r,Pt.g,Pt.b,Ft)}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var Rt=void 0!==e.canvas?e.canvas:document.createElement("canvas"),St=void 0!==e.precision?e.precision:"highp",Ct=void 0!==e.alpha?e.alpha:!1,Ht=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,Mt=void 0!==e.antialias?e.antialias:!1,kt=void 0!==e.stencil?e.stencil:!0,At=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,Pt=new THREE.Color(0),Ft=0;this.domElement=Rt,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.autoUpdateObjects=!0,this.gammaInput=!1,this.gammaOutput=!1,this.physicallyBasedShading=!1,this.shadowMapEnabled=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapDebug=!1,this.shadowMapCascade=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var Dt,Nt,zt,Lt,It,Ot,Vt=this,Bt=[],Ut=0,jt=null,Wt=null,$t=-1,Gt=null,qt=null,Xt=0,Yt=0,Kt=-1,Qt=-1,Jt=-1,Zt=-1,ei=-1,ti=-1,ii=-1,ni=-1,ri=null,oi=null,si=null,ai=null,li=0,hi=0,ci=Rt.width,ui=Rt.height,di=0,pi=0,fi={},mi=new THREE.Frustum,gi=new THREE.Matrix4,vi=new THREE.Matrix4,yi=new THREE.Vector3,_i=new THREE.Vector3,bi=!0,Ei={ambient:[0,0,0],directional:{length:0,colors:new Array,positions:new Array},point:{length:0,colors:new Array,positions:new Array,distances:new Array},spot:{length:0,colors:new Array,positions:new Array,distances:new Array,directions:new Array,anglesCos:new Array,exponents:new Array},hemi:{length:0,skyColors:new Array,groundColors:new Array,positions:new Array}};Tt(),wt(),this.context=Dt;var xi=Dt.getParameter(Dt.MAX_TEXTURE_IMAGE_UNITS),Ti=Dt.getParameter(Dt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Dt.getParameter(Dt.MAX_TEXTURE_SIZE);var wi=Dt.getParameter(Dt.MAX_CUBE_MAP_TEXTURE_SIZE),Ri=It?Dt.getParameter(It.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Si=Ti>0,Ci=Si&&Nt;Ot?Dt.getParameter(Dt.COMPRESSED_TEXTURE_FORMATS):[];var Hi=Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.HIGH_FLOAT),Mi=Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.MEDIUM_FLOAT);Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.LOW_FLOAT);var ki=Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.HIGH_FLOAT),Ai=Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.MEDIUM_FLOAT);Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.LOW_FLOAT),Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.HIGH_INT),Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.MEDIUM_INT),Dt.getShaderPrecisionFormat(Dt.VERTEX_SHADER,Dt.LOW_INT),Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.HIGH_INT),Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.MEDIUM_INT),Dt.getShaderPrecisionFormat(Dt.FRAGMENT_SHADER,Dt.LOW_INT);var Pi=Hi.precision>0&&ki.precision>0,Fi=Mi.precision>0&&Ai.precision>0;"highp"!==St||Pi||(Fi?(St="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(St="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==St||Fi||(St="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Dt},this.supportsVertexTextures=function(){return Si},this.supportsFloatTextures=function(){return Nt},this.supportsStandardDerivatives=function(){return Lt},this.supportsCompressedTextureS3TC=function(){return Ot},this.getMaxAnisotropy=function(){return Ri},this.getPrecision=function(){return St},this.setSize=function(e,t,i){Rt.width=e*this.devicePixelRatio,Rt.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&i!==!1&&(Rt.style.width=e+"px",Rt.style.height=t+"px"),this.setViewport(0,0,Rt.width,Rt.height)},this.setViewport=function(e,t,i,n){li=void 0!==e?e:0,hi=void 0!==t?t:0,ci=void 0!==i?i:Rt.width,ui=void 0!==n?n:Rt.height,Dt.viewport(li,hi,ci,ui)},this.setScissor=function(e,t,i,n){Dt.scissor(e,t,i,n)},this.enableScissorTest=function(e){e?Dt.enable(Dt.SCISSOR_TEST):Dt.disable(Dt.SCISSOR_TEST)},this.setClearColor=function(e,t){Pt.set(e),Ft=void 0!==t?t:1,Dt.clearColor(Pt.r,Pt.g,Pt.b,Ft)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return Pt},this.getClearAlpha=function(){return Ft},this.clear=function(e,t,i){var n=0;(void 0===e||e)&&(n|=Dt.COLOR_BUFFER_BIT),(void 0===t||t)&&(n|=Dt.DEPTH_BUFFER_BIT),(void 0===i||i)&&(n|=Dt.STENCIL_BUFFER_BIT),Dt.clear(n)},this.clearColor=function(){Dt.clear(Dt.COLOR_BUFFER_BIT)},this.clearDepth=function(){Dt.clear(Dt.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Dt.clear(Dt.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,i,n){this.setRenderTarget(e),this.clear(t,i,n)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){jt=null,Jt=-1,ii=-1,ni=-1,Gt=-1,$t=-1,bi=!0,Kt=-1,Qt=-1,this.shadowMapPlugin.update(e,t)};var Di=function(e){var t=e.target;t.removeEventListener("dispose",Di),Oi(t)},Ni=function(e){var t=e.target;t.removeEventListener("dispose",Ni),Vi(t),Vt.info.memory.textures--},zi=function(e){var t=e.target;t.removeEventListener("dispose",zi),Bi(t),Vt.info.memory.textures--},Li=function(e){var t=e.target;t.removeEventListener("dispose",Li),Ui(t)},Ii=function(e){if(void 0!==e.__webglVertexBuffer&&Dt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Dt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Dt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Dt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Dt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Dt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Dt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Dt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Dt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Dt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Dt.deleteBuffer(e.__webglLineDistanceBuffer),void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Dt.deleteBuffer(e.__webglCustomAttributesList[t].buffer);Vt.info.memory.geometries--},Oi=function(e){if(e.__webglInit=void 0,e instanceof THREE.BufferGeometry){var t=e.attributes;for(var i in t)void 0!==t[i].buffer&&Dt.deleteBuffer(t[i].buffer);Vt.info.memory.geometries--}else if(void 0!==e.geometryGroups)for(var n in e.geometryGroups){var r=e.geometryGroups[n];if(void 0!==r.numMorphTargets)for(var o=0,s=r.numMorphTargets;s>o;o++)Dt.deleteBuffer(r.__webglMorphTargetsBuffers[o]);if(void 0!==r.numMorphNormals)for(var o=0,s=r.numMorphNormals;s>o;o++)Dt.deleteBuffer(r.__webglMorphNormalsBuffers[o]);Ii(r)}else Ii(e)},Vi=function(e){if(e.image&&e.image.__webglTextureCube)Dt.deleteTexture(e.image.__webglTextureCube);else{if(!e.__webglInit)return;e.__webglInit=!1,Dt.deleteTexture(e.__webglTexture)}},Bi=function(e){if(e&&e.__webglTexture)if(Dt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Dt.deleteFramebuffer(e.__webglFramebuffer[t]),Dt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Dt.deleteFramebuffer(e.__webglFramebuffer),Dt.deleteRenderbuffer(e.__webglRenderbuffer)},Ui=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var i,n,r,o=!1;for(i=0,n=Bt.length;n>i;i++)if(r=Bt[i],r.program===t){r.usedTimes--,0===r.usedTimes&&(o=!0);break}if(o===!0){var s=[];for(i=0,n=Bt.length;n>i;i++)r=Bt[i],r.program!==t&&s.push(r);Bt=s,Dt.deleteProgram(t),Vt.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,i){if(e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Dt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Dt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Dt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Dt.createBuffer()),e.hasPositions&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglVertexBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.positionArray,Dt.DYNAMIC_DRAW),Dt.enableVertexAttribArray(t.attributes.position),Dt.vertexAttribPointer(t.attributes.position,3,Dt.FLOAT,!1,0,0)),e.hasNormals){if(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglNormalBuffer),i.shading===THREE.FlatShading){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v=3*e.count;for(g=0;v>g;g+=9)m=e.normalArray,s=m[g],h=m[g+1],d=m[g+2],a=m[g+3],c=m[g+4],p=m[g+5],l=m[g+6],u=m[g+7],f=m[g+8],n=(s+a+l)/3,r=(h+c+u)/3,o=(d+p+f)/3,m[g]=n,m[g+1]=r,m[g+2]=o,m[g+3]=n,m[g+4]=r,m[g+5]=o,m[g+6]=n,m[g+7]=r,m[g+8]=o}Dt.bufferData(Dt.ARRAY_BUFFER,e.normalArray,Dt.DYNAMIC_DRAW),Dt.enableVertexAttribArray(t.attributes.normal),Dt.vertexAttribPointer(t.attributes.normal,3,Dt.FLOAT,!1,0,0)}e.hasUvs&&i.map&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglUvBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.uvArray,Dt.DYNAMIC_DRAW),Dt.enableVertexAttribArray(t.attributes.uv),Dt.vertexAttribPointer(t.attributes.uv,2,Dt.FLOAT,!1,0,0)),e.hasColors&&i.vertexColors!==THREE.NoColors&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,e.__webglColorBuffer),Dt.bufferData(Dt.ARRAY_BUFFER,e.colorArray,Dt.DYNAMIC_DRAW),Dt.enableVertexAttribArray(t.attributes.color),Dt.vertexAttribPointer(t.attributes.color,3,Dt.FLOAT,!1,0,0)),Dt.drawArrays(Dt.TRIANGLES,0,e.count),e.count=0},this.renderBufferDirect=function(e,t,i,n,r,o){if(n.visible!==!1){var s,a,l,h,c=O(e,t,i,n,o),u=c.attributes,d=r.attributes,p=!1,f=n.wireframe?1:0,m=16777215*r.id+2*c.id+f;if(m!==Gt&&(Gt=m,p=!0),p&&_(),o instanceof THREE.Mesh){var g=d.index;if(g){var v=r.offsets;v.length>1&&(p=!0);for(var b=0,E=v.length;E>b;b++){var x=v[b].index;if(p){for(a in u)l=u[a],s=d[a],l>=0&&(s?(h=s.itemSize,Dt.bindBuffer(Dt.ARRAY_BUFFER,s.buffer),y(l),Dt.vertexAttribPointer(l,h,Dt.FLOAT,!1,0,4*x*h)):n.defaultAttributeValues&&(2===n.defaultAttributeValues[a].length?Dt.vertexAttrib2fv(l,n.defaultAttributeValues[a]):3===n.defaultAttributeValues[a].length&&Dt.vertexAttrib3fv(l,n.defaultAttributeValues[a])));Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,g.buffer)}Dt.drawElements(Dt.TRIANGLES,v[b].count,Dt.UNSIGNED_SHORT,2*v[b].start),Vt.info.render.calls++,Vt.info.render.vertices+=v[b].count,Vt.info.render.faces+=v[b].count/3}}else{if(p)for(a in u)"index"!==a&&(l=u[a],s=d[a],l>=0&&(s?(h=s.itemSize,Dt.bindBuffer(Dt.ARRAY_BUFFER,s.buffer),y(l),Dt.vertexAttribPointer(l,h,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[a]&&(2===n.defaultAttributeValues[a].length?Dt.vertexAttrib2fv(l,n.defaultAttributeValues[a]):3===n.defaultAttributeValues[a].length&&Dt.vertexAttrib3fv(l,n.defaultAttributeValues[a]))));var T=r.attributes.position;Dt.drawArrays(Dt.TRIANGLES,0,T.numItems/3),Vt.info.render.calls++,Vt.info.render.vertices+=T.numItems/3,Vt.info.render.faces+=T.numItems/3/3}}else if(o instanceof THREE.ParticleSystem){if(p){for(a in u)l=u[a],s=d[a],l>=0&&(s?(h=s.itemSize,Dt.bindBuffer(Dt.ARRAY_BUFFER,s.buffer),y(l),Dt.vertexAttribPointer(l,h,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[a]&&(2===n.defaultAttributeValues[a].length?Dt.vertexAttrib2fv(l,n.defaultAttributeValues[a]):3===n.defaultAttributeValues[a].length&&Dt.vertexAttrib3fv(l,n.defaultAttributeValues[a])));var T=d.position;Dt.drawArrays(Dt.POINTS,0,T.numItems/3),Vt.info.render.calls++,Vt.info.render.points+=T.numItems/3}}else if(o instanceof THREE.Line&&p){for(a in u)l=u[a],s=d[a],l>=0&&(s?(h=s.itemSize,Dt.bindBuffer(Dt.ARRAY_BUFFER,s.buffer),y(l),Dt.vertexAttribPointer(l,h,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&n.defaultAttributeValues[a]&&(2===n.defaultAttributeValues[a].length?Dt.vertexAttrib2fv(l,n.defaultAttributeValues[a]):3===n.defaultAttributeValues[a].length&&Dt.vertexAttrib3fv(l,n.defaultAttributeValues[a])));var w=o.type===THREE.LineStrip?Dt.LINE_STRIP:Dt.LINES;it(n.linewidth);var T=d.position;Dt.drawArrays(w,0,T.numItems/3),Vt.info.render.calls++,Vt.info.render.points+=T.numItems}}},this.renderBuffer=function(e,t,i,n,r,o){if(n.visible!==!1){var s,a,l,h=O(e,t,i,n,o),c=h.attributes,u=!1,d=n.wireframe?1:0,p=16777215*r.id+2*h.id+d;if(p!==Gt&&(Gt=p,u=!0),u&&_(),!n.morphTargets&&c.position>=0?u&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglVertexBuffer),y(c.position),Dt.vertexAttribPointer(c.position,3,Dt.FLOAT,!1,0,0)):o.morphTargetBase&&b(n,r,o),u){if(r.__webglCustomAttributesList)for(a=0,l=r.__webglCustomAttributesList.length;l>a;a++)s=r.__webglCustomAttributesList[a],c[s.buffer.belongsToAttribute]>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,s.buffer),y(c[s.buffer.belongsToAttribute]),Dt.vertexAttribPointer(c[s.buffer.belongsToAttribute],s.size,Dt.FLOAT,!1,0,0));c.color>=0&&(o.geometry.colors.length>0||o.geometry.faces.length>0?(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglColorBuffer),y(c.color),Dt.vertexAttribPointer(c.color,3,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib3fv(c.color,n.defaultAttributeValues.color)),c.normal>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglNormalBuffer),y(c.normal),Dt.vertexAttribPointer(c.normal,3,Dt.FLOAT,!1,0,0)),c.tangent>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglTangentBuffer),y(c.tangent),Dt.vertexAttribPointer(c.tangent,4,Dt.FLOAT,!1,0,0)),c.uv>=0&&(o.geometry.faceVertexUvs[0]?(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglUVBuffer),y(c.uv),Dt.vertexAttribPointer(c.uv,2,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib2fv(c.uv,n.defaultAttributeValues.uv)),c.uv2>=0&&(o.geometry.faceVertexUvs[1]?(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglUV2Buffer),y(c.uv2),Dt.vertexAttribPointer(c.uv2,2,Dt.FLOAT,!1,0,0)):n.defaultAttributeValues&&Dt.vertexAttrib2fv(c.uv2,n.defaultAttributeValues.uv2)),n.skinning&&c.skinIndex>=0&&c.skinWeight>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglSkinIndicesBuffer),y(c.skinIndex),Dt.vertexAttribPointer(c.skinIndex,4,Dt.FLOAT,!1,0,0),Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglSkinWeightsBuffer),y(c.skinWeight),Dt.vertexAttribPointer(c.skinWeight,4,Dt.FLOAT,!1,0,0)),c.lineDistance>=0&&(Dt.bindBuffer(Dt.ARRAY_BUFFER,r.__webglLineDistanceBuffer),y(c.lineDistance),Dt.vertexAttribPointer(c.lineDistance,1,Dt.FLOAT,!1,0,0))}if(o instanceof THREE.Mesh)n.wireframe?(it(n.wireframeLinewidth),u&&Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,r.__webglLineBuffer),Dt.drawElements(Dt.LINES,r.__webglLineCount,Dt.UNSIGNED_SHORT,0)):(u&&Dt.bindBuffer(Dt.ELEMENT_ARRAY_BUFFER,r.__webglFaceBuffer),Dt.drawElements(Dt.TRIANGLES,r.__webglFaceCount,Dt.UNSIGNED_SHORT,0)),Vt.info.render.calls++,Vt.info.render.vertices+=r.__webglFaceCount,Vt.info.render.faces+=r.__webglFaceCount/3;else if(o instanceof THREE.Line){var f=o.type===THREE.LineStrip?Dt.LINE_STRIP:Dt.LINES;it(n.linewidth),Dt.drawArrays(f,0,r.__webglLineCount),Vt.info.render.calls++}else o instanceof THREE.ParticleSystem&&(Dt.drawArrays(Dt.POINTS,0,r.__webglParticleCount),Vt.info.render.calls++,Vt.info.render.points+=r.__webglParticleCount)}},this.render=function(e,t,i,n){if(t instanceof THREE.Camera==!1)return console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera."),void 0;var r,o,s,a,l,h=e.__lights,c=e.fog;for($t=-1,bi=!0,e.autoUpdate===!0&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),gi.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),mi.setFromMatrix(gi),this.autoUpdateObjects&&this.initWebGLObjects(e),T(this.renderPluginsPre,e,t),Vt.info.render.calls=0,Vt.info.render.vertices=0,Vt.info.render.faces=0,Vt.info.render.points=0,this.setRenderTarget(i),(this.autoClear||n)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),l=e.__webglObjects,r=0,o=l.length;o>r;r++)s=l[r],a=s.object,s.id=r,s.render=!1,a.visible&&((a instanceof THREE.Mesh||a instanceof THREE.ParticleSystem)&&a.frustumCulled&&!mi.intersectsObject(a)||(J(a,t),C(s),s.render=!0,this.sortObjects===!0&&(null!==a.renderDepth?s.z=a.renderDepth:(yi.setFromMatrixPosition(a.matrixWorld),yi.applyProjection(gi),s.z=yi.z))));for(this.sortObjects&&l.sort(E),l=e.__webglObjectsImmediate,r=0,o=l.length;o>r;r++)s=l[r],a=s.object,a.visible&&(J(a,t),S(s));if(e.overrideMaterial){var u=e.overrideMaterial;this.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),this.setDepthTest(u.depthTest),this.setDepthWrite(u.depthWrite),nt(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits),w(e.__webglObjects,!1,"",t,h,c,!0,u),R(e.__webglObjectsImmediate,"",t,h,c,!1,u)}else{var u=null;this.setBlending(THREE.NoBlending),w(e.__webglObjects,!0,"opaque",t,h,c,!1,u),R(e.__webglObjectsImmediate,"opaque",t,h,c,!1,u),w(e.__webglObjects,!1,"transparent",t,h,c,!0,u),R(e.__webglObjectsImmediate,"transparent",t,h,c,!0,u)}T(this.renderPluginsPost,e,t),i&&i.generateMipmaps&&i.minFilter!==THREE.NearestFilter&&i.minFilter!==THREE.LinearFilter&&vt(i),this.setDepthTest(!0),this.setDepthWrite(!0)},this.renderImmediateObject=function(e,t,i,n,r){var o=O(e,t,i,n,r);Gt=-1,Vt.setMaterialFaces(n),r.immediateRenderCallback?r.immediateRenderCallback(o,Dt,mi):r.render(function(e){Vt.renderBufferImmediate(e,o,n)})},this.initWebGLObjects=function(e){for(e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);e.__objectsAdded.length;)M(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)N(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,i=e.__webglObjects.length;i>t;t++){var n=e.__webglObjects[t].object;void 0===n.__webglInit&&(void 0!==n.__webglActive&&N(n,e),M(n,e)),P(n)}},this.initMaterial=function(e,t,i,n){e.addEventListener("dispose",Li);var r,o,s,a,l,h,c;e instanceof THREE.MeshDepthMaterial?c="depth":e instanceof THREE.MeshNormalMaterial?c="normal":e instanceof THREE.MeshBasicMaterial?c="basic":e instanceof THREE.MeshLambertMaterial?c="lambert":e instanceof THREE.MeshPhongMaterial?c="phong":e instanceof THREE.LineBasicMaterial?c="basic":e instanceof THREE.LineDashedMaterial?c="dashed":e instanceof THREE.ParticleSystemMaterial&&(c="particle_basic"),c&&I(e,THREE.ShaderLib[c]),a=Et(t),h=xt(t),l=bt(n),s={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:i,useFog:e.fog,fogExp:i instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Ci&&n&&n.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:a.directional,maxPointLights:a.point,maxSpotLights:a.spot,maxHemiLights:a.hemi,maxShadows:h,shadowMapEnabled:this.shadowMapEnabled&&n.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,perPixel:e.perPixel,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},e.program=ot(c,e.fragmentShader,e.vertexShader,e.uniforms,e.attributes,e.defines,s,e.index0AttributeName);var u=e.program.attributes;if(e.morphTargets){e.numSupportedMorphTargets=0;var d,p="morphTarget";for(o=0;o<this.maxMorphTargets;o++)d=p+o,u[d]>=0&&e.numSupportedMorphTargets++}if(e.morphNormals){e.numSupportedMorphNormals=0;var d,p="morphNormal";for(o=0;o<this.maxMorphNormals;o++)d=p+o,u[d]>=0&&e.numSupportedMorphNormals++}e.uniformsList=[];for(r in e.uniforms)e.uniformsList.push([e.uniforms[r],r])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Dt.disable(Dt.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Dt.frontFace(Dt.CW):Dt.frontFace(Dt.CCW),e===THREE.CullFaceBack?Dt.cullFace(Dt.BACK):e===THREE.CullFaceFront?Dt.cullFace(Dt.FRONT):Dt.cullFace(Dt.FRONT_AND_BACK),Dt.enable(Dt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide,i=e.side===THREE.BackSide;Kt!==t&&(t?Dt.disable(Dt.CULL_FACE):Dt.enable(Dt.CULL_FACE),Kt=t),Qt!==i&&(i?Dt.frontFace(Dt.CW):Dt.frontFace(Dt.CCW),Qt=i)},this.setDepthTest=function(e){ii!==e&&(e?Dt.enable(Dt.DEPTH_TEST):Dt.disable(Dt.DEPTH_TEST),ii=e)},this.setDepthWrite=function(e){ni!==e&&(Dt.depthMask(e),ni=e)},this.setBlending=function(e,t,i,n){e!==Jt&&(e===THREE.NoBlending?Dt.disable(Dt.BLEND):e===THREE.AdditiveBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.SRC_ALPHA,Dt.ONE)):e===THREE.SubtractiveBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.ZERO,Dt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Dt.enable(Dt.BLEND),Dt.blendEquation(Dt.FUNC_ADD),Dt.blendFunc(Dt.ZERO,Dt.SRC_COLOR)):e===THREE.CustomBlending?Dt.enable(Dt.BLEND):(Dt.enable(Dt.BLEND),Dt.blendEquationSeparate(Dt.FUNC_ADD,Dt.FUNC_ADD),Dt.blendFuncSeparate(Dt.SRC_ALPHA,Dt.ONE_MINUS_SRC_ALPHA,Dt.ONE,Dt.ONE_MINUS_SRC_ALPHA)),Jt=e),e===THREE.CustomBlending?(t!==Zt&&(Dt.blendEquation(_t(t)),Zt=t),(i!==ei||n!==ti)&&(Dt.blendFunc(_t(i),_t(n)),ei=i,ti=n)):(Zt=null,ei=null,ti=null)},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",Ni),e.__webglTexture=Dt.createTexture(),Vt.info.memory.textures++),Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),Dt.pixelStorei(Dt.UNPACK_FLIP_Y_WEBGL,e.flipY),Dt.pixelStorei(Dt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Dt.pixelStorei(Dt.UNPACK_ALIGNMENT,e.unpackAlignment);var i=e.image,n=ct(i.width)&&ct(i.height),r=_t(e.format),o=_t(e.type);ut(Dt.TEXTURE_2D,e,n);var s,a=e.mipmaps;if(e instanceof THREE.DataTexture)if(a.length>0&&n){for(var l=0,h=a.length;h>l;l++)s=a[l],Dt.texImage2D(Dt.TEXTURE_2D,l,r,s.width,s.height,0,r,o,s.data);e.generateMipmaps=!1}else Dt.texImage2D(Dt.TEXTURE_2D,0,r,i.width,i.height,0,r,o,i.data);else if(e instanceof THREE.CompressedTexture)for(var l=0,h=a.length;h>l;l++)s=a[l],e.format!==THREE.RGBAFormat?Dt.compressedTexImage2D(Dt.TEXTURE_2D,l,r,s.width,s.height,0,s.data):Dt.texImage2D(Dt.TEXTURE_2D,l,r,s.width,s.height,0,r,o,s.data);else if(a.length>0&&n){for(var l=0,h=a.length;h>l;l++)s=a[l],Dt.texImage2D(Dt.TEXTURE_2D,l,r,r,o,s);e.generateMipmaps=!1}else Dt.texImage2D(Dt.TEXTURE_2D,0,r,r,o,e.image);e.generateMipmaps&&n&&Dt.generateMipmap(Dt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Dt.activeTexture(Dt.TEXTURE0+t),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture)
},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",zi),e.__webglTexture=Dt.createTexture(),Vt.info.memory.textures++;var i=ct(e.width)&&ct(e.height),n=_t(e.format),r=_t(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,e.__webglTexture),ut(Dt.TEXTURE_CUBE_MAP,e,i);for(var o=0;6>o;o++)e.__webglFramebuffer[o]=Dt.createFramebuffer(),e.__webglRenderbuffer[o]=Dt.createRenderbuffer(),Dt.texImage2D(Dt.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,n,e.width,e.height,0,n,r,null),mt(e.__webglFramebuffer[o],e,Dt.TEXTURE_CUBE_MAP_POSITIVE_X+o),gt(e.__webglRenderbuffer[o],e);i&&Dt.generateMipmap(Dt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Dt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Dt.createRenderbuffer(),Dt.bindTexture(Dt.TEXTURE_2D,e.__webglTexture),ut(Dt.TEXTURE_2D,e,i),Dt.texImage2D(Dt.TEXTURE_2D,0,n,e.width,e.height,0,n,r,null),mt(e.__webglFramebuffer,e,Dt.TEXTURE_2D),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_ATTACHMENT,Dt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Dt.framebufferRenderbuffer(Dt.FRAMEBUFFER,Dt.DEPTH_STENCIL_ATTACHMENT,Dt.RENDERBUFFER,e.__webglRenderbuffer):gt(e.__webglRenderbuffer,e),i&&Dt.generateMipmap(Dt.TEXTURE_2D);t?Dt.bindTexture(Dt.TEXTURE_CUBE_MAP,null):Dt.bindTexture(Dt.TEXTURE_2D,null),Dt.bindRenderbuffer(Dt.RENDERBUFFER,null),Dt.bindFramebuffer(Dt.FRAMEBUFFER,null)}var s,a,l,h,c;e?(s=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,a=e.width,l=e.height,h=0,c=0):(s=null,a=ci,l=ui,h=li,c=hi),s!==Wt&&(Dt.bindFramebuffer(Dt.FRAMEBUFFER,s),Dt.viewport(h,c,a,l),Wt=s),di=a,pi=l},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,i){this.width=e,this.height=t,i=i||{},this.wrapS=void 0!==i.wrapS?i.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==i.wrapT?i.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i.magFilter?i.magFilter:THREE.LinearFilter,this.minFilter=void 0!==i.minFilter?i.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==i.anisotropy?i.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==i.format?i.format:THREE.RGBAFormat,this.type=void 0!==i.type?i.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==i.depthBuffer?i.depthBuffer:!0,this.stencilBuffer=void 0!==i.stencilBuffer?i.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,i){THREE.WebGLRenderTarget.call(this,e,t,i),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace3=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.normalModelView=new THREE.Vector3,this.vertexNormalsLength=0,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsModelView=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.color=null,this.material=null,this.uvs=[[]],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.x=0,this.y=0,this.z=0,this.rotation=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,i){var n,r,o=e.vertices.length,s=(e.faceVertexUvs[0].length,t instanceof THREE.Mesh?t.geometry:t),a=e.vertices,l=s.vertices,h=e.faces,c=s.faces,u=e.faceVertexUvs[0],d=s.faceVertexUvs[0];void 0===i&&(i=0),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),n=t.matrix,r=(new THREE.Matrix3).getNormalMatrix(n));for(var p=0,f=l.length;f>p;p++){var m=l[p],g=m.clone();n&&g.applyMatrix4(n),a.push(g)}for(p=0,f=c.length;f>p;p++){var v,y,_,b=c[p],E=b.vertexNormals,x=b.vertexColors;v=new THREE.Face3(b.a+o,b.b+o,b.c+o),v.normal.copy(b.normal),r&&v.normal.applyMatrix3(r).normalize();for(var T=0,w=E.length;w>T;T++)y=E[T].clone(),r&&y.applyMatrix3(r).normalize(),v.vertexNormals.push(y);v.color.copy(b.color);for(var T=0,w=x.length;w>T;T++)_=x[T],v.vertexColors.push(_.clone());v.materialIndex=b.materialIndex+i,v.centroid.copy(b.centroid),n&&v.centroid.applyMatrix4(n),h.push(v)}for(p=0,f=d.length;f>p;p++){for(var R=d[p],S=[],T=0,w=R.length;w>T;T++)S.push(new THREE.Vector2(R[T].x,R[T].y));u.push(S)}},randomPointInTriangle:function(){var e=new THREE.Vector3;return function(t,i,n){var r=new THREE.Vector3,o=THREE.Math.random16(),s=THREE.Math.random16();o+s>1&&(o=1-o,s=1-s);var a=1-o-s;return r.copy(t),r.multiplyScalar(o),e.copy(i),e.multiplyScalar(s),r.add(e),e.copy(n),e.multiplyScalar(a),r.add(e),r}}(),randomPointInFace:function(e,t){var i,n,r;return i=t.vertices[e.a],n=t.vertices[e.b],r=t.vertices[e.c],THREE.GeometryUtils.randomPointInTriangle(i,n,r)},randomPointsInGeometry:function(e,t){function i(e){function t(i,n){if(i>n)return i;var r=i+Math.floor((n-i)/2);return d[r]>e?t(i,r-1):d[r]<e?t(r+1,n):r}var i=t(0,d.length-1);return i}var n,r,o,s,a,l=e.faces,h=e.vertices,c=l.length,u=0,d=[];for(r=0;c>r;r++)n=l[r],o=h[n.a],s=h[n.b],a=h[n.c],n._area=THREE.GeometryUtils.triangleArea(o,s,a),u+=n._area,d[r]=u;var p,f,m=[],g={};for(r=0;t>r;r++)p=THREE.Math.random16()*u,f=i(p),m[r]=THREE.GeometryUtils.randomPointInFace(l[f],e,!0),g[f]?g[f]+=1:g[f]=1;return m},triangleArea:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(i,n,r){return e.subVectors(n,i),t.subVectors(r,i),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,i=new THREE.Vector3;return i.addVectors(t.min,t.max),i.multiplyScalar(-.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(i.x,i.y,i.z)),e.computeBoundingBox(),i},triangulateQuads:function(e){var t,i,n,r,o=[],s=[];for(t=0,i=e.faceVertexUvs.length;i>t;t++)s[t]=[];for(t=0,i=e.faces.length;i>t;t++){var a=e.faces[t];for(o.push(a),n=0,r=e.faceVertexUvs.length;r>n;n++)s[n].push(e.faceVertexUvs[n][t])}e.faces=o,e.faceVertexUvs=s,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},THREE.ImageUtils={crossOrigin:"anonymous",loadTexture:function(e,t,i){var n=new THREE.ImageLoader;n.crossOrigin=this.crossOrigin;var r=new THREE.Texture(void 0,t),o=n.load(e,function(){r.needsUpdate=!0,i&&i(r)});return r.image=o,r.sourceFile=e,r},loadCompressedTexture:function(e,t,i,n){var r=new THREE.CompressedTexture;r.mapping=t;var o=new XMLHttpRequest;return o.onload=function(){var e=o.response,t=THREE.ImageUtils.parseDDS(e,!0);r.format=t.format,r.mipmaps=t.mipmaps,r.image.width=t.width,r.image.height=t.height,r.generateMipmaps=!1,r.needsUpdate=!0,i&&i(r)},o.onerror=n,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),r},loadTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.Texture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1;for(var s=0,a=e.length;a>s;++s){var l=new Image;r[s]=l,l.onload=function(){r.loadCount+=1,6===r.loadCount&&(o.needsUpdate=!0,i&&i(o))},l.onerror=n,l.crossOrigin=this.crossOrigin,l.src=e[s]}return o},loadCompressedTextureCube:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.CompressedTexture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var s=function(e,t){return function(){var n=e.response,s=THREE.ImageUtils.parseDDS(n,!0);t.format=s.format,t.mipmaps=s.mipmaps,t.width=s.width,t.height=s.height,r.loadCount+=1,6===r.loadCount&&(o.format=s.format,o.needsUpdate=!0,i&&i(o))}};if(e instanceof Array)for(var a=0,l=e.length;l>a;++a){var h={};r[a]=h;var c=new XMLHttpRequest;c.onload=s(c,h),c.onerror=n;var u=e[a];c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}else{var u=e,c=new XMLHttpRequest;c.onload=function(){var e=c.response,t=THREE.ImageUtils.parseDDS(e,!0);if(t.isCubemap){for(var n=t.mipmaps.length/t.mipmapCount,s=0;n>s;s++){r[s]={mipmaps:[]};for(var a=0;a<t.mipmapCount;a++)r[s].mipmaps.push(t.mipmaps[s*t.mipmapCount+a]),r[s].format=t.format,r[s].width=t.width,r[s].height=t.height}o.format=t.format,o.needsUpdate=!0,i&&i(o)}},c.onerror=n,c.open("GET",u,!0),c.responseType="arraybuffer",c.send(null)}return o},loadDDSTexture:function(e,t,i,n){var r=[];r.loadCount=0;var o=new THREE.CompressedTexture;o.image=r,void 0!==t&&(o.mapping=t),o.flipY=!1,o.generateMipmaps=!1;var s=new XMLHttpRequest;return s.onload=function(){var e=s.response,t=THREE.ImageUtils.parseDDS(e,!0);if(t.isCubemap)for(var n=t.mipmaps.length/t.mipmapCount,a=0;n>a;a++){r[a]={mipmaps:[]};for(var l=0;l<t.mipmapCount;l++)r[a].mipmaps.push(t.mipmaps[a*t.mipmapCount+l]),r[a].format=t.format,r[a].width=t.width,r[a].height=t.height}else o.image.width=t.width,o.image.height=t.height,o.mipmaps=t.mipmaps;o.format=t.format,o.needsUpdate=!0,i&&i(o)},s.onerror=n,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),o},parseDDS:function(e,t){function i(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function n(e){return String.fromCharCode(255&e,255&e>>8,255&e>>16,255&e>>24)}function r(e,t,i,n){for(var r=4*i*n,o=new Uint8Array(e,t,r),s=new Uint8Array(r),a=0,l=0,h=0;n>h;h++)for(var c=0;i>c;c++){var u=o[l];l++;var d=o[l];l++;var p=o[l];l++;var f=o[l];l++,s[a]=p,a++,s[a]=d,a++,s[a]=u,a++,s[a]=f,a++}return s}var o={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=542327876,a=131072,l=512,h=4,c=i("DXT1"),u=i("DXT3"),d=i("DXT5"),p=31,f=0,m=1,g=2,v=3,y=4,_=7,b=20,E=21,x=22,T=23,w=24,R=25,S=26,C=28,H=new Int32Array(e,0,p);if(H[f]!==s)return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),o;if(!H[b]&h)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),o;var M,k=H[E],A=!1;switch(k){case c:M=8,o.format=THREE.RGB_S3TC_DXT1_Format;break;case u:M=16,o.format=THREE.RGBA_S3TC_DXT3_Format;break;case d:M=16,o.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==H[x]&&16711680&H[T]&&65280&H[w]&&255&H[R]&&4278190080&H[S]))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",n(k)),o;A=!0,M=64,o.format=THREE.RGBAFormat}o.mipmapCount=1,H[g]&a&&t!==!1&&(o.mipmapCount=Math.max(1,H[_])),o.isCubemap=H[C]&l?!0:!1,o.width=H[y],o.height=H[v];for(var P=H[m]+4,F=o.width,D=o.height,N=o.isCubemap?6:1,z=0;N>z;z++){for(var L=0;L<o.mipmapCount;L++){if(A)var I=r(e,P,F,D),O=I.length;else var O=Math.max(4,F)/4*Math.max(4,D)/4*M,I=new Uint8Array(e,P,O);var V={data:I,width:F,height:D};o.mipmaps.push(V),P+=O,F=Math.max(.5*F,1),D=Math.max(.5*D,1)}F=o.width,D=o.height}return o},getNormalMap:function(e,t){var i=function(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]},n=function(e,t){return[e[0]-t[0],e[1]-t[1],e[2]-t[2]]},r=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t=1|t;var o=e.width,s=e.height,a=document.createElement("canvas");a.width=o,a.height=s;var l=a.getContext("2d");l.drawImage(e,0,0);for(var h=l.getImageData(0,0,o,s).data,c=l.createImageData(o,s),u=c.data,d=0;o>d;d++)for(var p=0;s>p;p++){var f=0>p-1?0:p-1,m=p+1>s-1?s-1:p+1,g=0>d-1?0:d-1,v=d+1>o-1?o-1:d+1,y=[],_=[0,0,h[4*(p*o+d)]/255*t];y.push([-1,0,h[4*(p*o+g)]/255*t]),y.push([-1,-1,h[4*(f*o+g)]/255*t]),y.push([0,-1,h[4*(f*o+d)]/255*t]),y.push([1,-1,h[4*(f*o+v)]/255*t]),y.push([1,0,h[4*(p*o+v)]/255*t]),y.push([1,1,h[4*(m*o+v)]/255*t]),y.push([0,1,h[4*(m*o+d)]/255*t]),y.push([-1,1,h[4*(m*o+g)]/255*t]);for(var b=[],E=y.length,x=0;E>x;x++){var T=y[x],w=y[(x+1)%E];T=n(T,_),w=n(w,_),b.push(r(i(T,w)))}for(var R=[0,0,0],x=0;x<b.length;x++)R[0]+=b[x][0],R[1]+=b[x][1],R[2]+=b[x][2];R[0]/=b.length,R[1]/=b.length,R[2]/=b.length;var S=4*(p*o+d);u[S]=0|255*((R[0]+1)/2),u[S+1]=0|255*((R[1]+1)/2),u[S+2]=0|255*R[2],u[S+3]=255}return l.putImageData(c,0,0),a},generateDataTexture:function(e,t,i){for(var n=e*t,r=new Uint8Array(3*n),o=Math.floor(255*i.r),s=Math.floor(255*i.g),a=Math.floor(255*i.b),l=0;n>l;l++)r[3*l]=o,r[3*l+1]=s,r[3*l+2]=a;var h=new THREE.DataTexture(r,e,t,THREE.RGBFormat);return h.needsUpdate=!0,h}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var i=new THREE.Object3D,n=0,r=t.length;r>n;n++)i.add(new THREE.Mesh(e,t[n]));return i},detach:function(e,t,i){e.applyMatrix(t.matrixWorld),t.remove(e),i.add(e)},attach:function(e,t,i){var n=new THREE.Matrix4;n.getInverse(i.matrixWorld),e.applyMatrix(n),t.remove(e),i.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase(),i=this;return i.faces[t]=i.faces[t]||{},i.faces[t][e.cssFontWeight]=i.faces[t][e.cssFontWeight]||{},i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,i.faces[t][e.cssFontWeight][e.cssFontStyle]=e,e},drawText:function(e){var t,i=this.getFace(),n=this.size/i.resolution,r=0,o=String(e).split(""),s=o.length,a=[];for(t=0;s>t;t++){var l=new THREE.Path,h=this.extractGlyphPoints(o[t],i,n,r,l);r+=h.offset,a.push(h.path)}var c=r/2;return{paths:a,offset:c}},extractGlyphPoints:function(e,t,i,n,r){var o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w=[],R=t.glyphs[e]||t.glyphs["?"];if(R){if(R.o)for(l=R._cachedOutline||(R._cachedOutline=R.o.split(" ")),c=l.length,u=i,d=i,o=0;c>o;)switch(h=l[o++]){case"m":p=l[o++]*u+n,f=l[o++]*d,r.moveTo(p,f);break;case"l":p=l[o++]*u+n,f=l[o++]*d,r.lineTo(p,f);break;case"q":if(m=l[o++]*u+n,g=l[o++]*d,_=l[o++]*u+n,b=l[o++]*d,r.quadraticCurveTo(_,b,m,g),T=w[w.length-1])for(v=T.x,y=T.y,s=1,a=this.divisions;a>=s;s++){var S=s/a;THREE.Shape.Utils.b2(S,v,_,m),THREE.Shape.Utils.b2(S,y,b,g)}break;case"b":if(m=l[o++]*u+n,g=l[o++]*d,_=l[o++]*u+n,b=l[o++]*-d,E=l[o++]*u+n,x=l[o++]*-d,r.bezierCurveTo(m,g,_,b,E,x),T=w[w.length-1])for(v=T.x,y=T.y,s=1,a=this.divisions;a>=s;s++){var S=s/a;THREE.Shape.Utils.b3(S,v,_,E,m),THREE.Shape.Utils.b3(S,y,b,x,g)}}return{offset:R.ha*i,path:r}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var i=void 0!==t.size?t.size:100,n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",o=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=i,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=o,THREE.FontUtils.style=s;for(var a=THREE.FontUtils.drawText(e),l=a.paths,h=[],c=0,u=l.length;u>c;c++)Array.prototype.push.apply(h,l[c].toShapes());return h},function(e){var t=1e-10,i=function(e,t){var i=e.length;if(3>i)return null;var o,s,a,l=[],h=[],c=[];if(n(e)>0)for(s=0;i>s;s++)h[s]=s;else for(s=0;i>s;s++)h[s]=i-1-s;var u=i,d=2*u;for(s=u-1;u>2;){if(d--<=0)return console.log("Warning, unable to triangulate polygon!"),t?c:l;if(o=s,o>=u&&(o=0),s=o+1,s>=u&&(s=0),a=s+1,a>=u&&(a=0),r(e,o,s,a,u,h)){var p,f,m,g,v;for(p=h[o],f=h[s],m=h[a],l.push([e[p],e[f],e[m]]),c.push([h[o],h[s],h[a]]),g=s,v=s+1;u>v;g++,v++)h[g]=h[v];u--,d=2*u}}return t?c:l},n=function(e){for(var t=e.length,i=0,n=t-1,r=0;t>r;n=r++)i+=e[n].x*e[r].y-e[r].x*e[n].y;return.5*i},r=function(e,i,n,r,o,s){var a,l,h,c,u,d,p,f,m;if(l=e[s[i]].x,h=e[s[i]].y,c=e[s[n]].x,u=e[s[n]].y,d=e[s[r]].x,p=e[s[r]].y,t>(c-l)*(p-h)-(u-h)*(d-l))return!1;var g,v,y,_,b,E,x,T,w,R,S,C,H,M,k;for(g=d-c,v=p-u,y=l-d,_=h-p,b=c-l,E=u-h,a=0;o>a;a++)if(a!==i&&a!==n&&a!==r&&(f=e[s[a]].x,m=e[s[a]].y,x=f-l,T=m-h,w=f-c,R=m-u,S=f-d,C=m-p,k=g*R-v*w,H=b*T-E*x,M=y*C-_*S,k>=-t&&M>=-t&&H>=-t))return!1;return!0};return e.Triangulate=i,e.Triangulate.area=n,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){var t=this.getUtoTmapping(e);return this.getPoint(t)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPoint(t/e));return i},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,i=[];for(t=0;e>=t;t++)i.push(this.getPointAt(t/e));return i},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){if(e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;e>=i;i++)t=this.getPoint(i/e),o+=t.distanceTo(r),n.push(o),r=t;return this.cacheArcLengths=n,n},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var i,n=this.getLengths(),r=0,o=n.length;i=t?t:e*n[o-1];for(var s,a=0,l=o-1;l>=a;)if(r=Math.floor(a+(l-a)/2),s=n[r]-i,0>s)a=r+1;else{if(!(s>0)){l=r;break}l=r-1}if(r=l,n[r]==i){var h=r/(o-1);return h}var c=n[r],u=n[r+1],d=u-c,p=(i-c)/d,h=(r+p)/(o-1);return h},THREE.Curve.prototype.getTangent=function(e){var t=1e-4,i=e-t,n=e+t;0>i&&(i=0),n>1&&(n=1);var r=this.getPoint(i),o=this.getPoint(n),s=o.clone().sub(r);return s.normalize()},THREE.Curve.prototype.getTangentAt=function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,i,n){return 2*(1-e)*(i-t)+2*e*(n-i)},tangentCubicBezier:function(e,t,i,n,r){return-3*t*(1-e)*(1-e)+3*i*(1-e)*(1-e)-6*e*i*(1-e)+6*e*n*(1-e)-3*e*e*n+3*e*e*r},tangentSpline:function(e){var t=6*e*e-6*e,i=3*e*e-4*e+1,n=-6*e*e+6*e,r=3*e*e-2*e;return t+i+n+r},interpolate:function(e,t,i,n,r){var o=.5*(i-e),s=.5*(n-t),a=r*r,l=r*a;return(2*t-2*i+o+s)*l+(-3*t+3*i-2*o-s)*a+o*r+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){for(var t,i,n=e*this.getLength(),r=this.getCurveLengths(),o=0;o<r.length;){if(r[o]>=n){t=r[o]-n,i=this.curves[o];var s=1-t/i.getLength();return i.getPointAt(s)}o++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e,t=[],i=0,n=this.curves.length;for(e=0;n>e;e++)i+=this.curves[e].getLength(),t.push(i);return this.cacheLengths=t,t},THREE.CurvePath.prototype.getBoundingBox=function(){var e,t,i,n,r,o,s=this.getPoints();e=t=Number.NEGATIVE_INFINITY,n=r=Number.POSITIVE_INFINITY;var a,l,h,c,u=s[0]instanceof THREE.Vector3;for(c=u?new THREE.Vector3:new THREE.Vector2,l=0,h=s.length;h>l;l++)a=s[l],a.x>e?e=a.x:a.x<n&&(n=a.x),a.y>t?t=a.y:a.y<r&&(r=a.y),u&&(a.z>i?i=a.z:a.z<o&&(o=a.z)),c.add(a);var d={minX:n,minY:r,maxX:e,maxY:t,centroid:c.divideScalar(h)};return u&&(d.maxZ=i,d.minZ=o),d},THREE.CurvePath.prototype.createPointsGeometry=function(e){var t=this.getPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){var t=this.getSpacedPoints(e,!0);return this.createGeometry(t)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,i=0;i<e.length;i++)t.vertices.push(new THREE.Vector3(e[i].x,e[i].y,e[i].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var i,n,r=this.getPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var i,n,r=this.getSpacedPoints(e);for(t||(t=this.bends),i=0,n=t.length;n>i;i++)r=this.getWrapPoints(r,t[i]);return r},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var i,n,r,o,s,a,l=this.getBoundingBox();for(i=0,n=e.length;n>i;i++){r=e[i],o=r.x,s=r.y,a=o/l.maxX,a=t.getUtoTmapping(a,o);var h=t.getPoint(a),c=t.getTangent(a);c.set(-c.y,c.x).multiplyScalar(s),r.x=h.x+c.x,r.y=h.y+c.y}return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=0,i=this.children.length;i>t;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,i=e.length;i>t;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(){var e=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:e})},THREE.Path.prototype.lineTo=function(e,t){var i=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,r=n[n.length-2],o=n[n.length-1],s=new THREE.LineCurve(new THREE.Vector2(r,o),new THREE.Vector2(e,t));this.curves.push(s),this.actions.push({action:THREE.PathActions.LINE_TO,args:i})},THREE.Path.prototype.quadraticCurveTo=function(e,t,i,n){var r=Array.prototype.slice.call(arguments),o=this.actions[this.actions.length-1].args,s=o[o.length-2],a=o[o.length-1],l=new THREE.QuadraticBezierCurve(new THREE.Vector2(s,a),new THREE.Vector2(e,t),new THREE.Vector2(i,n));this.curves.push(l),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:r})},THREE.Path.prototype.bezierCurveTo=function(e,t,i,n,r,o){var s=Array.prototype.slice.call(arguments),a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1],c=new THREE.CubicBezierCurve(new THREE.Vector2(l,h),new THREE.Vector2(e,t),new THREE.Vector2(i,n),new THREE.Vector2(r,o));this.curves.push(c),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:s})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),i=this.actions[this.actions.length-1].args,n=i[i.length-2],r=i[i.length-1],o=[new THREE.Vector2(n,r)];Array.prototype.push.apply(o,e);var s=new THREE.SplineCurve(o);this.curves.push(s),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,i,n,r,o){var s=this.actions[this.actions.length-1].args,a=s[s.length-2],l=s[s.length-1];this.absarc(e+a,t+l,i,n,r,o)},THREE.Path.prototype.absarc=function(e,t,i,n,r,o){this.absellipse(e,t,i,i,n,r,o)},THREE.Path.prototype.ellipse=function(e,t,i,n,r,o,s){var a=this.actions[this.actions.length-1].args,l=a[a.length-2],h=a[a.length-1];this.absellipse(e+l,t+h,i,n,r,o,s)},THREE.Path.prototype.absellipse=function(e,t,i,n,r,o,s){var a=Array.prototype.slice.call(arguments),l=new THREE.EllipseCurve(e,t,i,n,r,o,s);this.curves.push(l);var h=l.getPoint(1);a.push(h.x),a.push(h.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:a})},THREE.Path.prototype.getSpacedPoints=function(e){e||(e=40);for(var t=[],i=0;e>i;i++)t.push(this.getPoint(i/e));return t},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var i,n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b=[];for(i=0,n=this.actions.length;n>i;i++)switch(r=this.actions[i],o=r.action,s=r.args,o){case THREE.PathActions.MOVE_TO:b.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:b.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:for(a=s[2],l=s[3],u=s[0],d=s[1],b.length>0?(m=b[b.length-1],p=m.x,f=m.y):(m=this.actions[i-1].args,p=m[m.length-2],f=m[m.length-1]),g=1;e>=g;g++)v=g/e,y=THREE.Shape.Utils.b2(v,p,u,a),_=THREE.Shape.Utils.b2(v,f,d,l),b.push(new THREE.Vector2(y,_));break;case THREE.PathActions.BEZIER_CURVE_TO:for(a=s[4],l=s[5],u=s[0],d=s[1],h=s[2],c=s[3],b.length>0?(m=b[b.length-1],p=m.x,f=m.y):(m=this.actions[i-1].args,p=m[m.length-2],f=m[m.length-1]),g=1;e>=g;g++)v=g/e,y=THREE.Shape.Utils.b3(v,p,u,h,a),_=THREE.Shape.Utils.b3(v,f,d,c,l),b.push(new THREE.Vector2(y,_));break;case THREE.PathActions.CSPLINE_THRU:m=this.actions[i-1].args;var E=new THREE.Vector2(m[m.length-2],m[m.length-1]),x=[E],T=e*s[0].length;x=x.concat(s[0]);var w=new THREE.SplineCurve(x);for(g=1;T>=g;g++)b.push(w.getPointAt(g/T));break;case THREE.PathActions.ARC:var R,S=s[0],C=s[1],H=s[2],M=s[3],k=s[4],A=!!s[5],P=k-M,F=2*e;for(g=1;F>=g;g++)v=g/F,A||(v=1-v),R=M+v*P,y=S+H*Math.cos(R),_=C+H*Math.sin(R),b.push(new THREE.Vector2(y,_));break;case THREE.PathActions.ELLIPSE:var R,S=s[0],C=s[1],D=s[2],N=s[3],M=s[4],k=s[5],A=!!s[6],P=k-M,F=2*e;for(g=1;F>=g;g++)v=g/F,A||(v=1-v),R=M+v*P,y=S+D*Math.cos(R),_=C+N*Math.sin(R),b.push(new THREE.Vector2(y,_))}var z=b[b.length-1],L=1e-10;return Math.abs(z.x-b[0].x)<L&&Math.abs(z.y-b[0].y)<L&&b.splice(b.length-1,1),t&&b.push(b[0]),b},THREE.Path.prototype.toShapes=function(e){var t,i,n,r,o,s=[],a=new THREE.Path;for(t=0,i=this.actions.length;i>t;t++)n=this.actions[t],o=n.args,r=n.action,r==THREE.PathActions.MOVE_TO&&0!=a.actions.length&&(s.push(a),a=new THREE.Path),a[r].apply(a,o);if(0!=a.actions.length&&s.push(a),0==s.length)return[];var l,h,c,u=[];if(1==s.length)return h=s[0],c=new THREE.Shape,c.actions=h.actions,c.curves=h.curves,u.push(c),u;var d=!THREE.Shape.Utils.isClockWise(s[0].getPoints());if(d=e?!d:d)for(c=new THREE.Shape,t=0,i=s.length;i>t;t++)h=s[t],l=THREE.Shape.Utils.isClockWise(h.getPoints()),l=e?!l:l,l?(c.actions=h.actions,c.curves=h.curves,u.push(c),c=new THREE.Shape):c.holes.push(h);else{for(c=void 0,t=0,i=s.length;i>t;t++)h=s[t],l=THREE.Shape.Utils.isClockWise(h.getPoints()),l=e?!l:l,l?(c&&u.push(c),c=new THREE.Shape,c.actions=h.actions,c.curves=h.curves):c.holes.push(h);u.push(c)}return u},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){var t=new THREE.ExtrudeGeometry(this,e);return t},THREE.Shape.prototype.makeGeometry=function(e){var t=new THREE.ShapeGeometry(this,e);return t},THREE.Shape.prototype.getPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedPoints(e,this.bends);return n},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,i=this.holes.length,n=[];for(t=0;i>t;t++)n[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return n},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={removeHoles:function(e,t){var i,n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y=e.concat(),_=y.concat(),b=[];for(s=0;s<t.length;s++){for(l=t[s],Array.prototype.push.apply(_,l),h=Number.POSITIVE_INFINITY,a=0;a<l.length;a++){d=l[a];var E=[];for(u=0;u<y.length;u++)p=y[u],c=d.distanceToSquared(p),E.push(c),h>c&&(h=c,r=a,o=u)}i=o-1>=0?o-1:y.length-1,n=r-1>=0?r-1:l.length-1;var x=[l[r],y[o],y[i]],T=THREE.FontUtils.Triangulate.area(x),w=[l[r],l[n],y[o]],R=THREE.FontUtils.Triangulate.area(w),S=1,C=-1,H=o,M=r;o+=S,r+=C,0>o&&(o+=y.length),o%=y.length,0>r&&(r+=l.length),r%=l.length,i=o-1>=0?o-1:y.length-1,n=r-1>=0?r-1:l.length-1,x=[l[r],y[o],y[i]];var k=THREE.FontUtils.Triangulate.area(x);w=[l[r],l[n],y[o]];var A=THREE.FontUtils.Triangulate.area(w);T+R>k+A&&(o=H,r=M,0>o&&(o+=y.length),o%=y.length,0>r&&(r+=l.length),r%=l.length,i=o-1>=0?o-1:y.length-1,n=r-1>=0?r-1:l.length-1),f=y.slice(0,o),m=y.slice(o),g=l.slice(r),v=l.slice(0,r);var P=[l[r],y[o],y[i]],F=[l[r],l[n],y[o]];b.push(P),b.push(F),y=f.concat(g).concat(v).concat(m)}return{shape:y,isolatedPts:b,allpoints:_}},triangulateShape:function(e,t){var i,n,r,o,s,a,l=THREE.Shape.Utils.removeHoles(e,t),h=l.shape,c=l.allpoints,u=l.isolatedPts,d=THREE.FontUtils.Triangulate(h,!1),p={};for(i=0,n=c.length;n>i;i++)s=c[i].x+":"+c[i].y,void 0!==p[s]&&console.log("Duplicate point",s),p[s]=i;for(i=0,n=d.length;n>i;i++)for(o=d[i],r=0;3>r;r++)s=o[r].x+":"+o[r].y,a=p[s],void 0!==a&&(o[r]=a);for(i=0,n=u.length;n>i;i++)for(o=u[i],r=0;3>r;r++)s=o[r].x+":"+o[r].y,a=p[s],void 0!==a&&(o[r]=a);return d.concat(u)},isClockWise:function(e){return THREE.FontUtils.Triangulate.area(e)<0},b2p0:function(e,t){var i=1-e;return i*i*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,i,n){return this.b2p0(e,t)+this.b2p1(e,i)+this.b2p2(e,n)},b3p0:function(e,t){var i=1-e;return i*i*i*t},b3p1:function(e,t){var i=1-e;return 3*i*i*e*t},b3p2:function(e,t){var i=1-e;return 3*i*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,i,n,r){return this.b3p0(e,t)+this.b3p1(e,i)+this.b3p2(e,n)+this.b3p3(e,r)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(){var e=this.v2.clone().sub(this.v1);return e.normalize()},THREE.QuadraticBezierCurve=function(e,t,i){this.v0=e,this.v1=t,this.v2=i},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t,i;
return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,i)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y);var n=new THREE.Vector2(t,i);return n.normalize(),n},THREE.CubicBezierCurve=function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t,i;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,i)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t,i;t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y);var n=new THREE.Vector2(t,i);return n.normalize(),n},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t,i,n,r=new THREE.Vector2,o=[],s=this.points;return t=(s.length-1)*e,i=Math.floor(t),n=t-i,o[0]=0==i?i:i-1,o[1]=i,o[2]=i>s.length-2?s.length-1:i+1,o[3]=i>s.length-3?s.length-1:i+2,r.x=THREE.Curve.Utils.interpolate(s[o[0]].x,s[o[1]].x,s[o[2]].x,s[o[3]].x,n),r.y=THREE.Curve.Utils.interpolate(s[o[0]].y,s[o[1]].y,s[o[2]].y,s[o[3]].y,n),r},THREE.EllipseCurve=function(e,t,i,n,r,o,s){this.aX=e,this.aY=t,this.xRadius=i,this.yRadius=n,this.aStartAngle=r,this.aEndAngle=o,this.aClockwise=s},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t,i=this.aEndAngle-this.aStartAngle;0>i&&(i+=2*Math.PI),i>2*Math.PI&&(i-=2*Math.PI),t=this.aClockwise===!0?this.aEndAngle+(1-e)*(2*Math.PI-i):this.aStartAngle+e*i;var n=this.aX+this.xRadius*Math.cos(t),r=this.aY+this.yRadius*Math.sin(t);return new THREE.Vector2(n,r)},THREE.ArcCurve=function(e,t,i,n,r,o){THREE.EllipseCurve.call(this,e,t,i,i,n,r,o)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,i){this.v0=e,this.v1=t,this.v2=i},function(e){var t,i,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),i=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),n=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,i,n)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,i,n){this.v0=e,this.v1=t,this.v2=i,this.v3=n},function(e){var t,i,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),i=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),n=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,i,n)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,n,r=new THREE.Vector3,o=[],s=this.points;t=(s.length-1)*e,i=Math.floor(t),n=t-i,o[0]=0==i?i:i-1,o[1]=i,o[2]=i>s.length-2?s.length-1:i+1,o[3]=i>s.length-3?s.length-1:i+2;var a=s[o[0]],l=s[o[1]],h=s[o[2]],c=s[o[3]];return r.x=THREE.Curve.Utils.interpolate(a.x,l.x,h.x,c.x,n),r.y=THREE.Curve.Utils.interpolate(a.y,l.y,h.y,c.y,n),r.z=THREE.Curve.Utils.interpolate(a.z,l.z,h.z,c.z,n),r}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t,i,n,r=new THREE.Vector3,o=[],s=this.points;return t=(s.length-0)*e,i=Math.floor(t),n=t-i,i+=i>0?0:(Math.floor(Math.abs(i)/s.length)+1)*s.length,o[0]=(i-1)%s.length,o[1]=i%s.length,o[2]=(i+1)%s.length,o[3]=(i+2)%s.length,r.x=THREE.Curve.Utils.interpolate(s[o[0]].x,s[o[1]].x,s[o[2]].x,s[o[3]].x,n),r.y=THREE.Curve.Utils.interpolate(s[o[0]].y,s[o[1]].y,s[o[2]].y,s[o[3]].y,n),r.z=THREE.Curve.Utils.interpolate(s[o[0]].z,s[o[1]].z,s[o[2]].z,s[o[3]].z,n),r}),THREE.AnimationHandler=function(){var e=[],t={},i={};i.update=function(t){for(var i=0;i<e.length;i++)e[i].update(t)},i.addToUpdate=function(t){-1===e.indexOf(t)&&e.push(t)},i.removeFromUpdate=function(t){var i=e.indexOf(t);-1!==i&&e.splice(i,1)},i.add=function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e,r(e)},i.get=function(e){return"string"==typeof e?t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null):void 0},i.parse=function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var i=0;i<e.bones.length;i++)t.push(e.bones[i]);else n(e,t);return t};var n=function(e,t){t.push(e);for(var i=0;i<e.children.length;i++)n(e.children[i],t)},r=function(e){if(e.initialized!==!0){for(var t=0;t<e.hierarchy.length;t++){for(var i=0;i<e.hierarchy[t].keys.length;i++)if(e.hierarchy[t].keys[i].time<0&&(e.hierarchy[t].keys[i].time=0),void 0!==e.hierarchy[t].keys[i].rot&&!(e.hierarchy[t].keys[i].rot instanceof THREE.Quaternion)){var n=e.hierarchy[t].keys[i].rot;e.hierarchy[t].keys[i].rot=new THREE.Quaternion(n[0],n[1],n[2],n[3])}if(e.hierarchy[t].keys.length&&void 0!==e.hierarchy[t].keys[0].morphTargets){for(var r={},i=0;i<e.hierarchy[t].keys.length;i++)for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++){var s=e.hierarchy[t].keys[i].morphTargets[o];r[s]=-1}e.hierarchy[t].usedMorphTargets=r;for(var i=0;i<e.hierarchy[t].keys.length;i++){var a={};for(var s in r){for(var o=0;o<e.hierarchy[t].keys[i].morphTargets.length;o++)if(e.hierarchy[t].keys[i].morphTargets[o]===s){a[s]=e.hierarchy[t].keys[i].morphTargetsInfluences[o];break}o===e.hierarchy[t].keys[i].morphTargets.length&&(a[s]=0)}e.hierarchy[t].keys[i].morphTargetsInfluences=a}}for(var i=1;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].time===e.hierarchy[t].keys[i-1].time&&(e.hierarchy[t].keys.splice(i,1),i--);for(var i=0;i<e.hierarchy[t].keys.length;i++)e.hierarchy[t].keys[i].index=i}var l=parseInt(e.length*e.fps,10);e.JIT={},e.JIT.hierarchy=[];for(var t=0;t<e.hierarchy.length;t++)e.JIT.hierarchy.push(new Array(l));e.initialized=!0}};return i.LINEAR=0,i.CATMULLROM=1,i.CATMULLROM_FORWARD=2,i}(),THREE.Animation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.interpolationType=void 0!==i?i:THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e,t){if(this.isPlaying===!1){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0;var i,n,r=this.hierarchy.length;for(i=0;r>i;i++){n=this.hierarchy[i],n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var o=n.animationCache.prevKey,s=n.animationCache.nextKey;o.pos=this.data.hierarchy[i].keys[0],o.rot=this.data.hierarchy[i].keys[0],o.scl=this.data.hierarchy[i].keys[0],s.pos=this.getNextKeyWith("pos",i,1),s.rot=this.getNextKeyWith("rot",i,1),s.scl=this.getNextKeyWith("scl",i,1)}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){this.isPaused===!0?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.update=function(e){if(this.isPlaying!==!1){var t,i,n,r,o,s,a,l,h,c,u=["pos","rot","scl"];this.data.JIT.hierarchy;var d,p,f,m,g;for(this.currentTime+=e*this.timeScale,p=this.currentTime;this.currentTime>this.data.length;)this.currentTime-=this.data.length;d=this.currentTime=this.currentTime%this.data.length,c=parseInt(Math.min(d*this.data.fps,this.data.length*this.data.fps),10);for(var v=0,y=this.hierarchy.length;y>v;v++){l=this.hierarchy[v],h=l.animationCache;for(var _=0;3>_;_++){if(t=u[_],s=h.prevKey[t],a=h.nextKey[t],a.time<=p){if(p>=d){if(!this.loop)return this.stop(),void 0;for(s=this.data.hierarchy[v].keys[0],a=this.getNextKeyWith(t,v,1);null!==a&&a.time<d&&a.index>s.index;)s=a,a=this.getNextKeyWith(t,v,a.index+1)}else do s=a,a=this.getNextKeyWith(t,v,a.index+1);while(null!==a&&a.time<d&&a.index>s.index);h.prevKey[t]=s,h.nextKey[t]=a}l.matrixAutoUpdate=!0,l.matrixWorldNeedsUpdate=!0,i=(d-s.time)/(a.time-s.time),r=s[t],o=a[t],(0>i||i>1)&&(console.log("THREE.Animation.update: Warning! Scale out of bounds:"+i+" on bone "+v),i=0>i?0:1),"pos"===t?(n=l.position,this.interpolationType===THREE.AnimationHandler.LINEAR?(n.x=r[0]+(o[0]-r[0])*i,n.y=r[1]+(o[1]-r[1])*i,n.z=r[2]+(o[2]-r[2])*i):(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)&&(this.points[0]=this.getPrevKeyWith("pos",v,s.index-1).pos,this.points[1]=r,this.points[2]=o,this.points[3]=this.getNextKeyWith("pos",v,a.index+1).pos,i=.33*i+.33,f=this.interpolateCatmullRom(this.points,i),n.x=f[0],n.y=f[1],n.z=f[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(m=this.interpolateCatmullRom(this.points,1.01*i),this.target.set(m[0],m[1],m[2]),this.target.sub(n),this.target.y=0,this.target.normalize(),g=Math.atan2(this.target.x,this.target.z),l.rotation.set(0,g,0)))):"rot"===t?THREE.Quaternion.slerp(r,o,l.quaternion,i):"scl"===t&&(n=l.scale,n.x=r[0]+(o[0]-r[0])*i,n.y=r[1]+(o[1]-r[1])*i,n.z=r[2]+(o[2]-r[2])*i)}}}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var i,n,r,o,s,a,l,h,c,u=[],d=[];return i=(e.length-1)*t,n=Math.floor(i),r=i-n,u[0]=0===n?n:n-1,u[1]=n,u[2]=n>e.length-2?n:n+1,u[3]=n>e.length-3?n:n+2,a=e[u[0]],l=e[u[1]],h=e[u[2]],c=e[u[3]],o=r*r,s=r*o,d[0]=this.interpolate(a[0],l[0],h[0],c[0],r,o,s),d[1]=this.interpolate(a[1],l[1],h[1],c[1],r,o,s),d[2]=this.interpolate(a[2],l[2],h[2],c[2],r,o,s),d},THREE.Animation.prototype.interpolate=function(e,t,i,n,r,o,s){var a=.5*(i-e),l=.5*(n-t);return(2*(t-i)+a+l)*s+(-3*(t-i)-2*a-l)*o+a*r+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i=i<n.length-1?i:n.length-1:i%=n.length;i<n.length;i++)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?i>0?i:0:i>=0?i:i+n.length;i>=0;i--)if(void 0!==n[i][e])return n[i];return this.data.hierarchy[t].keys[n.length-1]},THREE.KeyFrameAnimation=function(e,t,i){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.isPaused=!0,this.loop=!0,this.JITCompile=void 0!==i?i:!0;for(var n=0,r=this.hierarchy.length;r>n;n++){var o=this.data.hierarchy[n].keys,s=this.data.hierarchy[n].sids,a=this.hierarchy[n];if(o.length&&s){for(var l=0;l<s.length;l++){var h=s[l],c=this.getNextKeyWith(h,n,0);c&&c.apply(h)}a.matrixAutoUpdate=!1,this.data.hierarchy[n].node.updateMatrix(),a.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e,t){if(!this.isPlaying){this.isPlaying=!0,this.loop=void 0!==e?e:!0,this.currentTime=void 0!==t?t:0,this.startTimeMs=t,this.startTime=1e7,this.endTime=-this.startTime;var i,n,r,o=this.hierarchy.length;for(i=0;o>i;i++){n=this.hierarchy[i],r=this.data.hierarchy[i],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var s=this.data.hierarchy[i].keys;s.length&&(r.animationCache.prevKey=s[0],r.animationCache.nextKey=s[1],this.startTime=Math.min(s[0].time,this.startTime),this.endTime=Math.max(s[s.length-1].time,this.endTime))}this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPlaying=!1,this.isPaused=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],i=this.data.hierarchy[e];if(void 0!==i.animationCache){var n=i.animationCache.originalMatrix;t instanceof THREE.Bone?(n.copy(t.skinMatrix),t.skinMatrix=n):(n.copy(t.matrix),t.matrix=n),delete i.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(this.isPlaying){var t,i,n,r,o,s,a,l,h=this.data.JIT.hierarchy;if(this.currentTime+=e*this.timeScale,a=this.currentTime,s=this.currentTime=this.currentTime%this.data.length,s<this.startTimeMs&&(s=this.currentTime=this.startTimeMs+s),o=parseInt(Math.min(s*this.data.fps,this.data.length*this.data.fps),10),l=a>s,l&&!this.loop){for(var c=0,u=this.hierarchy.length;u>c;c++){var d=this.data.hierarchy[c].keys,p=this.data.hierarchy[c].sids,f=d.length-1,m=this.hierarchy[c];if(d.length){for(var g=0;g<p.length;g++){var v=p[g],y=this.getPrevKeyWith(v,c,f);y&&y.apply(v)}this.data.hierarchy[c].node.updateMatrix(),m.matrixWorldNeedsUpdate=!0}}return this.stop(),void 0}if(!(s<this.startTime)){for(var c=0,u=this.hierarchy.length;u>c;c++){n=this.hierarchy[c],r=this.data.hierarchy[c];var d=r.keys,_=r.animationCache;if(this.JITCompile&&void 0!==h[c][o])n instanceof THREE.Bone?(n.skinMatrix=h[c][o],n.matrixWorldNeedsUpdate=!1):(n.matrix=h[c][o],n.matrixWorldNeedsUpdate=!0);else if(d.length){if(this.JITCompile&&_&&(n instanceof THREE.Bone?n.skinMatrix=_.originalMatrix:n.matrix=_.originalMatrix),t=_.prevKey,i=_.nextKey,t&&i){if(i.time<=a){if(l&&this.loop)for(t=d[0],i=d[1];i.time<s;)t=i,i=d[t.index+1];else if(!l)for(var b=d.length-1;i.time<s&&i.index!==b;)t=i,i=d[t.index+1];_.prevKey=t,_.nextKey=i}i.time>=s?t.interpolate(i,s):t.interpolate(i,i.time)}this.data.hierarchy[c].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}if(this.JITCompile&&void 0===h[0][o]){this.hierarchy[0].updateMatrixWorld(!0);for(var c=0;c<this.hierarchy.length;c++)h[c][o]=this.hierarchy[c]instanceof THREE.Bone?this.hierarchy[c].skinMatrix.clone():this.hierarchy[c].matrix.clone()}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i%=n.length;i<n.length;i++)if(n[i].hasTarget(e))return n[i];return n[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,i){var n=this.data.hierarchy[t].keys;for(i=i>=0?i:i+n.length;i>=0;i--)if(n[i].hasTarget(e))return n[i];return n[n.length-1]},THREE.CubeCamera=function(e,t,i){THREE.Object3D.call(this);var n=90,r=1,o=new THREE.PerspectiveCamera(n,r,e,t);o.up.set(0,-1,0),o.lookAt(new THREE.Vector3(1,0,0)),this.add(o);var s=new THREE.PerspectiveCamera(n,r,e,t);s.up.set(0,-1,0),s.lookAt(new THREE.Vector3(-1,0,0)),this.add(s);var a=new THREE.PerspectiveCamera(n,r,e,t);a.up.set(0,0,1),a.lookAt(new THREE.Vector3(0,1,0)),this.add(a);var l=new THREE.PerspectiveCamera(n,r,e,t);l.up.set(0,0,-1),l.lookAt(new THREE.Vector3(0,-1,0)),this.add(l);var h=new THREE.PerspectiveCamera(n,r,e,t);h.up.set(0,-1,0),h.lookAt(new THREE.Vector3(0,0,1)),this.add(h);var c=new THREE.PerspectiveCamera(n,r,e,t);c.up.set(0,-1,0),c.lookAt(new THREE.Vector3(0,0,-1)),this.add(c),this.renderTarget=new THREE.WebGLRenderTargetCube(i,i,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var i=this.renderTarget,n=i.generateMipmaps;i.generateMipmaps=!1,i.activeCubeFace=0,e.render(t,o,i),i.activeCubeFace=1,e.render(t,s,i),i.activeCubeFace=2,e.render(t,a,i),i.activeCubeFace=3,e.render(t,l,i),i.activeCubeFace=4,e.render(t,h,i),i.generateMipmaps=n,i.activeCubeFace=5,e.render(t,c,i)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,i,n,r,o,s){THREE.Camera.call(this),this.fov=i,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,o,s),this.cameraP=new THREE.PerspectiveCamera(i,e/t,n,r),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.fov,t=this.cameraP.aspect,i=this.cameraP.near,n=this.cameraP.far,r=(i+n)/2,o=Math.tan(e/2)*r,s=2*o,a=s*t,l=a/2;o/=this.zoom,l/=this.zoom,this.cameraO.left=-l,this.cameraO.right=l,this.cameraO.top=o,this.cameraO.bottom=-o,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var i=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(i),i},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CircleGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=i=void 0!==i?i:0,this.thetaLength=n=void 0!==n?n:2*Math.PI;var r,o=[],s=new THREE.Vector3,a=new THREE.Vector2(.5,.5);for(this.vertices.push(s),o.push(a),r=0;t>=r;r++){var l=new THREE.Vector3,h=i+r/t*n;l.x=e*Math.cos(h),l.y=e*Math.sin(h),this.vertices.push(l),o.push(new THREE.Vector2((l.x/e+1)/2,(l.y/e+1)/2))}var c=new THREE.Vector3(0,0,1);for(r=1;t>=r;r++){var u=r,d=r+1,p=0;this.faces.push(new THREE.Face3(u,d,p,[c.clone(),c.clone(),c.clone()])),this.faceVertexUvs[0].push([o[r].clone(),o[r+1].clone(),a.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=function(e,t,i,n,r,o){function s(e,t,i,n,r,o,s,l){var h,c,u,d=a.widthSegments,p=a.heightSegments,f=r/2,m=o/2,g=a.vertices.length;"x"===e&&"y"===t||"y"===e&&"x"===t?h="z":"x"===e&&"z"===t||"z"===e&&"x"===t?(h="y",p=a.depthSegments):("z"===e&&"y"===t||"y"===e&&"z"===t)&&(h="x",d=a.depthSegments);var v=d+1,y=p+1,_=r/d,b=o/p,E=new THREE.Vector3;for(E[h]=s>0?1:-1,u=0;y>u;u++)for(c=0;v>c;c++){var x=new THREE.Vector3;x[e]=(c*_-f)*i,x[t]=(u*b-m)*n,x[h]=s,a.vertices.push(x)}for(u=0;p>u;u++)for(c=0;d>c;c++){var T=c+v*u,w=c+v*(u+1),R=c+1+v*(u+1),S=c+1+v*u,C=new THREE.Vector2(c/d,1-u/p),H=new THREE.Vector2(c/d,1-(u+1)/p),M=new THREE.Vector2((c+1)/d,1-(u+1)/p),k=new THREE.Vector2((c+1)/d,1-u/p),A=new THREE.Face3(T+g,w+g,S+g);A.normal.copy(E),A.vertexNormals.push(E.clone(),E.clone(),E.clone()),A.materialIndex=l,a.faces.push(A),a.faceVertexUvs[0].push([C,H,k]),A=new THREE.Face3(w+g,R+g,S+g),A.normal.copy(E),A.vertexNormals.push(E.clone(),E.clone(),E.clone()),A.materialIndex=l,a.faces.push(A),a.faceVertexUvs[0].push([H.clone(),M,k.clone()])}}THREE.Geometry.call(this);var a=this;this.width=e,this.height=t,this.depth=i,this.widthSegments=n||1,this.heightSegments=r||1,this.depthSegments=o||1;var l=this.width/2,h=this.height/2,c=this.depth/2;s("z","y",-1,-1,this.depth,this.height,l,0),s("z","y",1,-1,this.depth,this.height,-l,1),s("x","z",1,1,this.width,this.depth,h,2),s("x","z",1,-1,this.width,this.depth,-h,3),s("x","y",1,-1,this.width,this.height,c,4),s("x","y",-1,-1,this.width,this.height,-c,5),this.computeCentroids(),this.mergeVertices()},THREE.CubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CylinderGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=i=void 0!==i?i:100,this.radialSegments=n=n||8,this.heightSegments=r=r||1,this.openEnded=o=void 0!==o?o:!1;var s,a,l=i/2,h=[],c=[];for(a=0;r>=a;a++){var u=[],d=[],p=a/r,f=p*(t-e)+e;for(s=0;n>=s;s++){var m=s/n,g=new THREE.Vector3;g.x=f*Math.sin(2*m*Math.PI),g.y=-p*i+l,g.z=f*Math.cos(2*m*Math.PI),this.vertices.push(g),u.push(this.vertices.length-1),d.push(new THREE.Vector2(m,1-p))}h.push(u),c.push(d)}var v,y,_=(t-e)/i;for(s=0;n>s;s++)for(0!==e?(v=this.vertices[h[0][s]].clone(),y=this.vertices[h[0][s+1]].clone()):(v=this.vertices[h[1][s]].clone(),y=this.vertices[h[1][s+1]].clone()),v.setY(Math.sqrt(v.x*v.x+v.z*v.z)*_).normalize(),y.setY(Math.sqrt(y.x*y.x+y.z*y.z)*_).normalize(),a=0;r>a;a++){var b=h[a][s],E=h[a+1][s],x=h[a+1][s+1],T=h[a][s+1],w=v.clone(),R=v.clone(),S=y.clone(),C=y.clone(),H=c[a][s].clone(),M=c[a+1][s].clone(),k=c[a+1][s+1].clone(),A=c[a][s+1].clone();this.faces.push(new THREE.Face3(b,E,T,[w,R,C])),this.faceVertexUvs[0].push([H,M,A]),this.faces.push(new THREE.Face3(E,x,T,[R.clone(),S,C.clone()])),this.faceVertexUvs[0].push([M.clone(),k,A.clone()])}if(o===!1&&e>0)for(this.vertices.push(new THREE.Vector3(0,l,0)),s=0;n>s;s++){var b=h[0][s],E=h[0][s+1],x=this.vertices.length-1,w=new THREE.Vector3(0,1,0),R=new THREE.Vector3(0,1,0),S=new THREE.Vector3(0,1,0),H=c[0][s].clone(),M=c[0][s+1].clone(),k=new THREE.Vector2(M.x,0);this.faces.push(new THREE.Face3(b,E,x,[w,R,S])),this.faceVertexUvs[0].push([H,M,k])}if(o===!1&&t>0)for(this.vertices.push(new THREE.Vector3(0,-l,0)),s=0;n>s;s++){var b=h[a][s+1],E=h[a][s],x=this.vertices.length-1,w=new THREE.Vector3(0,-1,0),R=new THREE.Vector3(0,-1,0),S=new THREE.Vector3(0,-1,0),H=c[a][s+1].clone(),M=c[a][s].clone(),k=new THREE.Vector2(M.x,1);this.faces.push(new THREE.Face3(b,E,x,[w,R,S])),this.faceVertexUvs[0].push([H,M,k])}this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){return"undefined"==typeof e?(e=[],void 0):(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals(),void 0)},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var i=e.length,n=0;i>n;n++){var r=e[n];this.addShape(r,t)}},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function i(e,t,i){return t||console.log("die"),t.clone().multiplyScalar(i).add(e)}function n(e,t,i){return o(e,t,i)}function r(e,t,i){var n=Math.atan2(t.y-e.y,t.x-e.x),r=Math.atan2(i.y-e.y,i.x-e.x);n>r&&(r+=2*Math.PI);var o=(n+r)/2,s=-Math.cos(o),a=-Math.sin(o),l=new THREE.Vector2(s,a);return l}function o(e,t,i){var n,o,s,a,l,h,c=THREE.ExtrudeGeometry.__v1,u=THREE.ExtrudeGeometry.__v2,d=THREE.ExtrudeGeometry.__v3,p=THREE.ExtrudeGeometry.__v4,f=THREE.ExtrudeGeometry.__v5,m=THREE.ExtrudeGeometry.__v6;return c.set(e.x-t.x,e.y-t.y),u.set(e.x-i.x,e.y-i.y),n=c.normalize(),o=u.normalize(),d.set(-n.y,n.x),p.set(o.y,-o.x),f.copy(e).add(d),m.copy(e).add(p),f.equals(m)?p.clone():(f.copy(t).add(d),m.copy(i).add(p),s=n.dot(p),a=m.sub(f).dot(p),0===s&&(console.log("Either infinite or no solutions!"),0===a?console.log("Its finite solutions."):console.log("Too bad, no solutions.")),l=a/s,0>l?r(e,t,i):(h=n.multiplyScalar(l).add(f),h.sub(e).clone()))}function s(){if(v){var e=0,t=G*e;for(Y=0;q>Y;Y++)$=I[Y],c($[2]+t,$[1]+t,$[0]+t,!0);for(e=_+2*g,t=G*e,Y=0;q>Y;Y++)$=I[Y],c($[0]+t,$[1]+t,$[2]+t,!1)}else{for(Y=0;q>Y;Y++)$=I[Y],c($[2],$[1],$[0],!0);for(Y=0;q>Y;Y++)$=I[Y],c($[0]+G*_,$[1]+G*_,$[2]+G*_,!1)}}function a(){var e=0;for(l(O,e),e+=O.length,k=0,A=z.length;A>k;k++)M=z[k],l(M,e),e+=M.length}function l(e,t){var i,n;for(Y=e.length;--Y>=0;){i=Y,n=Y-1,0>n&&(n=e.length-1);var r=0,o=_+2*g;for(r=0;o>r;r++){var s=G*r,a=G*(r+1),l=t+i+s,h=t+n+s,c=t+n+a,d=t+i+a;u(l,h,c,d,e,r,o,i,n)}}}function h(e,t,i){P.vertices.push(new THREE.Vector3(e,t,i))}function c(i,n,r,o){i+=F,n+=F,r+=F,P.faces.push(new THREE.Face3(i,n,r,null,null,x));var s=o?w.generateBottomUV(P,e,t,i,n,r):w.generateTopUV(P,e,t,i,n,r);P.faceVertexUvs[0].push(s)}function u(i,n,r,o,s,a,l,h,c){i+=F,n+=F,r+=F,o+=F,P.faces.push(new THREE.Face3(i,n,o,null,null,T)),P.faces.push(new THREE.Face3(n,r,o,null,null,T));var u=w.generateSideWallUV(P,e,s,t,i,n,r,o,a,l,h,c);P.faceVertexUvs[0].push([u[0],u[1],u[3]]),P.faceVertexUvs[0].push([u[1],u[2],u[3]])}var d,p=void 0!==t.amount?t.amount:100,f=void 0!==t.bevelThickness?t.bevelThickness:6,m=void 0!==t.bevelSize?t.bevelSize:f-2,g=void 0!==t.bevelSegments?t.bevelSegments:3,v=void 0!==t.bevelEnabled?t.bevelEnabled:!0,y=void 0!==t.curveSegments?t.curveSegments:12,_=void 0!==t.steps?t.steps:1,b=t.extrudePath,E=!1,x=t.material,T=t.extrudeMaterial,w=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator;this.shapebb;var R,S,C,H;b&&(d=b.getSpacedPoints(_),E=!0,v=!1,R=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(b,_,!1),S=new THREE.Vector3,C=new THREE.Vector3,H=new THREE.Vector3),v||(g=0,f=0,m=0);var M,k,A,P=this,F=this.vertices.length,D=e.extractPoints(y),N=D.shape,z=D.holes,L=!THREE.Shape.Utils.isClockWise(N);if(L){for(N=N.reverse(),k=0,A=z.length;A>k;k++)M=z[k],THREE.Shape.Utils.isClockWise(M)&&(z[k]=M.reverse());L=!1}var I=THREE.Shape.Utils.triangulateShape(N,z),O=N;for(k=0,A=z.length;A>k;k++)M=z[k],N=N.concat(M);var V,B,U,j,W,$,G=N.length,q=I.length;O.length,180/Math.PI;for(var X=[],Y=0,K=O.length,Q=K-1,J=Y+1;K>Y;Y++,Q++,J++)Q===K&&(Q=0),J===K&&(J=0),O[Y],O[Q],O[J],X[Y]=n(O[Y],O[Q],O[J]);var Z,et=[],tt=X.concat();for(k=0,A=z.length;A>k;k++){for(M=z[k],Z=[],Y=0,K=M.length,Q=K-1,J=Y+1;K>Y;Y++,Q++,J++)Q===K&&(Q=0),J===K&&(J=0),Z[Y]=n(M[Y],M[Q],M[J]);et.push(Z),tt=tt.concat(Z)}for(V=0;g>V;V++){for(U=V/g,j=f*(1-U),B=m*Math.sin(U*Math.PI/2),Y=0,K=O.length;K>Y;Y++)W=i(O[Y],X[Y],B),h(W.x,W.y,-j);for(k=0,A=z.length;A>k;k++)for(M=z[k],Z=et[k],Y=0,K=M.length;K>Y;Y++)W=i(M[Y],Z[Y],B),h(W.x,W.y,-j)}for(B=m,Y=0;G>Y;Y++)W=v?i(N[Y],tt[Y],B):N[Y],E?(C.copy(R.normals[0]).multiplyScalar(W.x),S.copy(R.binormals[0]).multiplyScalar(W.y),H.copy(d[0]).add(C).add(S),h(H.x,H.y,H.z)):h(W.x,W.y,0);var it;for(it=1;_>=it;it++)for(Y=0;G>Y;Y++)W=v?i(N[Y],tt[Y],B):N[Y],E?(C.copy(R.normals[it]).multiplyScalar(W.x),S.copy(R.binormals[it]).multiplyScalar(W.y),H.copy(d[it]).add(C).add(S),h(H.x,H.y,H.z)):h(W.x,W.y,p/_*it);for(V=g-1;V>=0;V--){for(U=V/g,j=f*(1-U),B=m*Math.sin(U*Math.PI/2),Y=0,K=O.length;K>Y;Y++)W=i(O[Y],X[Y],B),h(W.x,W.y,p+j);for(k=0,A=z.length;A>k;k++)for(M=z[k],Z=et[k],Y=0,K=M.length;K>Y;Y++)W=i(M[Y],Z[Y],B),E?h(W.x,W.y+d[_-1].y,d[_-1].x+j):h(W.x,W.y,p+j)}s(),a()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,i,n,r,o){var s=e.vertices[n].x,a=e.vertices[n].y,l=e.vertices[r].x,h=e.vertices[r].y,c=e.vertices[o].x,u=e.vertices[o].y;return[new THREE.Vector2(s,a),new THREE.Vector2(l,h),new THREE.Vector2(c,u)]},generateBottomUV:function(e,t,i,n,r,o){return this.generateTopUV(e,t,i,n,r,o)},generateSideWallUV:function(e,t,i,n,r,o,s,a){var l=e.vertices[r].x,h=e.vertices[r].y,c=e.vertices[r].z,u=e.vertices[o].x,d=e.vertices[o].y,p=e.vertices[o].z,f=e.vertices[s].x,m=e.vertices[s].y,g=e.vertices[s].z,v=e.vertices[a].x,y=e.vertices[a].y,_=e.vertices[a].z;return Math.abs(h-d)<.01?[new THREE.Vector2(l,1-c),new THREE.Vector2(u,1-p),new THREE.Vector2(f,1-g),new THREE.Vector2(v,1-_)]:[new THREE.Vector2(h,1-c),new THREE.Vector2(d,1-p),new THREE.Vector2(m,1-g),new THREE.Vector2(y,1-_)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),e instanceof Array==!1&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var i=0,n=e.length;n>i;i++)this.addShape(e[i],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var i=void 0!==t.curveSegments?t.curveSegments:12,n=t.material,r=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator;this.shapebb;var o,s,a,l=this.vertices.length,h=e.extractPoints(i),c=h.shape,u=h.holes,d=!THREE.Shape.Utils.isClockWise(c);if(d){for(c=c.reverse(),o=0,s=u.length;s>o;o++)a=u[o],THREE.Shape.Utils.isClockWise(a)&&(u[o]=a.reverse());d=!1}var p=THREE.Shape.Utils.triangulateShape(c,u),f=c;for(o=0,s=u.length;s>o;o++)a=u[o],c=c.concat(a);var m,g,v=c.length,y=p.length;for(f.length,o=0;v>o;o++)m=c[o],this.vertices.push(new THREE.Vector3(m.x,m.y,0));for(o=0;y>o;o++){g=p[o];var _=g[0]+l,b=g[1]+l,E=g[2]+l;this.faces.push(new THREE.Face3(_,b,E,null,null,n)),this.faceVertexUvs[0].push(r.generateBottomUV(this,e,t,_,b,E))}},THREE.LatheGeometry=function(e,t,i,n){THREE.Geometry.call(this),t=t||12,i=i||0,n=n||2*Math.PI;for(var r=1/(e.length-1),o=1/t,s=0,a=t;a>=s;s++)for(var l=i+s*o*n,h=Math.cos(l),c=Math.sin(l),u=0,d=e.length;d>u;u++){var p=e[u],f=new THREE.Vector3;f.x=h*p.x-c*p.y,f.y=c*p.x+h*p.y,f.z=p.z,this.vertices.push(f)}for(var m=e.length,s=0,a=t;a>s;s++)for(var u=0,d=e.length-1;d>u;u++){var g=u+m*s,v=g,y=g+m,h=g+1+m,_=g+1,b=s*o,E=u*r,x=b+o,T=E+r;this.faces.push(new THREE.Face3(v,y,_)),this.faceVertexUvs[0].push([new THREE.Vector2(b,E),new THREE.Vector2(x,E),new THREE.Vector2(b,T)]),this.faces.push(new THREE.Face3(y,h,_)),this.faceVertexUvs[0].push([new THREE.Vector2(x,E),new THREE.Vector2(x,T),new THREE.Vector2(b,T)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,i,n){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=i||1,this.heightSegments=n||1;var r,o,s=e/2,a=t/2,l=this.widthSegments,h=this.heightSegments,c=l+1,u=h+1,d=this.width/l,p=this.height/h,f=new THREE.Vector3(0,0,1);for(o=0;u>o;o++)for(r=0;c>r;r++){var m=r*d-s,g=o*p-a;this.vertices.push(new THREE.Vector3(m,-g,0))}for(o=0;h>o;o++)for(r=0;l>r;r++){var v=r+c*o,y=r+c*(o+1),_=r+1+c*(o+1),b=r+1+c*o,E=new THREE.Vector2(r/l,1-o/h),x=new THREE.Vector2(r/l,1-(o+1)/h),T=new THREE.Vector2((r+1)/l,1-(o+1)/h),w=new THREE.Vector2((r+1)/l,1-o/h),R=new THREE.Face3(v,y,b);
R.normal.copy(f),R.vertexNormals.push(f.clone(),f.clone(),f.clone()),this.faces.push(R),this.faceVertexUvs[0].push([E,x,w]),R=new THREE.Face3(y,_,b),R.normal.copy(f),R.vertexNormals.push(f.clone(),f.clone(),f.clone()),this.faces.push(R),this.faceVertexUvs[0].push([x.clone(),T,w.clone()])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,i,n,r,o){THREE.Geometry.call(this),e=e||0,t=t||50,r=void 0!==r?r:0,o=void 0!==o?o:2*Math.PI,i=void 0!==i?Math.max(3,i):8,n=void 0!==n?Math.max(3,n):8;var s,a,l=[],h=e,c=(t-e)/n;for(s=0;n>=s;s++){for(a=0;i>=a;a++){var u=new THREE.Vector3,d=r+a/i*o;u.x=h*Math.cos(d),u.y=h*Math.sin(d),this.vertices.push(u),l.push(new THREE.Vector2((u.x/t+1)/2,(u.y/t+1)/2))}h+=c}var p=new THREE.Vector3(0,0,1);for(s=0;n>s;s++){var f=s*i;for(a=0;i>=a;a++){var d=a+f,m=d+s,g=d+i+s,v=d+i+1+s;this.faces.push(new THREE.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()]),m=d+s,g=d+i+1+s,v=d+1+s,this.faces.push(new THREE.Face3(m,g,v,[p.clone(),p.clone(),p.clone()])),this.faceVertexUvs[0].push([l[m].clone(),l[g].clone(),l[v].clone()])}}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,h)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,i,n,r,o,s){THREE.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=i=Math.max(2,Math.floor(i)||6),this.phiStart=n=void 0!==n?n:0,this.phiLength=r=void 0!==r?r:2*Math.PI,this.thetaStart=o=void 0!==o?o:0,this.thetaLength=s=void 0!==s?s:Math.PI;var a,l,h=[],c=[];for(l=0;i>=l;l++){var u=[],d=[];for(a=0;t>=a;a++){var p=a/t,f=l/i,m=new THREE.Vector3;m.x=-e*Math.cos(n+p*r)*Math.sin(o+f*s),m.y=e*Math.cos(o+f*s),m.z=e*Math.sin(n+p*r)*Math.sin(o+f*s),this.vertices.push(m),u.push(this.vertices.length-1),d.push(new THREE.Vector2(p,1-f))}h.push(u),c.push(d)}for(l=0;l<this.heightSegments;l++)for(a=0;a<this.widthSegments;a++){var g=h[l][a+1],v=h[l][a],y=h[l+1][a],_=h[l+1][a+1],b=this.vertices[g].clone().normalize(),E=this.vertices[v].clone().normalize(),x=this.vertices[y].clone().normalize(),T=this.vertices[_].clone().normalize(),w=c[l][a+1].clone(),R=c[l][a].clone(),S=c[l+1][a].clone(),C=c[l+1][a+1].clone();Math.abs(this.vertices[g].y)===this.radius?(w.x=(w.x+R.x)/2,this.faces.push(new THREE.Face3(g,y,_,[b,x,T])),this.faceVertexUvs[0].push([w,S,C])):Math.abs(this.vertices[y].y)===this.radius?(S.x=(S.x+C.x)/2,this.faces.push(new THREE.Face3(g,v,y,[b,E,x])),this.faceVertexUvs[0].push([w,R,S])):(this.faces.push(new THREE.Face3(g,v,_,[b,E,T])),this.faceVertexUvs[0].push([w,R,C]),this.faces.push(new THREE.Face3(v,y,_,[E.clone(),x,T.clone()])),this.faceVertexUvs[0].push([R.clone(),S,C.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var i=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,i,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,i,n,r){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=i||8,this.tubularSegments=n||6,this.arc=r||2*Math.PI;for(var o=new THREE.Vector3,s=[],a=[],l=0;l<=this.radialSegments;l++)for(var h=0;h<=this.tubularSegments;h++){var c=h/this.tubularSegments*this.arc,u=2*l/this.radialSegments*Math.PI;o.x=this.radius*Math.cos(c),o.y=this.radius*Math.sin(c);var d=new THREE.Vector3;d.x=(this.radius+this.tube*Math.cos(u))*Math.cos(c),d.y=(this.radius+this.tube*Math.cos(u))*Math.sin(c),d.z=this.tube*Math.sin(u),this.vertices.push(d),s.push(new THREE.Vector2(h/this.tubularSegments,l/this.radialSegments)),a.push(d.clone().sub(o).normalize())}for(var l=1;l<=this.radialSegments;l++)for(var h=1;h<=this.tubularSegments;h++){var p=(this.tubularSegments+1)*l+h-1,f=(this.tubularSegments+1)*(l-1)+h-1,m=(this.tubularSegments+1)*(l-1)+h,g=(this.tubularSegments+1)*l+h,v=new THREE.Face3(p,f,g,[a[p],a[f],a[g]]);v.normal.add(a[p]),v.normal.add(a[f]),v.normal.add(a[g]),v.normal.normalize(),this.faces.push(v),this.faceVertexUvs[0].push([s[p].clone(),s[f].clone(),s[g].clone()]),v=new THREE.Face3(f,m,g,[a[f],a[m],a[g]]),v.normal.add(a[f]),v.normal.add(a[m]),v.normal.add(a[g]),v.normal.normalize(),this.faces.push(v),this.faceVertexUvs[0].push([s[f].clone(),s[m].clone(),s[g].clone()])}this.computeCentroids()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,i,n,r,o,s){function a(e,t,i,n,r){var o=Math.cos(e),s=Math.sin(e),a=t/i*e,l=Math.cos(a),h=.5*n*(2+l)*o,c=.5*n*(2+l)*s,u=.5*r*n*Math.sin(a);return new THREE.Vector3(h,c,u)}THREE.Geometry.call(this);var l=this;this.radius=e||100,this.tube=t||40,this.radialSegments=i||64,this.tubularSegments=n||8,this.p=r||2,this.q=o||3,this.heightScale=s||1,this.grid=new Array(this.radialSegments);for(var h=new THREE.Vector3,c=new THREE.Vector3,u=new THREE.Vector3,d=0;d<this.radialSegments;++d){this.grid[d]=new Array(this.tubularSegments);var p=2*(d/this.radialSegments)*this.p*Math.PI,f=a(p,this.q,this.p,this.radius,this.heightScale),m=a(p+.01,this.q,this.p,this.radius,this.heightScale);h.subVectors(m,f),c.addVectors(m,f),u.crossVectors(h,c),c.crossVectors(u,h),u.normalize(),c.normalize();for(var g=0;g<this.tubularSegments;++g){var v=2*(g/this.tubularSegments)*Math.PI,y=-this.tube*Math.cos(v),_=this.tube*Math.sin(v),b=new THREE.Vector3;b.x=f.x+y*c.x+_*u.x,b.y=f.y+y*c.y+_*u.y,b.z=f.z+y*c.z+_*u.z,this.grid[d][g]=l.vertices.push(b)-1}}for(var d=0;d<this.radialSegments;++d)for(var g=0;g<this.tubularSegments;++g){var E=(d+1)%this.radialSegments,x=(g+1)%this.tubularSegments,T=this.grid[d][g],w=this.grid[E][g],R=this.grid[E][x],S=this.grid[d][x],C=new THREE.Vector2(d/this.radialSegments,g/this.tubularSegments),H=new THREE.Vector2((d+1)/this.radialSegments,g/this.tubularSegments),M=new THREE.Vector2((d+1)/this.radialSegments,(g+1)/this.tubularSegments),k=new THREE.Vector2(d/this.radialSegments,(g+1)/this.tubularSegments);this.faces.push(new THREE.Face3(T,w,S)),this.faceVertexUvs[0].push([C,H,k]),this.faces.push(new THREE.Face3(w,R,S)),this.faceVertexUvs[0].push([H.clone(),M,k.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,i,n,r){function o(e,t,i){return S.vertices.push(new THREE.Vector3(e,t,i))-1}THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=i||1,this.radialSegments=n||8,this.closed=r||!1,this.grid=[];var s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S=this,C=this.segments+1,H=new THREE.Vector3,M=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),k=M.tangents,A=M.normals,P=M.binormals;for(this.tangents=k,this.normals=A,this.binormals=P,f=0;C>f;f++)for(this.grid[f]=[],h=f/(C-1),p=e.getPointAt(h),s=k[f],a=A[f],l=P[f],m=0;m<this.radialSegments;m++)c=2*(m/this.radialSegments)*Math.PI,u=-this.radius*Math.cos(c),d=this.radius*Math.sin(c),H.copy(p),H.x+=u*a.x+d*l.x,H.y+=u*a.y+d*l.y,H.z+=u*a.z+d*l.z,this.grid[f][m]=o(H.x,H.y,H.z);for(f=0;f<this.segments;f++)for(m=0;m<this.radialSegments;m++)g=this.closed?(f+1)%this.segments:f+1,v=(m+1)%this.radialSegments,y=this.grid[f][m],_=this.grid[g][m],b=this.grid[g][v],E=this.grid[f][v],x=new THREE.Vector2(f/this.segments,m/this.radialSegments),T=new THREE.Vector2((f+1)/this.segments,m/this.radialSegments),w=new THREE.Vector2((f+1)/this.segments,(m+1)/this.radialSegments),R=new THREE.Vector2(f/this.segments,(m+1)/this.radialSegments),this.faces.push(new THREE.Face3(y,_,E)),this.faceVertexUvs[0].push([x,T,R]),this.faces.push(new THREE.Face3(_,b,E)),this.faceVertexUvs[0].push([T.clone(),w,R.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,i){function n(){p[0]=new THREE.Vector3,f[0]=new THREE.Vector3,o=Number.MAX_VALUE,s=Math.abs(d[0].x),a=Math.abs(d[0].y),l=Math.abs(d[0].z),o>=s&&(o=s,u.set(1,0,0)),o>=a&&(o=a,u.set(0,1,0)),o>=l&&u.set(0,0,1),m.crossVectors(d[0],u).normalize(),p[0].crossVectors(d[0],m),f[0].crossVectors(d[0],p[0])}var r,o,s,a,l,h,c,u=(new THREE.Vector3,new THREE.Vector3),d=(new THREE.Vector3,[]),p=[],f=[],m=new THREE.Vector3,g=new THREE.Matrix4,v=t+1,y=1e-4;for(this.tangents=d,this.normals=p,this.binormals=f,h=0;v>h;h++)c=h/(v-1),d[h]=e.getTangentAt(c),d[h].normalize();for(n(),h=1;v>h;h++)p[h]=p[h-1].clone(),f[h]=f[h-1].clone(),m.crossVectors(d[h-1],d[h]),m.length()>y&&(m.normalize(),r=Math.acos(THREE.Math.clamp(d[h-1].dot(d[h]),-1,1)),p[h].applyMatrix4(g.makeRotationAxis(m,r))),f[h].crossVectors(d[h],p[h]);if(i)for(r=Math.acos(THREE.Math.clamp(p[0].dot(p[v-1]),-1,1)),r/=v-1,d[0].dot(m.crossVectors(p[0],p[v-1]))>0&&(r=-r),h=1;v>h;h++)p[h].applyMatrix4(g.makeRotationAxis(d[h],r*h)),f[h].crossVectors(d[h],p[h])},THREE.PolyhedronGeometry=function(e,t,i,n){function r(e){var t=e.normalize().clone();t.index=c.vertices.push(t)-1;var i=a(e)/2/Math.PI+.5,n=l(e)/Math.PI+.5;return t.uv=new THREE.Vector2(i,1-n),t}function o(e,t,i){var n=new THREE.Face3(e.index,t.index,i.index,[e.clone(),t.clone(),i.clone()]);n.centroid.add(e).add(t).add(i).divideScalar(3),c.faces.push(n);var r=a(n.centroid);c.faceVertexUvs[0].push([h(e.uv,e,r),h(t.uv,t,r),h(i.uv,i,r)])}function s(e,t){var i=Math.pow(2,t);Math.pow(4,t);for(var n=r(c.vertices[e.a]),s=r(c.vertices[e.b]),a=r(c.vertices[e.c]),l=[],h=0;i>=h;h++){l[h]=[];for(var u=r(n.clone().lerp(a,h/i)),d=r(s.clone().lerp(a,h/i)),p=i-h,f=0;p>=f;f++)l[h][f]=0==f&&h==i?u:r(u.clone().lerp(d,f/p))}for(var h=0;i>h;h++)for(var f=0;2*(i-h)-1>f;f++){var m=Math.floor(f/2);0==f%2?o(l[h][m+1],l[h+1][m],l[h][m]):o(l[h][m+1],l[h+1][m+1],l[h+1][m])}}function a(e){return Math.atan2(e.z,-e.x)}function l(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}function h(e,t,i){return 0>i&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(i/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),i=i||1,n=n||0;for(var c=this,u=0,d=e.length;d>u;u++)r(new THREE.Vector3(e[u][0],e[u][1],e[u][2]));for(var p=this.vertices,f=[],u=0,d=t.length;d>u;u++){var m=p[t[u][0]],g=p[t[u][1]],v=p[t[u][2]];f[u]=new THREE.Face3(m.index,g.index,v.index,[m.clone(),g.clone(),v.clone()])}for(var u=0,d=f.length;d>u;u++)s(f[u],n);for(var u=0,d=this.faceVertexUvs[0].length;d>u;u++){var y=this.faceVertexUvs[0][u],_=y[0].x,b=y[1].x,E=y[2].x,x=Math.max(_,Math.max(b,E)),T=Math.min(_,Math.min(b,E));x>.9&&.1>T&&(.2>_&&(y[0].x+=1),.2>b&&(y[1].x+=1),.2>E&&(y[2].x+=1))}for(var u=0,d=this.vertices.length;d>u;u++)this.vertices[u].multiplyScalar(i);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,i)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var i=(1+Math.sqrt(5))/2,n=[[-1,i,0],[1,i,0],[-1,-i,0],[1,-i,0],[0,-1,i],[0,1,i],[0,-1,-i],[0,1,-i],[i,0,-1],[i,0,1],[-i,0,-1],[-i,0,1]],r=[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]];THREE.PolyhedronGeometry.call(this,n,r,e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){var i=[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],n=[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]];THREE.PolyhedronGeometry.call(this,i,n,e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){var i=[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],n=[[2,1,0],[0,3,2],[1,3,0],[2,3,1]];THREE.PolyhedronGeometry.call(this,i,n,e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,i){THREE.Geometry.call(this);var n,r,o,s,a,l=this.vertices,h=this.faces,c=this.faceVertexUvs[0],u=t+1;for(n=0;i>=n;n++)for(a=n/i,r=0;t>=r;r++)s=r/t,o=e(s,a),l.push(o);var d,p,f,m,g,v,y,_;for(n=0;i>n;n++)for(r=0;t>r;r++)d=n*u+r,p=n*u+r+1,f=(n+1)*u+r+1,m=(n+1)*u+r,g=new THREE.Vector2(r/t,n/i),v=new THREE.Vector2((r+1)/t,n/i),y=new THREE.Vector2((r+1)/t,(n+1)/i),_=new THREE.Vector2(r/t,(n+1)/i),h.push(new THREE.Face3(d,p,m)),c.push([g,v,_]),h.push(new THREE.Face3(p,f,m)),c.push([v.clone(),y,_.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775));var i=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});THREE.Line.call(this,t,i,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,i,n,r,o){THREE.Object3D.call(this),void 0===n&&(n=16776960),void 0===i&&(i=1),void 0===r&&(r=.2*i),void 0===o&&(o=.2*r),this.position=t;var s=new THREE.Geometry;s.vertices.push(new THREE.Vector3(0,0,0)),s.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(s,new THREE.LineBasicMaterial({color:n})),this.line.matrixAutoUpdate=!1,this.add(this.line);var a=new THREE.CylinderGeometry(0,.5,1,5,1);a.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),this.cone=new THREE.Mesh(a,new THREE.MeshBasicMaterial({color:n})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(i,r,o)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e,t=new THREE.Vector3;return function(i){i.y>.99999?this.quaternion.set(0,0,0,1):i.y<-.99999?this.quaternion.set(1,0,0,0):(t.set(i.z,0,-i.x).normalize(),e=Math.acos(i.y),this.quaternion.setFromAxisAngle(t,e))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,i){void 0===t&&(t=.2*e),void 0===i&&(i=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(i,t,i),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.BoxHelper=function(e){var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=t;var i=new THREE.Geometry;i.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),THREE.Line.call(this,i,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var i=t.boundingBox.min,n=t.boundingBox.max,r=this.vertices;r[0].set(n.x,n.y,n.z),r[1].set(i.x,n.y,n.z),r[2].set(i.x,i.y,n.z),r[3].set(n.x,i.y,n.z),r[4].set(n.x,n.y,i.z),r[5].set(i.x,n.y,i.z),r[6].set(i.x,i.y,i.z),r[7].set(n.x,i.y,i.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var i=t||8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.CubeGeometry(1,1,1),new THREE.MeshBasicMaterial({color:i,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,n){i(e,n),i(t,n)}function i(e,t){n.vertices.push(new THREE.Vector3),n.colors.push(new THREE.Color(t)),void 0===o[e]&&(o[e]=[]),o[e].push(n.vertices.length-1)}var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),o={},s=16755200,a=16711680,l=43775,h=16777215,c=3355443;t("n1","n2",s),t("n2","n4",s),t("n4","n3",s),t("n3","n1",s),t("f1","f2",s),t("f2","f4",s),t("f4","f3",s),t("f3","f1",s),t("n1","f1",s),t("n2","f2",s),t("n3","f3",s),t("n4","f4",s),t("p","n1",a),t("p","n2",a),t("p","n3",a),t("p","n4",a),t("u1","u2",l),t("u2","u3",l),t("u3","u1",l),t("c","t",h),t("p","c",c),t("cn1","cn2",c),t("cn3","cn4",c),t("cf1","cf2",c),t("cf3","cf4",c),THREE.Line.call(this,n,r,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=o,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,i=new THREE.Projector;return function(){function n(n,o,s,a){e.set(o,s,a),i.unprojectVector(e,t);var l=r.pointMap[n];if(void 0!==l)for(var h=0,c=l.length;c>h;h++)r.geometry.vertices[l[h]].copy(e)}var r=this,o=1,s=1;t.projectionMatrix.copy(this.camera.projectionMatrix),n("c",0,0,-1),n("t",0,0,1),n("n1",-o,-s,-1),n("n2",o,-s,-1),n("n3",-o,s,-1),n("n4",o,s,-1),n("f1",-o,-s,1),n("f2",o,-s,1),n("f3",-o,s,1),n("f4",o,s,1),n("u1",.7*o,1.1*s,-1),n("u2",.7*-o,1.1*s,-1),n("u3",0,2*s,-1),n("cf1",-o,0,1),n("cf2",o,0,1),n("cf3",0,-s,1),n("cf4",0,s,1),n("cn1",-o,0,-1),n("cn2",o,0,-1),n("cn3",0,-s,-1),n("cn4",0,s,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var i=new THREE.PlaneGeometry(t,t),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Mesh(i,n),this.add(this.lightPlane),i=new THREE.Geometry,i.vertices.push(new THREE.Vector3),i.vertices.push(new THREE.Vector3),n=new THREE.LineBasicMaterial({fog:!1}),n.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(i,n),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,i=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),i.subVectors(t,e),this.lightPlane.lookAt(i),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(i),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.FaceNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;for(var r=i||16776960,o=n||1,s=new THREE.Geometry,a=this.object.geometry.faces,l=0,h=a.length;h>l;l++)s.vertices.push(new THREE.Vector3),s.vertices.push(new THREE.Vector3);THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var t=this.geometry.vertices,i=this.object.geometry.faces,n=this.object.matrixWorld,r=0,o=i.length;o>r;r++){var s=i[r];e.copy(s.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var a=2*r;t[a].copy(s.centroid).applyMatrix4(n),t[a+1].addVectors(t[a],e)}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var i=new THREE.Geometry,n=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var r=-e;e>=r;r+=t){i.vertices.push(new THREE.Vector3(-e,0,r),new THREE.Vector3(e,0,r),new THREE.Vector3(r,0,-e),new THREE.Vector3(r,0,e));var o=0===r?this.color1:this.color2;i.colors.push(o,o,o,o)}THREE.Line.call(this,i,n,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color];var i=new THREE.SphereGeometry(t,4,2);i.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(var n=0,r=8;r>n;n++)i.faces[n].color=this.colors[4>n?0:1];var o=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0});this.lightSphere=new THREE.Mesh(i,o),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var i=new THREE.SphereGeometry(t,4,2),n=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});n.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,i,n),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1;var t=new THREE.CylinderGeometry(0,1,1,8,1,!0);t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-.5,0)),t.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var i=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(t,i),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var i=this.light.distance?this.light.distance:1e4,n=i*Math.tan(this.light.angle);this.cone.scale.set(n,n,i),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,i,n){this.object=e,this.size=t||1;var r=i||16711680,o=n||1,s=new THREE.Geometry;e.geometry.vertices;for(var a=e.geometry.faces,l=0,h=a.length;h>l;l++)for(var c=a[l],u=0,d=c.vertexNormals.length;d>u;u++)s.vertices.push(new THREE.Vector3),s.vertices.push(new THREE.Vector3);THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,r=this.object.geometry.faces,o=this.object.matrixWorld,s=0,a=0,l=r.length;l>a;a++)for(var h=r[a],c=0,u=h.vertexNormals.length;u>c;c++){var d=h[t[c]],p=n[d],f=h.vertexNormals[c];i[s].copy(p).applyMatrix4(o),e.copy(f).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),e.add(i[s]),s+=1,i[s].copy(e),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,i,n){this.object=e,this.size=t||1;var r=i||255,o=n||1,s=new THREE.Geometry;e.geometry.vertices;for(var a=e.geometry.faces,l=0,h=a.length;h>l;l++)for(var c=a[l],u=0,d=c.vertexTangents.length;d>u;u++)s.vertices.push(new THREE.Vector3),s.vertices.push(new THREE.Vector3);THREE.Line.call(this,s,new THREE.LineBasicMaterial({color:r,linewidth:o}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){var t=["a","b","c","d"];this.object.updateMatrixWorld(!0);for(var i=this.geometry.vertices,n=this.object.geometry.vertices,r=this.object.geometry.faces,o=this.object.matrixWorld,s=0,a=0,l=r.length;l>a;a++)for(var h=r[a],c=0,u=h.vertexTangents.length;u>c;c++){var d=h[t[c]],p=n[d],f=h.vertexTangents[c];i[s].copy(p).applyMatrix4(o),e.copy(f).transformDirection(o).multiplyScalar(this.size),e.add(i[s]),s+=1,i[s].copy(e),s+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e){var t=[0,0],i={},n=function(e,t){return e-t},r=["a","b","c","d"],o=new THREE.BufferGeometry,s=0;if(e.geometry instanceof THREE.Geometry){for(var a=e.geometry.vertices,l=e.geometry.faces,h=new Uint32Array(6*l.length),c=0,u=l.length;u>c;c++)for(var d=l[c],p=0;3>p;p++){t[0]=d[r[p]],t[1]=d[r[(p+1)%3]],t.sort(n);var f=t.toString();void 0===i[f]&&(h[2*s]=t[0],h[2*s+1]=t[1],i[f]=!0,s++)}o.addAttribute("position",Float32Array,2*s,3);for(var m=o.attributes.position.array,c=0,u=s;u>c;c++)for(var p=0;2>p;p++){var g=a[h[2*c+p]],v=6*c+3*p;m[v+0]=g.x,m[v+1]=g.y,m[v+2]=g.z}}else{for(var a=e.geometry.attributes.position.array,l=e.geometry.attributes.index.array,h=new Uint32Array(2*l.length),c=0,u=l.length/3;u>c;c++)for(var p=0;3>p;p++){var v=3*c;t[0]=l[v+p],t[1]=l[v+(p+1)%3],t.sort(n);var f=t.toString();void 0===i[f]&&(h[2*s]=t[0],h[2*s+1]=t[1],i[f]=!0,s++)}o.addAttribute("position",Float32Array,2*s,3);for(var m=o.attributes.position.array,c=0,u=s;u>c;c++)for(var p=0;2>p;p++){var v=6*c+3*p,y=3*h[2*c+p];m[v+0]=a[y],m[v+1]=a[y+1],m[v+2]=a[y+2]}}THREE.Line.call(this,o,new THREE.LineBasicMaterial({color:16777215}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,i,n,r){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,i,n,r)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,i,n,r,o){void 0===t&&(t=-1),void 0===i&&(i=0),void 0===o&&(o=1),void 0===r&&(r=new THREE.Color(16777215)),void 0===n&&(n=THREE.NormalBlending),i=Math.min(i,Math.max(0,i)),this.lensFlares.push({texture:e,size:t,distance:i,x:0,y:0,z:0,scale:1,rotation:1,opacity:o,color:r,blending:n})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t,i=this.lensFlares.length,n=2*-this.positionScreen.x,r=2*-this.positionScreen.y;for(e=0;i>e;e++)t=this.lensFlares[e],t.x=this.positionScreen.x+n*t.distance,t.y=this.positionScreen.y+r*t.distance,t.wantedRotation=.25*t.x*Math.PI,t.rotation+=.25*(t.wantedRotation-t.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var i=this.geometry.morphTargets.length,n="__default",r=0,o=i-1,s=i/1;this.createAnimation(n,r,o,s),this.setAnimationWeight(n,1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,i,n){var r={startFrame:t,endFrame:i,length:i-t+1,fps:n,duration:(i-t)/n,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1};this.animationsMap[e]=r,this.animationsList.push(r)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t,i=/([a-z]+)(\d+)/,n={},r=this.geometry,o=0,s=r.morphTargets.length;s>o;o++){var a=r.morphTargets[o],l=a.name.match(i);if(l&&l.length>1){var h=l[1];l[2],n[h]||(n[h]={start:1/0,end:-1/0});var c=n[h];o<c.start&&(c.start=o),o>c.end&&(c.end=o),t||(t=h)}}for(var h in n){var c=n[h];this.createAnimation(h,c.start,c.end,e)}this.firstAnimation=t},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){var t=this.animationsMap[e];t&&(t.direction=1,t.directionBackwards=!1)},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){var t=this.animationsMap[e];t&&(t.direction=-1,t.directionBackwards=!0)},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var i=this.animationsMap[e];i&&(i.fps=t,i.duration=(i.end-i.start)/i.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var i=this.animationsMap[e];i&&(i.duration=t,i.fps=(i.end-i.start)/i.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var i=this.animationsMap[e];i&&(i.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var i=this.animationsMap[e];i&&(i.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0,i=this.animationsMap[e];return i&&(t=i.time),t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1,i=this.animationsMap[e];return i&&(t=i.duration),t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){var t=this.animationsMap[e];t&&(t.active=!1)},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,i=this.animationsList.length;i>t;t++){var n=this.animationsList[t];if(n.active){var r=n.duration/n.length;n.time+=n.direction*e,n.mirroredLoop?(n.time>n.duration||n.time<0)&&(n.direction*=-1,n.time>n.duration&&(n.time=n.duration,n.directionBackwards=!0),n.time<0&&(n.time=0,n.directionBackwards=!1)):(n.time=n.time%n.duration,n.time<0&&(n.time+=n.duration));var o=n.startFrame+THREE.Math.clamp(Math.floor(n.time/r),0,n.length-1),s=n.weight;o!==n.currentFrame&&(this.morphTargetInfluences[n.lastFrame]=0,this.morphTargetInfluences[n.currentFrame]=1*s,this.morphTargetInfluences[o]=0,n.lastFrame=n.currentFrame,n.currentFrame=o);var a=n.time%r/r;n.directionBackwards&&(a=1-a),this.morphTargetInfluences[n.currentFrame]=a*s,this.morphTargetInfluences[n.lastFrame]=(1-a)*s}}},THREE.LensFlarePlugin=function(){function e(e,i){var n=t.createProgram(),r=t.createShader(t.FRAGMENT_SHADER),o=t.createShader(t.VERTEX_SHADER),s="precision "+i+" float;\n";return t.shaderSource(r,s+e.fragmentShader),t.shaderSource(o,s+e.vertexShader),t.compileShader(r),t.compileShader(o),t.attachShader(n,r),t.attachShader(n,o),t.linkProgram(n),n
}var t,i,n,r={};this.init=function(o){t=o.context,i=o,n=o.getPrecision(),r.vertices=new Float32Array(16),r.faces=new Uint16Array(6);var s=0;r.vertices[s++]=-1,r.vertices[s++]=-1,r.vertices[s++]=0,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=1,r.vertices[s++]=-1,r.vertices[s++]=1,r.vertices[s++]=0,r.vertices[s++]=1,s=0,r.faces[s++]=0,r.faces[s++]=1,r.faces[s++]=2,r.faces[s++]=0,r.faces[s++]=2,r.faces[s++]=3,r.vertexBuffer=t.createBuffer(),r.elementBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,r.vertexBuffer),t.bufferData(t.ARRAY_BUFFER,r.vertices,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.elementBuffer),t.bufferData(t.ELEMENT_ARRAY_BUFFER,r.faces,t.STATIC_DRAW),r.tempTexture=t.createTexture(),r.occlusionTexture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,r.occlusionTexture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)<=0?(r.hasVertexTexture=!1,r.program=e(THREE.ShaderFlares.lensFlare,n)):(r.hasVertexTexture=!0,r.program=e(THREE.ShaderFlares.lensFlareVertexTexture,n)),r.attributes={},r.uniforms={},r.attributes.vertex=t.getAttribLocation(r.program,"position"),r.attributes.uv=t.getAttribLocation(r.program,"uv"),r.uniforms.renderType=t.getUniformLocation(r.program,"renderType"),r.uniforms.map=t.getUniformLocation(r.program,"map"),r.uniforms.occlusionMap=t.getUniformLocation(r.program,"occlusionMap"),r.uniforms.opacity=t.getUniformLocation(r.program,"opacity"),r.uniforms.color=t.getUniformLocation(r.program,"color"),r.uniforms.scale=t.getUniformLocation(r.program,"scale"),r.uniforms.rotation=t.getUniformLocation(r.program,"rotation"),r.uniforms.screenPosition=t.getUniformLocation(r.program,"screenPosition")},this.render=function(e,n,o,s){var a=e.__webglFlares,l=a.length;if(l){var h=new THREE.Vector3,c=s/o,u=.5*o,d=.5*s,p=16/s,f=new THREE.Vector2(p*c,p),m=new THREE.Vector3(1,1,0),g=new THREE.Vector2(1,1),v=r.uniforms,y=r.attributes;t.useProgram(r.program),t.enableVertexAttribArray(r.attributes.vertex),t.enableVertexAttribArray(r.attributes.uv),t.uniform1i(v.occlusionMap,0),t.uniform1i(v.map,1),t.bindBuffer(t.ARRAY_BUFFER,r.vertexBuffer),t.vertexAttribPointer(y.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(y.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r.elementBuffer),t.disable(t.CULL_FACE),t.depthMask(!1);var _,b,E,x,T;for(_=0;l>_;_++)if(p=16/s,f.set(p*c,p),x=a[_],h.set(x.matrixWorld.elements[12],x.matrixWorld.elements[13],x.matrixWorld.elements[14]),h.applyMatrix4(n.matrixWorldInverse),h.applyProjection(n.projectionMatrix),m.copy(h),g.x=m.x*u+u,g.y=m.y*d+d,r.hasVertexTexture||g.x>0&&g.x<o&&g.y>0&&g.y<s)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,g.x-8,g.y-8,16,16,0),t.uniform1i(v.renderType,0),t.uniform2f(v.scale,f.x,f.y),t.uniform3f(v.screenPosition,m.x,m.y,m.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,r.occlusionTexture),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,g.x-8,g.y-8,16,16,0),t.uniform1i(v.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,r.tempTexture),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),x.positionScreen.copy(m),x.customUpdateCallback?x.customUpdateCallback(x):x.updateLensFlares(),t.uniform1i(v.renderType,2),t.enable(t.BLEND),b=0,E=x.lensFlares.length;E>b;b++)T=x.lensFlares[b],T.opacity>.001&&T.scale>.001&&(m.x=T.x,m.y=T.y,m.z=T.z,p=T.size*T.scale/s,f.x=p*c,f.y=p,t.uniform3f(v.screenPosition,m.x,m.y,m.z),t.uniform2f(v.scale,f.x,f.y),t.uniform1f(v.rotation,T.rotation),t.uniform1f(v.opacity,T.opacity),t.uniform3f(v.color,T.color.r,T.color.g,T.color.b),i.setBlending(T.blending,T.blendEquation,T.blendSrc,T.blendDst),i.setTexture(T.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){function e(e,t){var i=new THREE.DirectionalLight;i.isVirtual=!0,i.onlyShadow=!0,i.castShadow=!0,i.shadowCameraNear=e.shadowCameraNear,i.shadowCameraFar=e.shadowCameraFar,i.shadowCameraLeft=e.shadowCameraLeft,i.shadowCameraRight=e.shadowCameraRight,i.shadowCameraBottom=e.shadowCameraBottom,i.shadowCameraTop=e.shadowCameraTop,i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t],i.shadowMapWidth=e.shadowCascadeWidth[t],i.shadowMapHeight=e.shadowCascadeHeight[t],i.pointsWorld=[],i.pointsFrustum=[];for(var n=i.pointsWorld,r=i.pointsFrustum,o=0;8>o;o++)n[o]=new THREE.Vector3,r[o]=new THREE.Vector3;var s=e.shadowCascadeNearZ[t],a=e.shadowCascadeFarZ[t];return r[0].set(-1,-1,s),r[1].set(1,-1,s),r[2].set(-1,1,s),r[3].set(1,1,s),r[4].set(-1,-1,a),r[5].set(1,-1,a),r[6].set(-1,1,a),r[7].set(1,1,a),i}function t(e,t){var i=e.shadowCascadeArray[t];i.position.copy(e.position),i.target.position.copy(e.target.position),i.lookAt(i.target),i.shadowCameraVisible=e.shadowCameraVisible,i.shadowDarkness=e.shadowDarkness,i.shadowBias=e.shadowCascadeBias[t];var n=e.shadowCascadeNearZ[t],r=e.shadowCascadeFarZ[t],o=i.pointsFrustum;o[0].z=n,o[1].z=n,o[2].z=n,o[3].z=n,o[4].z=r,o[5].z=r,o[6].z=r,o[7].z=r}function i(e,t){var i=t.shadowCamera,n=t.pointsFrustum,r=t.pointsWorld;d.set(1/0,1/0,1/0),p.set(-1/0,-1/0,-1/0);for(var o=0;8>o;o++){var s=r[o];s.copy(n[o]),THREE.ShadowMapPlugin.__projector.unprojectVector(s,e),s.applyMatrix4(i.matrixWorldInverse),s.x<d.x&&(d.x=s.x),s.x>p.x&&(p.x=s.x),s.y<d.y&&(d.y=s.y),s.y>p.y&&(p.y=s.y),s.z<d.z&&(d.z=s.z),s.z>p.z&&(p.z=s.z)}i.left=d.x,i.right=p.x,i.top=p.y,i.bottom=d.y,i.updateProjectionMatrix()}function n(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}var r,o,s,a,l,h,c=new THREE.Frustum,u=new THREE.Matrix4,d=new THREE.Vector3,p=new THREE.Vector3,f=new THREE.Vector3;this.init=function(e){r=e.context,o=e;var t=THREE.ShaderLib.depthRGBA,i=THREE.UniformsUtils.clone(t.uniforms);s=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i}),a=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0}),l=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,skinning:!0}),h=new THREE.ShaderMaterial({fragmentShader:t.fragmentShader,vertexShader:t.vertexShader,uniforms:i,morphTargets:!0,skinning:!0}),s._shadowPass=!0,a._shadowPass=!0,l._shadowPass=!0,h._shadowPass=!0},this.render=function(e,t){o.shadowMapEnabled&&o.shadowMapAutoUpdate&&this.update(e,t)},this.update=function(d,p){var m,g,v,y,_,b,E,x,T,w,R,S,C,H,M=[],k=0,A=null;for(r.clearColor(1,1,1,1),r.disable(r.BLEND),r.enable(r.CULL_FACE),r.frontFace(r.CCW),o.shadowMapCullFace===THREE.CullFaceFront?r.cullFace(r.FRONT):r.cullFace(r.BACK),o.setDepthTest(!0),m=0,g=d.__lights.length;g>m;m++)if(C=d.__lights[m],C.castShadow)if(C instanceof THREE.DirectionalLight&&C.shadowCascade)for(_=0;_<C.shadowCascadeCount;_++){var P;if(C.shadowCascadeArray[_])P=C.shadowCascadeArray[_];else{P=e(C,_),P.originalCamera=p;var F=new THREE.Gyroscope;F.position=C.shadowCascadeOffset,F.add(P),F.add(P.target),p.add(F),C.shadowCascadeArray[_]=P,console.log("Created virtualLight",P)}t(C,_),M[k]=P,k++}else M[k]=C,k++;for(m=0,g=M.length;g>m;m++){if(C=M[m],!C.shadowMap){var D=THREE.LinearFilter;o.shadowMapType===THREE.PCFSoftShadowMap&&(D=THREE.NearestFilter);var N={minFilter:D,magFilter:D,format:THREE.RGBAFormat};C.shadowMap=new THREE.WebGLRenderTarget(C.shadowMapWidth,C.shadowMapHeight,N),C.shadowMapSize=new THREE.Vector2(C.shadowMapWidth,C.shadowMapHeight),C.shadowMatrix=new THREE.Matrix4}if(!C.shadowCamera){if(C instanceof THREE.SpotLight)C.shadowCamera=new THREE.PerspectiveCamera(C.shadowCameraFov,C.shadowMapWidth/C.shadowMapHeight,C.shadowCameraNear,C.shadowCameraFar);else{if(!(C instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}C.shadowCamera=new THREE.OrthographicCamera(C.shadowCameraLeft,C.shadowCameraRight,C.shadowCameraTop,C.shadowCameraBottom,C.shadowCameraNear,C.shadowCameraFar)}d.add(C.shadowCamera),d.autoUpdate===!0&&d.updateMatrixWorld()}for(C.shadowCameraVisible&&!C.cameraHelper&&(C.cameraHelper=new THREE.CameraHelper(C.shadowCamera),C.shadowCamera.add(C.cameraHelper)),C.isVirtual&&P.originalCamera==p&&i(p,C),b=C.shadowMap,E=C.shadowMatrix,x=C.shadowCamera,x.position.setFromMatrixPosition(C.matrixWorld),f.setFromMatrixPosition(C.target.matrixWorld),x.lookAt(f),x.updateMatrixWorld(),x.matrixWorldInverse.getInverse(x.matrixWorld),C.cameraHelper&&(C.cameraHelper.visible=C.shadowCameraVisible),C.shadowCameraVisible&&C.cameraHelper.update(),E.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),E.multiply(x.projectionMatrix),E.multiply(x.matrixWorldInverse),u.multiplyMatrices(x.projectionMatrix,x.matrixWorldInverse),c.setFromMatrix(u),o.setRenderTarget(b),o.clear(),H=d.__webglObjects,v=0,y=H.length;y>v;v++)R=H[v],S=R.object,R.render=!1,S.visible&&S.castShadow&&((S instanceof THREE.Mesh||S instanceof THREE.ParticleSystem)&&S.frustumCulled&&!c.intersectsObject(S)||(S._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,S.matrixWorld),R.render=!0));var z,L,I;for(v=0,y=H.length;y>v;v++)R=H[v],R.render&&(S=R.object,T=R.buffer,z=n(S),L=S.geometry.morphTargets.length>0&&z.morphTargets,I=S instanceof THREE.SkinnedMesh&&z.skinning,w=S.customDepthMaterial?S.customDepthMaterial:I?L?h:l:L?a:s,T instanceof THREE.BufferGeometry?o.renderBufferDirect(x,d.__lights,A,w,T,S):o.renderBuffer(x,d.__lights,A,w,T,S));for(H=d.__webglObjectsImmediate,v=0,y=H.length;y>v;v++)R=H[v],S=R.object,S.visible&&S.castShadow&&(S._modelViewMatrix.multiplyMatrices(x.matrixWorldInverse,S.matrixWorld),o.renderImmediateObject(x,d.__lights,A,s,S))}var O=o.getClearColor(),V=o.getClearAlpha();r.clearColor(O.r,O.g,O.b,V),r.enable(r.BLEND),o.shadowMapCullFace===THREE.CullFaceFront&&r.cullFace(r.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function e(){var e=i.createProgram(),t=i.createShader(i.VERTEX_SHADER),r=i.createShader(i.FRAGMENT_SHADER);return i.shaderSource(t,["precision "+n.getPrecision()+" float;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uvOffset + uv * uvScale;","vec2 alignedPosition = position * scale;","vec2 rotatedPosition;","rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","vec4 finalPosition;","finalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","finalPosition.xy += rotatedPosition;","finalPosition = projectionMatrix * finalPosition;","gl_Position = finalPosition;","}"].join("\n")),i.shaderSource(r,["precision "+n.getPrecision()+" float;","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","void main() {","vec4 texture = texture2D( map, vUV );","if ( texture.a < alphaTest ) discard;","gl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","if ( fogType > 0 ) {","float depth = gl_FragCoord.z / gl_FragCoord.w;","float fogFactor = 0.0;","if ( fogType == 1 ) {","fogFactor = smoothstep( fogNear, fogFar, depth );","} else {","const float LOG2 = 1.442695;","float fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );","fogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","}","gl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );","}","}"].join("\n")),i.compileShader(t),i.compileShader(r),i.attachShader(e,t),i.attachShader(e,r),i.linkProgram(e),e}function t(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var i,n,r,o,s,a,l,h,c,u;this.init=function(t){i=t.context,n=t,o=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),s=new Uint16Array([0,1,2,0,2,3]),a=i.createBuffer(),l=i.createBuffer(),i.bindBuffer(i.ARRAY_BUFFER,a),i.bufferData(i.ARRAY_BUFFER,o,i.STATIC_DRAW),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.bufferData(i.ELEMENT_ARRAY_BUFFER,s,i.STATIC_DRAW),h=e(),c={position:i.getAttribLocation(h,"position"),uv:i.getAttribLocation(h,"uv")},u={uvOffset:i.getUniformLocation(h,"uvOffset"),uvScale:i.getUniformLocation(h,"uvScale"),rotation:i.getUniformLocation(h,"rotation"),scale:i.getUniformLocation(h,"scale"),color:i.getUniformLocation(h,"color"),map:i.getUniformLocation(h,"map"),opacity:i.getUniformLocation(h,"opacity"),modelViewMatrix:i.getUniformLocation(h,"modelViewMatrix"),projectionMatrix:i.getUniformLocation(h,"projectionMatrix"),fogType:i.getUniformLocation(h,"fogType"),fogDensity:i.getUniformLocation(h,"fogDensity"),fogNear:i.getUniformLocation(h,"fogNear"),fogFar:i.getUniformLocation(h,"fogFar"),fogColor:i.getUniformLocation(h,"fogColor"),alphaTest:i.getUniformLocation(h,"alphaTest")};var d=document.createElement("canvas");d.width=8,d.height=8;var p=d.getContext("2d");p.fillStyle="#ffffff",p.fillRect(0,0,d.width,d.height),r=new THREE.Texture(d),r.needsUpdate=!0},this.render=function(e,o){var s=e.__webglSprites,d=s.length;if(d){i.useProgram(h),i.enableVertexAttribArray(c.position),i.enableVertexAttribArray(c.uv),i.disable(i.CULL_FACE),i.enable(i.BLEND),i.bindBuffer(i.ARRAY_BUFFER,a),i.vertexAttribPointer(c.position,2,i.FLOAT,!1,16,0),i.vertexAttribPointer(c.uv,2,i.FLOAT,!1,16,8),i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,l),i.uniformMatrix4fv(u.projectionMatrix,!1,o.projectionMatrix.elements),i.activeTexture(i.TEXTURE0),i.uniform1i(u.map,0);var p=0,f=0,m=e.fog;m?(i.uniform3f(u.fogColor,m.color.r,m.color.g,m.color.b),m instanceof THREE.Fog?(i.uniform1f(u.fogNear,m.near),i.uniform1f(u.fogFar,m.far),i.uniform1i(u.fogType,1),p=1,f=1):m instanceof THREE.FogExp2&&(i.uniform1f(u.fogDensity,m.density),i.uniform1i(u.fogType,2),p=2,f=2)):(i.uniform1i(u.fogType,0),p=0,f=0);var g,v,y,_,b=[];for(g=0;d>g;g++)v=s[g],y=v.material,v.visible!==!1&&(v._modelViewMatrix.multiplyMatrices(o.matrixWorldInverse,v.matrixWorld),v.z=-v._modelViewMatrix.elements[14]);for(s.sort(t),g=0;d>g;g++)v=s[g],v.visible!==!1&&(y=v.material,i.uniform1f(u.alphaTest,y.alphaTest),i.uniformMatrix4fv(u.modelViewMatrix,!1,v._modelViewMatrix.elements),b[0]=v.scale.x,b[1]=v.scale.y,_=e.fog&&y.fog?f:0,p!==_&&(i.uniform1i(u.fogType,_),p=_),i.uniform2f(u.uvScale,y.uvScale.x,y.uvScale.y),i.uniform2f(u.uvOffset,y.uvOffset.x,y.uvOffset.y),i.uniform1f(u.opacity,y.opacity),i.uniform3f(u.color,y.color.r,y.color.g,y.color.b),i.uniform1f(u.rotation,y.rotation),i.uniform2fv(u.scale,b),n.setBlending(y.blending,y.blendEquation,y.blendSrc,y.blendDst),n.setDepthTest(y.depthTest),n.setDepthWrite(y.depthWrite),y.map&&y.map.image&&y.map.image.width?n.setTexture(y.map,0):n.setTexture(r,0),i.drawElements(i.TRIANGLES,6,i.UNSIGNED_SHORT,0));i.enable(i.CULL_FACE)}}},THREE.DepthPassPlugin=function(){function e(e){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[0]:e.material}this.enabled=!1,this.renderTarget=null;var t,i,n,r,o,s,a=new THREE.Frustum,l=new THREE.Matrix4;this.init=function(e){t=e.context,i=e;var a=THREE.ShaderLib.depthRGBA,l=THREE.UniformsUtils.clone(a.uniforms);n=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l}),r=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,morphTargets:!0}),o=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,o._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(h,c){var u,d,p,f,m,g,v,y=null;for(t.clearColor(1,1,1,1),t.disable(t.BLEND),i.setDepthTest(!0),h.autoUpdate===!0&&h.updateMatrixWorld(),c.matrixWorldInverse.getInverse(c.matrixWorld),l.multiplyMatrices(c.projectionMatrix,c.matrixWorldInverse),a.setFromMatrix(l),i.setRenderTarget(this.renderTarget),i.clear(),v=h.__webglObjects,u=0,d=v.length;d>u;u++)m=v[u],g=m.object,m.render=!1,g.visible&&((g instanceof THREE.Mesh||g instanceof THREE.ParticleSystem)&&g.frustumCulled&&!a.intersectsObject(g)||(g._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,g.matrixWorld),m.render=!0));var _,b,E;for(u=0,d=v.length;d>u;u++)if(m=v[u],m.render){if(g=m.object,p=m.buffer,g instanceof THREE.ParticleSystem&&!g.customDepthMaterial)continue;_=e(g),_&&i.setMaterialFaces(g.material),b=g.geometry.morphTargets.length>0&&_.morphTargets,E=g instanceof THREE.SkinnedMesh&&_.skinning,f=g.customDepthMaterial?g.customDepthMaterial:E?b?s:o:b?r:n,p instanceof THREE.BufferGeometry?i.renderBufferDirect(c,h.__lights,y,f,p,g):i.renderBuffer(c,h.__lights,y,f,p,g)}for(v=h.__webglObjectsImmediate,u=0,d=v.length;d>u;u++)m=v[u],g=m.object,g.visible&&(g._modelViewMatrix.multiplyMatrices(c.matrixWorldInverse,g.matrixWorld),i.renderImmediateObject(c,h.__lights,y,n,g));var x=i.getClearColor(),T=i.getClearAlpha();t.clearColor(x.r,x.g,x.b,T),t.enable(t.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","uniform sampler2D occlusionMap;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float vVisibility;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","vec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );","visibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );","vVisibility =        visibility.r / 9.0;","vVisibility *= 1.0 - visibility.g / 9.0;","vVisibility *=       visibility.b / 9.0;","vVisibility *= 1.0 - visibility.a / 9.0;","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["uniform lowp int renderType;","uniform sampler2D map;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","varying float vVisibility;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * vVisibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")},lensFlare:{vertexShader:["uniform lowp int renderType;","uniform vec3 screenPosition;","uniform vec2 scale;","uniform float rotation;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","void main() {","vUV = uv;","vec2 pos = position;","if( renderType == 2 ) {","pos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;","pos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;","}","gl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );","}"].join("\n"),fragmentShader:["precision mediump float;","uniform lowp int renderType;","uniform sampler2D map;","uniform sampler2D occlusionMap;","uniform float opacity;","uniform vec3 color;","varying vec2 vUV;","void main() {","if( renderType == 0 ) {","gl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );","} else if( renderType == 1 ) {","gl_FragColor = texture2D( map, vUV );","} else {","float visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;","visibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;","visibility = ( 1.0 - visibility / 4.0 );","vec4 texture = texture2D( map, vUV );","texture.a *= opacity * visibility;","gl_FragColor = texture;","gl_FragColor.rgb *= color;","}","}"].join("\n")}},define("Three",function(e){return function(){var t;return t||e.THREE}}(this)),THREE.VignetteShader={uniforms:{tDiffuse:{type:"t",value:null},offset:{type:"f",value:1},darkness:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float offset;","uniform float darkness;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","vec2 uv = ( vUv - vec2( 0.5 ) ) * vec2( offset );","gl_FragColor = vec4( mix( texel.rgb, vec3( 1.0 - darkness ), dot( uv, uv ) ), texel.a );","}"].join("\n")},define("ShaderVignette",function(){}),THREE.HorizontalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},h:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float h;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x - 4.0 * h, vUv.y ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x - 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x - 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x - 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x + 1.0 * h, vUv.y ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x + 2.0 * h, vUv.y ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x + 3.0 * h, vUv.y ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x + 4.0 * h, vUv.y ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},define("HorizontalBlurShader",function(){}),THREE.VerticalBlurShader={uniforms:{tDiffuse:{type:"t",value:null},v:{type:"f",value:1/512}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform float v;","varying vec2 vUv;","void main() {","vec4 sum = vec4( 0.0 );","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 4.0 * v ) ) * 0.051;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y - 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y ) ) * 0.1633;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 1.0 * v ) ) * 0.1531;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 2.0 * v ) ) * 0.12245;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 3.0 * v ) ) * 0.0918;","sum += texture2D( tDiffuse, vec2( vUv.x, vUv.y + 4.0 * v ) ) * 0.051;","gl_FragColor = sum;","}"].join("\n")},define("VerticalBlurShader",function(){}),THREE.BleachBypassShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 base = texture2D( tDiffuse, vUv );","vec3 lumCoeff = vec3( 0.25, 0.65, 0.1 );","float lum = dot( lumCoeff, base.rgb );","vec3 blend = vec3( lum );","float L = min( 1.0, max( 0.0, 10.0 * ( lum - 0.45 ) ) );","vec3 result1 = 2.0 * base.rgb * blend;","vec3 result2 = 1.0 - 2.0 * ( 1.0 - blend ) * ( 1.0 - base.rgb );","vec3 newColor = mix( result1, result2, L );","float A2 = opacity * base.a;","vec3 mixRGB = A2 * newColor.rgb;","mixRGB += ( ( 1.0 - A2 ) * base.rgb );","gl_FragColor = vec4( mixRGB, base.a );","}"].join("\n")},define("BleachBypassShader",function(){}),THREE.DotScreenPass=function(e,t,i){void 0===THREE.DotScreenShader&&console.error("THREE.DotScreenPass relies on THREE.DotScreenShader");var n=THREE.DotScreenShader;this.uniforms=THREE.UniformsUtils.clone(n.uniforms),void 0!==e&&this.uniforms.center.value.copy(e),void 0!==t&&(this.uniforms.angle.value=t),void 0!==i&&(this.uniforms.scale.value=i),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:n.vertexShader,fragmentShader:n.fragmentShader}),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.DotScreenPass.prototype={render:function(e,t,i){this.uniforms.tDiffuse.value=i,this.uniforms.tSize.value.set(i.width,i.height),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}},define("DotScreenPass",function(){}),THREE.ConvolutionShader={defines:{KERNEL_SIZE_FLOAT:"25.0",KERNEL_SIZE_INT:"25"},uniforms:{tDiffuse:{type:"t",value:null},uImageIncrement:{type:"v2",value:new THREE.Vector2(.001953125,0)},cKernel:{type:"fv1",value:[]}},vertexShader:["uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vUv = uv - ( ( KERNEL_SIZE_FLOAT - 1.0 ) / 2.0 ) * uImageIncrement;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float cKernel[ KERNEL_SIZE_INT ];","uniform sampler2D tDiffuse;","uniform vec2 uImageIncrement;","varying vec2 vUv;","void main() {","vec2 imageCoord = vUv;","vec4 sum = vec4( 0.0, 0.0, 0.0, 0.0 );","for( int i = 0; i < KERNEL_SIZE_INT; i ++ ) {","sum += texture2D( tDiffuse, imageCoord ) * cKernel[ i ];","imageCoord += uImageIncrement;","}","gl_FragColor = sum;","}"].join("\n"),buildKernel:function(e){function t(e,t){return Math.exp(-(e*e)/(2*t*t))}var i,n,r,o,s=25,a=2*Math.ceil(3*e)+1;for(a>s&&(a=s),o=.5*(a-1),n=new Array(a),r=0,i=0;a>i;++i)n[i]=t(i-o,e),r+=n[i];for(i=0;a>i;++i)n[i]/=r;return n}},define("ConvolutionShader",function(){}),THREE.BloomPass=function(e,t,i,n){e=void 0!==e?e:1,t=void 0!==t?t:25,i=void 0!==i?i:4,n=void 0!==n?n:256;var r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat};this.renderTargetX=new THREE.WebGLRenderTarget(n,n,r),this.renderTargetY=new THREE.WebGLRenderTarget(n,n,r),void 0===THREE.CopyShader&&console.error("THREE.BloomPass relies on THREE.CopyShader");var o=THREE.CopyShader;this.copyUniforms=THREE.UniformsUtils.clone(o.uniforms),this.copyUniforms.opacity.value=e,this.materialCopy=new THREE.ShaderMaterial({uniforms:this.copyUniforms,vertexShader:o.vertexShader,fragmentShader:o.fragmentShader,blending:THREE.AdditiveBlending,transparent:!0}),void 0===THREE.ConvolutionShader&&console.error("THREE.BloomPass relies on THREE.ConvolutionShader");var s=THREE.ConvolutionShader;this.convolutionUniforms=THREE.UniformsUtils.clone(s.uniforms),this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurx,this.convolutionUniforms.cKernel.value=THREE.ConvolutionShader.buildKernel(i),this.materialConvolution=new THREE.ShaderMaterial({uniforms:this.convolutionUniforms,vertexShader:s.vertexShader,fragmentShader:s.fragmentShader,defines:{KERNEL_SIZE_FLOAT:t.toFixed(1),KERNEL_SIZE_INT:t.toFixed(0)}}),this.enabled=!0,this.needsSwap=!1,this.clear=!1},THREE.BloomPass.prototype={render:function(e,t,i,n,r){r&&e.context.disable(e.context.STENCIL_TEST),THREE.EffectComposer.quad.material=this.materialConvolution,this.convolutionUniforms.tDiffuse.value=i,this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurX,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetX,!0),this.convolutionUniforms.tDiffuse.value=this.renderTargetX,this.convolutionUniforms.uImageIncrement.value=THREE.BloomPass.blurY,e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,this.renderTargetY,!0),THREE.EffectComposer.quad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetY,r&&e.context.enable(e.context.STENCIL_TEST),e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,i,this.clear)}},THREE.BloomPass.blurX=new THREE.Vector2(.001953125,0),THREE.BloomPass.blurY=new THREE.Vector2(0,.001953125),define("BloomPass",["Three","ConvolutionShader"],function(){}),THREE.FilmShader={uniforms:{tDiffuse:{type:"t",value:null},time:{type:"f",value:0},nIntensity:{type:"f",value:.5},sIntensity:{type:"f",value:.05},sCount:{type:"f",value:4096},grayscale:{type:"i",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float time;","uniform bool grayscale;","uniform float nIntensity;","uniform float sIntensity;","uniform float sCount;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 cTextureScreen = texture2D( tDiffuse, vUv );","float x = vUv.x * vUv.y * time *  1000.0;","x = mod( x, 13.0 ) * mod( x, 123.0 );","float dx = mod( x, 0.01 );","vec3 cResult = cTextureScreen.rgb + cTextureScreen.rgb * clamp( 0.1 + dx * 100.0, 0.0, 1.0 );","vec2 sc = vec2( sin( vUv.y * sCount ), cos( vUv.y * sCount ) );","cResult += cTextureScreen.rgb * vec3( sc.x, sc.y, sc.x ) * sIntensity;","cResult = cTextureScreen.rgb + clamp( nIntensity, 0.0,1.0 ) * ( cResult - cTextureScreen.rgb );","if( grayscale ) {","cResult = vec3( cResult.r * 0.3 + cResult.g * 0.59 + cResult.b * 0.11 );","}","gl_FragColor =  vec4( cResult, cTextureScreen.a );","}"].join("\n")},define("FilmShader",function(){}),THREE.FilmPass=function(e,t,i,n){void 0===THREE.FilmShader&&console.error("THREE.FilmPass relies on THREE.FilmShader");var r=THREE.FilmShader;this.uniforms=THREE.UniformsUtils.clone(r.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:r.vertexShader,fragmentShader:r.fragmentShader}),void 0!==n&&(this.uniforms.grayscale.value=n),void 0!==e&&(this.uniforms.nIntensity.value=e),void 0!==t&&(this.uniforms.sIntensity.value=t),void 0!==i&&(this.uniforms.sCount.value=i),this.enabled=!0,this.renderToScreen=!1,this.needsSwap=!0},THREE.FilmPass.prototype={render:function(e,t,i,n){this.uniforms.tDiffuse.value=i,this.uniforms.time.value+=n,THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,!1)}},define("FilmPass",["Three","FilmShader"],function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/PostProcessing",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/nodes/models/Node","ShaderVignette","HorizontalBlurShader","VerticalBlurShader","BleachBypassShader","DotScreenPass","BloomPass","FilmPass"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b;
return p=t("Underscore"),n=t("Backbone"),c=t("cs!threenodes/utils/Utils"),h=t("cs!threenodes/nodes/models/Node"),t("ShaderVignette"),t("HorizontalBlurShader"),t("VerticalBlurShader"),t("BleachBypassShader"),t("DotScreenPass"),t("BloomPass"),t("FilmPass"),namespace("ThreeNodes.nodes.models",{BloomPass:o=function(t){function n(){return this.compute=e(this.compute,this),this.value_has_changed=e(this.value_has_changed,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),f=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Bloom",n.group_name="PostProcessing",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.BloomPass(1.6),this.cached=this.createCacheObject(["kernelSize","sigma","resolution"])},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{strength:1.6,kernelSize:25,sigma:4,resolution:256},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.value_has_changed=function(e){var t;return t=this.createCacheObject(e),c.flatArraysAreEquals(t,this.cached)===!1?(this.cached=t,!0):!1},n.prototype.compute=function(){return this.value_has_changed(["kernelSize","sigma","resolution"])===!0&&(this.ob=new THREE.BloomPass(this.fields.getField("strength").getValue(),this.fields.getField("kernelSize").getValue(),this.fields.getField("sigma").getValue(),this.fields.getField("resolution").getValue())),this.ob.copyUniforms.opacity.value=this.fields.getField("strength").getValue(),this.fields.setField("out",this.ob)},n}(h),DotScreenPass:s=function(t){function n(){return this.compute=e(this.compute,this),this.value_has_changed=e(this.value_has_changed,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),m=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="DotScreen",n.group_name="PostProcessing",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.DotScreenPass(new THREE.Vector2(.5,.5)),this.cached=this.createCacheObject(["center","angle","scale"])},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{center:{type:"Vector2",val:new THREE.Vector2(.5,.5)},angle:1.57,scale:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.value_has_changed=function(e){var t;return t=this.createCacheObject(e),c.flatArraysAreEquals(t,this.cached)===!1?(this.cached=t,!0):!1},n.prototype.compute=function(){return this.value_has_changed(["center","angle","scale"])===!0&&(this.ob=new THREE.DotScreenPass(this.fields.getField("center").getValue(),this.fields.getField("angle").getValue(),this.fields.getField("scale").getValue())),this.fields.setField("out",this.ob)},n}(h),FilmPass:a=function(t){function n(){return this.compute=e(this.compute,this),this.value_has_changed=e(this.value_has_changed,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),g=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Film",n.group_name="PostProcessing",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.FilmPass(.5,.125,2048,!1),this.cached=this.createCacheObject(["noiseIntensity","scanlinesIntensity","scanlinesCount","grayscale"])},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{noiseIntensity:.5,scanlinesIntensity:.125,scanlinesCount:2048,grayscale:!1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.value_has_changed=function(e){var t;return t=this.createCacheObject(e),c.flatArraysAreEquals(t,this.cached)===!1?(this.cached=t,!0):!1},n.prototype.compute=function(){return this.ob.uniforms.grayscale.value=this.fields.getField("grayscale").getValue(),this.ob.uniforms.nIntensity.value=this.fields.getField("noiseIntensity").getValue(),this.ob.uniforms.sIntensity.value=this.fields.getField("scanlinesIntensity").getValue(),this.ob.uniforms.sCount.value=this.fields.getField("scanlinesCount").getValue(),this.fields.setField("out",this.ob)},n}(h),VignettePass:d=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),v=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Vignette",n.group_name="PostProcessing",n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=THREE.VignetteShader,this.ob=new THREE.ShaderPass(e)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{offset:1,darkness:1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.uniforms.offset.value=this.fields.getField("offset").getValue(),this.ob.uniforms.darkness.value=this.fields.getField("darkness").getValue(),this.fields.setField("out",this.ob)},n}(h),HorizontalBlurPass:l=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),y=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="HorizontalBlur",n.group_name="PostProcessing",n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=THREE.HorizontalBlurShader,this.ob=new THREE.ShaderPass(e)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{delta:1/512},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.uniforms.h.value=this.fields.getField("delta").getValue(),this.fields.setField("out",this.ob)},n}(h),VerticalBlurPass:u=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),_=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="VerticalBlur",n.group_name="PostProcessing",n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=THREE.VerticalBlurShader,this.ob=new THREE.ShaderPass(e)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{delta:1/512},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.uniforms.v.value=this.fields.getField("delta").getValue(),this.fields.setField("out",this.ob)},n}(h),BleachPass:r=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),b=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Bleach",n.group_name="PostProcessing",n.prototype.initialize=function(){var e;return n.__super__.initialize.apply(this,arguments),e=THREE.BleachBypassShader,this.ob=new THREE.ShaderPass(e)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{opacity:.95},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.uniforms.opacity.value=this.fields.getField("opacity").getValue(),this.fields.setField("out",this.ob)},n}(h)})})}.call(this),THREE.ColladaLoader=function(){function e(e,i,n){var r=0;if(document.implementation&&document.implementation.createDocument){var o=new XMLHttpRequest;o.onreadystatechange=function(){if(4==o.readyState){if(0==o.status||200==o.status)if(o.responseXML)At=i,t(o.responseXML,void 0,e);else if(o.responseText){At=i;var s=new DOMParser,a=s.parseFromString(o.responseText,"application/xml");t(a,void 0,e)}else console.error("ColladaLoader: Empty or non-existing file ("+e+")")}else 3==o.readyState&&n&&(0==r&&(r=o.getResponseHeader("Content-Length")),n({total:r,loaded:o.responseText.length}))},o.open("GET",e,!0),o.send(null)}else alert("Don't know how to parse XML!")}function t(e,t,i){if(Mt=e,t=t||At,void 0!==i){var o=i.split("/");o.pop(),St=(o.length<1?".":o.join("/"))+"/"}n(),vt(),Ft=r("library_images image",H,"image"),Lt=r("library_materials material",X,"material"),It=r("library_effects effect",Z,"effect"),zt=r("library_geometries geometry",I,"geometry"),Ot=r("library_cameras camera",ot,"camera"),Vt=r("library_lights light",at,"light"),Nt=r("library_controllers controller",M,"controller"),Dt=r("library_animations animation",tt,"animation"),Rt=r("library_visual_scenes visual_scene",P,"visual_scene"),Ct=[],Ht=[],Tt=a(),kt=new THREE.Object3D;for(var s=0;s<Tt.nodes.length;s++)kt.add(y(Tt.nodes[s]));kt.scale.multiplyScalar(jt),l();var h={scene:kt,morphs:Ct,skins:Ht,animations:wt,dae:{images:Ft,materials:Lt,cameras:Ot,lights:Vt,effects:It,geometries:zt,controllers:Nt,animations:Dt,visualScenes:Rt,scene:Tt}};return t&&t(h),h}function i(e){Bt=e}function n(){var e=Mt.querySelectorAll("asset"),t=e[0];if(t&&t.childNodes)for(var i=0;i<t.childNodes.length;i++){var n=t.childNodes[i];switch(n.nodeName){case"unit":var r=n.getAttribute("meter");r&&(jt=parseFloat(r));break;case"up_axis":Wt=n.textContent.charAt(0)}}}function r(e,t,i){for(var n=Mt.querySelectorAll(e),r={},o=0,s=n.length,a=0;s>a;a++){var l=n[a],h=(new t).parse(l);h.id&&0!=h.id.length||(h.id=i+o++),r[h.id]=h}return r}function a(){var e=Mt.querySelectorAll("scene instance_visual_scene")[0];if(e){var t=e.getAttribute("url").replace(/^#/,"");return Rt[t.length>0?t:"visual_scene0"]}return null}function l(){wt=[],h(kt)}function h(e){var t=Tt.getChildById(e.name,!0),i=null;if(t&&t.keys){i={fps:60,hierarchy:[{node:t,keys:t.keys,sids:t.sids}],node:e,name:"animation_"+e.name,length:0},wt.push(i);for(var n=0,r=t.keys.length;r>n;n++)i.length=Math.max(i.length,t.keys[n].time)}else i={hierarchy:[{keys:[],sids:[]}]};for(var n=0,r=e.children.length;r>n;n++)for(var o=h(e.children[n]),s=0,a=o.hierarchy.length;a>s;s++)i.hierarchy.push({keys:[],sids:[]});return i}function c(){var e,t=1e6,i=-t,n=0;for(var r in Dt){var o=Dt[r];e=e||o.id;for(var s=0;s<o.sampler.length;s++){var a=o.sampler[s];a.create(),t=Math.min(t,a.startTime),i=Math.max(i,a.endTime),n=Math.max(n,a.input.length)}}return{start:t,end:i,frames:n,ID:e}}function u(e,t){var i=t instanceof N?Nt[t.url]:t;if(!i||!i.morph)return console.log("could not find morph controller!"),void 0;for(var n=i.morph,r=0;r<n.targets.length;r++){var o=n.targets[r],s=zt[o];if(s.mesh&&s.mesh.primitives&&s.mesh.primitives.length){var a=s.mesh.primitives[0].geometry;a.vertices.length===e.vertices.length&&e.morphTargets.push({name:"target_1",vertices:a.vertices})}}e.morphTargets.push({name:"target_Z",vertices:e.vertices})}function d(e,t,i,n){if(e.world=e.world||new THREE.Matrix4,e.localworld=e.localworld||new THREE.Matrix4,e.world.copy(e.matrix),e.localworld.copy(e.matrix),e.channels&&e.channels.length){var r=e.channels[0],o=r.sampler.output[i];o instanceof THREE.Matrix4&&(e.world.copy(o),e.localworld.copy(o),0==i&&e.matrix.copy(o))}n&&e.world.multiplyMatrices(n,e.world),t.push(e);for(var s=0;s<e.nodes.length;s++)d(e.nodes[s],t,i,e.world)}function p(e,t){for(var i=0;i<e.length;i++){var n=e[i],r=-1;if("JOINT"==n.type){for(var o=0;o<t.joints.length;o++)if(n.sid==t.joints[o]){r=o;break}if(r>=0){var s=t.invBindMatrices[r];n.invBindMatrix=s,n.skinningMatrix=new THREE.Matrix4,n.skinningMatrix.multiplyMatrices(n.world,s),n.animatrix=new THREE.Matrix4,n.animatrix.copy(n.localworld),n.weights=[];for(var o=0;o<t.weights.length;o++)for(var a=0;a<t.weights[o].length;a++){var l=t.weights[o][a];l.joint==r&&n.weights.push(l)}}else console.warn("ColladaLoader: Could not find joint '"+n.sid+"'."),n.skinningMatrix=new THREE.Matrix4,n.weights=[]}}}function f(e){var t=[],i=function(e,t,n){var r={};r.name=t.sid,r.parent=e,r.matrix=t.matrix;var o=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];r.matrix.decompose(o[0],o[1],o[2]),r.pos=[o[0].x,o[0].y,o[0].z],r.scl=[o[2].x,o[2].y,o[2].z],r.rotq=[o[1].x,o[1].y,o[1].z,o[1].w],n.push(r);for(var s in t.nodes)i(t.sid,t.nodes[s],n)};return i(-1,e,t),t}function m(e,t,i){var n=[];d(t,n,-1),p(n,i.skin),v=new THREE.Vector3;for(var r=[],a=0;a<e.vertices.length;a++)r.push(new THREE.Vector3);for(a=0;a<n.length;a++)if("JOINT"==n[a].type)for(j=0;j<n[a].weights.length;j++)w=n[a].weights[j],vidx=w.index,weight=w.weight,o=e.vertices[vidx],s=r[vidx],v.x=o.x,v.y=o.y,v.z=o.z,v.applyMatrix4(n[a].skinningMatrix),s.x+=v.x*weight,s.y+=v.y*weight,s.z+=v.z*weight;for(var a=0;a<e.vertices.length;a++)e.vertices[a]=r[a]}function g(e,t,i){var n=30,r=Nt[t.url];if(i=void 0!==i?i:40,!r||!r.skin)return console.log("ColladaLoader: Could not find skin controller."),void 0;if(!t.skeleton||!t.skeleton.length)return console.log("ColladaLoader: Could not find the skeleton for the skin. "),void 0;for(var o=c(),s=Tt.getChildById(t.skeleton[0],!0)||Tt.getChildBySid(t.skeleton[0],!0),a=f(s),l=r.skin.joints,h=[],u=0;u<l.length;u++)for(var g=0;g<a.length;g++)a[g].name==l[u]&&(h[u]=a[g]);for(var u=0;u<h.length;u++)for(var g=0;g<h.length;g++)h[u].parent==h[g].name&&(h[u].parent=g);var u,g,v,y,_,b,E,x=new THREE.Vector3;for(u=0;u<e.vertices.length;u++)e.vertices[u].applyMatrix4(r.skin.bindShapeMatrix);for(var T=[],w=[],R=r.skin.weights,u=0;u<R.length;u++){var S=new THREE.Vector4(R[u][0]?R[u][0].joint:0,R[u][1]?R[u][1].joint:0,R[u][2]?R[u][2].joint:0,R[u][3]?R[u][3].joint:0),_=new THREE.Vector4(R[u][0]?R[u][0].weight:0,R[u][1]?R[u][1].weight:0,R[u][2]?R[u][2].weight:0,R[u][3]?R[u][3].weight:0);T.push(S),w.push(_)}e.skinIndices=T,e.skinWeights=w,e.bones=h;for(var C={name:o.ID,fps:30,length:o.frames/30,hierarchy:[]},g=0;g<h.length;g++)C.hierarchy.push({parent:h[g].parent,name:h[g].name,keys:[]});for(h.length<n&&m(e,s,r),i=0;i<o.frames;i++){var H=[],M=[];if(d(s,H,i),p(H,r.skin),h.length<n){for(var u=0;u<H.length;u++)for(var g=0;g<C.hierarchy.length;g++)if(C.hierarchy[g].name==H[u].sid){var k={};k.time=i/30,k.matrix=H[u].animatrix,0==i&&(H[u].matrix=k.matrix);var A=[new THREE.Vector3,new THREE.Quaternion,new THREE.Vector3];k.matrix.decompose(A[0],A[1],A[2]),k.pos=[A[0].x,A[0].y,A[0].z],k.scl=[A[2].x,A[2].y,A[2].z],k.rot=A[1],C.hierarchy[g].keys.push(k)}e.animation=C}else{for(u=0;u<e.vertices.length;u++)M.push(new THREE.Vector3);for(u=0;u<H.length;u++)if("JOINT"==H[u].type)for(g=0;g<H[u].weights.length;g++)v=H[u].weights[g],y=v.index,_=v.weight,b=e.vertices[y],E=M[y],x.x=b.x,x.y=b.y,x.z=b.z,x.applyMatrix4(H[u].skinningMatrix),E.x+=x.x*_,E.y+=x.y*_,E.z+=x.z*_;e.morphTargets.push({name:"target_"+i,vertices:M})}}}function y(e){var t,i,n,r,o=new THREE.Object3D,s=!1;for(n=0;n<e.controllers.length;n++){var a=Nt[e.controllers[n].url];switch(a.type){case"skin":if(zt[a.skin.source]){var l=new L;l.url=a.skin.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l),s=!0,t=e.controllers[n]}else if(Nt[a.skin.source]){var h=Nt[a.skin.source];if(i=h,h.morph&&zt[h.morph.source]){var l=new L;l.url=h.morph.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l)}}break;case"morph":if(zt[a.morph.source]){var l=new L;l.url=a.morph.source,l.instance_material=e.controllers[n].instance_material,e.geometries.push(l),i=e.controllers[n]}console.log("ColladaLoader: Morph-controller partially supported.")}}var c={};for(n=0;n<e.geometries.length;n++){var d,p=e.geometries[n],f=p.instance_material,m=zt[p.url],v={},_=[],b=0;if(m){if(!m.mesh||!m.mesh.primitives)continue;if(0==o.name.length&&(o.name=m.id),f)for(r=0;r<f.length;r++){var E=f[r],x=Lt[E.target],T=x.instance_effect.url,w=It[T].shader,R=w.material;if(m.doubleSided){if(!(E.symbol in c)){var S=R.clone();S.side=THREE.DoubleSide,c[E.symbol]=S}R=c[E.symbol]}R.opacity=R.opacity?R.opacity:1,v[E.symbol]=b,_.push(R),d=R,d.name=null==x.name||""===x.name?x.id:x.name,b++}var C,H=d||new THREE.MeshLambertMaterial({color:14540253,shading:THREE.FlatShading,side:m.doubleSided?THREE.DoubleSide:THREE.FrontSide}),M=m.mesh.geometry3js;if(b>1)for(H=new THREE.MeshFaceMaterial(_),r=0;r<M.faces.length;r++){var k=M.faces[r];k.materialIndex=v[k.daeMaterial]}void 0!==t?(g(M,t),M.morphTargets.length>0?(H.morphTargets=!0,H.skinning=!1):(H.morphTargets=!1,H.skinning=!0),C=new THREE.SkinnedMesh(M,H,!1),C.name="skin_"+Ht.length,Ht.push(C)):void 0!==i?(u(M,i),H.morphTargets=!0,C=new THREE.Mesh(M,H),C.name="morph_"+Ct.length,Ct.push(C)):C=new THREE.Mesh(M,H),e.geometries.length>1?o.add(C):o=C}}for(n=0;n<e.cameras.length;n++){var A=e.cameras[n],P=Ot[A.url];o=new THREE.PerspectiveCamera(P.fov,parseFloat(P.aspect_ratio),parseFloat(P.znear),parseFloat(P.zfar))}for(n=0;n<e.lights.length;n++){var F=e.lights[n],D=Vt[F.url];if(D&&D.technique){var N,z=D.color.getHex(),I=D.intensity,O=0,V=D.falloff_angle;switch(D.technique){case"directional":o=new THREE.DirectionalLight(z,I,O);break;case"point":o=new THREE.PointLight(z,I,O);break;case"spot":o=new THREE.SpotLight(z,I,O,V,N);break;case"ambient":o=new THREE.AmbientLight(z)}}}if(o.name=e.name||e.id||"",o.layer=e.layer||"",o.matrix=e.matrix,o.matrix.decompose(o.position,o.quaternion,o.scale),Ut.centerGeometry&&o.geometry){var B=THREE.GeometryUtils.center(o.geometry);B.multiply(o.scale),B.applyQuaternion(o.quaternion),o.position.sub(B)}for(n=0;n<e.nodes.length;n++)o.add(y(e.nodes[n],e));return o}function _(e){for(var t=Mt.querySelectorAll("library_nodes node"),i=0;i<t.length;i++){var n=t[i].attributes.getNamedItem("id");if(n&&n.value===e)return t[i]}return void 0}function b(e){var t=[],i=1e6,n=-1e6;for(var r in Dt)for(var o=Dt[r],s=0;s<o.channel.length;s++){var a=o.channel[s],l=o.sampler[s],r=a.target.split("/")[0];r==e.id&&(l.create(),a.sampler=l,i=Math.min(i,l.startTime),n=Math.max(n,l.endTime),t.push(a))}return t.length&&(e.startTime=i,e.endTime=n),t}function E(e){if(e.channels&&e.channels.length){for(var t=[],i=[],n=0,r=e.channels.length;r>n;n++){var o,s=e.channels[n],a=s.fullSid,l=s.sampler,h=l.input,c=e.getTransformBySid(s.sid);if(s.arrIndices){o=[];for(var u=0,d=s.arrIndices.length;d>u;u++)o[u]=Et(s.arrIndices[u])}else o=xt(s.member);if(c){-1===i.indexOf(a)&&i.push(a);for(var u=0,d=h.length;d>u;u++){var p=h[u],f=l.getData(c.type,u),m=x(t,p);if(!m){m=new rt(p);var g=T(t,p);t.splice(-1==g?t.length:g,0,m)}m.addTarget(a,c,o,f)}}else console.log('Could not find transform "'+s.sid+'" in node '+e.id)}for(var n=0;n<i.length;n++)for(var v=i[n],u=0;u<t.length;u++){var m=t[u];m.hasTarget(v)||R(t,m,u,v)}e.keys=t,e.sids=i}}function x(e,t){for(var i=null,n=0,r=e.length;r>n&&null==i;n++){var o=e[n];if(o.time===t)i=o;else if(o.time>t)break}return i}function T(e,t){for(var i=-1,n=0,r=e.length;r>n&&-1==i;n++){var o=e[n];o.time>=t&&(i=n)}return i}function R(e,t,i,n){var r=C(e,n,i?i-1:0),o=S(e,n,i+1);if(r&&o){var s,a=(t.time-r.time)/(o.time-r.time),l=r.getTarget(n),h=o.getTarget(n).data,c=l.data;if("matrix"===l.type)s=c;else if(c.length){s=[];for(var u=0;u<c.length;++u)s[u]=c[u]+(h[u]-c[u])*a}else s=c+(h-c)*a;t.addTarget(n,l.transform,l.member,s)}}function S(e,t,i){for(;i<e.length;i++){var n=e[i];if(n.hasTarget(t))return n}return null}function C(e,t,i){for(i=i>=0?i:i+e.length;i>=0;i--){var n=e[i];if(n.hasTarget(t))return n}return null}function H(){this.id="",this.init_from=""}function M(){this.id="",this.name="",this.type="",this.skin=null,this.morph=null}function k(){this.method=null,this.source=null,this.targets=null,this.weights=null}function A(){this.source="",this.bindShapeMatrix=null,this.invBindMatrices=[],this.joints=[],this.weights=[]}function P(){this.id="",this.name="",this.nodes=[],this.scene=new THREE.Object3D}function F(){this.id="",this.name="",this.sid="",this.nodes=[],this.controllers=[],this.transforms=[],this.geometries=[],this.channels=[],this.matrix=new THREE.Matrix4}function D(){this.sid="",this.type="",this.data=[],this.obj=null}function N(){this.url="",this.skeleton=[],this.instance_material=[]}function z(){this.symbol="",this.target=""}function L(){this.url="",this.instance_material=[]}function I(){this.id="",this.mesh=null}function O(e){this.geometry=e.id,this.primitives=[],this.vertices=null,this.geometry3js=null}function V(){this.material="",this.count=0,this.inputs=[],this.vcount=null,this.p=[],this.geometry=new THREE.Geometry}function B(){V.call(this),this.vcount=[]}function U(){V.call(this),this.vcount=3}function W(){this.source="",this.count=0,this.stride=0,this.params=[]}function $(){this.input={}}function G(){this.semantic="",this.offset=0,this.source="",this.set=0}function q(e){this.id=e,this.type=null}function X(){this.id="",this.name="",this.instance_effect=null}function Y(){this.color=new THREE.Color,this.color.setRGB(Math.random(),Math.random(),Math.random()),this.color.a=1,this.texture=null,this.texcoord=null,this.texOpts=null}function K(e,t){this.type=e,this.effect=t,this.material=null}function Q(e){this.effect=e,this.init_from=null,this.format=null}function J(e){this.effect=e,this.source=null,this.wrap_s=null,this.wrap_t=null,this.minfilter=null,this.magfilter=null,this.mipfilter=null}function Z(){this.id="",this.name="",this.shader=null,this.surface={},this.sampler={}}function et(){this.url=""}function tt(){this.id="",this.name="",this.source={},this.sampler=[],this.channel=[]}function it(e){this.animation=e,this.source="",this.target="",this.fullSid=null,this.sid=null,this.dotSyntax=null,this.arrSyntax=null,this.arrIndices=null,this.member=null}function nt(e){this.id="",this.animation=e,this.inputs=[],this.input=null,this.output=null,this.strideOut=null,this.interpolation=null,this.startTime=null,this.endTime=null,this.duration=0}function rt(e){this.targets=[],this.time=e}function ot(){this.id="",this.name="",this.technique=""}function st(){this.url=""}function at(){this.id="",this.name="",this.technique=""}function lt(){this.url=""}function ht(e){var t=e.getAttribute("id");return void 0!=Pt[t]?Pt[t]:(Pt[t]=new q(t).parse(e),Pt[t])}function ct(e){for(var t=pt(e),i=[],n=0,r=t.length;r>n;n++)i.push("true"==t[n]||"1"==t[n]?!0:!1);return i}function ut(e){for(var t=pt(e),i=[],n=0,r=t.length;r>n;n++)i.push(parseFloat(t[n]));return i}function dt(e){for(var t=pt(e),i=[],n=0,r=t.length;r>n;n++)i.push(parseInt(t[n],10));return i}function pt(e){return e.length>0?ft(e).split(/\s+/):[]}function ft(e){return e.replace(/^\s+/,"").replace(/\s+$/,"")}function mt(e,t,i){return e.hasAttribute(t)?parseInt(e.getAttribute(t),10):i}function gt(e,t){e.doubleSided=!1;var i=t.querySelectorAll("extra double_sided")[0];i&&i&&1===parseInt(i.textContent,10)&&(e.doubleSided=!0)}function vt(){if(Ut.convertUpAxis&&Wt!==Ut.upAxis)switch(Wt){case"X":$t="Y"===Ut.upAxis?"XtoY":"XtoZ";break;case"Y":$t="X"===Ut.upAxis?"YtoX":"YtoZ";break;case"Z":$t="X"===Ut.upAxis?"ZtoX":"ZtoY"}else $t=null}function yt(e,t){if(Ut.convertUpAxis&&Wt!==Ut.upAxis)switch($t){case"XtoY":var i=e[0];e[0]=t*e[1],e[1]=i;break;case"XtoZ":var i=e[2];e[2]=e[1],e[1]=e[0],e[0]=i;break;case"YtoX":var i=e[0];e[0]=e[1],e[1]=t*i;break;case"YtoZ":var i=e[1];e[1]=t*e[2],e[2]=i;break;case"ZtoX":var i=e[0];e[0]=e[1],e[1]=e[2],e[2]=i;break;case"ZtoY":var i=e[1];e[1]=e[2],e[2]=t*i}}function _t(e,t){var i=[e[t],e[t+1],e[t+2]];return yt(i,-1),new THREE.Vector3(i[0],i[1],i[2])}function bt(e){if(Ut.convertUpAxis){var t=[e[0],e[4],e[8]];yt(t,-1),e[0]=t[0],e[4]=t[1],e[8]=t[2],t=[e[1],e[5],e[9]],yt(t,-1),e[1]=t[0],e[5]=t[1],e[9]=t[2],t=[e[2],e[6],e[10]],yt(t,-1),e[2]=t[0],e[6]=t[1],e[10]=t[2],t=[e[0],e[1],e[2]],yt(t,-1),e[0]=t[0],e[1]=t[1],e[2]=t[2],t=[e[4],e[5],e[6]],yt(t,-1),e[4]=t[0],e[5]=t[1],e[6]=t[2],t=[e[8],e[9],e[10]],yt(t,-1),e[8]=t[0],e[9]=t[1],e[10]=t[2],t=[e[3],e[7],e[11]],yt(t,-1),e[3]=t[0],e[7]=t[1],e[11]=t[2]}return new THREE.Matrix4(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function Et(e){if(e>-1&&3>e){var t=["X","Y","Z"],i={X:0,Y:1,Z:2};e=xt(t[e]),e=i[e]}return e}function xt(e){if(Ut.convertUpAxis)switch(e){case"X":switch($t){case"XtoY":case"XtoZ":case"YtoX":e="Y";break;case"ZtoX":e="Z"}break;case"Y":switch($t){case"XtoY":case"YtoX":case"ZtoX":e="X";break;case"XtoZ":case"YtoZ":case"ZtoY":e="Z"}break;case"Z":switch($t){case"XtoZ":e="X";break;case"YtoZ":case"ZtoX":case"ZtoY":e="Y"}}return e}var Tt,wt,Rt,St,Ct,Ht,Mt=null,kt=null,At=null,Pt={},Ft={},Dt={},Nt={},zt={},Lt={},It={},Ot={},Vt={},Bt=THREE.SmoothShading,Ut={centerGeometry:!1,convertUpAxis:!1,subdivideFaces:!0,upAxis:"Y",defaultEnvMap:null},jt=1,Wt="Y",$t=null;return H.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];"init_from"==i.nodeName&&(this.init_from=i.textContent)}return this},M.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.type="none";for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"skin":this.skin=(new A).parse(i),this.type=i.nodeName;break;case"morph":this.morph=(new k).parse(i),this.type=i.nodeName}}return this},k.prototype.parse=function(e){var t,i={},n=[];for(this.method=e.getAttribute("method"),this.source=e.getAttribute("source").replace(/^#/,""),t=0;t<e.childNodes.length;t++){var r=e.childNodes[t];if(1==r.nodeType)switch(r.nodeName){case"source":var o=(new q).parse(r);i[o.id]=o;break;case"targets":n=this.parseInputs(r);break;default:console.log(r.nodeName)}}for(t=0;t<n.length;t++){var s=n[t],o=i[s.source];switch(s.semantic){case"MORPH_TARGET":this.targets=o.read();break;case"MORPH_WEIGHT":this.weights=o.read()}}return this},k.prototype.parseInputs=function(e){for(var t=[],i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"input":t.push((new G).parse(n))}}return t},A.prototype.parse=function(e){var t,i,n={};this.source=e.getAttribute("source").replace(/^#/,""),this.invBindMatrices=[],this.joints=[],this.weights=[];for(var r=0;r<e.childNodes.length;r++){var o=e.childNodes[r];if(1==o.nodeType)switch(o.nodeName){case"bind_shape_matrix":var s=ut(o.textContent);this.bindShapeMatrix=bt(s);break;case"source":var a=(new q).parse(o);n[a.id]=a;break;case"joints":t=o;break;case"vertex_weights":i=o;break;default:console.log(o.nodeName)}}return this.parseJoints(t,n),this.parseWeights(i,n),this},A.prototype.parseJoints=function(e,t){for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"input":var r=(new G).parse(n),o=t[r.source];"JOINT"==r.semantic?this.joints=o.read():"INV_BIND_MATRIX"==r.semantic&&(this.invBindMatrices=o.read())}}},A.prototype.parseWeights=function(e,t){for(var i,n,r=[],o=0;o<e.childNodes.length;o++){var s=e.childNodes[o];if(1==s.nodeType)switch(s.nodeName){case"input":r.push((new G).parse(s));break;case"v":i=dt(s.textContent);break;case"vcount":n=dt(s.textContent)}}for(var a=0,o=0;o<n.length;o++){for(var l=n[o],h=[],c=0;l>c;c++){for(var u={},d=0;d<r.length;d++){var p=r[d],f=i[a+p.offset];switch(p.semantic){case"JOINT":u.joint=f;break;case"WEIGHT":u.weight=t[p.source].data[f]}}h.push(u),a+=r.length}for(var c=0;c<h.length;c++)h[c].index=o;this.weights.push(h)}},P.prototype.getChildById=function(e,t){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(e,t);if(n)return n}return null},P.prototype.getChildBySid=function(e,t){for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(e,t);if(n)return n}return null},P.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.nodes=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"node":this.nodes.push((new F).parse(i))}}return this},F.prototype.getChannelForTransform=function(e){for(var t=0;t<this.channels.length;t++){var i=this.channels[t],n=i.target.split("/");n.shift();var r,o,s=n.shift(),a=s.indexOf(".")>=0,l=s.indexOf("(")>=0;if(a)n=s.split("."),s=n.shift(),o=n.shift();else if(l){r=s.split("("),s=r.shift();for(var h=0;h<r.length;h++)r[h]=parseInt(r[h].replace(/\)/,""))}if(s==e)return i.info={sid:s,dotSyntax:a,arrSyntax:l,arrIndices:r},i}return null},F.prototype.getChildById=function(e,t){if(this.id==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildById(e,t);if(n)return n}return null},F.prototype.getChildBySid=function(e,t){if(this.sid==e)return this;if(t)for(var i=0;i<this.nodes.length;i++){var n=this.nodes[i].getChildBySid(e,t);if(n)return n}return null},F.prototype.getTransformBySid=function(e){for(var t=0;t<this.transforms.length;t++)if(this.transforms[t].sid==e)return this.transforms[t];return null},F.prototype.parse=function(e){var t;this.id=e.getAttribute("id"),this.sid=e.getAttribute("sid"),this.name=e.getAttribute("name"),this.type=e.getAttribute("type"),this.layer=e.getAttribute("layer"),this.type="JOINT"==this.type?this.type:"NODE",this.nodes=[],this.transforms=[],this.geometries=[],this.cameras=[],this.lights=[],this.controllers=[],this.matrix=new THREE.Matrix4;for(var i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"node":this.nodes.push((new F).parse(n));break;case"instance_camera":this.cameras.push((new st).parse(n));break;case"instance_controller":this.controllers.push((new N).parse(n));break;case"instance_geometry":this.geometries.push((new L).parse(n));break;case"instance_light":this.lights.push((new lt).parse(n));break;case"instance_node":t=n.getAttribute("url").replace(/^#/,"");var r=_(t);r&&this.nodes.push((new F).parse(r));break;case"rotate":case"translate":case"scale":case"matrix":case"lookat":case"skew":this.transforms.push((new D).parse(n));break;case"extra":break;default:console.log(n.nodeName)}}return this.channels=b(this),E(this),this.updateMatrix(),this},F.prototype.updateMatrix=function(){this.matrix.identity();for(var e=0;e<this.transforms.length;e++)this.transforms[e].apply(this.matrix)},D.prototype.parse=function(e){return this.sid=e.getAttribute("sid"),this.type=e.nodeName,this.data=ut(e.textContent),this.convert(),this},D.prototype.convert=function(){switch(this.type){case"matrix":this.obj=bt(this.data);break;case"rotate":this.angle=THREE.Math.degToRad(this.data[3]);case"translate":yt(this.data,-1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;case"scale":yt(this.data,1),this.obj=new THREE.Vector3(this.data[0],this.data[1],this.data[2]);break;default:console.log("Can not convert Transform of type "+this.type)}},D.prototype.apply=function(){var e=new THREE.Matrix4;return function(t){switch(this.type){case"matrix":t.multiply(this.obj);break;case"translate":t.multiply(e.makeTranslation(this.obj.x,this.obj.y,this.obj.z));break;case"rotate":t.multiply(e.makeRotationAxis(this.obj,this.angle));break;case"scale":t.scale(this.obj)}}}(),D.prototype.update=function(e,t){var i=["X","Y","Z","ANGLE"];switch(this.type){case"matrix":if(t)if(1===t.length)switch(t[0]){case 0:this.obj.n11=e[0],this.obj.n21=e[1],this.obj.n31=e[2],this.obj.n41=e[3];break;case 1:this.obj.n12=e[0],this.obj.n22=e[1],this.obj.n32=e[2],this.obj.n42=e[3];break;case 2:this.obj.n13=e[0],this.obj.n23=e[1],this.obj.n33=e[2],this.obj.n43=e[3];break;case 3:this.obj.n14=e[0],this.obj.n24=e[1],this.obj.n34=e[2],this.obj.n44=e[3]}else if(2===t.length){var n="n"+(t[0]+1)+(t[1]+1);this.obj[n]=e}else console.log("Incorrect addressing of matrix in transform.");
else this.obj.copy(e);break;case"translate":case"scale":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2]}break;case"rotate":switch("[object Array]"===Object.prototype.toString.call(t)&&(t=i[t[0]]),t){case"X":this.obj.x=e;break;case"Y":this.obj.y=e;break;case"Z":this.obj.z=e;break;case"ANGLE":this.angle=THREE.Math.degToRad(e);break;default:this.obj.x=e[0],this.obj.y=e[1],this.obj.z=e[2],this.angle=THREE.Math.degToRad(e[3])}}},N.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.skeleton=[],this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1===i.nodeType)switch(i.nodeName){case"skeleton":this.skeleton.push(i.textContent.replace(/^#/,""));break;case"bind_material":for(var n=i.querySelectorAll("instance_material"),r=0;r<n.length;r++){var o=n[r];this.instance_material.push((new z).parse(o))}break;case"extra":}}return this},z.prototype.parse=function(e){return this.symbol=e.getAttribute("symbol"),this.target=e.getAttribute("target").replace(/^#/,""),this},L.prototype.parse=function(e){this.url=e.getAttribute("url").replace(/^#/,""),this.instance_material=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType&&"bind_material"==i.nodeName){for(var n=i.querySelectorAll("instance_material"),r=0;r<n.length;r++){var o=n[r];this.instance_material.push((new z).parse(o))}break}}return this},I.prototype.parse=function(e){this.id=e.getAttribute("id"),gt(this,e);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"mesh":this.mesh=new O(this).parse(i);break;case"extra":}}return this},O.prototype.parse=function(e){this.primitives=[];var t;for(t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"source":ht(i);break;case"vertices":this.vertices=(new $).parse(i);break;case"triangles":this.primitives.push((new U).parse(i));break;case"polygons":this.primitives.push((new V).parse(i));break;case"polylist":this.primitives.push((new B).parse(i))}}this.geometry3js=new THREE.Geometry;var n=Pt[this.vertices.input.POSITION.source].data;for(t=0;t<n.length;t+=3)this.geometry3js.vertices.push(_t(n,t).clone());for(t=0;t<this.primitives.length;t++){var r=this.primitives[t];r.setVertices(this.vertices),this.handlePrimitive(r,this.geometry3js)}return this.geometry3js.computeCentroids(),this.geometry3js.computeFaceNormals(),this.geometry3js.calcNormals&&(this.geometry3js.computeVertexNormals(),delete this.geometry3js.calcNormals),this},O.prototype.handlePrimitive=function(e,t){var i,n,r,o,s,a,l,h=e.p,c=e.inputs,u=0,d=3,p=0,f=[];for(i=0;i<c.length;i++){r=c[i];var m=r.offset+1;switch(p=m>p?m:p,r.semantic){case"TEXCOORD":f.push(r.set)}}for(var g=0;g<h.length;++g)for(var v=h[g],y=0;y<v.length;){var _=[],b=[],E=null,x=[];for(d=e.vcount?e.vcount.length?e.vcount[u++]:e.vcount:v.length/p,i=0;d>i;i++)for(n=0;n<c.length;n++)switch(r=c[n],a=Pt[r.source],o=v[y+i*p+r.offset],l=a.accessor.params.length,s=o*l,r.semantic){case"VERTEX":_.push(o);break;case"NORMAL":b.push(_t(a.data,s));break;case"TEXCOORD":E=E||{},void 0===E[r.set]&&(E[r.set]=[]),E[r.set].push(new THREE.Vector2(a.data[s],a.data[s+1]));break;case"COLOR":x.push((new THREE.Color).setRGB(a.data[s],a.data[s+1],a.data[s+2]))}if(0==b.length)if(r=this.vertices.input.NORMAL){a=Pt[r.source],l=a.accessor.params.length;for(var T=0,w=_.length;w>T;T++)b.push(_t(a.data,_[T]*l))}else t.calcNormals=!0;if(!E&&(E={},r=this.vertices.input.TEXCOORD)){f.push(r.set),a=Pt[r.source],l=a.accessor.params.length;for(var T=0,w=_.length;w>T;T++)s=_[T]*l,void 0===E[r.set]&&(E[r.set]=[]),E[r.set].push(new THREE.Vector2(a.data[s],1-a.data[s+1]))}if(0==x.length&&(r=this.vertices.input.COLOR)){a=Pt[r.source],l=a.accessor.params.length;for(var T=0,w=_.length;w>T;T++)s=_[T]*l,x.push((new THREE.Color).setRGB(a.data[s],a.data[s+1],a.data[s+2]))}var R,S,C=null,H=[];if(3===d)H.push(new THREE.Face3(_[0],_[1],_[2],b,x.length?x:new THREE.Color));else if(4===d)H.push(new THREE.Face3(_[0],_[1],_[3],[b[0],b[1],b[3]],x.length?[x[0],x[1],x[3]]:new THREE.Color)),H.push(new THREE.Face3(_[1],_[2],_[3],[b[1],b[2],b[3]],x.length?[x[1],x[2],x[3]]:new THREE.Color));else if(d>4&&Ut.subdivideFaces){var M=x.length?x:new THREE.Color;for(n=1;d-1>n;)H.push(new THREE.Face3(_[0],_[n],_[n+1],[b[0],b[n++],b[n]],M))}if(H.length)for(var T=0,w=H.length;w>T;T++)for(C=H[T],C.daeMaterial=e.material,t.faces.push(C),n=0;n<f.length;n++)R=E[f[n]],S=d>4?[R[0],R[T+1],R[T+2]]:4===d?0===T?[R[0],R[1],R[3]]:[R[1].clone(),R[2],R[3].clone()]:[R[0],R[1],R[2]],void 0===t.faceVertexUvs[n]&&(t.faceVertexUvs[n]=[]),t.faceVertexUvs[n].push(S);else console.log("dropped face with vcount "+d+" for geometry with id: "+t.id);y+=p*d}},V.prototype.setVertices=function(e){for(var t=0;t<this.inputs.length;t++)this.inputs[t].source==e.id&&(this.inputs[t].source=e.input.POSITION.source)},V.prototype.parse=function(e){this.material=e.getAttribute("material"),this.count=mt(e,"count",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"input":this.inputs.push((new G).parse(e.childNodes[t]));break;case"vcount":this.vcount=dt(i.textContent);break;case"p":this.p.push(dt(i.textContent));break;case"ph":console.warn("polygon holes not yet supported!")}}return this},B.prototype=Object.create(V.prototype),U.prototype=Object.create(V.prototype),W.prototype.parse=function(e){this.params=[],this.source=e.getAttribute("source"),this.count=mt(e,"count",0),this.stride=mt(e,"stride",0);for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if("param"==i.nodeName){var n={};n.name=i.getAttribute("name"),n.type=i.getAttribute("type"),this.params.push(n)}}return this},$.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++)if("input"==e.childNodes[t].nodeName){var i=(new G).parse(e.childNodes[t]);this.input[i.semantic]=i}return this},G.prototype.parse=function(e){return this.semantic=e.getAttribute("semantic"),this.source=e.getAttribute("source").replace(/^#/,""),this.set=mt(e,"set",-1),this.offset=mt(e,"offset",0),"TEXCOORD"==this.semantic&&this.set<0&&(this.set=0),this},q.prototype.parse=function(e){this.id=e.getAttribute("id");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"bool_array":this.data=ct(i.textContent),this.type=i.nodeName;break;case"float_array":this.data=ut(i.textContent),this.type=i.nodeName;break;case"int_array":this.data=dt(i.textContent),this.type=i.nodeName;break;case"IDREF_array":case"Name_array":this.data=pt(i.textContent),this.type=i.nodeName;break;case"technique_common":for(var n=0;n<i.childNodes.length;n++)if("accessor"==i.childNodes[n].nodeName){this.accessor=(new W).parse(i.childNodes[n]);break}}}return this},q.prototype.read=function(){var e=[],t=this.accessor.params[0];switch(t.type){case"IDREF":case"Name":case"name":case"float":return this.data;case"float4x4":for(var i=0;i<this.data.length;i+=16){var n=this.data.slice(i,i+16),r=bt(n);e.push(r)}break;default:console.log("ColladaLoader: Source: Read dont know how to read "+t.type+".")}return e},X.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++)if("instance_effect"==e.childNodes[t].nodeName){this.instance_effect=(new et).parse(e.childNodes[t]);break}return this},Y.prototype.isColor=function(){return null==this.texture},Y.prototype.isTexture=function(){return null!=this.texture},Y.prototype.parse=function(e){"transparent"==e.nodeName&&(this.opaque=e.getAttribute("opaque"));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"color":var n=ut(i.textContent);this.color=new THREE.Color,this.color.setRGB(n[0],n[1],n[2]),this.color.a=n[3];break;case"texture":this.texture=i.getAttribute("texture"),this.texcoord=i.getAttribute("texcoord"),this.texOpts={offsetU:0,offsetV:0,repeatU:1,repeatV:1,wrapU:1,wrapV:1},this.parseTexture(i)}}return this},Y.prototype.parseTexture=function(e){if(!e.childNodes)return this;e.childNodes[1]&&"extra"===e.childNodes[1].nodeName&&(e=e.childNodes[1],e.childNodes[1]&&"technique"===e.childNodes[1].nodeName&&(e=e.childNodes[1]));for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"offsetU":case"offsetV":case"repeatU":case"repeatV":this.texOpts[i.nodeName]=parseFloat(i.textContent);break;case"wrapU":case"wrapV":this.texOpts[i.nodeName]="TRUE"===i.textContent.toUpperCase()?1:parseInt(i.textContent);break;default:this.texOpts[i.nodeName]=i.textContent}}return this},K.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"ambient":case"emission":case"diffuse":case"specular":case"transparent":this[i.nodeName]=(new Y).parse(i);break;case"shininess":case"reflectivity":case"index_of_refraction":case"transparency":var n=i.querySelectorAll("float");n.length>0&&(this[i.nodeName]=parseFloat(n[0].textContent))}}return this.create(),this},K.prototype.create=function(){var e={},t=!1;if(void 0!==this.transparency&&void 0!==this.transparent){this.transparent;var i=(this.transparent.color.r+this.transparent.color.g+this.transparent.color.b)/3*this.transparency;i>0&&(t=!0,e.transparent=!0,e.opacity=1-i)}for(var n in this)switch(n){case"ambient":case"emission":case"diffuse":case"specular":var r=this[n];if(r instanceof Y)if(r.isTexture()){var o=r.texture,s=this.effect.sampler[o];if(void 0!==s&&void 0!==s.source){var a=this.effect.surface[s.source],l=Ft[a.init_from];if(l){var h=THREE.ImageUtils.loadTexture(St+l.init_from);h.wrapS=r.texOpts.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.wrapT=r.texOpts.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping,h.offset.x=r.texOpts.offsetU,h.offset.y=r.texOpts.offsetV,h.repeat.x=r.texOpts.repeatU,h.repeat.y=r.texOpts.repeatV,e.map=h,"emission"===n&&(e.emissive=16777215)}}}else"diffuse"!==n&&t||("emission"===n?e.emissive=r.color.getHex():e[n]=r.color.getHex());break;case"shininess":e[n]=this[n];break;case"reflectivity":e[n]=this[n],e[n]>0&&(e.envMap=Ut.defaultEnvMap),e.combine=THREE.MixOperation;break;case"index_of_refraction":e.refractionRatio=this[n],1!==this[n]&&(e.envMap=Ut.defaultEnvMap);break;case"transparency":}switch(e.shading=Bt,e.side=this.effect.doubleSided?THREE.DoubleSide:THREE.FrontSide,this.type){case"constant":void 0!=e.emissive&&(e.color=e.emissive),this.material=new THREE.MeshBasicMaterial(e);break;case"phong":case"blinn":void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshPhongMaterial(e);break;case"lambert":default:void 0!=e.diffuse&&(e.color=e.diffuse),this.material=new THREE.MeshLambertMaterial(e)}return this.material},Q.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"init_from":this.init_from=i.textContent;break;case"format":this.format=i.textContent;break;default:console.log("unhandled Surface prop: "+i.nodeName)}}return this},J.prototype.parse=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"source":this.source=i.textContent;break;case"minfilter":this.minfilter=i.textContent;break;case"magfilter":this.magfilter=i.textContent;break;case"mipfilter":this.mipfilter=i.textContent;break;case"wrap_s":this.wrap_s=i.textContent;break;case"wrap_t":this.wrap_t=i.textContent;break;default:console.log("unhandled Sampler2D prop: "+i.nodeName)}}return this},Z.prototype.create=function(){return null==this.shader?null:void 0},Z.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),gt(this,e),this.shader=null;for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"profile_COMMON":this.parseTechnique(this.parseProfileCOMMON(i))}}return this},Z.prototype.parseNewparam=function(e){for(var t=e.getAttribute("sid"),i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"surface":this.surface[t]=new Q(this).parse(n);break;case"sampler2D":this.sampler[t]=new J(this).parse(n);break;case"extra":break;default:console.log(n.nodeName)}}},Z.prototype.parseProfileCOMMON=function(e){for(var t,i=0;i<e.childNodes.length;i++){var n=e.childNodes[i];if(1==n.nodeType)switch(n.nodeName){case"profile_COMMON":this.parseProfileCOMMON(n);break;case"technique":t=n;break;case"newparam":this.parseNewparam(n);break;case"image":var r=(new H).parse(n);Ft[r.id]=r;break;case"extra":break;default:console.log(n.nodeName)}}return t},Z.prototype.parseTechnique=function(e){for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"constant":case"lambert":case"blinn":case"phong":this.shader=new K(i.nodeName,this).parse(i)}}},et.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},tt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name"),this.source={};for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"animation":var n=(new tt).parse(i);for(var r in n.source)this.source[r]=n.source[r];for(var o=0;o<n.channel.length;o++)this.channel.push(n.channel[o]),this.sampler.push(n.sampler[o]);break;case"source":var r=(new q).parse(i);this.source[r.id]=r;break;case"sampler":this.sampler.push(new nt(this).parse(i));break;case"channel":this.channel.push(new it(this).parse(i))}}return this},it.prototype.parse=function(e){this.source=e.getAttribute("source").replace(/^#/,""),this.target=e.getAttribute("target");var t=this.target.split("/");t.shift();var i=t.shift(),n=i.indexOf(".")>=0,r=i.indexOf("(")>=0;if(n)t=i.split("."),this.sid=t.shift(),this.member=t.shift();else if(r){var o=i.split("(");this.sid=o.shift();for(var s=0;s<o.length;s++)o[s]=parseInt(o[s].replace(/\)/,""));this.arrIndices=o}else this.sid=i;return this.fullSid=i,this.dotSyntax=n,this.arrSyntax=r,this},nt.prototype.parse=function(e){this.id=e.getAttribute("id"),this.inputs=[];for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"input":this.inputs.push((new G).parse(i))}}return this},nt.prototype.create=function(){for(var e=0;e<this.inputs.length;e++){var t=this.inputs[e],i=this.animation.source[t.source];switch(t.semantic){case"INPUT":this.input=i.read();break;case"OUTPUT":this.output=i.read(),this.strideOut=i.accessor.stride;break;case"INTERPOLATION":this.interpolation=i.read();break;case"IN_TANGENT":break;case"OUT_TANGENT":break;default:console.log(t.semantic)}}if(this.startTime=0,this.endTime=0,this.duration=0,this.input.length){this.startTime=1e8,this.endTime=-1e8;for(var e=0;e<this.input.length;e++)this.startTime=Math.min(this.startTime,this.input[e]),this.endTime=Math.max(this.endTime,this.input[e]);this.duration=this.endTime-this.startTime}},nt.prototype.getData=function(e,t){var i;if("matrix"===e&&16===this.strideOut)i=this.output[t];else if(this.strideOut>1){i=[],t*=this.strideOut;for(var n=0;n<this.strideOut;++n)i[n]=this.output[t+n];if(3===this.strideOut)switch(e){case"rotate":case"translate":yt(i,-1);break;case"scale":yt(i,1)}else 4===this.strideOut&&"matrix"===e&&yt(i,-1)}else i=this.output[t];return i},rt.prototype.addTarget=function(e,t,i,n){this.targets.push({sid:e,member:i,transform:t,data:n})},rt.prototype.apply=function(e){for(var t=0;t<this.targets.length;++t){var i=this.targets[t];e&&i.sid!==e||i.transform.update(i.data,i.member)}},rt.prototype.getTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return this.targets[t];return null},rt.prototype.hasTarget=function(e){for(var t=0;t<this.targets.length;++t)if(this.targets[t].sid===e)return!0;return!1},rt.prototype.interpolate=function(e,t){for(var i=0;i<this.targets.length;++i){var n,r=this.targets[i],o=e.getTarget(r.sid);if("matrix"!==r.transform.type&&o){var s=(t-this.time)/(e.time-this.time),a=o.data,l=r.data;if((0>s||s>1)&&(console.log("Key.interpolate: Warning! Scale out of bounds:"+s),s=0>s?0:1),l.length){n=[];for(var h=0;h<l.length;++h)n[h]=l[h]+(a[h]-l[h])*s}else n=l+(a-l)*s}else n=r.data;r.transform.update(n,r.member)}},ot.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"optics":this.parseOptics(i)}}return this},ot.prototype.parseOptics=function(e){for(var t=0;t<e.childNodes.length;t++)if("technique_common"==e.childNodes[t].nodeName)for(var i=e.childNodes[t],n=0;n<i.childNodes.length;n++)if(this.technique=i.childNodes[n].nodeName,"perspective"==this.technique)for(var r=i.childNodes[n],o=0;o<r.childNodes.length;o++){var s=r.childNodes[o];switch(s.nodeName){case"yfov":this.yfov=s.textContent;break;case"xfov":this.xfov=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}else if("orthographic"==this.technique)for(var a=i.childNodes[n],o=0;o<a.childNodes.length;o++){var s=a.childNodes[o];switch(s.nodeName){case"xmag":this.xmag=s.textContent;break;case"ymag":this.ymag=s.textContent;break;case"znear":this.znear=s.textContent;break;case"zfar":this.zfar=s.textContent;break;case"aspect_ratio":this.aspect_ratio=s.textContent}}return this},st.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},at.prototype.parse=function(e){this.id=e.getAttribute("id"),this.name=e.getAttribute("name");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];if(1==i.nodeType)switch(i.nodeName){case"technique_common":this.parseCommon(i);break;case"technique":this.parseTechnique(i)}}return this},at.prototype.parseCommon=function(e){for(var t=0;t<e.childNodes.length;t++)switch(e.childNodes[t].nodeName){case"directional":case"point":case"spot":case"ambient":this.technique=e.childNodes[t].nodeName;for(var i=e.childNodes[t],n=0;n<i.childNodes.length;n++){var r=i.childNodes[n];switch(r.nodeName){case"color":var o=ut(r.textContent);this.color=new THREE.Color(0),this.color.setRGB(o[0],o[1],o[2]),this.color.a=o[3];break;case"falloff_angle":this.falloff_angle=parseFloat(r.textContent)}}}return this},at.prototype.parseTechnique=function(e){this.profile=e.getAttribute("profile");for(var t=0;t<e.childNodes.length;t++){var i=e.childNodes[t];switch(i.nodeName){case"intensity":this.intensity=parseFloat(i.textContent)}}return this},lt.prototype.parse=function(e){return this.url=e.getAttribute("url").replace(/^#/,""),this},{load:e,parse:t,setPreferredShading:i,applySkin:g,geometries:zt,options:Ut}},define("ColladaLoader",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Three",["require","jquery","Underscore","Backbone","cs!threenodes/nodes/models/Node","ColladaLoader"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H;return g=t("jquery"),v=t("Underscore"),n=t("Backbone"),l=t("cs!threenodes/nodes/models/Node"),t("ColladaLoader"),namespace("ThreeNodes.nodes.models",{Object3D:h=function(t){function n(){return this.compute=e(this.compute,this),this.applyRotation=e(this.applyRotation,this),this.apply_children=e(this.apply_children,this),this.get_children_array=e(this.get_children_array,this),this.remove=e(this.remove,this),this.deleteObjectAttributes=e(this.deleteObjectAttributes,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),y=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Object3D",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.Object3D,this.vars_shadow_options=["castShadow","receiveShadow"],this.shadow_cache=this.createCacheObject(this.vars_shadow_options),this.vars_shadow_options=["castShadow","receiveShadow"]},n.prototype.getFields=function(){var e;return e={inputs:{children:{type:"Object3D",val:[],"default":[]},position:{type:"Vector3",val:new THREE.Vector3},rotation:{type:"Any",val:new THREE.Euler},scale:{type:"Vector3",val:new THREE.Vector3(1,1,1)},visible:!0,castShadow:!1,receiveShadow:!1},outputs:{out:{type:"Any",val:this.ob}}}},n.prototype.deleteObjectAttributes=function(e){return e?(delete e.up,delete e.position,delete e.rotation,delete e.scale,delete e.matrix,delete e.matrixWorld,delete e.matrixRotationWorld,delete e.quaternion,delete e._vector):void 0},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),this.deleteObjectAttributes(this.ob),delete this.ob,delete this.shadow_cache},n.prototype.get_children_array=function(){var e;return e=this.fields.getField("children").get("value"),e&&"array"!==$.type(e)?[e]:e},n.prototype.apply_children=function(){var e,t,i,n,r,o,s,a,l;if(!this.fields.getField("children"))return!1;if(0===this.fields.getField("children").connections.length&&0!==this.ob.children.length){for(;this.ob.children.length>0;)this.ob.remove(this.ob.children[0]);return!0}for(t=this.get_children_array(),a=this.ob.children,n=0,o=a.length;o>n;n++)e=a[n],i=t.indexOf(e),e&&-1===i&&this.ob.remove(e);for(l=[],r=0,s=t.length;s>r;r++)e=t[r],i=this.ob.children.indexOf(e),e instanceof THREE.Light==!0?-1===i?(this.ob.add(e),l.push(this.trigger("RebuildAllShaders"))):l.push(void 0):-1===i?l.push(this.ob.add(e)):l.push(void 0);return l},n.prototype.applyRotation=function(e,t){return t instanceof THREE.Euler?e.setRotationFromEuler(t):t instanceof THREE.Quaternion?e.quaternion=t:t instanceof THREE.Vector3?e.rotation.set(t.x,t.y,t.z,"XYZ"):void 0},n.prototype.compute=function(){var e;return this.applyFieldsToVal(this.fields.inputs,this.ob,["children","rotation"]),e=this.fields.getField("rotation").getValue(),this.applyRotation(this.ob,e),this.apply_children(),this.fields.setField("out",this.ob)},n}(l),Scene:u=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),_=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Scene",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.Scene},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{fog:{type:"Any",val:null}}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return this.v_fog=this.fields.getField("fog")},n.prototype.remove=function(){return this.ob&&(delete this.ob.fog,delete this.ob.__objects,delete this.ob.__lights,delete this.ob.__objectsAdded,delete this.ob.__objectsRemoved),delete this.vfog,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e;return this.applyFieldsToVal(this.fields.inputs,this.ob,["children","lights","rotation"]),this.apply_children(),e=this.fields.getField("rotation").getValue(),this.applyRotation(this.ob,e),this.fields.setField("out",this.ob)},n}(h),Object3DwithMeshAndMaterial:c=function(t){function n(){return this.get_material_cache=e(this.get_material_cache,this),this.get_geometry_cache=e(this.get_geometry_cache,this),this.rebuild_geometry=e(this.rebuild_geometry,this),this.remove=e(this.remove,this),this.initialize=e(this.initialize,this),E=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.material_cache=!1,this.geometry_cache=!1},n.prototype.remove=function(){return delete this.material_cache,delete this.geometry_cache,n.__super__.remove.apply(this,arguments)},n.prototype.rebuild_geometry=function(){var e,t;return e=this.fields.getField("geometry"),e.connections.length>0?(t=e.connections[0].from_field.node,t.cached=[],t.compute()):this.fields.getField("geometry").setValue(new THREE.CubeGeometry(200,200,200))},n.prototype.get_geometry_cache=function(){var e,t,i,n,r;if(i="",e=this.fields.getField("geometry").get("value"),"array"===$.type(e))for(n=0,r=e.length;r>n;n++)t=e[n],i+=t.id;else i=e.id;return i},n.prototype.get_material_cache=function(){var e,t,i,n,r;if(i="",e=this.fields.getField("material").get("value"),"array"===$.type(e))for(n=0,r=e.length;r>n;n++)t=e[n],i+=t.id;else i=e.id;return i},n}(h),ColladaLoader:o=function(t){function n(){return this.compute=e(this.compute,this),this.onModelLoaded=e(this.onModelLoaded,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),x=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="ColladaLoader",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[new THREE.Object3D],this.file_url="",this.vars_shadow_options=["castShadow","receiveShadow"],this.shadow_cache=[],this.compute()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{file_url:""}},$.extend(!0,e,t)},n.prototype.remove=function(){var e,t,i,r;if(this.ob)for(r=this.ob,t=0,i=r.length;i>t;t++)e=r[t],this.deleteObjectAttributes(e);return delete this.model_object,n.__super__.remove.apply(this,arguments)},n.prototype.onModelLoaded=function(){var e,t,i,n,r;for(n=this.ob,r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push(e.add(this.model_object));return r},n.prototype.compute=function(){var e,t,i,n,r,o,s,a,l,h,c,u=this;if(r=!1,s=0,o=this.fields.getField("file_url").getValue(),t=this.fields.getField("castShadow").getValue(),a=this.fields.getField("receiveShadow").getValue(),""!==o&&this.file_url!==o){for(this.ob=[],i=h=0;s>=0?s>=h:h>=s;i=s>=0?++h:--h)this.ob[i]=new THREE.Object3D;n=new THREE.ColladaLoader,n.options.convertUpAxis=!0,n.load(o,function(t){var i;return i=t.scene,i.updateMatrix(),u.model_object=i,u.onModelLoaded(),e(u.model_object)})}for(e=function(i){var n,r,o,s,l,h;if(!i)return!1;if(i.castShadow=t,i.receiveShadow=a,i.material&&(r=!1,(i.material.castShadow!==t||i.material.receiveShadow!==a)&&(r=!0,i.material.castShadow=t,i.material.receiveShadow=a),r===!0&&(i.material.program=!1)),i.children&&i.children.length>0){for(l=i.children,h=[],o=0,s=l.length;s>o;o++)n=l[o],h.push(e(n));return h}},i=c=0;s>=0?s>=c:c>=s;i=s>=0?++c:--c)this.applyFieldsToVal(this.fields.inputs,this.ob[i],["children","file_url","castShadow","receiveShadow","rotation"],i),l=this.fields.getField("rotation").getValue(i),this.applyRotation(this.ob[i],l),this.ob[i].castShadow=t,this.ob[i].receiveShadow=a;return this.model_object&&this.inputValueHasChanged(this.vars_shadow_options,this.shadow_cache)&&(r=!0,e(this.model_object)),r===!0&&this.trigger("RebuildAllShaders"),this.file_url=o,this.shadow_cache=this.createCacheObject(this.vars_shadow_options),this.fields.setField("out",this.ob)},n}(h),ThreeMesh:f=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),T=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Mesh",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[new THREE.Mesh(new THREE.CubeGeometry(200,200,200),new THREE.MeshBasicMaterial({color:16711680}))],this.last_slice_count=1,this.compute()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{geometry:{type:"Geometry",val:new THREE.CubeGeometry(200,200,200)},material:{type:"Material",val:new THREE.MeshBasicMaterial({color:16711680})},overdraw:!1}},$.extend(!0,e,t)},n.prototype.remove=function(){var e,t,i,r;if(this.ob)for(r=this.ob,t=0,i=r.length;i>t;t++)e=r[t],this.deleteObjectAttributes(e),delete e.geometry,delete e.material;return n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a,l;if(i=!1,o=this.fields.getMaxInputSliceCount(),r=this.get_material_cache(),n=this.get_geometry_cache(),this.last_slice_count!==o&&(i=!0,this.last_slice_count=o),this.inputValueHasChanged(this.vars_shadow_options,this.shadow_cache)&&(i=!0),this.material_cache!==r&&this.rebuild_geometry(),this.geometry_cache!==n||this.material_cache!==r||i)for(this.ob=[],e=a=0;o>=0?o>=a:a>=o;e=o>=0?++a:--a)t=new THREE.Mesh(this.fields.getField("geometry").getValue(e),this.fields.getField("material").getValue(e)),this.ob[e]=t;for(e=l=0;o>=0?o>=l:l>=o;e=o>=0?++l:--l)this.applyFieldsToVal(this.fields.inputs,this.ob[e],["children","geometry","material","rotation"],e),s=this.fields.getField("rotation").getValue(e),this.applyRotation(this.ob[e],s);return i===!0&&this.trigger("RebuildAllShaders"),this.shadow_cache=this.createCacheObject(this.vars_shadow_options),this.geometry_cache=this.get_geometry_cache(),this.material_cache=this.get_material_cache(),this.fields.setField("out",this.ob)},n}(c),ThreeLine:p=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),w=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Line",n.group_name="Three",n.prototype.initialize=function(){return this.ob=[new THREE.Line(new THREE.CubeGeometry(200,200,200),new THREE.LineBasicMaterial({color:16777215}))],this.last_slice_count=1,this.compute()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{geometry:{type:"Geometry",val:new THREE.CubeGeometry(200,200,200)},material:{type:"Material",val:new THREE.LineBasicMaterial({color:16777215})},type:{type:"Float",val:THREE.LineStrip,values:{LineStrip:THREE.LineStrip,LinePieces:THREE.LinePieces}}}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a,l;if(i=!1,o=this.fields.getMaxInputSliceCount(),r=this.get_material_cache(),n=this.get_geometry_cache(),this.last_slice_count!==o&&(i=!0,this.last_slice_count=o),this.inputValueHasChanged(this.vars_shadow_options,this.shadow_cache)&&(i=!0),this.material_cache!==r&&this.rebuild_geometry(),this.geometry_cache!==n||this.material_cache!==r||i)for(this.ob=[],e=a=0;o>=0?o>=a:a>=o;e=o>=0?++a:--a)t=new THREE.Line(this.fields.getField("geometry").getValue(e),this.fields.getField("material").getValue(e)),this.ob[e]=t;for(e=l=0;o>=0?o>=l:l>=o;e=o>=0?++l:--l)this.applyFieldsToVal(this.fields.inputs,this.ob[e],["children","geometry","material","rotation"],e),s=this.fields.getField("rotation").getValue(e),this.applyRotation(this.ob[e],s);return i===!0&&this.trigger("RebuildAllShaders"),this.shadow_cache=this.createCacheObject(this.vars_shadow_options),this.geometry_cache=this.get_geometry_cache(),this.material_cache=this.get_material_cache(),this.fields.setField("out",this.ob)},n}(c),Camera:r=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.deleteObjectAttributes=e(this.deleteObjectAttributes,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),R=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Camera",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.PerspectiveCamera(75,800/600,1,1e4)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{fov:50,aspect:1,near:.1,far:2e3,position:{type:"Vector3",val:new THREE.Vector3},target:{type:"Vector3",val:new THREE.Vector3},useTarget:!1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.deleteObjectAttributes=function(e){return e?(delete e.up,delete e.position,delete e.rotation,delete e.scale,delete e.matrix,delete e.matrixWorld,delete e.matrixRotationWorld,delete e.quaternion,delete e._vector):void 0
},n.prototype.remove=function(){return this.deleteObjectAttributes(this.ob),delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.applyFieldsToVal(this.fields.inputs,this.ob,["target"]),this.ob.lookAt(this.fields.getField("target").getValue()),this.fields.setField("out",this.ob)},n}(l),Texture:d=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),S=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Texture",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=!1,this.cached=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{image:{type:"String",val:!1}},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e;return e=this.fields.getField("image").getValue(),e&&""!==e&&(this.cached===!1||"object"===$.type(this.cached)&&this.cached.constructor===THREE.Texture&&this.cached.image.attributes[0].nodeValue!==e)&&(this.ob=new THREE.ImageUtils.loadTexture(e),console.log("new texture"),console.log(this.ob),this.cached=this.ob),this.fields.setField("out",this.ob)},n}(l),Fog:s=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),C=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Fog",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},near:1,far:1e3},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob===!1&&(this.ob=new THREE.Fog(16777215,1,1e3)),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(l),FogExp2:a=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),H=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="FogExp2",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16777215)},density:25e-5},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob===!1&&(this.ob=new THREE.FogExp2(16777215,25e-5)),this.applyFieldsToVal(this.fields.inputs,this.ob),this.fields.setField("out",this.ob)},n}(l),WebGLRenderer:m=function(t){function n(){return this.compute=e(this.compute,this),this.apply_post_fx=e(this.apply_post_fx,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),b=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="WebGLRenderer",n.group_name="Three",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=ThreeNodes.Webgl.current_renderer,this.width=0,this.height=0},n.prototype.getFields=function(){var e,t,i;return t=new THREE.PerspectiveCamera(75,800/600,1,1e4),t.position.z=1e3,e=n.__super__.getFields.apply(this,arguments),i={inputs:{width:800,height:600,scene:{type:"Scene",val:new THREE.Scene},camera:{type:"Camera",val:t},bg_color:{type:"Color",val:new THREE.Color(0,0,0)},postfx:{type:"Array",val:[]},shadowCameraNear:3,shadowCameraFar:3e3,shadowMapWidth:512,shadowMapHeight:512,shadowMapEnabled:!1,shadowMapSoft:!0}},$.extend(!0,e,i)},n.prototype.remove=function(){return ThreeNodes.Webgl.current_camera===this.fields.getField("camera").getValue()&&(ThreeNodes.Webgl.current_camera=new THREE.PerspectiveCamera(75,800/600,1,1e4),ThreeNodes.Webgl.renderModel.camera=ThreeNodes.Webgl.current_camera),ThreeNodes.Webgl.current_scene===this.fields.getField("scene").getValue()&&(ThreeNodes.Webgl.current_scene=new THREE.Scene,ThreeNodes.Webgl.renderModel.scene=ThreeNodes.Webgl.current_scene),$(this.ob.domElement).unbind(),delete this.ob,delete this.width,delete this.height,n.__super__.remove.apply(this,arguments)},n.prototype.apply_post_fx=function(){var e;return e=this.fields.getField("postfx").getValue().slice(0),e.unshift(ThreeNodes.Webgl.renderModel),e.push(ThreeNodes.Webgl.effectScreen),ThreeNodes.Webgl.composer.passes=e},n.prototype.compute=function(){return ThreeNodes.Webgl.current_renderer?(this.trigger("on_compute"),this.applyFieldsToVal(this.fields.inputs,this.ob,["width","height","scene","camera","bg_color","postfx"]),ThreeNodes.Webgl.current_camera=this.fields.getField("camera").getValue(),ThreeNodes.Webgl.current_scene=this.fields.getField("scene").getValue(),this.fields.getField("camera").getValue().aspect=this.width/this.height,this.fields.getField("camera").getValue().updateProjectionMatrix(),this.apply_post_fx(),this.ob.clear(),ThreeNodes.Webgl.renderModel.scene=ThreeNodes.Webgl.current_scene,ThreeNodes.Webgl.renderModel.camera=ThreeNodes.Webgl.current_camera,ThreeNodes.Webgl.composer.renderer=ThreeNodes.Webgl.current_renderer,ThreeNodes.Webgl.composer.render(.05)):void 0},n}(l)})})}.call(this),window.ThreeBSP=function(){var e,t=1e-5,i=0,n=1,r=2,o=3;return e=function(t){var i,n,r,o,s,a,l=[];if(t instanceof THREE.Geometry)this.matrix=new THREE.Matrix4;else{if(!(t instanceof THREE.Mesh)){if(t instanceof e.Node)return this.tree=t,this.matrix=new THREE.Matrix4,this;throw"ThreeBSP: Given geometry is unsupported"}t.updateMatrix(),this.matrix=t.matrix.clone(),t=t.geometry}for(i=0,n=t.faces.length;n>i;i++)r=t.faces[i],s=t.faceVertexUvs[0][i],a=new e.Polygon,r instanceof THREE.Face3?(o=t.vertices[r.a],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[0],new THREE.Vector2(s[0].x,s[0].y)),o.applyMatrix4(this.matrix),a.vertices.push(o),o=t.vertices[r.b],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[1],new THREE.Vector2(s[1].x,s[1].y)),o.applyMatrix4(this.matrix),a.vertices.push(o),o=t.vertices[r.c],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[2],new THREE.Vector2(s[2].x,s[2].y)),o.applyMatrix4(this.matrix),a.vertices.push(o)):(o=t.vertices[r.a],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[0],new THREE.Vector2(s[0].x,s[0].y)),o.applyMatrix4(this.matrix),a.vertices.push(o),o=t.vertices[r.b],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[1],new THREE.Vector2(s[1].x,s[1].y)),o.applyMatrix4(this.matrix),a.vertices.push(o),o=t.vertices[r.c],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[2],new THREE.Vector2(s[2].x,s[2].y)),o.applyMatrix4(this.matrix),a.vertices.push(o),o=t.vertices[r.d],o=new e.Vertex(o.x,o.y,o.z,r.vertexNormals[3],new THREE.Vector2(s[3].x,s[3].y)),o.applyMatrix4(this.matrix),a.vertices.push(o)),a.calculateProperties(),l.push(a);this.tree=new e.Node(l)},e.prototype.subtract=function(t){var i=this.tree.clone(),n=t.tree.clone();return i.invert(),i.clipTo(n),n.clipTo(i),n.invert(),n.clipTo(i),n.invert(),i.build(n.allPolygons()),i.invert(),i=new e(i),i.matrix=this.matrix,i},e.prototype.union=function(t){var i=this.tree.clone(),n=t.tree.clone();return i.clipTo(n),n.clipTo(i),n.invert(),n.clipTo(i),n.invert(),i.build(n.allPolygons()),i=new e(i),i.matrix=this.matrix,i},e.prototype.intersect=function(t){var i=this.tree.clone(),n=t.tree.clone();return i.invert(),n.clipTo(i),n.invert(),i.clipTo(n),n.clipTo(i),i.build(n.allPolygons()),i.invert(),i=new e(i),i.matrix=this.matrix,i},e.prototype.toGeometry=function(){var e,t,i,n,r,o,s,a,l,h,c=(new THREE.Matrix4).getInverse(this.matrix),u=new THREE.Geometry,d=this.tree.allPolygons(),p=d.length,f={};for(e=0;p>e;e++)for(i=d[e],n=i.vertices.length,t=2;n>t;t++)h=[],a=i.vertices[0],h.push(new THREE.Vector2(a.uv.x,a.uv.y)),a=new THREE.Vector3(a.x,a.y,a.z),a.applyMatrix4(c),"undefined"!=typeof f[a.x+","+a.y+","+a.z]?r=f[a.x+","+a.y+","+a.z]:(u.vertices.push(a),r=f[a.x+","+a.y+","+a.z]=u.vertices.length-1),a=i.vertices[t-1],h.push(new THREE.Vector2(a.uv.x,a.uv.y)),a=new THREE.Vector3(a.x,a.y,a.z),a.applyMatrix4(c),"undefined"!=typeof f[a.x+","+a.y+","+a.z]?o=f[a.x+","+a.y+","+a.z]:(u.vertices.push(a),o=f[a.x+","+a.y+","+a.z]=u.vertices.length-1),a=i.vertices[t],h.push(new THREE.Vector2(a.uv.x,a.uv.y)),a=new THREE.Vector3(a.x,a.y,a.z),a.applyMatrix4(c),"undefined"!=typeof f[a.x+","+a.y+","+a.z]?s=f[a.x+","+a.y+","+a.z]:(u.vertices.push(a),s=f[a.x+","+a.y+","+a.z]=u.vertices.length-1),l=new THREE.Face3(r,o,s,new THREE.Vector3(i.normal.x,i.normal.y,i.normal.z)),u.faces.push(l),u.faceVertexUvs[0].push(h);return u},e.prototype.toMesh=function(e){var t=this.toGeometry(),i=new THREE.Mesh(t,e);return i.position.getPositionFromMatrix(this.matrix),i.rotation.setFromRotationMatrix(this.matrix),i},e.Polygon=function(e){e instanceof Array||(e=[]),this.vertices=e,e.length>0?this.calculateProperties():this.normal=this.w=void 0},e.Polygon.prototype.calculateProperties=function(){var e=this.vertices[0],t=this.vertices[1],i=this.vertices[2];return this.normal=t.clone().subtract(e).cross(i.clone().subtract(e)).normalize(),this.w=this.normal.clone().dot(e),this},e.Polygon.prototype.clone=function(){var t,i,n=new e.Polygon;for(t=0,i=this.vertices.length;i>t;t++)n.vertices.push(this.vertices[t].clone());return n.calculateProperties(),n},e.Polygon.prototype.flip=function(){var e,t=[];for(this.normal.multiplyScalar(-1),this.w*=-1,e=this.vertices.length-1;e>=0;e--)t.push(this.vertices[e]);return this.vertices=t,this},e.Polygon.prototype.classifyVertex=function(e){var o=this.normal.dot(e)-this.w;return-t>o?r:o>t?n:i},e.Polygon.prototype.classifySide=function(e){var t,s,a,l=0,h=0,c=e.vertices.length;for(t=0;c>t;t++)s=e.vertices[t],a=this.classifyVertex(s),a===n?l++:a===r&&h++;return l>0&&0===h?n:0===l&&h>0?r:0===l&&0===h?i:o},e.Polygon.prototype.splitPolygon=function(t,s,a,l,h){var c=this.classifySide(t);if(c===i)(this.normal.dot(t.normal)>0?s:a).push(t);else if(c===n)l.push(t);else if(c===r)h.push(t);else{var u,d,p,f,m,g,v,y,_,b=[],E=[];for(d=0,u=t.vertices.length;u>d;d++)p=(d+1)%u,g=t.vertices[d],v=t.vertices[p],f=this.classifyVertex(g),m=this.classifyVertex(v),f!=r&&b.push(g),f!=n&&E.push(g),(f|m)===o&&(y=(this.w-this.normal.dot(g))/this.normal.dot(v.clone().subtract(g)),_=g.interpolate(v,y),b.push(_),E.push(_));b.length>=3&&l.push(new e.Polygon(b).calculateProperties()),E.length>=3&&h.push(new e.Polygon(E).calculateProperties())}},e.Vertex=function(e,t,i,n,r){this.x=e,this.y=t,this.z=i,this.normal=n||new THREE.Vector3,this.uv=r||new THREE.Vector2},e.Vertex.prototype.clone=function(){return new e.Vertex(this.x,this.y,this.z,this.normal.clone(),this.uv.clone())},e.Vertex.prototype.add=function(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this},e.Vertex.prototype.subtract=function(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this},e.Vertex.prototype.multiplyScalar=function(e){return this.x*=e,this.y*=e,this.z*=e,this},e.Vertex.prototype.cross=function(e){var t=this.x,i=this.y,n=this.z;return this.x=i*e.z-n*e.y,this.y=n*e.x-t*e.z,this.z=t*e.y-i*e.x,this},e.Vertex.prototype.normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z);return this.x/=e,this.y/=e,this.z/=e,this},e.Vertex.prototype.dot=function(e){return this.x*e.x+this.y*e.y+this.z*e.z},e.Vertex.prototype.lerp=function(e,t){return this.add(e.clone().subtract(this).multiplyScalar(t)),this.normal.add(e.normal.clone().sub(this.normal).multiplyScalar(t)),this.uv.add(e.uv.clone().sub(this.uv).multiplyScalar(t)),this},e.Vertex.prototype.interpolate=function(e,t){return this.clone().lerp(e,t)},e.Vertex.prototype.applyMatrix4=function(e){var t=this.x,i=this.y,n=this.z,r=e.elements;return this.x=r[0]*t+r[4]*i+r[8]*n+r[12],this.y=r[1]*t+r[5]*i+r[9]*n+r[13],this.z=r[2]*t+r[6]*i+r[10]*n+r[14],this},e.Node=function(t){var i,n,r=[],o=[];if(this.polygons=[],this.front=this.back=void 0,t instanceof Array&&0!==t.length){for(this.divider=t[0].clone(),i=0,n=t.length;n>i;i++)this.divider.splitPolygon(t[i],this.polygons,this.polygons,r,o);r.length>0&&(this.front=new e.Node(r)),o.length>0&&(this.back=new e.Node(o))}},e.Node.isConvex=function(e){var t,i;for(t=0;t<e.length;t++)for(i=0;i<e.length;i++)if(t!==i&&e[t].classifySide(e[i])!==r)return!1;return!0},e.Node.prototype.build=function(t){var i,n,r=[],o=[];for(this.divider||(this.divider=t[0].clone()),i=0,n=t.length;n>i;i++)this.divider.splitPolygon(t[i],this.polygons,this.polygons,r,o);r.length>0&&(this.front||(this.front=new e.Node),this.front.build(r)),o.length>0&&(this.back||(this.back=new e.Node),this.back.build(o))},e.Node.prototype.allPolygons=function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},e.Node.prototype.clone=function(){var t=new e.Node;return t.divider=this.divider.clone(),t.polygons=this.polygons.map(function(e){return e.clone()}),t.front=this.front&&this.front.clone(),t.back=this.back&&this.back.clone(),t},e.Node.prototype.invert=function(){var e,t,i;for(e=0,t=this.polygons.length;t>e;e++)this.polygons[e].flip();return this.divider.flip(),this.front&&this.front.invert(),this.back&&this.back.invert(),i=this.front,this.front=this.back,this.back=i,this},e.Node.prototype.clipPolygons=function(e){var t,i,n,r;if(!this.divider)return e.slice();for(n=[],r=[],t=0,i=e.length;i>t;t++)this.divider.splitPolygon(e[t],n,r,n,r);return this.front&&(n=this.front.clipPolygons(n)),r=this.back?this.back.clipPolygons(r):[],n.concat(r)},e.Node.prototype.clipTo=function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},e}(),define("ThreeCSG",function(){}),CSG=function(){this.polygons=[]},CSG.fromPolygons=function(e){var t=new CSG;return t.polygons=e,t},CSG.prototype={clone:function(){var e=new CSG;return e.polygons=this.polygons.map(function(e){return e.clone()}),e},toPolygons:function(){return this.polygons},union:function(e){var t=new CSG.Node(this.clone().polygons),i=new CSG.Node(e.clone().polygons);return t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),CSG.fromPolygons(t.allPolygons())},subtract:function(e){var t=new CSG.Node(this.clone().polygons),i=new CSG.Node(e.clone().polygons);return t.invert(),t.clipTo(i),i.clipTo(t),i.invert(),i.clipTo(t),i.invert(),t.build(i.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},intersect:function(e){var t=new CSG.Node(this.clone().polygons),i=new CSG.Node(e.clone().polygons);return t.invert(),i.clipTo(t),i.invert(),t.clipTo(i),i.clipTo(t),t.build(i.allPolygons()),t.invert(),CSG.fromPolygons(t.allPolygons())},inverse:function(){var e=this.clone();return e.polygons.map(function(e){e.flip()}),e}},CSG.cube=function(e){e=e||{};var t=new CSG.Vector(e.center||[0,0,0]),i=e.radius?e.radius.length?e.radius:[e.radius,e.radius,e.radius]:[1,1,1];return CSG.fromPolygons([[[0,4,6,2],[-1,0,0]],[[1,3,7,5],[1,0,0]],[[0,1,5,4],[0,-1,0]],[[2,6,7,3],[0,1,0]],[[0,2,3,1],[0,0,-1]],[[4,5,7,6],[0,0,1]]].map(function(e){return new CSG.Polygon(e[0].map(function(n){var r=new CSG.Vector(t.x+i[0]*(2*!!(1&n)-1),t.y+i[1]*(2*!!(2&n)-1),t.z+i[2]*(2*!!(4&n)-1));return new CSG.Vertex(r,new CSG.Vector(e[1]))}))}))},CSG.sphere=function(e){function t(e,t){e*=2*Math.PI,t*=Math.PI;var o=new CSG.Vector(Math.cos(e)*Math.sin(t),Math.cos(t),Math.sin(e)*Math.sin(t));i.push(new CSG.Vertex(n.plus(o.times(r)),o))}e=e||{};for(var i,n=new CSG.Vector(e.center||[0,0,0]),r=e.radius||1,o=e.slices||16,s=e.stacks||8,a=[],l=0;o>l;l++)for(var h=0;s>h;h++)i=[],t(l/o,h/s),h>0&&t((l+1)/o,h/s),s-1>h&&t((l+1)/o,(h+1)/s),t(l/o,(h+1)/s),a.push(new CSG.Polygon(i));return CSG.fromPolygons(a)},CSG.cylinder=function(e){function t(e,t,n){var s=2*t*Math.PI,l=h.times(Math.cos(s)).plus(c.times(Math.sin(s))),u=i.plus(r.times(e)).plus(l.times(o)),d=l.times(1-Math.abs(n)).plus(a.times(n));return new CSG.Vertex(u,d)}e=e||{};for(var i=new CSG.Vector(e.start||[0,-1,0]),n=new CSG.Vector(e.end||[0,1,0]),r=n.minus(i),o=e.radius||1,s=e.slices||16,a=r.unit(),l=Math.abs(a.y)>.5,h=new CSG.Vector(l,!l,0).cross(a).unit(),c=h.cross(a).unit(),u=new CSG.Vertex(i,a.negated()),d=new CSG.Vertex(n,a.unit()),p=[],f=0;s>f;f++){var m=f/s,g=(f+1)/s;p.push(new CSG.Polygon([u,t(0,m,-1),t(0,g,-1)])),p.push(new CSG.Polygon([t(0,g,0),t(0,m,0),t(1,m,0),t(1,g,0)])),p.push(new CSG.Polygon([d,t(1,g,1),t(1,m,1)]))}return CSG.fromPolygons(p)},CSG.Vector=function(e,t,i){3==arguments.length?(this.x=e,this.y=t,this.z=i):"x"in e?(this.x=e.x,this.y=e.y,this.z=e.z):(this.x=e[0],this.y=e[1],this.z=e[2])},CSG.Vector.prototype={clone:function(){return new CSG.Vector(this.x,this.y,this.z)},negated:function(){return new CSG.Vector(-this.x,-this.y,-this.z)},plus:function(e){return new CSG.Vector(this.x+e.x,this.y+e.y,this.z+e.z)},minus:function(e){return new CSG.Vector(this.x-e.x,this.y-e.y,this.z-e.z)},times:function(e){return new CSG.Vector(this.x*e,this.y*e,this.z*e)},dividedBy:function(e){return new CSG.Vector(this.x/e,this.y/e,this.z/e)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lerp:function(e,t){return this.plus(e.minus(this).times(t))},length:function(){return Math.sqrt(this.dot(this))},unit:function(){return this.dividedBy(this.length())},cross:function(e){return new CSG.Vector(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}},CSG.Vertex=function(e,t){this.pos=new CSG.Vector(e),this.normal=new CSG.Vector(t)},CSG.Vertex.prototype={clone:function(){return new CSG.Vertex(this.pos.clone(),this.normal.clone())},flip:function(){this.normal=this.normal.negated()},interpolate:function(e,t){return new CSG.Vertex(this.pos.lerp(e.pos,t),this.normal.lerp(e.normal,t))}},CSG.Plane=function(e,t){this.normal=e,this.w=t},CSG.Plane.EPSILON=1e-5,CSG.Plane.fromPoints=function(e,t,i){var n=t.minus(e).cross(i.minus(e)).unit();return new CSG.Plane(n,n.dot(e))},CSG.Plane.prototype={clone:function(){return new CSG.Plane(this.normal.clone(),this.w)},flip:function(){this.normal=this.normal.negated(),this.w=-this.w},splitPolygon:function(e,t,i,n,r){for(var o=0,s=1,a=2,l=3,h=0,c=[],u=0;u<e.vertices.length;u++){var d=this.normal.dot(e.vertices[u].pos)-this.w,p=d<-CSG.Plane.EPSILON?a:d>CSG.Plane.EPSILON?s:o;h|=p,c.push(p)}switch(h){case o:(this.normal.dot(e.plane.normal)>0?t:i).push(e);break;case s:n.push(e);break;case a:r.push(e);break;case l:for(var f=[],m=[],u=0;u<e.vertices.length;u++){var g=(u+1)%e.vertices.length,v=c[u],y=c[g],_=e.vertices[u],b=e.vertices[g];if(v!=a&&f.push(_),v!=s&&m.push(v!=a?_.clone():_),(v|y)==l){var d=(this.w-this.normal.dot(_.pos))/this.normal.dot(b.pos.minus(_.pos)),E=_.interpolate(b,d);f.push(E),m.push(E.clone())}}f.length>=3&&n.push(new CSG.Polygon(f,e.shared)),m.length>=3&&r.push(new CSG.Polygon(m,e.shared))}}},CSG.Polygon=function(e,t){this.vertices=e,this.shared=t,this.plane=CSG.Plane.fromPoints(e[0].pos,e[1].pos,e[2].pos)},CSG.Polygon.prototype={clone:function(){var e=this.vertices.map(function(e){return e.clone()});return new CSG.Polygon(e,this.shared)},flip:function(){this.vertices.reverse().map(function(e){e.flip()}),this.plane.flip()}},CSG.Node=function(e){this.plane=null,this.front=null,this.back=null,this.polygons=[],e&&this.build(e)},CSG.Node.prototype={clone:function(){var e=new CSG.Node;return e.plane=this.plane&&this.plane.clone(),e.front=this.front&&this.front.clone(),e.back=this.back&&this.back.clone(),e.polygons=this.polygons.map(function(e){return e.clone()}),e},invert:function(){for(var e=0;e<this.polygons.length;e++)this.polygons[e].flip();this.plane.flip(),this.front&&this.front.invert(),this.back&&this.back.invert();var t=this.front;this.front=this.back,this.back=t},clipPolygons:function(e){if(!this.plane)return e.slice();for(var t=[],i=[],n=0;n<e.length;n++)this.plane.splitPolygon(e[n],t,i,t,i);return this.front&&(t=this.front.clipPolygons(t)),i=this.back?this.back.clipPolygons(i):[],t.concat(i)},clipTo:function(e){this.polygons=e.clipPolygons(this.polygons),this.front&&this.front.clipTo(e),this.back&&this.back.clipTo(e)},allPolygons:function(){var e=this.polygons.slice();return this.front&&(e=e.concat(this.front.allPolygons())),this.back&&(e=e.concat(this.back.allPolygons())),e},build:function(e){if(e.length){this.plane||(this.plane=e[0].plane.clone());for(var t=[],i=[],n=0;n<e.length;n++)this.plane.splitPolygon(e[n],this.polygons,this.polygons,t,i);t.length&&(this.front||(this.front=new CSG.Node),this.front.build(t)),i.length&&(this.back||(this.back=new CSG.Node),this.back.build(i))}}},define("csg",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/ConstructiveSolidGeometry",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/nodes/models/Node","Three","csg","ThreeCSG"],function(t){var n,r,o,s,a,l,h,c,u,d,p;return c=t("Underscore"),n=t("Backbone"),h=t("cs!threenodes/utils/Utils"),a=t("cs!threenodes/nodes/models/Node"),t("Three"),t("csg"),t("ThreeCSG"),namespace("ThreeNodes.nodes.models",{NodeCSG:l=function(t){function n(){this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.get_cache_array=e(this.get_cache_array,this),this.comput_csg_geometry=e(this.comput_csg_geometry,this),this.getFields=e(this.getFields,this),n.__super__.constructor.apply(this,arguments),this.auto_evaluate=!0,this.ob=!1,this.cached=[]}return i(n,t),n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{a:{type:"Any",val:!1},position_a:{type:"Vector3",val:new THREE.Vector3},rotation_a:{type:"Vector3",val:new THREE.Vector3},b:{type:"Any",val:!1},position_b:{type:"Vector3",val:new THREE.Vector3},rotation_b:{type:"Vector3",val:new THREE.Vector3}},outputs:{geometry:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.comput_csg_geometry=function(e,t){return e.union(t)},n.prototype.get_cache_array=function(){var e,t,i,n,r,o;return e=this.fields.getField("a").getValue(),i=this.fields.getField("position_a").getValue(),r=this.fields.getField("rotation_a").getValue(),t=this.fields.getField("b").getValue(),n=this.fields.getField("position_b").getValue(),o=this.fields.getField("rotation_b").getValue(),e&&t?[e.id,t.id,i.x,i.y,i.z,r.x,r.y,r.z,n.x,n.y,n.z,o.x,o.y,o.z]:[]},n.prototype.remove=function(){return delete this.ob,delete this.cached,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a,l,c;return e=this.fields.getField("a").getValue(),s=this.fields.getField("position_a").getValue(),l=this.fields.getField("rotation_a").getValue(),t=this.fields.getField("b").getValue(),a=this.fields.getField("position_b").getValue(),c=this.fields.getField("rotation_b").getValue(),o=this.get_cache_array(),e&&t&&h.flatArraysAreEquals(o,this.cached)===!1&&(console.log("csg operation"),i=THREE.CSG.toCSG(e,s,l),n=THREE.CSG.toCSG(t,a,c),r=this.comput_csg_geometry(i,n),this.ob=THREE.CSG.fromCSG(r),this.cached=o),this.fields.setField("geometry",this.ob)},n}(a),CsgUnion:s=function(e){function t(){return u=t.__super__.constructor.apply(this,arguments)}return i(t,e),t.node_name="Union",t.group_name="Constructive-Geometry",t}(l),CsgSubtract:o=function(t){function n(){return this.comput_csg_geometry=e(this.comput_csg_geometry,this),d=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Subtract",n.group_name="Constructive-Geometry",n.prototype.comput_csg_geometry=function(e,t){return e.subtract(t)},n}(l),CsgIntersect:r=function(t){function n(){return this.comput_csg_geometry=e(this.comput_csg_geometry,this),p=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Intersect",n.group_name="Constructive-Geometry",n.prototype.comput_csg_geometry=function(e,t){return e.intersect(t)},n}(l)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Utils",["require","Underscore","Backbone","cs!threenodes/nodes/models/Node","cs!threenodes/nodes/views/NodeWithCenterTextfield"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R;return f=t("Underscore"),n=t("Backbone"),c=t("cs!threenodes/nodes/models/Node"),u=t("cs!threenodes/nodes/views/NodeWithCenterTextfield"),namespace("ThreeNodes.nodes.views",{Random:d=function(t){function n(){return this.getCenterField=e(this.getCenterField,this),m=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.getCenterField=function(){return this.model.fields.getField("out",!0)},n}(u),LFO:s=function(t){function n(){return this.getCenterField=e(this.getCenterField,this),g=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.getCenterField=function(){return this.model.fields.getField("out",!0)},n}(u),Timer:p=function(t){function n(){return this.getCenterField=e(this.getCenterField,this),y=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.getCenterField=function(){return this.model.fields.getField("out",!0)},n}(u)}),namespace("ThreeNodes.nodes.models",{Random:d=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),_=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Random",n.group_name="Utils",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{min:0,max:1},outputs:{out:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e;return e=this.fields.getField("min").getValue()+Math.random()*(this.fields.getField("max").getValue()-this.fields.getField("min").getValue()),this.fields.setField("out",e)},n}(c),LFO:s=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),b=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="LFO",n.group_name="Utils",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.rndB=Math.random(),this.rndA=this.rndB,this.rndrange=1,this.flip=0,this.taskinterval=1,this.taskintervalhold=20,this.clock=0,this.PI=3.14159},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{min:0,max:1,duration:1e3,mode:{type:"Float",val:0,values:{sawtooth:0,sine:1,triangle:2,"square waver":3,random:4,"random triangle":5}}},outputs:{out:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i,n,r,o,s,a,l,h,c,u,d;return e=this.fields.getField("duration").getValue(),a=this.fields.getField("min").getValue(),s=this.fields.getField("max").getValue(),l=this.fields.getField("mode").getValue(),this.clock=Date.now(),d=this.taskinterval*this.clock%e,c=d/e,h=s-a,n=0,r=function(){switch(l){case 0:return c*h+a;case 1:return h*Math.sin(c*this.PI)+a;case 2:return t=e/2,t>d?2*c*h+a:(u=(t-(d-t))/e,2*u*h+a);case 3:return o=e/2>d,i=d>=e/2,o*a+i*s;case 4:return d>=e-this.taskinterval&&(this.rndA=Math.random()),this.rndA*h+a;case 5:return d<this.taskinterval&&(this.rndA=this.rndB,this.rndB=h*Math.random()+a,this.rndrange=this.rndB-this.rndA),c*this.rndrange+this.rndA}}.call(this),this.fields.setField("out",r)},n}(c),Merge:a=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),E=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Merge",n.group_name="Utils",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0},n.prototype.getFields=function(){var e;return e={inputs:{in0:{type:"Any",val:null},in1:{type:"Any",val:null},in2:{type:"Any",val:null},in3:{type:"Any",val:null},in4:{type:"Any",val:null},in5:{type:"Any",val:null}},outputs:{out:{type:"Array",val:[]}}}},n.prototype.compute=function(){var e,t,i,n;i=[];for(e in this.fields.inputs)t=this.fields.inputs[e],null!==t.get("value")&&t.connections.length>0&&(n=t.get("value"),"array"===jQuery.type(n)?i=i.concat(n):i[i.length]=n);return this.fields.setField("out",i)},n}(c),Get:o=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),x=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Get",n.group_name="Utils",n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{array:{type:"Array",val:null},index:0},outputs:{out:{type:"Any",val:null}}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t,i;return i=this.fields.getField("out",!0).getValue(),this.value=!1,e=this.fields.getField("array").getValue(),t=parseInt(this.fields.getField("index").getValue()),"array"===$.type(e)&&(this.value=e[t%e.length]),this.value!==i?this.fields.setField("out",this.value):void 0},n}(c),Mp3Input:h=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getAverageLevel=e(this.getAverageLevel,this),this.onSoundLoad=e(this.onSoundLoad,this),this.loadAudioBuffer=e(this.loadAudioBuffer,this),this.loadAudio=e(this.loadAudio,this),this.createSound=e(this.createSound,this),this.finishLoad=e(this.finishLoad,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),this.is_chrome=e(this.is_chrome,this),T=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Mp3Input",n.group_name="Utils",n.prototype.is_chrome=function(){return navigator.userAgent.toLowerCase().indexOf("chrome")>-1},n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.counter=0,this.is_chrome()?this.audioContext=new window.webkitAudioContext:$(".options",this.main_view).prepend('<p class="warning">This node currently require chrome.</p>'),this.url_cache=""},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{url:"",smoothingTime:.1},outputs:{average:0,low:0,medium:0,high:0}},$.extend(!0,e,t)},n.prototype.remove=function(){return this.stopSound(),delete this.audioContext,delete this.url_cache,n.__super__.remove.apply(this,arguments)},n.prototype.onRegister=function(){return n.__super__.onRegister.apply(this,arguments),""!==this.fields.getField("url").getValue()?this.loadAudio(this.fields.getField("url").getValue()):void 0},n.prototype.stopSound=function(){return this.source?(this.source.noteOff(0),this.source.disconnect(0),console.log("stop sound")):void 0},n.prototype.playSound=function(e){return this.source&&this.audioContext&&this.audioBuffer?(this.stopSound(),this.source=this.createSound(),this.source.noteGrainOn(0,e,this.audioBuffer.duration-e)):void 0},n.prototype.finishLoad=function(){var e;return this.source.buffer=this.audioBuffer,this.source.looping=!0,this.onSoundLoad(),Timeline.getGlobalInstance().maxTime=this.audioBuffer.duration,e=function(e,t){return setTimeout(t,e)},e(1e3,function(){return Timeline.getGlobalInstance().stop(),Timeline.getGlobalInstance().play()})},n.prototype.createSound=function(){var e;
return e=this.audioContext.createBufferSource(),this.audioBuffer&&(e.buffer=this.audioBuffer),e.connect(this.analyser),this.analyser.connect(this.audioContext.destination),e},n.prototype.loadAudio=function(e){return Timeline.getGlobalInstance().stop(),this.analyser=this.audioContext.createAnalyser(),this.analyser.fftSize=1024,this.source=this.createSound(),this.loadAudioBuffer(e)},n.prototype.loadAudioBuffer=function(e){var t,i=this;return t=new XMLHttpRequest,t.open("GET",e,!0),t.responseType="arraybuffer",t.onload=function(){return i.audioBuffer=i.audioContext.createBuffer(t.response,!1),i.finishLoad()},t.send(),this},n.prototype.onSoundLoad=function(){return this.freqByteData=new Uint8Array(this.analyser.frequencyBinCount),this.timeByteData=new Uint8Array(this.analyser.frequencyBinCount)},n.prototype.getAverageLevel=function(e,t){var i,n,r,o;if(null==e&&(e=0),null==t&&(t=512),!this.freqByteData)return 0;for(e=Math.floor(e),t=Math.floor(t),n=t-e,r=0,i=o=e;t>=e?t>=o:o>=t;i=t>=e?++o:--o)r+=this.freqByteData[i];return r/n},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),this.source&&(this.source.noteOff(0),this.source.disconnect()),this.freqByteData=!1,this.timeByteData=!1,this.audioBuffer=!1,this.audioContext=!1,this.source=!1},n.prototype.compute=function(){var e,t;if(this.is_chrome())return this.url_cache!==this.fields.getField("url").getValue()&&(this.url_cache=this.fields.getField("url").getValue(),this.loadAudio(this.url_cache)),this.analyser&&(this.analyser.smoothingTimeConstant=this.fields.getField("smoothingTime").getValue(),this.analyser.getByteFrequencyData(this.freqByteData),this.analyser.getByteTimeDomainData(this.timeByteData)),this.freqByteData&&(e=this.freqByteData.length,t=e/3,this.fields.setField("average",this.getAverageLevel(0,e-1)),this.fields.setField("low",this.getAverageLevel(0,t-1)),this.fields.setField("medium",this.getAverageLevel(t,2*t-1)),this.fields.setField("high",this.getAverageLevel(2*t,e-1))),!0},n}(c),Mouse:l=function(t){function n(){return this.compute=e(this.compute,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),w=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Mouse",n.group_name="Utils",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={outputs:{xy:{type:"Vector2",val:new THREE.Vector2},x:0,y:0}},$.extend(!0,e,t)},n.prototype.compute=function(){var e,t;return e=ThreeNodes.renderer.mouseX,t=ThreeNodes.renderer.mouseY,this.fields.setField("xy",new THREE.Vector2(e,t)),this.fields.setField("x",e),this.fields.setField("y",t)},n}(c),Timer:p=function(t){function n(){return this.compute=e(this.compute,this),this.get_time=e(this.get_time,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),R=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Timer",n.group_name="Utils",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.old=this.get_time(),this.counter=0},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{reset:!1,pause:!1,max:99999999999},outputs:{out:0}},$.extend(!0,e,t)},n.prototype.get_time=function(){return(new Date).getTime()},n.prototype.compute=function(){var e,t,i;return i=this.fields.getField("out",!0).getValue(),t=this.get_time(),this.fields.getField("pause").getValue()===!1&&(this.counter+=t-this.old),this.fields.getField("reset").getValue()===!0&&(this.counter=0),e=this.fields.getField("max").getValue()-this.counter,0>=e&&(this.counter=0),this.old=t,this.fields.setField("out",this.counter)},n}(c),Font:r=function(n){function r(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),v=r.__super__.constructor.apply(this,arguments)}return i(r,n),r.node_name="Font",r.group_name="Utils",r.prototype.initialize=function(){var e,t;r.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob="",e="../../../../../../assets/fonts/",this.files={helvetiker:{normal:e+"helvetiker_regular.typeface",bold:e+"helvetiker_bold.typeface"},optimer:{normal:e+"optimer_regular.typeface",bold:e+"optimer_bold.typeface"},gentilis:{normal:e+"gentilis_regular.typeface",bold:e+"gentilis_bold.typeface"},"droid sans":{normal:e+"droid/droid_sans_regular.typeface",bold:e+"droid/droid_sans_bold.typeface"},"droid serif":{normal:e+"droid/droid_serif_regular.typeface",bold:e+"droid/droid_serif_bold.typeface"}},this.reverseFontMap={},this.reverseWeightMap={};for(t in this.fields.getField("weight").get("possibilities"))this.reverseWeightMap[this.fields.getField("weight").get("possibilities")[t]]=t;for(t in this.fields.getField("font").get("possibilities"))this.reverseFontMap[this.fields.getField("font").get("possibilities")[t]]=t;return this.fontcache=-1,this.weightcache=-1},r.prototype.getFields=function(){var e,t;return e=r.__super__.getFields.apply(this,arguments),t={inputs:{font:{type:"Float",val:0,values:{helvetiker:0,optimer:1,gentilis:2,"droid sans":3,"droid serif":4}},weight:{type:"Float",val:0,values:{normal:0,bold:1}}},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},r.prototype.remove=function(){return delete this.reverseFontMap,delete this.reverseWeightMap,delete this.ob,r.__super__.remove.apply(this,arguments)},r.prototype.compute=function(){var e,i,n,r,o=this;return e=parseInt(this.fields.getField("font").getValue()),r=parseInt(this.fields.getField("weight").getValue()),(e>4||0>e)&&(e=0),(0!==r||1!==r)&&(r=0),i=this.reverseFontMap[e],n=this.reverseWeightMap[r],(e!==this.fontcache||r!==this.weightcache)&&t([this.files[i][n]],function(){return o.ob={font:i,weight:n}}),this.fontcache=e,this.weightcache=r,this.fields.setField("out",this.ob)},r}(c)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/utils/Rc4Random",["require"],function(){var t;return t=function(){function t(t){this.getRandomNumber=e(this.getRandomNumber,this),this.getRandomByte=e(this.getRandomByte,this);var i,n,r,o,s,a,l;for(this.keySchedule=[],this.keySchedule_i=0,this.keySchedule_j=0,i=o=0,a=255;a>=0?a>=o:o>=a;i=a>=0?++o:--o)this.keySchedule[i]=i;for(n=0,i=s=0,l=255;l>=0?l>=s:s>=l;i=l>=0?++s:--s)n=(n+this.keySchedule[i]+t.charCodeAt(i%t.length))%256,r=this.keySchedule[i],this.keySchedule[i]=this.keySchedule[n],this.keySchedule[n]=r}return t.prototype.getRandomByte=function(){var e;return this.keySchedule_i=(this.keySchedule_i+1)%256,this.keySchedule_j=(this.keySchedule_j+this.keySchedule[this.keySchedule_i])%256,e=this.keySchedule[this.keySchedule_i],this.keySchedule[this.keySchedule_i]=this.keySchedule[this.keySchedule_j],this.keySchedule[this.keySchedule_j]=e,this.keySchedule[(this.keySchedule[this.keySchedule_i]+this.keySchedule[this.keySchedule_j])%256]},t.prototype.getRandomNumber=function(){var e,t,i,n,r;for(i=0,t=1,e=n=0,r=7;r>=0?r>=n:n>=r;e=r>=0?++n:--n)i+=this.getRandomByte()*t,t*=256;return i/0x10000000000000000},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Spread",["require","Underscore","Backbone","cs!threenodes/utils/Rc4Random","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l,h,c;return l=t("Underscore"),n=t("Backbone"),a=t("cs!threenodes/utils/Rc4Random"),o=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes.nodes.models",{RandomSpread:s=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),h=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="RandomSpread",n.group_name="Spread",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.rnd=!1,this.value=!1,this.seed=!1,this.count=!1,this.width=!1,this.offset=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{count:1,seed:1,width:1,offset:0},outputs:{out:0}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return this.v_out=this.fields.getField("out",!0)},n.prototype.remove=function(){return delete this.v_out,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n;if(t=!1,this.seed!==this.fields.getField("seed").get("value")||this.count!==parseInt(this.fields.getField("count").getValue(0))||this.width!==this.fields.getField("width").get("value")||this.offset!==this.fields.getField("offset").get("value"))for(this.seed=this.fields.getField("seed").get("value"),this.rnd=new a(this.seed.toString()),this.value=[],this.width=this.fields.getField("width").getValue(0),this.offset=this.fields.getField("offset").getValue(0),this.count=parseInt(this.fields.getField("count").get("value")),e=i=0,n=this.count-1;n>=0?n>=i:i>=n;e=n>=0?++i:--i)this.value[e]=this.rnd.getRandomNumber()*this.width-this.width/2+this.offset;return this.fields.setField("out",this.value)},n}(o),LinearSpread:r=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.onFieldsCreated=e(this.onFieldsCreated,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),c=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="LinearSpread",n.group_name="Spread",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.value=!1,this.count=!1,this.width=!1,this.phase=!1,this.offset=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{count:1,width:1,phase:0,offset:0},outputs:{out:0}},$.extend(!0,e,t)},n.prototype.onFieldsCreated=function(){return this.v_out=this.fields.getField("out",!0)},n.prototype.remove=function(){return delete this.v_out,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){var e,t,i,n,r,o,s;for(t=!1,this.width=this.fields.getField("width").getValue(0),this.offset=this.fields.getField("offset").getValue(0),this.phase=this.fields.getField("phase").getValue(0),this.count=parseInt(this.fields.getField("count").getValue()),this.value=[],r=this.width/this.count,n=r/2,e=o=0,s=this.count-1;s>=0?s>=o:o>=s;e=s>=0?++o:--o)i=(e*r+n+this.phase)%this.width,i=this.offset-this.width/2+i,this.value[e]=i;return this.fields.setField("out",this.value)},n}(o)})})}.call(this);var TWEEN=TWEEN||function(){var e,t,i,n=60,r=!1,o=[];return{setFPS:function(e){n=e||60},start:function(e){0!=arguments.length&&this.setFPS(e),t=setInterval(this.update,1e3/n)},stop:function(){clearInterval(t)},setAutostart:function(e){(r=e)&&!t&&this.start()},add:function(e){o.push(e),r&&!t&&this.start()},getAll:function(){return o},removeAll:function(){o=[]},remove:function(t){e=o.indexOf(t),-1!==e&&o.splice(e,1)},update:function(t){for(e=0,i=o.length,t=t||Date.now();i>e;)o[e].update(t)?e++:(o.splice(e,1),i--);0==i&&1==r&&this.stop()}}}();TWEEN.Tween=function(e){var t={},i={},n={},r=1e3,o=0,s=null,a=TWEEN.Easing.Linear.EaseNone,l=null,h=null,c=null;this.to=function(t,i){null!==i&&(r=i);for(var o in t)null!==e[o]&&(n[o]=t[o]);return this},this.start=function(r){TWEEN.add(this),s=r?r+o:Date.now()+o;for(var a in n)null!==e[a]&&(t[a]=e[a],i[a]=n[a]-e[a]);return this},this.stop=function(){return TWEEN.remove(this),this},this.delay=function(e){return o=e,this},this.easing=function(e){return a=e,this},this.chain=function(e){l=e},this.onUpdate=function(e){return h=e,this},this.onComplete=function(e){return c=e,this},this.update=function(n){var o,u;if(s>n)return!0;n=(n-s)/r,n=n>1?1:n,u=a(n);for(o in i)e[o]=t[o]+i[o]*u;return null!==h&&h.call(e,u),1==n?(null!==c&&c.call(e),null!==l&&l.start(),!1):!0}},TWEEN.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},TWEEN.Easing.Linear.EaseNone=function(e){return e},TWEEN.Easing.Quadratic.EaseIn=function(e){return e*e},TWEEN.Easing.Quadratic.EaseOut=function(e){return-e*(e-2)},TWEEN.Easing.Quadratic.EaseInOut=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},TWEEN.Easing.Cubic.EaseIn=function(e){return e*e*e},TWEEN.Easing.Cubic.EaseOut=function(e){return--e*e*e+1},TWEEN.Easing.Cubic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},TWEEN.Easing.Quartic.EaseIn=function(e){return e*e*e*e},TWEEN.Easing.Quartic.EaseOut=function(e){return-(--e*e*e*e-1)},TWEEN.Easing.Quartic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2)},TWEEN.Easing.Quintic.EaseIn=function(e){return e*e*e*e*e},TWEEN.Easing.Quintic.EaseOut=function(e){return(e-=1)*e*e*e*e+1},TWEEN.Easing.Quintic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2)},TWEEN.Easing.Sinusoidal.EaseIn=function(e){return-Math.cos(e*Math.PI/2)+1},TWEEN.Easing.Sinusoidal.EaseOut=function(e){return Math.sin(e*Math.PI/2)},TWEEN.Easing.Sinusoidal.EaseInOut=function(e){return-.5*(Math.cos(Math.PI*e)-1)},TWEEN.Easing.Exponential.EaseIn=function(e){return 0==e?0:Math.pow(2,10*(e-1))},TWEEN.Easing.Exponential.EaseOut=function(e){return 1==e?1:-Math.pow(2,-10*e)+1},TWEEN.Easing.Exponential.EaseInOut=function(e){return 0==e?0:1==e?1:(e*=2)<1?.5*Math.pow(2,10*(e-1)):.5*(-Math.pow(2,-10*(e-1))+2)},TWEEN.Easing.Circular.EaseIn=function(e){return-(Math.sqrt(1-e*e)-1)},TWEEN.Easing.Circular.EaseOut=function(e){return Math.sqrt(1- --e*e)},TWEEN.Easing.Circular.EaseInOut=function(e){return(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1)},TWEEN.Easing.Elastic.EaseIn=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)))},TWEEN.Easing.Elastic.EaseOut=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*e)*Math.sin(2*(e-t)*Math.PI/n)+1)},TWEEN.Easing.Elastic.EaseInOut=function(e){var t,i=.1,n=.4;return 0==e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n):.5*i*Math.pow(2,-10*(e-=1))*Math.sin(2*(e-t)*Math.PI/n)+1)},TWEEN.Easing.Back.EaseIn=function(e){return e*e*(2.70158*e-1.70158)},TWEEN.Easing.Back.EaseOut=function(e){return(e-=1)*e*(2.70158*e+1.70158)+1},TWEEN.Easing.Back.EaseInOut=function(e){return(e*=2)<1?.5*e*e*(3.5949095*e-2.5949095):.5*((e-=2)*e*(3.5949095*e+2.5949095)+2)},TWEEN.Easing.Bounce.EaseIn=function(e){return 1-TWEEN.Easing.Bounce.EaseOut(1-e)},TWEEN.Easing.Bounce.EaseOut=function(e){return(e/=1)<1/2.75?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},TWEEN.Easing.Bounce.EaseInOut=function(e){return.5>e?.5*TWEEN.Easing.Bounce.EaseIn(2*e):.5*TWEEN.Easing.Bounce.EaseOut(2*e-1)+.5},define("libs/Tween",function(){});var SPARKS={};SPARKS.Engine={_TIMESTEP:15,_timer:null,_lastTime:null,_timerStep:10,_velocityVerlet:!1,_emitters:[],_isRunning:!1,add:function(e){this._emitters.push(e)},start:function(){this._lastTime=Date.now(),this._timer=setTimeout(this.step,this._timerStep,this);for(var e=0,t=this._emitters.length;t>e;e++)this._emitters[e]._isRunning=!0;this._isRunning=!0},stop:function(){this._isRunning=!1;for(var e=0,t=this._emitters.length;t>e;e++)this._emitters[e]._isRunning=!1;clearTimeout(this._timer)},isRunning:function(){return this._isRunning},step:function(e){var t=Date.now(),i=t-e._lastTime;if(this._velocityVerlet)e.update(i/1e3),e._lastTime=t;else{var n=20*e._TIMESTEP;for(i>=n&&(i=n);i>=e._TIMESTEP;)e.update(e._TIMESTEP/1e3),i-=e._TIMESTEP;e._lastTime=t-i}setTimeout(e.step,e._timerStep,e)},update:function(e){for(var t=0,i=this._emitters.length;i>t;t++)this._emitters[t].update(e)}},SPARKS.Emitter=function(e){this._counter=e?e:new SPARKS.SteadyCounter(10),this._particles=[],this._initializers=[],this._actions=[],this._activities=[],this._handlers=[],this.callbacks={}},SPARKS.Emitter.prototype={_TIMESTEP:15,_timer:null,_lastTime:null,_timerStep:10,_velocityVerlet:!1,_isRunning:!1,start:function(){this._lastTime=Date.now(),this._timer=setTimeout(this.step,this._timerStep,this),this._isRunning=!0},stop:function(){this._isRunning=!1,clearTimeout(this._timer)},isRunning:function(){return this._isRunning},step:function(e){var t=Date.now(),i=t-e._lastTime;if(this._velocityVerlet)e.update(i/1e3),e._lastTime=t;else{var n=20*e._TIMESTEP;for(i>=n&&(i=n);i>=e._TIMESTEP;)e.update(e._TIMESTEP/1e3),i-=e._TIMESTEP;e._lastTime=t-i}e._isRunning&&setTimeout(e.step,e._timerStep,e)},update:function(e){var t=this._counter.updateEmitter(this,e);for(i=0;t>i;i++)this.createParticle();for(t=this._activities.length,i=0;t>i;i++)this._activities[i].update(this,e);t=this._actions.length;var n,r=this._particles.length;for(j=0;t>j;j++)for(n=this._actions[j],i=0;r>i;++i)particle=this._particles[i],n.update(this,particle,e);for(i=r;i--;)particle=this._particles[i],particle.isDead?(this._particles.splice(i,1),this.dispatchEvent("dead",particle),SPARKS.VectorPool.release(particle.position),SPARKS.VectorPool.release(particle.velocity)):this.dispatchEvent("updated",particle);this.dispatchEvent("loopUpdated")},createParticle:function(){var e,t=new SPARKS.Particle,i=this._initializers.length;for(e=0;i>e;e++)this._initializers[e].initialize(this,t);return this._particles.push(t),this.dispatchEvent("created",t),t},addInitializer:function(e){this._initializers.push(e)},addAction:function(e){this._actions.push(e)},removeInitializer:function(e){var t=this._initializers.indexOf(e);t>-1&&this._initializers.splice(t,1)},removeAction:function(e){var t=this._actions.indexOf(e);t>-1&&this._actions.splice(t,1)},addCallback:function(e,t){this.callbacks[e]=t},removeCallback:function(e){delete this.callbacks[e]},dispatchEvent:function(e,t){var i=this.callbacks[e];i&&i(t)}},SPARKS.EVENT_PARTICLE_CREATED="created",SPARKS.EVENT_PARTICLE_UPDATED="updated",SPARKS.EVENT_PARTICLE_DEAD="dead",SPARKS.EVENT_LOOP_UPDATED="loopUpdated",SPARKS.SteadyCounter=function(e){this.rate=e,this.leftover=0},SPARKS.SteadyCounter.prototype.updateEmitter=function(e,t){var i=t*this.rate+this.leftover,n=Math.floor(i);return this.leftover=i-n,n},SPARKS.ShotCounter=function(e){this.particles=e,this.used=!1},SPARKS.ShotCounter.prototype.updateEmitter=function(){return this.used?0:(this.used=!0,this.particles)},SPARKS.Particle=function(){this.lifetime=0,this.age=0,this.energy=1,this.isDead=!1,this.target=null,this.position=SPARKS.VectorPool.get().set(0,0,0),this.velocity=SPARKS.VectorPool.get().set(0,0,0),this._oldvelocity=SPARKS.VectorPool.get().set(0,0,0)},SPARKS.Action=function(){this._priority=0},SPARKS.Age=function(e){this._easing=null==e?TWEEN.Easing.Linear.EaseNone:e},SPARKS.Age.prototype.update=function(e,t,i){if(t.age+=i,t.age>=t.lifetime)t.energy=0,t.isDead=!0;else{var n=this._easing(t.age/t.lifetime);t.energy=-1*n+1}},SPARKS.Move=function(){},SPARKS.Move.prototype.update=function(e,t,i){var n=t.position,r=t.velocity,o=t._oldvelocity;this._velocityVerlet?(n.x+=.5*(r.x+o.x)*i,n.y+=.5*(r.y+o.y)*i,n.z+=.5*(r.z+o.z)*i):(n.x+=r.x*i,n.y+=r.y*i,n.z+=r.z*i)},SPARKS.DeathZone=function(e){this.zone=e},SPARKS.DeathZone.prototype.update=function(e,t){this.zone.contains(t.position)&&(t.isDead=!0)},SPARKS.ActionZone=function(e,t){this.action=e,this.zone=t},SPARKS.ActionZone.prototype.update=function(e,t,i){this.zone.contains(t.position)&&this.action.update(e,t,i)},SPARKS.Accelerate=function(e,t,i){return e instanceof THREE.Vector3?(this.acceleration=e,void 0):(this.acceleration=new THREE.Vector3(e,t,i),void 0)},SPARKS.Accelerate.prototype.update=function(e,t,i){var n=this.acceleration,r=t.velocity;t._oldvelocity.set(r.x,r.y,r.z),r.x+=n.x*i,r.y+=n.y*i,r.z+=n.z*i},SPARKS.AccelerateFactor=function(e){this.factor=e},SPARKS.AccelerateFactor.prototype.update=function(e,t,i){var n,r=this.factor,o=t.velocity,s=o.length();s>0&&(n=r*i/s,n+=1,o.multiplyScalar(n))},SPARKS.AccelerateVelocity=function(e){this.factor=e},SPARKS.AccelerateVelocity.prototype.update=function(e,t){var i=this.factor,n=t.velocity;n.z+=-n.x*i,n.y+=n.z*i,n.x+=n.y*i},SPARKS.RandomDrift=function(e,t,i){return e instanceof THREE.Vector3?(this.drift=e,void 0):(this.drift=new THREE.Vector3(e,t,i),void 0)},SPARKS.RandomDrift.prototype.update=function(e,t,i){var n=this.drift,r=t.velocity;r.x+=(Math.random()-.5)*n.x*i,r.y+=(Math.random()-.5)*n.y*i,r.z+=(Math.random()-.5)*n.z*i},SPARKS.Zone=function(){},SPARKS.PointZone=function(e){this.pos=e},SPARKS.PointZone.prototype.getLocation=function(){return this.pos},SPARKS.PointZone=function(e){this.pos=e},SPARKS.PointZone.prototype.getLocation=function(){return this.pos},SPARKS.LineZone=function(e,t){this.start=e,this.end=t,this._length=t.clone().sub(e)},SPARKS.LineZone.prototype.getLocation=function(){var e=this._length.clone();return e.multiplyScalar(Math.random()),e.add(this.start)},SPARKS.ParallelogramZone=function(e,t,i){this.corner=e,this.side1=t,this.side2=i},SPARKS.ParallelogramZone.prototype.getLocation=function(){var e=this.side1.clone().multiplyScalar(Math.random()),t=this.side2.clone().multiplyScalar(Math.random());return e.add(t),e.add(this.corner)},SPARKS.CubeZone=function(e,t,i,n){this.position=e,this.x=t,this.y=i,this.z=n},SPARKS.CubeZone.prototype.getLocation=function(){var e=this.position.clone();return e.x+=Math.random()*this.x,e.y+=Math.random()*this.y,e.z+=Math.random()*this.z,e},SPARKS.CubeZone.prototype.contains=function(e){var t=this.position.x,i=this.position.y,n=this.position.z,r=this.x,o=this.y,s=this.z;0>r&&(t+=r,r=Math.abs(r)),0>o&&(i+=o,o=Math.abs(o)),0>s&&(n+=s,s=Math.abs(s));var a=e.x-t,l=e.y-i,h=e.z-n;return a>0&&r>a&&l>0&&o>l&&h>0&&s>h?!0:!1},SPARKS.SphereCapZone=function(e,t,i,n,r,o){this.x=e,this.y=t,this.z=i,this.minr=n,this.maxr=r,this.angle=o},SPARKS.SphereCapZone.prototype.getLocation=function(){var e=2*Math.PI*SPARKS.Utils.random(),t=SPARKS.Utils.random(),i=SPARKS.VectorPool.get().set(t*Math.cos(e),-1/Math.tan(this.angle*SPARKS.Utils.DEGREE_TO_RADIAN),t*Math.sin(e)),n=this.minr-(this.minr-this.maxr)*Math.random();return i.multiplyScalar(n),i.__markedForReleased=!0,i},SPARKS.Lifetime=function(e,t){this._min=e,this._max=t?t:e},SPARKS.Lifetime.prototype.initialize=function(e,t){t.lifetime=this._min+SPARKS.Utils.random()*(this._max-this._min)},SPARKS.Position=function(e){this.zone=e},SPARKS.Position.prototype.initialize=function(e,t){var i=this.zone.getLocation();t.position.set(i.x,i.y,i.z)},SPARKS.Velocity=function(e){this.zone=e},SPARKS.Velocity.prototype.initialize=function(e,t){var i=this.zone.getLocation();t.velocity.set(i.x,i.y,i.z),i.__markedForReleased&&(SPARKS.VectorPool.release(i),i.__markedForReleased=!1)},SPARKS.Target=function(e,t){this.target=e,this.callback=t},SPARKS.Target.prototype.initialize=function(e,t){t.target=this.callback?this.callback():this.target},SPARKS.VectorPool={__pools:[],get:function(){return this.__pools.length>0?this.__pools.pop():this._addToPool()},release:function(e){this.__pools.push(e)},_addToPool:function(){for(var e=0,t=100;t>e;e++)this.__pools.push(new THREE.Vector3);return new THREE.Vector3}},SPARKS.Utils={random:function(){return Math.random()},DEGREE_TO_RADIAN:Math.PI/180,TWOPI:2*Math.PI,getPerpendiculars:function(e){var t=this.getPerpendicular(e),i=e.cross(t);return i.normalize(),[t,i]},getPerpendicular:function(e){if(0==e.x)return new THREE.Vector3D(1,0,0);var t=new THREE.Vector3(e.y,-e.x,0);return t.normalize()}},define("libs/Sparks",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Particle",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/nodes/models/Node","cs!./Three","cs!./Materials","libs/Tween","libs/Sparks"],function(t){var n,r,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R,S,C,H,M,k,A,P,F,D,N,z,L,I,O,V;return T=t("Underscore"),n=t("Backbone"),x=t("cs!threenodes/utils/Utils"),r=t("cs!threenodes/nodes/models/Node"),t("cs!./Three"),t("cs!./Materials"),t("libs/Tween"),t("libs/Sparks"),namespace("ThreeNodes.nodes.models",{ParticleSystem:a=function(t){function n(){return this.compute=e(this.compute,this),this.rebuild_geometry=e(this.rebuild_geometry,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),w=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="ParticleSystem",n.group_name="Particle",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=new THREE.ParticleSystem(new THREE.CubeGeometry(200,200,200),new THREE.ParticleBasicMaterial),this.ob.dynamic=!0,this.geometry_cache=!1,this.material_cache=!1,this.compute()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{geometry:{type:"Any",val:new THREE.CubeGeometry(200,200,200)},material:{type:"Any",val:new THREE.ParticleBasicMaterial},sortParticles:!1}},$.extend(!0,e,t)},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),delete this.geometry_cache,delete this.material_cache},n.prototype.rebuild_geometry=function(){var e,t;return e=this.fields.getField("geometry"),e.connections.length>0?(t=e.connections[0].from_field.node,t.cached=[],t.compute()):this.fields.getField("geometry").setValue(new THREE.CubeGeometry(200,200,200))},n.prototype.compute=function(){var e;return e=!1,this.material_cache!==this.fields.getField("material").getValue().id&&this.rebuild_geometry(),(this.geometry_cache!==this.fields.getField("geometry").getValue().id||this.material_cache!==this.fields.getField("material").getValue().id||e)&&(this.ob=new THREE.ParticleSystem(this.fields.getField("geometry").getValue(),this.fields.getField("material").getValue()),this.geometry_cache=this.fields.getField("geometry").getValue().id,this.material_cache=this.fields.getField("material").getValue().id),this.applyFieldsToVal(this.fields.inputs,this.ob,["children","geometry","material"]),e===!0&&this.trigger("RebuildAllShaders"),this.fields.setField("out",this.ob)},n}(ThreeNodes.nodes.models.Object3D),ParticleBasicMaterial:o=function(t){function n(){return this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),R=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="ParticleBasicMaterial",n.group_name="Materials",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.ob=[],this.material_class=THREE.ParticleBasicMaterial,this.vars_rebuild_shader_on_change=["transparent","depthTest","map"],this.material_cache=this.createCacheObject(this.vars_rebuild_shader_on_change)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{color:{type:"Color",val:new THREE.Color(16711680)},map:{type:"Any",val:!1},size:1,sizeAttenuation:!0,vertexColors:!1},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n}(ThreeNodes.NodeMaterialBase),SparksEmitter:f=function(t){function n(){return this.remove=e(this.remove,this),this.compute=e(this.compute,this),this.setTargetParticle=e(this.setTargetParticle,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),F=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Emitter",n.group_name="Particle.sparks",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.geom=new THREE.Geometry,this.target_initializer=new SPARKS.Target(null,this.setTargetParticle),this.pool=this.fields.getField("pool").getValue(),this.ob=new SPARKS.Emitter(this.fields.getField("counter").getValue())},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{counter:{type:"Any",val:new SPARKS.SteadyCounter(50)},pool:{type:"Any",val:!1},initializers:{type:"Array",val:[]},actions:{type:"Array",val:[]}},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.setTargetParticle=function(){return this.pool&&this.pool.pool?this.pool.pool.get():void 0},n.prototype.compute=function(){var e;return this.fields.getField("pool").getValue()!==!1&&this.pool!==this.fields.getField("pool").getValue()&&(this.ob.removeCallback("created"),this.ob.removeCallback("dead"),this.ob.stop(),this.ob=new SPARKS.Emitter(this.fields.getField("counter").getValue()),this.geom=new THREE.Geometry,this.pool=this.fields.getField("pool").getValue(),this.pool.init_pool(this.geom),this.ob.addCallback("created",this.pool.on_particle_created),this.ob.addCallback("dead",this.pool.on_particle_dead),console.log("pool particle setup...")),e=this.fields.getField("initializers").getValue().slice(0),e.push(this.target_initializer),this.ob._initializers=e,this.ob._actions=this.fields.getField("actions").getValue(),this.ob._counter=this.fields.getField("counter").getValue(),this.pool!==!1&&this.ob.isRunning()===!1&&this.ob.start(),this.fields.setField("out",this.geom)},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments),this.ob&&(this.ob.removeCallback("created"),this.ob.removeCallback("dead"),this.ob.stop()),delete this.ob,delete this.target_initializer,delete this.geom,delete this.pool},n}(r),SparksAge:d=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),D=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Age",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.Age(TWEEN.Easing.Linear.EaseNone)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{easing:{type:"Any",val:TWEEN.Easing.Linear.EaseNone}},outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob._easing=this.fields.getField("easing").get("value"),this.fields.setField("action",this.ob)},n}(r),SparksMove:v=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),N=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Move",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.Move},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.fields.setField("action",this.ob)},n}(r),SparksAccelerate:h=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),z=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Accelerate",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.Accelerate(new THREE.Vector3(0,1,0))
},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{vector:{type:"Vector3",val:new THREE.Vector3(0,1,0)}},outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.acceleration=this.fields.getField("vector").getValue(),this.fields.setField("action",this.ob)},n}(r),SparksAccelerateFactor:c=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),L=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="AccelerateFactor",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.AccelerateFactor(2)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{factor:2},outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.factor=this.fields.getField("factor").getValue(),this.fields.setField("action",this.ob)},n}(r),SparksAccelerateVelocity:u=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),I=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="AccelerateVelocity",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.AccelerateVelocity(2)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{factor:2},outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.factor=this.fields.getField("factor").getValue(),this.fields.setField("action",this.ob)},n}(r),SparksRandomDrift:b=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),O=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="RandomDrift",n.group_name="Particle.sparks.actions",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.RandomDrift(new THREE.Vector3(0,1,0))},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{vector:{type:"Vector3",val:new THREE.Vector3(0,1,0)}},outputs:{action:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.drift=this.fields.getField("vector").getValue(),this.fields.setField("action",this.ob)},n}(r),SparksLifetime:m=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),V=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Lifetime",n.group_name="Particle.sparks.initializers",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.Lifetime(4,7)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{min:4,max:7},outputs:{initializer:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob._min=this.fields.getField("min").getValue(),this.ob._min=this.fields.getField("max").getValue(),this.fields.setField("initializer",this.ob)},n}(r),SparksPosition:_=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),S=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Position",n.group_name="Particle.sparks.initializers",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.Position(new SPARKS.PointZone(new THREE.Vector3(0,0,0)))},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{zone:{type:"Any",val:new SPARKS.PointZone(new THREE.Vector3(0,0,0))}},outputs:{initializer:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.zone=this.fields.getField("zone").getValue(),this.fields.setField("initializer",this.ob)},n}(r),SparksPointZone:y=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),C=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="PointZone",n.group_name="Particle.sparks.zone",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.PointZone(new THREE.Vector3)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{pos:{type:"Vector3",val:new THREE.Vector3}},outputs:{zone:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.pos=this.fields.getField("pos").getValue(),this.fields.setField("zone",this.ob)},n}(r),SparksLineZone:g=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),H=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="LineZone",n.group_name="Particle.sparks.zone",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.LineZone(new THREE.Vector3,new THREE.Vector3(100,0,0))},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{start:{type:"Vector3",val:new THREE.Vector3},end:{type:"Vector3",val:new THREE.Vector3(100,0,0)}},outputs:{zone:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return(this.ob.start!==this.fields.get("start").getValue()||this.ob.end!==this.fields.get("end").getValue())&&(this.ob.start=this.fields.getField("start").getValue(),this.ob.end=this.fields.getField("end").getValue(),this.ob._length=this.ob.end.clone().subSelf(this.ob.start)),this.fields.setField("zone",this.ob)},n}(r),SparksCubeZone:p=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),M=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="CubeZone",n.group_name="Particle.sparks.zone",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.CubeZone(new THREE.Vector3,0,0,0)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{position:{type:"Vector3",val:new THREE.Vector3},x:0,y:0,z:0},outputs:{zone:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.position=this.fields.getField("position").getValue(),this.ob.x=this.fields.getField("x").getValue(),this.ob.y=this.fields.getField("y").getValue(),this.ob.z=this.fields.getField("z").getValue(),this.fields.setField("zone",this.ob)},n}(r),SparksSteadyCounter:E=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),k=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="SteadyCounter",n.group_name="Particle.sparks",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new SPARKS.SteadyCounter(100)},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{rate:100},outputs:{counter:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this.ob.pos=this.fields.getField("rate").getValue(),this.fields.setField("counter",this.ob)},n}(r),ParticlePool:s=function(t){function n(){return this.compute=e(this.compute,this),this.on_particle_dead=e(this.on_particle_dead,this),this.on_particle_updated=e(this.on_particle_updated,this),this.on_particle_created=e(this.on_particle_created,this),this.init_pool=e(this.init_pool,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),A=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="ParticlePool",n.group_name="Particle.sparks",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.geom=!1},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{maxParticles:1e4},outputs:{pool:{type:"Any",val:this}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.pool,delete this.geom,n.__super__.remove.apply(this,arguments)},n.prototype.init_pool=function(e){var t,i,n,r,o,s;for(this.geom=e,this.pool={pools:[],get:function(){return this.pools.length>0?this.pools.pop():null},add:function(e){return this.pools.push(e)}},i=function(){return new THREE.Vector3(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY)},s=[],t=r=0,o=this.fields.getField("maxParticles").getValue()-1;o>=0?o>=r:r>=o;t=o>=0?++r:--r)n=i(),e.vertices.push(n),s.push(this.pool.add(n));return s},n.prototype.on_particle_created=function(e){var t;return this.geom===!1?!1:(t=e.target,t?e.target.position=e.position:void 0)},n.prototype.on_particle_updated=function(){return!0},n.prototype.on_particle_dead=function(e){var t;return this.geom===!1?!1:(t=e.target,t?(e.target.position.set(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),this.pool.add(e.target)):void 0)},n.prototype.compute=function(){return this.geom!==!1&&(this.geom.verticesNeedUpdate=!0),this.fields.setField("pool",this)},n}(r),RandomCloudGeometry:l=function(t){function n(){return this.compute=e(this.compute,this),this.generate=e(this.generate,this),this.move_particles=e(this.move_particles,this),this.limit_position=e(this.limit_position,this),this.get_cache_array=e(this.get_cache_array,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.initialize=e(this.initialize,this),P=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="RandomCloudGeometry",n.group_name="Particle",n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.auto_evaluate=!0,this.ob=new THREE.Geometry,this.cache=this.get_cache_array(),this.generate()},n.prototype.getFields=function(){var e,t;return e=n.__super__.getFields.apply(this,arguments),t={inputs:{nbrParticles:2e4,radius:2e3,rndVelocity:{type:"Vector3",val:new THREE.Vector3(1,1,1)},linearVelocity:{type:"Vector3",val:new THREE.Vector3(1,1,1)}},outputs:{out:{type:"Any",val:this.ob}}},$.extend(!0,e,t)},n.prototype.remove=function(){return delete this.ob,delete this.cache,n.__super__.remove.apply(this,arguments)},n.prototype.get_cache_array=function(){return[this.fields.getField("radius").getValue(),this.fields.getField("nbrParticles").getValue(),this.fields.getField("linearVelocity").getValue()]},n.prototype.limit_position=function(e){var t,i;return i=this.fields.getField("radius").getValue(),t=5,-1*i>e?e=i-t:e>i&&(e=-1*i+t),e},n.prototype.move_particles=function(){var e,t,i,n;i=this.fields.getField("rndVelocity").getValue(),n=this.ob.vertices;for(e in n)t=n[e],t.x+=Math.random()*i.x-.5*i.x+t.velocity.x,t.y+=Math.random()*i.y-.5*i.y+t.velocity.y,t.z+=Math.random()*i.z-.5*i.z+t.velocity.z,t.x=this.limit_position(t.x),t.y=this.limit_position(t.y),t.z=this.limit_position(t.z);return this.ob.verticesNeedUpdate=!0,!0},n.prototype.generate=function(){var e,t,i,n,r,o;for(this.ob=new THREE.Geometry,i=this.fields.getField("radius").getValue(),n=this.fields.getField("nbrParticles").getValue(),t=this.fields.getField("linearVelocity").getValue(),e=o=0;n>=0?n>=o:o>=n;e=n>=0?++o:--o)r=new THREE.Vector3(2*Math.random()*i-i,2*Math.random()*i-i,2*Math.random()*i-i),r.velocity=new THREE.Vector3(Math.random()*t.x-.5*t.x,Math.random()*t.y-.5*t.y,Math.random()*t.z-.5*t.z),this.ob.vertices.push(r);return!0},n.prototype.compute=function(){var e;return e=this.get_cache_array(),x.flatArraysAreEquals(e,this.cache)===!1&&this.generate(),this.move_particles(),this.cache=e,this.fields.setField("out",this.ob)},n}(r)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/connections/models/Connection",["require","Backbone","cs!threenodes/utils/Indexer"],function(t){var n,r,o,s;return n=t("Backbone"),o=t("cs!threenodes/utils/Indexer"),r=function(t){function n(){return this.switchFieldsIfNeeded=e(this.switchFieldsIfNeeded,this),this.validate=e(this.validate,this),this.render=e(this.render,this),this.remove=e(this.remove,this),this.initialize=e(this.initialize,this),this.sync=e(this.sync,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.STATIC_INDEXER=new o,n.prototype.defaults={cid:-1},n.prototype.sync=function(){},n.prototype.initialize=function(e){var t;return this.options=e,t=e.indexer||n.STATIC_INDEXER,-1===this.get("cid")&&this.set({cid:t.getUID()}),this.isValid()?(this.to_field.removeConnections(),this.from_field.addConnection(this),this.to_field.addConnection(this),this.to_field.setValue(this.from_field.get("value")),this.from_field.node.dirty=!0):void 0},n.prototype.remove=function(){return this.from_field.unregisterConnection(this),this.to_field.unregisterConnection(this),this.to_field.removeConnections(),this.to_field.node.dirty=!0,this.to_field.changed=!0,delete this.from_field,delete this.to_field,this.trigger("connection:removed",this),this.destroy(),!1},n.prototype.render=function(){return this.trigger("render",this,this)},n.prototype.validate=function(e){return this.from_field=e.from_field,this.to_field=e.to_field,this.from_field&&this.to_field?this.from_field.get("is_output")===this.to_field.get("is_output")?!0:this.from_field.node.get("nid")===this.to_field.node.get("nid")?!0:(this.switchFieldsIfNeeded(),!1):!0},n.prototype.switchFieldsIfNeeded=function(){var e;return this.from_field.get("is_output")===!1&&(e=this.to_field,this.to_field=this.from_field,this.from_field=e),this},n.prototype.toJSON=function(){var e;return e={id:this.get("cid"),from_node:this.from_field.node.get("nid"),from_node_gid:this.from_field.node.get("gid"),from:this.from_field.get("machine_name"),to_node:this.to_field.node.get("nid"),to_node_gid:this.to_field.node.get("gid"),to:this.to_field.get("machine_name")}},n}(n.Model)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/connections/collections/Connections",["require","Backbone","cs!threenodes/connections/models/Connection"],function(t){var n,r,o,s;return n=t("Backbone"),r=t("cs!threenodes/connections/models/Connection"),o=function(t){function n(){return this.removeAll=e(this.removeAll,this),this.create=e(this.create,this),this.render=e(this.render,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.model=r,n.prototype.initialize=function(e,t){var i=this;return this.indexer=t.indexer,this.bind("connection:removed",function(e){return i.remove(e)}),n.__super__.initialize.apply(this,arguments)},n.prototype.render=function(){return this.each(function(e){return e.render()})},n.prototype.create=function(e,t){return t||(t={}),e.indexer=this.indexer,(e=this._prepareModel(e,t))?(this.add(e,t),e):!1},n.prototype.removeAll=function(){return this.remove(this.models)},n}(n.Collection)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/collections/Nodes",["require","Underscore","Backbone","cs!threenodes/utils/Indexer","cs!threenodes/connections/collections/Connections"],function(t){var n,r,o,s,a,l;return a=t("Underscore"),n=t("Backbone"),o=t("cs!threenodes/utils/Indexer"),r=t("cs!threenodes/connections/collections/Connections"),s=function(t){function n(){return this.stopSound=e(this.stopSound,this),this.startSound=e(this.startSound,this),this.showNodesAnimation=e(this.showNodesAnimation,this),this.getNodeByNid=e(this.getNodeByNid,this),this.renderAllConnections=e(this.renderAllConnections,this),this.removeGroupsByDefinition=e(this.removeGroupsByDefinition,this),this.createGroup=e(this.createGroup,this),this.createConnectionFromObject=e(this.createConnectionFromObject,this),this.render=e(this.render,this),this.createNode=e(this.createNode,this),this.bindTimelineEvents=e(this.bindTimelineEvents,this),this.destroy=e(this.destroy,this),this.clearWorkspace=e(this.clearWorkspace,this),this.initialize=e(this.initialize,this),l=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e,t){var i,n=this;return this.settings=t.settings,i=this,this.materials=[],this.indexer=new o,this.connections=new r([],{indexer:this.indexer}),this.parent=t.parent,this.connections.bind("add",function(){return i.trigger("nodeslist:rebuild",i)}),this.bind("remove",function(e){var t;return t=n.materials.indexOf(e),-1!==t&&n.materials.splice(t,1),i.trigger("nodeslist:rebuild",i)}),this.bind("RebuildAllShaders",function(){var e,t,i,r,o;for(r=n.materials,o=[],t=0,i=r.length;i>t;t++)e=r[t],o.push(e.rebuildShader());return o}),this.connections.bind("remove",function(){return i.trigger("nodeslist:rebuild",i)}),this.bind("add",function(e){return e.is_material&&e.is_material===!0&&this.materials.push(e),i.trigger("nodeslist:rebuild",i)}),this.bind("createConnection",function(e,t){return n.connections.create({from_field:e,to_field:t})})},n.prototype.clearWorkspace=function(){return this.removeConnections(),this.removeAll(),$("#webgl-window canvas").remove(),this.materials=[],this.indexer.reset(),this},n.prototype.destroy=function(){return this.removeConnections(),this.removeAll(),delete this.materials,delete this.indexer,delete this.connections},n.prototype.bindTimelineEvents=function(e){return this.timeline&&(this.timeline.off("tfieldsRebuild",this.showNodesAnimation),this.timeline.off("startSound",this.startSound),this.timeline.off("stopSound",this.stopSound)),this.timeline=e,this.timeline.on("tfieldsRebuild",this.showNodesAnimation),this.timeline.on("startSound",this.startSound),this.timeline.on("stopSound",this.stopSound)},n.prototype.createNode=function(e){var t;return"string"===$.type(e)&&(e={type:e}),e.timeline=this.timeline,e.settings=this.settings,e.indexer=this.indexer,e.parent=this.parent,ThreeNodes.nodes.models[e.type]?(t=new ThreeNodes.nodes.models[e.type](e),this.add(t),t):(console.error("Node type doesn't exists: "+e.type),!1)},n.prototype.render=function(){var e,t,i,n,r;i={},r={},e=function(t){var n,o,s,a;for(a=[],o=0,s=t.length;s>o;o++)n=t[o],(n.hasOutConnection()===!1||n.auto_evaluate||n.delays_output)&&(r[n.attributes.nid+"/"+n.attributes.gid]=n),i[n.attributes.nid+"/"+n.attributes.gid]=n,n.nodes?a.push(e(n.nodes.models)):a.push(void 0);return a},e(this.models),t=function(e){var n,r,o,s;for(r=e.getUpstreamNodes(),o=0,s=r.length;s>o;o++)n=r[o],i[n.attributes.nid+"/"+n.attributes.gid]&&!n.delays_output&&t(n);return(e.dirty||e.auto_evaluate)&&(e.compute(),e.dirty=!1,e.fields.setFieldInputUnchanged()),delete i[e.attributes.nid+"/"+e.attributes.gid],!0};for(n in r)i[n]&&t(r[n]);return!0},n.prototype.createConnectionFromObject=function(e){var t,i,n,r,o,s,a,l;return n=e.from_node_gid?e.from_node_gid.toString():"-1",r=this.getNodeByNid(e.from_node.toString(),n),i=r.fields.outputs[e.from.toString()],a=e.to_node_gid?e.to_node_gid.toString():"-1",l=this.getNodeByNid(e.to_node.toString(),a),s=l.fields.inputs[e.to.toString()],i&&s||(o=r,r=l,l=o,i=r.fields.outputs[e.to.toString()],s=l.fields.inputs[e.from.toString()]),t=this.connections.create({from_field:i,to_field:s,cid:e.id})},n.prototype.createGroup=function(e,t){var i,n,r,o,s,a,l,h;for(null==t&&(t=[]),o=this.createNode(e),l=0,h=t.length;h>l;l++)n=t[l],r=!1,a=!1,n.to_subfield?(r=this.getNodeByNid(n.from_node).fields.getField(n.from,!0),s=this.getNodeByNid(n.to_node),s&&(a=s.fields.getField(n.to,!1))):(s=this.getNodeByNid(n.from_node),s&&(r=s.fields.getField(n.from,!0)),a=this.getNodeByNid(n.to_node).fields.getField(n.to)),i=this.connections.create({from_field:r,to_field:a});return o},n.prototype.removeGroupsByDefinition=function(e){var t;return t=this.models.concat(),a.each(t,function(t){return t.definition&&t.definition.gid===e.gid?t.remove():void 0})},n.prototype.renderAllConnections=function(){return this.connections.render()},n.prototype.removeConnection=function(e){return this.connections.remove(e)},n.prototype.getNodeByNid=function(e,t){var i,n,r,o,s;for(null==t&&(t="-1"),s=this.models,r=0,o=s.length;o>r;r++){if(i=s[r],i.get("nid").toString()===e.toString()&&("-1"===t||i.get("gid").toString()===t.toString()))return i;if(i.nodes&&(n=i.nodes.getNodeByNid(e,t)))return n}return!1},n.prototype.showNodesAnimation=function(){return this.invoke("showNodeAnimation")},n.prototype.startSound=function(e){return this.each(function(t){return t.playSound instanceof Function?t.playSound(e):void 0})},n.prototype.stopSound=function(){return this.each(function(e){return e.stopSound instanceof Function?e.stopSound():void 0})},n.prototype.removeSelectedNodes=function(){var e,t,i,n,r;for(n=$(".node.ui-selected"),r=[],t=0,i=n.length;i>t;t++)e=n[t],r.push($(e).data("object").remove());return r},n.prototype.removeAll=function(){var e;return $("#tab-attribute").html(""),e=this.models.concat(),a.invoke(e,"remove"),this.reset([]),!0},n.prototype.removeConnections=function(){return this.connections.removeAll()},n}(n.Collection)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/models/components/Group",["require","Underscore","Backbone","cs!threenodes/nodes/collections/Nodes","cs!threenodes/nodes/models/Node"],function(t){var n,r,o,s,a,l;return a=t("Underscore"),n=t("Backbone"),s=t("cs!threenodes/nodes/collections/Nodes"),o=t("cs!threenodes/nodes/models/Node"),namespace("ThreeNodes.nodes.models",{Group:r=function(t){function n(){return this.compute=e(this.compute,this),this.remove=e(this.remove,this),this.getFields=e(this.getFields,this),this.toJSON=e(this.toJSON,this),this.initSubnodes=e(this.initSubnodes,this),this.initialize=e(this.initialize,this),l=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.node_name="Group",n.group_name=!1,n.prototype.initialize=function(e){var t,i,r,o,s,a=this;for(this.initSubnodes(e),n.__super__.initialize.apply(this,arguments),this.nodes.each(function(e){return e.set("gid",a.get("nid"))}),o=this.definition.get("connections"),s=[],i=0,r=o.length;r>i;i++)t=o[i],s.push(this.nodes.createConnectionFromObject(t));return s},n.prototype.initSubnodes=function(e){var t,i,n,r,o,a;for(this.nodes=new s([],{settings:e.settings,parent:this}),this.definition=e.definition,i=e.nodes?e.nodes:this.definition.get("nodes"),a=[],r=0,o=i.length;o>r;r++)n=i[r],a.push(t=this.nodes.createNode(n));return a},n.prototype.toJSON=function(){var e;return e={nid:this.get("nid"),name:this.get("name"),type:this.typename(),anim:this.getAnimationData(),x:this.get("x"),y:this.get("y"),nodes:jQuery.map(this.nodes.models,function(e){return e.toJSON()}),definition_id:this.definition.get("gid")}},n.prototype.getFields=function(){return!1},n.prototype.remove=function(){return this.nodes&&(this.nodes.destroy(),delete this.nodes),delete this.definition,n.__super__.remove.apply(this,arguments)},n.prototype.compute=function(){return this},n}(o)})})}.call(this),function(){define("cs!node-types",["require","cs!threenodes/nodes/models/components/Base","cs!threenodes/nodes/models/components/Conditional","cs!threenodes/nodes/models/components/Code","cs!threenodes/nodes/models/components/Geometry","cs!threenodes/nodes/models/components/Lights","cs!threenodes/nodes/models/components/Materials","cs!threenodes/nodes/models/components/Math","cs!threenodes/nodes/models/components/PostProcessing","cs!threenodes/nodes/models/components/Three","cs!threenodes/nodes/models/components/ConstructiveSolidGeometry","cs!threenodes/nodes/models/components/Utils","cs!threenodes/nodes/models/components/Spread","cs!threenodes/nodes/models/components/Particle","cs!threenodes/nodes/models/components/Group"],function(e){return e("cs!threenodes/nodes/models/components/Base"),e("cs!threenodes/nodes/models/components/Conditional"),e("cs!threenodes/nodes/models/components/Code"),e("cs!threenodes/nodes/models/components/Geometry"),e("cs!threenodes/nodes/models/components/Lights"),e("cs!threenodes/nodes/models/components/Materials"),e("cs!threenodes/nodes/models/components/Math"),e("cs!threenodes/nodes/models/components/PostProcessing"),e("cs!threenodes/nodes/models/components/Three"),e("cs!threenodes/nodes/models/components/ConstructiveSolidGeometry"),e("cs!threenodes/nodes/models/components/Utils"),e("cs!threenodes/nodes/models/components/Spread"),e("cs!threenodes/nodes/models/components/Particle"),e("cs!threenodes/nodes/models/components/Group")})}.call(this),function(){var e={}.hasOwnProperty,t=function(t,i){function n(){this.constructor=t}for(var r in i)e.call(i,r)&&(t[r]=i[r]);return n.prototype=i.prototype,t.prototype=new n,t.__super__=i.prototype,t};define("cs!threenodes/connections/views/ConnectionView",["require","Underscore","Backbone","cs!threenodes/views/UI","jquery.ui"],function(e){var i,n,r,o,s;return o=e("Underscore"),i=e("Backbone"),r=e("cs!threenodes/views/UI"),e("jquery.ui"),n=function(e){function i(){return s=i.__super__.constructor.apply(this,arguments)}return t(i,e),i.prototype.initialize=function(){var e=this;return i.__super__.initialize.apply(this,arguments),this.container=$("#graph"),this.line=r.svg.path().attr({stroke:"#555",fill:"none"}),this.el=this.line.node,this.model.bind("render",function(){return e.render()}),this.model.bind("destroy",function(){return e.remove()}),this.render()},i.prototype.remove=function(){return r.svg&&this.line&&(this.line.remove(),delete this.line),!0},i.prototype.render=function(){return r.svg&&this.line&&this.line.attrs&&this.line.attr({path:this.getPath()}),this},i.prototype.getFieldPosition=function(e){var t,i;return e.button?(i=$(".inner-field span",e.button).offset())?(t=3,i.top+=t,i.left+=t,i):(console.log("no o1"),{left:0,top:0}):(console.log("no button"),console.log(e),{left:0,top:0})},i.prototype.getPath=function(){var e,t,i,n,r,o,s,a,l,h,c,u,d,p,f,m;return i=this.getFieldPosition(this.model.from_field),n=this.getFieldPosition(this.model.to_field),o=$("#container-wrapper").offset(),s=$("#container-wrapper").scrollLeft()-o.left,a=$("#container-wrapper").scrollTop()-o.top,l=i.left+s,d=i.top+a,u=n.left+s,m=n.top+a,r=42,e=Math.max(r,u-l),t=Math.max(r,m-d),h=l+.5*e,p=d,c=u-.5*e,f=m,["M",l.toFixed(3),d.toFixed(3),"C",h,p,c,f,u.toFixed(3),m.toFixed(3)].join(",")},i}(i.View)})}.call(this),function(e){var t=function(){var t=65,i='<div class="colorpicker"><div class="colorpicker_color"><div><div></div></div></div><div class="colorpicker_hue"><div></div></div><div class="colorpicker_new_color"></div><div class="colorpicker_current_color"></div><div class="colorpicker_hex"><input type="text" maxlength="6" size="6" /></div><div class="colorpicker_rgb_r colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_g colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_rgb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_h colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_s colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_hsb_b colorpicker_field"><input type="text" maxlength="3" size="3" /><span></span></div><div class="colorpicker_submit"></div></div>',n={eventName:"click",onShow:function(){},onBeforeShow:function(){},onHide:function(){},onChange:function(){},onSubmit:function(){},color:"ff0000",livePreview:!0,flat:!1},r=function(t,i){var n=L(t);e(i).data("colorpicker").fields.eq(1).val(n.r).end().eq(2).val(n.g).end().eq(3).val(n.b).end()},o=function(t,i){e(i).data("colorpicker").fields.eq(4).val(t.h).end().eq(5).val(t.s).end().eq(6).val(t.b).end()},s=function(t,i){e(i).data("colorpicker").fields.eq(0).val(O(t)).end()},a=function(t,i){e(i).data("colorpicker").selector.css("backgroundColor","#"+O({h:t.h,s:100,b:100})),e(i).data("colorpicker").selectorIndic.css({left:parseInt(150*t.s/100,10),top:parseInt(150*(100-t.b)/100,10)})},l=function(t,i){e(i).data("colorpicker").hue.css("top",parseInt(150-150*t.h/360,10))},h=function(t,i){e(i).data("colorpicker").currentColor.css("backgroundColor","#"+O(t))},c=function(t,i){e(i).data("colorpicker").newColor.css("backgroundColor","#"+O(t))},u=function(i){var n=i.charCode||i.keyCode||-1;if(n>t&&90>=n||32==n)return!1;var r=e(this).parent().parent();r.data("colorpicker").livePreview===!0&&d.apply(this)},d=function(t){var i,n=e(this).parent().parent();n.data("colorpicker").color=i=this.parentNode.className.indexOf("_hex")>0?N(F(this.value)):this.parentNode.className.indexOf("_hsb")>0?A({h:parseInt(n.data("colorpicker").fields.eq(4).val(),10),s:parseInt(n.data("colorpicker").fields.eq(5).val(),10),b:parseInt(n.data("colorpicker").fields.eq(6).val(),10)}):z(P({r:parseInt(n.data("colorpicker").fields.eq(1).val(),10),g:parseInt(n.data("colorpicker").fields.eq(2).val(),10),b:parseInt(n.data("colorpicker").fields.eq(3).val(),10)})),t&&(r(i,n.get(0)),s(i,n.get(0)),o(i,n.get(0))),a(i,n.get(0)),l(i,n.get(0)),c(i,n.get(0)),n.data("colorpicker").onChange.apply(n,[i,O(i),L(i)])},p=function(){var t=e(this).parent().parent();t.data("colorpicker").fields.parent().removeClass("colorpicker_focus")},f=function(){t=this.parentNode.className.indexOf("_hex")>0?70:65,e(this).parent().parent().data("colorpicker").fields.parent().removeClass("colorpicker_focus"),e(this).parent().addClass("colorpicker_focus")
},m=function(t){var i=e(this).parent().find("input").focus(),n={el:e(this).parent().addClass("colorpicker_slider"),max:this.parentNode.className.indexOf("_hsb_h")>0?360:this.parentNode.className.indexOf("_hsb")>0?100:255,y:t.pageY,field:i,val:parseInt(i.val(),10),preview:e(this).parent().parent().data("colorpicker").livePreview};e(document).bind("mouseup",n,v),e(document).bind("mousemove",n,g)},g=function(e){return e.data.field.val(Math.max(0,Math.min(e.data.max,parseInt(e.data.val+e.pageY-e.data.y,10)))),e.data.preview&&d.apply(e.data.field.get(0),[!0]),!1},v=function(t){return d.apply(t.data.field.get(0),[!0]),t.data.el.removeClass("colorpicker_slider").find("input").focus(),e(document).unbind("mouseup",v),e(document).unbind("mousemove",g),!1},y=function(){var t={cal:e(this).parent(),y:e(this).offset().top};t.preview=t.cal.data("colorpicker").livePreview,e(document).bind("mouseup",t,b),e(document).bind("mousemove",t,_)},_=function(e){return d.apply(e.data.cal.data("colorpicker").fields.eq(4).val(parseInt(360*(150-Math.max(0,Math.min(150,e.pageY-e.data.y)))/150,10)).get(0),[e.data.preview]),!1},b=function(t){return r(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),s(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",b),e(document).unbind("mousemove",_),!1},E=function(){var t={cal:e(this).parent(),pos:e(this).offset()};t.preview=t.cal.data("colorpicker").livePreview,e(document).bind("mouseup",t,T),e(document).bind("mousemove",t,x)},x=function(e){return d.apply(e.data.cal.data("colorpicker").fields.eq(6).val(parseInt(100*(150-Math.max(0,Math.min(150,e.pageY-e.data.pos.top)))/150,10)).end().eq(5).val(parseInt(100*Math.max(0,Math.min(150,e.pageX-e.data.pos.left))/150,10)).get(0),[e.data.preview]),!1},T=function(t){return r(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),s(t.data.cal.data("colorpicker").color,t.data.cal.get(0)),e(document).unbind("mouseup",T),e(document).unbind("mousemove",x),!1},w=function(){e(this).addClass("colorpicker_focus")},R=function(){e(this).removeClass("colorpicker_focus")},S=function(){var t=e(this).parent(),i=t.data("colorpicker").color;t.data("colorpicker").origColor=i,h(i,t.get(0)),t.data("colorpicker").onSubmit(i,O(i),L(i),t.data("colorpicker").el)},C=function(){var t=e("#"+e(this).data("colorpickerId"));t.data("colorpicker").onBeforeShow.apply(this,[t.get(0)]);var i=e(this).offset(),n=k(),r=i.top+this.offsetHeight,o=i.left;return r+176>n.t+n.h&&(r-=this.offsetHeight+176),o+356>n.l+n.w&&(o-=356),t.css({left:o+"px",top:r+"px"}),0!=t.data("colorpicker").onShow.apply(this,[t.get(0)])&&t.show(),e(document).bind("mousedown",{cal:t},H),!1},H=function(t){M(t.data.cal.get(0),t.target,t.data.cal.get(0))||(0!=t.data.cal.data("colorpicker").onHide.apply(this,[t.data.cal.get(0)])&&t.data.cal.hide(),e(document).unbind("mousedown",H))},M=function(e,t,i){if(e==t)return!0;if(e.contains)return e.contains(t);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(t));for(var n=t.parentNode;n&&n!=i;){if(n==e)return!0;n=n.parentNode}return!1},k=function(){var e="CSS1Compat"==document.compatMode;return{l:window.pageXOffset||(e?document.documentElement.scrollLeft:document.body.scrollLeft),t:window.pageYOffset||(e?document.documentElement.scrollTop:document.body.scrollTop),w:window.innerWidth||(e?document.documentElement.clientWidth:document.body.clientWidth),h:window.innerHeight||(e?document.documentElement.clientHeight:document.body.clientHeight)}},A=function(e){return{h:Math.min(360,Math.max(0,e.h)),s:Math.min(100,Math.max(0,e.s)),b:Math.min(100,Math.max(0,e.b))}},P=function(e){return{r:Math.min(255,Math.max(0,e.r)),g:Math.min(255,Math.max(0,e.g)),b:Math.min(255,Math.max(0,e.b))}},F=function(e){var t=6-e.length;if(t>0){for(var i=[],n=0;t>n;n++)i.push("0");i.push(e),e=i.join("")}return e},D=function(e){var e=parseInt(e.indexOf("#")>-1?e.substring(1):e,16);return{r:e>>16,g:(65280&e)>>8,b:255&e}},N=function(e){return z(D(e))},z=function(e){var t={h:0,s:0,b:0},i=Math.min(e.r,e.g,e.b),n=Math.max(e.r,e.g,e.b),r=n-i;return t.b=n,t.s=0!=n?255*r/n:0,t.h=0!=t.s?e.r==n?(e.g-e.b)/r:e.g==n?2+(e.b-e.r)/r:4+(e.r-e.g)/r:-1,t.h*=60,t.h<0&&(t.h+=360),t.s*=100/255,t.b*=100/255,t},L=function(e){var t={},i=Math.round(e.h),n=Math.round(255*e.s/100),r=Math.round(255*e.b/100);if(0==n)t.r=t.g=t.b=r;else{var o=r,s=(255-n)*r/255,a=(o-s)*(i%60)/60;360==i&&(i=0),60>i?(t.r=o,t.b=s,t.g=s+a):120>i?(t.g=o,t.b=s,t.r=o-a):180>i?(t.g=o,t.r=s,t.b=s+a):240>i?(t.b=o,t.r=s,t.g=o-a):300>i?(t.b=o,t.g=s,t.r=s+a):360>i?(t.r=o,t.g=s,t.b=o-a):(t.r=0,t.g=0,t.b=0)}return{r:Math.round(t.r),g:Math.round(t.g),b:Math.round(t.b)}},I=function(t){var i=[t.r.toString(16),t.g.toString(16),t.b.toString(16)];return e.each(i,function(e,t){1==t.length&&(i[e]="0"+t)}),i.join("")},O=function(e){return I(L(e))},V=function(){var t=e(this).parent(),i=t.data("colorpicker").origColor;t.data("colorpicker").color=i,r(i,t.get(0)),s(i,t.get(0)),o(i,t.get(0)),a(i,t.get(0)),l(i,t.get(0)),c(i,t.get(0))};return{init:function(t){if(t=e.extend({},n,t||{}),"string"==typeof t.color)t.color=N(t.color);else if(void 0!=t.color.r&&void 0!=t.color.g&&void 0!=t.color.b)t.color=z(t.color);else{if(void 0==t.color.h||void 0==t.color.s||void 0==t.color.b)return this;t.color=A(t.color)}return this.each(function(){if(!e(this).data("colorpickerId")){var n=e.extend({},t);n.origColor=t.color;var g="collorpicker_"+parseInt(1e3*Math.random());e(this).data("colorpickerId",g);var v=e(i).attr("id",g);n.flat?v.appendTo(this).show():v.appendTo(document.body),n.fields=v.find("input").bind("keyup",u).bind("change",d).bind("blur",p).bind("focus",f),v.find("span").bind("mousedown",m).end().find(">div.colorpicker_current_color").bind("click",V),n.selector=v.find("div.colorpicker_color").bind("mousedown",E),n.selectorIndic=n.selector.find("div div"),n.el=this,n.hue=v.find("div.colorpicker_hue div"),v.find("div.colorpicker_hue").bind("mousedown",y),n.newColor=v.find("div.colorpicker_new_color"),n.currentColor=v.find("div.colorpicker_current_color"),v.data("colorpicker",n),v.find("div.colorpicker_submit").bind("mouseenter",w).bind("mouseleave",R).bind("click",S),r(n.color,v.get(0)),o(n.color,v.get(0)),s(n.color,v.get(0)),l(n.color,v.get(0)),a(n.color,v.get(0)),h(n.color,v.get(0)),c(n.color,v.get(0)),console.log(n),n.flat?v.css({position:"relative",display:"block"}):e(this).bind(n.eventName,C)}})},showPicker:function(){return this.each(function(){e(this).data("colorpickerId")&&C.apply(this)})},hidePicker:function(){return this.each(function(){e(this).data("colorpickerId")&&e("#"+e(this).data("colorpickerId")).hide()})},setColor:function(t){if("string"==typeof t)t=N(t);else if(void 0!=t.r&&void 0!=t.g&&void 0!=t.b)t=z(t);else{if(void 0==t.h||void 0==t.s||void 0==t.b)return this;t=A(t)}return this.each(function(){if(e(this).data("colorpickerId")){var i=e("#"+e(this).data("colorpickerId"));i.data("colorpicker").color=t,i.data("colorpicker").origColor=t,r(t,i.get(0)),o(t,i.get(0)),s(t,i.get(0)),l(t,i.get(0)),a(t,i.get(0)),h(t,i.get(0)),c(t,i.get(0))}})}}}();e.fn.extend({ColorPicker:t.init,ColorPickerHide:t.hidePicker,ColorPickerShow:t.showPicker,ColorPickerSetColor:t.setColor})}(jQuery),define("colorpicker",["jquery"],function(e){return function(){var t;return t||e.jquery}}(this)),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/Color",["require","Underscore","Backbone","cs!../models/Node","cs!./NodeView","colorpicker"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!../models/Node"),t("cs!./NodeView"),t("colorpicker"),namespace("ThreeNodes.nodes.views",{Color:r=function(t){function n(){return this.remove=e(this.remove,this),this.init_preview=e(this.init_preview,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){return n.__super__.initialize.apply(this,arguments),this.init_preview()},n.prototype.init_preview=function(){var e,t,i=this;return t=this.model.fields,this.$picker_el=$("<div class='color_preview'></div>"),e=t.getField("rgb",!0).getValue(0),this.$picker_el.ColorPicker({color:{r:255*e.r,g:255*e.g,b:255*e.b},onChange:function(e,i,n){return t.getField("r").setValue(n.r/255),t.getField("g").setValue(n.g/255),t.getField("b").setValue(n.b/255)}}),$(".center",this.$el).append(this.$picker_el),t.getField("rgb",!0).on_value_update_hooks.set_bg_color_preview=function(e){return i.$picker_el.css({background:e[0].getStyle()})}},n.prototype.remove=function(){return this.$picker_el.each(function(){var e,t;return $(this).data("colorpickerId")?(e=$("#"+$(this).data("colorpickerId")),t=e.data("colorpicker"),t&&delete t.onChange,e.remove()):void 0}),this.$picker_el.unbind(),this.$picker_el.remove(),delete this.$picker_el,n.__super__.remove.apply(this,arguments)},n}(ThreeNodes.NodeView)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/WebGLRenderer",["require","Underscore","Backbone","cs!../models/Node","cs!./NodeView"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!../models/Node"),t("cs!./NodeView"),namespace("ThreeNodes.nodes.views",{WebGLRenderer:r=function(t){function n(){return this.apply_size=e(this.apply_size,this),this.add_renderer_to_dom=e(this.add_renderer_to_dom,this),this.create_preview_view=e(this.create_preview_view,this),this.create_popup_view=e(this.create_popup_view,this),this.add_mouse_handler=e(this.add_mouse_handler,this),this.remove=e(this.remove,this),this.update=e(this.update,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(){var e=this;return n.__super__.initialize.apply(this,arguments),this.preview_mode=!0,this.creating_popup=!1,this.win=!1,this.old_bg=!1,$("body").append("<div id='webgl-window'></div>"),this.webgl_container=$("#webgl-window"),this.apply_size(),this.apply_bg_color(),this.add_mouse_handler(),this.model.on("on_compute",this.update),this.webgl_container.bind("click",function(){return e.model.settings.player_mode===!1?e.create_popup_view():void 0})},n.prototype.update=function(){return this.creating_popup!==!0||this.win?(this.creating_popup=!1,this.win!==!1&&this.win.closed&&this.preview_mode===!1&&(this.preview_mode=!0,this.win=!1),this.model.settings.test||this.add_renderer_to_dom(),this.apply_size(),this.apply_bg_color()):void 0},n.prototype.remove=function(){return this.win&&this.win!==!1&&this.win.close(),this.webgl_container.unbind(),this.webgl_container.remove(),delete this.webgl_container,delete this.win,n.__super__.remove.apply(this,arguments)},n.prototype.add_mouse_handler=function(){return $(this.model.ob.domElement).unbind("mousemove"),$(this.model.ob.domElement).bind("mousemove",function(e){return ThreeNodes.renderer.mouseX=e.clientX,ThreeNodes.renderer.mouseY=e.clientY}),this},n.prototype.create_popup_view=function(){var e,t;return this.preview_mode=!1,this.creating_popup=!0,t=this.model.fields.getField("width").getValue(),e=this.model.fields.getField("height").getValue(),this.win=window.open("","win"+this.model.nid,"width="+t+",height="+e+",scrollbars=false,location=false,status=false,menubar=false"),$("body",$(this.win.document)).append(this.model.ob.domElement),$("*",$(this.win.document)).css({padding:0,margin:0}),this.apply_bg_color(!0),this.apply_size(!0),this.add_mouse_handler(),this},n.prototype.create_preview_view=function(){return this.preview_mode=!0,this.webgl_container.append(this.model.ob.domElement),this.apply_bg_color(!0),this.apply_size(!0),this.add_mouse_handler(),this},n.prototype.add_renderer_to_dom=function(){return this.preview_mode&&0===$("canvas",this.webgl_container).length&&this.create_preview_view(),this.preview_mode===!1&&this.win===!1&&this.create_popup_view(),this},n.prototype.apply_bg_color=function(e){var t;return null==e&&(e=!1),t=this.model.fields.getField("bg_color").getValue().getStyle(),this.old_bg===t&&e===!1?!1:(this.model.ob.setClearColor(this.model.fields.getField("bg_color").getValue(),1),this.webgl_container.css({background:t}),this.win&&$(this.win.document.body).css({background:t}),this.old_bg=t)},n.prototype.apply_size=function(e){var t,i,n,r,o,s;return null==e&&(e=!1),s=this.model.fields.getField("width").getValue(),n=this.model.fields.getField("height").getValue(),i=s,t=n,this.win===!1&&this.model.settings.player_mode===!1&&(r=220,o=s/n,i=r,t=i/o),(i!==this.model.width||t!==this.model.height||e)&&(this.model.ob.setSize(i,t),this.win&&this.win!==!1&&console.log("...")),this.model.width=i,this.model.height=t},n}(ThreeNodes.NodeView)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/nodes/views/Group",["require","Underscore","Backbone","cs!../models/Node","cs!./NodeView"],function(t){var n,r,o,s;return o=t("Underscore"),n=t("Backbone"),t("cs!../models/Node"),t("cs!./NodeView"),namespace("ThreeNodes.nodes.views",{Group:r=function(t){function n(){return this.remove=e(this.remove,this),this.renderNode=e(this.renderNode,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e){return n.__super__.initialize.apply(this,arguments),this.views=[],console.log(e.model.nodes),o.each(e.model.nodes.models,this.renderNode)},n.prototype.renderNode=function(e){var t,i,n,r;return i=e.constructor.name,r=ThreeNodes.nodes.views[i]?ThreeNodes.nodes.views[i]:ThreeNodes.NodeView,t=$("<div class='node'></div>").appendTo(this.$el.find("> .options")),n=new r({model:e,isSubNode:!0,el:t}),n.$el.data("nid",e.get("nid")),n.$el.data("object",e),this.views.push(n)},n.prototype.remove=function(){return n.__super__.remove.apply(this,arguments)},n}(ThreeNodes.NodeView)})})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/Workspace",["require","Underscore","Backbone","cs!threenodes/connections/views/ConnectionView","jquery.ui","cs!threenodes/nodes/views/NodeView","cs!threenodes/nodes/views/Color","cs!threenodes/nodes/views/WebGLRenderer","cs!threenodes/nodes/views/Group"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),r=t("cs!threenodes/connections/views/ConnectionView"),t("jquery.ui"),t("cs!threenodes/nodes/views/NodeView"),t("cs!threenodes/nodes/views/Color"),t("cs!threenodes/nodes/views/WebGLRenderer"),t("cs!threenodes/nodes/views/Group"),o=function(t){function n(){return this.initDrop=e(this.initDrop,this),this.renderConnection=e(this.renderConnection,this),this.renderNode=e(this.renderNode,this),this.destroy=e(this.destroy,this),this.render=e(this.render,this),this.initialize=e(this.initialize,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e){return n.__super__.initialize.apply(this,arguments),this.settings=e.settings,this.initDrop()},n.prototype.render=function(e){return this.nodes=e,console.log("Workspace.render "+e.length),this.views=[],s.each(this.nodes.models,this.renderNode),s.each(this.nodes.connections.models,this.renderConnection),this.nodes.bind("add",this.renderNode),this.nodes.connections.bind("add",this.renderConnection)},n.prototype.destroy=function(){return s.each(this.views,function(e){return e.remove()}),this.nodes.unbind("add",this.renderNode),this.nodes.connections.unbind("add",this.renderConnection),delete this.views,delete this.settings,this.remove()},n.prototype.renderNode=function(e){var t,i,n,r;return i=e.constructor.name,r=ThreeNodes.nodes.views[i]?ThreeNodes.nodes.views[i]:ThreeNodes.NodeView,t=$("<div class='node'></div>").appendTo(this.$el),n=new r({model:e,el:t}),n.$el.data("nid",e.get("nid")),n.$el.data("object",e),this.views.push(n)},n.prototype.renderConnection=function(e){var t;return this.settings.test===!0?!1:(t=new r({model:e}),this.views.push(t))},n.prototype.initDrop=function(){var e;return e=this,$("#container").droppable({accept:"#tab-new a.button, #library .definition",activeClass:"ui-state-active",hoverClass:"ui-state-hover",drop:function(t,i){var n,r,o,s,a,l;return l=$("#container-wrapper").offset(),r=!1,i.draggable.hasClass("definition")?(a="Group",n=$("#library"),r=i.draggable.data("model"),l.left-=n.offset().left):(a=i.draggable.attr("rel"),n=$("#sidebar .ui-layout-center")),o=i.position.left+$("#container-wrapper").scrollLeft()-l.left-10,s=i.position.top+$("#container-wrapper").scrollTop()-n.scrollTop()-l.top,e.nodes&&e.nodes.createNode({type:a,x:o,y:s,definition:r}),$("#sidebar").show()}}),this},n}(n.View)})}.call(this);var Timeline=function(e){this.parameters=e||{},this.name="Global",this.anims=[],this.anims_container=[],this.tracks=[],this.time=0,this.totalTime=0,this.loopCount=0,this.loopMode=0,this.playing=!0,this.maxTime=void 0!==this.parameters.maxTime?this.parameters.maxTime:0,this.setPropertyValue=void 0!==this.parameters.setPropertyValue?this.parameters.setPropertyValue:function(e,t){e.target[e.propertyName]=t},this.applyPropertyValue=void 0!==this.parameters.applyPropertyValue?this.parameters.applyPropertyValue:function(e,t){e.target[e.propertyName]=e.startValue+(e.endValue-e.startValue)*t},this.getPropertyValue=void 0!==this.parameters.getPropertyValue?this.parameters.getPropertyValue:function(e){return e.target[e.propertyName]},this.onStop=void 0!==this.parameters.onStop?this.parameters.onStop:function(){},this.onPlay=void 0!==this.parameters.onPlay?this.parameters.onPlay:function(){}};Timeline.currentInstance=null,Timeline.getGlobalInstance=function(){return Timeline.globalInstance||(Timeline.globalInstance=new Timeline),Timeline.globalInstance},Timeline.prototype.destroy=function(){this.stop(),delete this.setPropertyValue,delete this.applyPropertyValue,delete this.getPropertyValue,delete this.onStop,delete this.onPlay,this.removeGUI(),delete this.parameters,delete this.anims,delete this.anims_container,delete this.tracks},Timeline.prototype.loop=function(e){this.loopMode=e},Timeline.prototype.stop=function(){this.playing=!1,this.time=0,this.prevTime=this.time-1/30,this.onStop()},Timeline.prototype.pause=function(){this.playing=!1,this.onStop()},Timeline.prototype.play=function(){this.playing=!0,this.onPlay(this.time)},Timeline.prototype.start=function(){var e=this;setInterval(function(){e.update(1/30)},1e3/30)},Timeline.prototype.preUpdate=function(){},Timeline.prototype.removeGUI=function(){},Timeline.prototype.update=function(e){if(this.preUpdate(),this.playing&&(this.totalTime+=e,this.prevTime=this.time,this.time+=e),0!==this.loopMode){var t=this.findAnimationEnd();0!=t&&(this.time>t&&(this.loopCount++,this.time=0,this.onPlay(0)),-1==this.loopMode||this.loopCount>=this.loopMode&&(this.playing=!1,this.onStop()))}this.applyValues()},Timeline.prototype.findAnimationEnd=function(){for(var e=0,t=0;t<this.anims.length;t++)this.anims[t].endTime>e&&(e=this.anims[t].endTime);return Math.max(e,this.maxTime)},Timeline.prototype.applyValues=function(){for(var e=0,t=this.anims.length;t>e;e++){var i=this.anims[e],n=i.container;if(!(this.time<i.startTime)){var r=n.getPropertyTrack(i.propertyName);if(0!=r.enabled)if(this.prevTime<=i.startTime&&i.startTime<=this.time&&(i.startValue=this.getPropertyValue(i),i.startFunction&&i.startFunction.call(i.target)),this.prevTime<=i.endTime&&i.endTime<=this.time)this.setPropertyValue(i,i.endValue),i.endFunction&&i.endFunction.call(i.target);else if(0!==i.endTime-i.startTime){var o=(this.time-i.startTime)/(i.endTime-i.startTime);o=i.easing(o),o=Math.max(0,Math.min(o,1)),this.applyPropertyValue(i,o)}}}},Anim.prototype.destroy=function(){var e=this.timeline.tracks.indexOf(this.objectTrack);-1!==e&&this.timeline.tracks.splice(e,1),e=this.timeline.anims_container.indexOf(this),-1!==e&&this.timeline.anims_container.splice(e,1),delete this.propertyAnims,delete this.target,delete this.timeline,delete this.tracks,delete this.objectTrack},Anim.prototype.disableProperty=function(e){if(!this.objectTrack)return!1;for(var t=0;t<this.objectTrack.propertyTracks.length;t++){var i=this.objectTrack.propertyTracks[t];i.propertyName==e&&(i.enabled=!1)}},Anim.prototype.enableProperty=function(e){if(!this.objectTrack)return!1;for(var t=0;t<this.objectTrack.propertyTracks.length;t++){var i=this.objectTrack.propertyTracks[t];i.propertyName==e&&(i.enabled=!0)}},Anim.prototype.getPropertyTrack=function(e){if(!this.objectTrack)return!1;for(var t=0;t<this.objectTrack.propertyTracks.length;t++){var i=this.objectTrack.propertyTracks[t];if(i.propertyName==e)return i}return!1},Anim.prototype.to=function(){for(var e=[],t=0;t<arguments.length;t++)e.push(arguments[t]);var i,n,r,o,s,a;i="number"==typeof e[0]?e.shift():0,n="object"==typeof e[0]?e.shift():{},"function"==typeof e[0]&&(s=e.shift()),"function"==typeof e[0]&&(a=e.shift()),r="number"==typeof e[0]?e.shift():1,o="function"==typeof e[0]?e.shift():Timeline.Easing.Linear.EaseNone;for(var l in n)this.timeline.anims.push({timeline:this.timeline,targetName:this.name,target:this.target,propertyName:l,endValue:n[l],delay:i,startTime:this.timeline.time+i+this.endTime,endTime:this.timeline.time+i+this.endTime+r,easing:o,endFunction:a,startFunction:s,container:this});return this.endTime+=i+r,this},Timeline.Easing={Linear:{},Quadratic:{},Cubic:{},Quartic:{},Quintic:{},Sinusoidal:{},Exponential:{},Circular:{},Elastic:{},Back:{},Bounce:{}},Timeline.Easing.Linear.EaseNone=function(e){return e},Timeline.Easing.Quadratic.EaseIn=function(e){return e*e},Timeline.Easing.Quadratic.EaseOut=function(e){return-e*(e-2)},Timeline.Easing.Quadratic.EaseInOut=function(e){return(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1)},Timeline.Easing.Cubic.EaseIn=function(e){return e*e*e},Timeline.Easing.Cubic.EaseOut=function(e){return--e*e*e+1},Timeline.Easing.Cubic.EaseInOut=function(e){return(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)},Timeline.Easing.Elastic.EaseIn=function(e){var t,i=.1,n=.4;return 0===e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),-(i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/n)))},Timeline.Easing.Elastic.EaseOut=function(e){var t,i=.1,n=.4;return 0===e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),i*Math.pow(2,-10*e)*Math.sin((e-t)*2*Math.PI/n)+1)},Timeline.Easing.Elastic.EaseInOut=function(e){var t,i=.1,n=.4;return 0===e?0:1==e?1:(n||(n=.3),!i||1>i?(i=1,t=n/4):t=n/(2*Math.PI)*Math.asin(1/i),(e*=2)<1?-.5*i*Math.pow(2,10*(e-=1))*Math.sin((e-t)*2*Math.PI/n):.5*i*Math.pow(2,-10*(e-=1))*Math.sin((e-t)*2*Math.PI/n)+1)},Timeline.Easing.Back.EaseIn=function(e){var t=1.70158;return e*e*((t+1)*e-t)},Timeline.Easing.Back.EaseOut=function(e){var t=1.70158;return(e-=1)*e*((t+1)*e+t)+1},Timeline.Easing.Back.EaseInOut=function(e){var t=2.5949095;return(e*=2)<1?.5*e*e*((t+1)*e-t):.5*((e-=2)*e*((t+1)*e+t)+2)},Timeline.Easing.Bounce.EaseIn=function(e){return 1-Timeline.Easing.Bounce.EaseOut(1-e)},Timeline.Easing.Bounce.EaseOut=function(e){return(e/=1)<1/2.75?7.5625*e*e:2/2.75>e?7.5625*(e-=1.5/2.75)*e+.75:2.5/2.75>e?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},Timeline.Easing.Bounce.EaseInOut=function(e){return.5>e?.5*Timeline.Easing.Bounce.EaseIn(2*e):.5*Timeline.Easing.Bounce.EaseOut(2*e-1)+.5},Timeline.easingFunctionToString=function(e){for(var t in Timeline.easingMap)if(Timeline.easingMap[t]==e)return t},Timeline.stringToEasingFunction=function(e){return Timeline.easingMap[e]},Timeline.easingMap={};for(var easingFunctionFamilyName in Timeline.Easing){var easingFunctionFamily=Timeline.Easing[easingFunctionFamilyName];for(var easingFunctionName in easingFunctionFamily)Timeline.easingMap[easingFunctionFamilyName+"."+easingFunctionName]=easingFunctionFamily[easingFunctionName]}define("timeline",function(){}),Timeline.prototype.initGUI=function(e){var t=this;this.element=void 0!==e.element?e.element:!1,this.displayOnlySelected=void 0!==e.displayOnlySelected?e.displayOnlySelected:!1,this.trackLabelWidth=void 0!==e.trackLabelWidth?e.trackLabelWidth:108,this.trackLabelHeight=void 0!==e.trackLabelHeight?e.trackLabelHeight:20,this.tracksScrollWidth=void 0!==e.tracksScrollWidth?e.tracksScrollWidth:16,this.tracksScrollHeight=0,this.tracksScrollThumbPos=0,this.tracksScrollThumbHeight=0,this.tracksScrollY=0,this.timeScrollWidth=0,this.timeScrollHeight=void 0!==e.timeScrollHeight?e.timeScrollHeight:16,this.timeScrollThumbPos=0,this.timeScrollThumbWidth=0,this.timeScrollX=0,this.headerHeight=void 0!==e.headerHeight?e.headerHeight:30,this.canvasHeight=void 0!==e.canvasHeight?e.canvasHeight:200,this.draggingTime=!1,this.draggingTracksScrollThumb=!1,this.draggingTimeScrollThumb=!1,this.draggingKeys=!1,this.draggingTimeScale=!1,this.draggingSelectKeys=!1,this.mousePositionDown={x:0,y:0},this.mousePositionMove={x:0,y:0},this.selectedKeys=[],this.selectedAnims=[],this.displayedTracks=[],this.timeScale=void 0!==e.timeScale?e.timeScale:1,this.colorBackground=void 0!==e.colorBackground?e.colorBackground:"#EEEEEE",this.colorButtonBackground=void 0!==e.colorButtonBackground?e.colorButtonBackground:"#DDDDDD",this.colorButtonStroke=void 0!==e.colorButtonStroke?e.colorButtonStroke:"#777777",this.colorScrollbar=void 0!==e.colorScrollbar?e.colorScrollbar:"#DDDDDD",this.colorScrollbarThumb=void 0!==e.colorScrollbarThumb?e.colorScrollbarThumb:"#999999",this.colorTimelineLabel=void 0!==e.colorTimelineLabel?e.colorTimelineLabel:"#666666",this.colorTimeScale=void 0!==e.colorTimeScale?e.colorTimeScale:"#666666",this.colorTimelineTick=void 0!==e.colorTimelineTick?e.colorTimelineTick:"#999999",this.colorHeaderBorder=void 0!==e.colorHeaderBorder?e.colorHeaderBorder:"#000000",this.colorTimeTicker=void 0!==e.colorTimeTicker?e.colorTimeTicker:"#FF0000",this.colorTrackBottomLine=void 0!==e.colorTrackBottomLine?e.colorTrackBottomLine:"#FFFFFF",this.colorObjectLabel=void 0!==e.colorObjectLabel?e.colorObjectLabel:"#000000",this.colorPropertyLabel=void 0!==e.colorPropertyLabel?e.colorPropertyLabel:"#555555",this.onTrackRebuild=void 0!==e.onTrackRebuild?e.onTrackRebuild:function(){},this.onGuiSave=void 0!==e.onGuiSave?e.onGuiSave:function(){},this.trackNameCounter=0,this.initTracks(),this.load(),this.buildDOMContainer(),this.canvas=document.createElement("canvas"),this.c=this.canvas.getContext("2d"),this.canvas.width=0,0!=this.element?this.element.appendChild(this.canvas):this.container.appendChild(this.canvas),this.buildInputDialog();var t=this;this.onMouseClick=t.onMouseClick.bind(this),this.onMouseDown=t.onMouseDown.bind(this),this.onDocumentMouseMove=t.onDocumentMouseMove.bind(this),this.onCanvasMouseMove=t.onCanvasMouseMove.bind(this),this.onMouseUp=t.onMouseUp.bind(this),this.onMouseDoubleClick=t.onMouseDoubleClick.bind(this),this.onMouseWheel=t.onMouseWheel.bind(this),this.canvas.addEventListener("click",t.onMouseClick,!1),this.canvas.addEventListener("mousedown",t.onMouseDown,!1),document.body.addEventListener("mousemove",t.onDocumentMouseMove,!1),this.canvas.addEventListener("mousemove",t.onCanvasMouseMove,!1),document.body.addEventListener("mouseup",t.onMouseUp,!1),this.canvas.addEventListener("dblclick",t.onMouseDoubleClick,!1);var i=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this.canvas.addEventListener(i,t.onMouseWheel,!1)},Timeline.prototype.buildDOMContainer=function(){return this.element?this:(this.container=document.createElement("div"),this.container.id="timeline-container",this.container.style.width="100%",this.container.style.height=this.canvasHeight+"px",this.container.style.background=this.colorBackground,this.container.style.position="fixed",this.container.style.left="0px",this.container.style.bottom="0px",document.body.appendChild(this.container),this.splitter=document.createElement("div"),this.splitter.id="timeline-splitter",this.splitter.style.width="100%",this.splitter.style.height="4px",this.splitter.style.cursor="ns-resize",this.splitter.style.position="fixed",this.splitter.style.left="0px",this.splitter.style.bottom=this.canvasHeight-2+"px",this.splitter.addEventListener("mousedown",function(e){function t(e){e.preventDefault();var t=window.innerHeight-e.clientY;t=Math.max(t,46),self.splitter.style.bottom=t-2+"px",self.container.style.height=t+"px",self.canvasHeight=t,self.tracksScrollY=0,self.tracksScrollThumbPos=0,self.save()}function i(){document.body.removeEventListener("mousemove",t,!1),document.body.removeEventListener("mouseup",i,!1)}e.preventDefault(),document.body.addEventListener("mousemove",t,!1),document.body.addEventListener("mouseup",i,!1)},!1),document.body.appendChild(this.splitter),void 0)},Timeline.prototype.removeGUI=function(){var e=this;if(this.canvas){this.canvas.removeEventListener("click",e.onMouseClick),this.canvas.removeEventListener("mousedown",e.onMouseDown),this.canvas.removeEventListener("mousemove",e.onCanvasMouseMove),this.canvas.removeEventListener("dblclick",e.onMouseDoubleClick);var t=/Firefox/i.test(navigator.userAgent)?"DOMMouseScroll":"mousewheel";this.canvas.removeEventListener(t,e.onMouseWheel)}document.body.removeEventListener("mousemove",e.onDocumentMouseMove),document.body.removeEventListener("mouseup",e.onMouseUp),this.container&&this.canvas&&this.container.removeChild(this.canvas),this.splitter&&document.body.removeChild(this.splitter),this.element&&delete this.element,delete this.onGuiSave,delete this.selectedKeys,delete this.selectedAnims,delete this.displayedTracks,delete this.container,delete this.canvas,delete this.splitter,delete this.c},Timeline.prototype.onMouseDown=function(e){0==e.shiftKey&&0==e.metaKey&&(this.selectedKeys=[]);var t=e.layerX,i=e.layerY;this.mousePositionStart=t,this.mousePositionDown.x=t,this.mousePositionDown.y=i,t>this.trackLabelWidth&&i<this.headerHeight?(this.draggingTime=!0,this.onCanvasMouseMove(e)):t>this.canvas.width-this.tracksScrollWidth&&i>this.headerHeight?i>=this.headerHeight+this.tracksScrollThumbPos&&i<=this.headerHeight+this.tracksScrollThumbPos+this.tracksScrollThumbHeight&&(this.tracksScrollThumbDragOffset=i-this.headerHeight-this.tracksScrollThumbPos,this.draggingTracksScrollThumb=!0):t>this.trackLabelWidth&&i>this.headerHeight&&i<this.canvasHeight-this.timeScrollHeight?(this.selectKeys({x:e.layerX,y:e.layerY},!1,e.shiftKey||e.metaKey),this.selectedKeys.length>0?this.draggingKeys=!0:this.draggingSelectKeys=!0,this.cancelKeyClick=!1):t<this.trackLabelWidth&&i>this.canvasHeight-this.timeScrollHeight?(this.timeScale=Math.max(.01,Math.min((this.trackLabelWidth-t)/this.trackLabelWidth,1)),this.draggingTimeScale=!0,this.save()):t>this.trackLabelWidth&&i>this.canvasHeight-this.timeScrollHeight&&t>=this.trackLabelWidth+this.timeScrollThumbPos&&t<=this.trackLabelWidth+this.timeScrollThumbPos+this.timeScrollThumbWidth&&(this.timeScrollThumbDragOffset=t-this.trackLabelWidth-this.timeScrollThumbPos,this.draggingTimeScrollThumb=!0)},Timeline.prototype.onMouseWheel=function(e){e.layerX;var t=e.layerY,i=e.detail?e.detail:-1*(e.wheelDelta/120);t>this.headerHeight&&(this.tracksScrollThumbPos+=20*i,this.tracksScrollThumbPos<0&&(this.tracksScrollThumbPos=0),this.tracksScrollThumbPos+this.tracksScrollThumbHeight>this.tracksScrollHeight&&(this.tracksScrollThumbPos=Math.max(0,this.tracksScrollHeight-this.tracksScrollThumbHeight)),this.tracksScrollY=this.tracksScrollHeight-this.tracksScrollThumbHeight>0?this.tracksScrollThumbPos/(this.tracksScrollHeight-this.tracksScrollThumbHeight):0)
},Timeline.prototype.onDocumentMouseMove=function(e){var t=e.layerX,i=e.layerY,n=this.xToTime(t)-this.xToTime(this.mousePositionStart);if(this.mousePositionMove.x=t,this.mousePositionMove.y=i,this.draggingTime){this.time=this.xToTime(t);var r=this.findAnimationEnd();this.time<0&&(this.time=0),this.time>r&&(this.time=r),this.prevTime=this.time-1/30,this.onPlay(this.time)}if(this.draggingKeys){for(var o=0;o<this.selectedKeys.length;o++){var s=this.selectedKeys[o];s.time=Math.max(0,s.time+n),this.sortTrackKeys(s.track),this.rebuildSelectedTracks()}this.cancelKeyClick=!0,this.timeScrollThumbPos=this.timeScrollX*(this.timeScrollWidth-this.timeScrollThumbWidth)}this.draggingTimeScale&&(this.timeScale=Math.max(.01,Math.min((this.trackLabelWidth-t)/this.trackLabelWidth,1)),this.save()),this.mousePositionStart=t},Timeline.prototype.onCanvasMouseMove=function(e){var t=e.layerX,i=e.layerY;this.draggingTracksScrollThumb&&(this.tracksScrollThumbPos=i-this.headerHeight-this.tracksScrollThumbDragOffset,this.tracksScrollThumbPos<0&&(this.tracksScrollThumbPos=0),this.tracksScrollThumbPos+this.tracksScrollThumbHeight>this.tracksScrollHeight&&(this.tracksScrollThumbPos=Math.max(0,this.tracksScrollHeight-this.tracksScrollThumbHeight)),this.tracksScrollY=this.tracksScrollHeight-this.tracksScrollThumbHeight>0?this.tracksScrollThumbPos/(this.tracksScrollHeight-this.tracksScrollThumbHeight):0),this.draggingTimeScrollThumb&&(this.timeScrollThumbPos=t-this.trackLabelWidth-this.timeScrollThumbDragOffset,this.timeScrollThumbPos<0&&(this.timeScrollThumbPos=0),this.timeScrollThumbPos+this.timeScrollThumbWidth>this.timeScrollWidth&&(this.timeScrollThumbPos=Math.max(0,this.timeScrollWidth-this.timeScrollThumbWidth)),this.timeScrollX=this.timeScrollWidth-this.timeScrollThumbWidth>0?this.timeScrollThumbPos/(this.timeScrollWidth-this.timeScrollThumbWidth):0)},Timeline.prototype.onMouseUp=function(e){if(this.draggingTime&&(this.draggingTime=!1),this.draggingKeys&&(this.draggingKeys=!1),this.draggingSelectKeys){var t=this.mousePositionDown,i={x:e.layerX,y:e.layerY};this.selectKeys(t,i,e.shiftKey||e.metaKey),this.draggingSelectKeys=!1}this.draggingTracksScrollThumb&&(this.draggingTracksScrollThumb=!1),this.draggingTimeScale&&(this.draggingTimeScale=!1),this.draggingTimeScrollThumb&&(this.draggingTimeScrollThumb=!1)},Timeline.prototype.onMouseClick=function(e){e.layerX<1*this.headerHeight-0&&e.layerY<this.headerHeight&&this.play(),e.layerX>1*this.headerHeight-0&&e.layerX<2*this.headerHeight-4&&e.layerY<this.headerHeight&&this.pause(),e.layerX>2*this.headerHeight-4&&e.layerX<3*this.headerHeight-8&&e.layerY<this.headerHeight&&this.stop(),e.layerX>3*this.headerHeight-8&&e.layerX<4*this.headerHeight-12&&e.layerY<this.headerHeight&&this.export(),this.selectedKeys.length>0&&!this.cancelKeyClick&&this.showKeyEditDialog(e.pageX,e.pageY)},Timeline.prototype.onMouseDoubleClick=function(e){var t=e.layerX,i=e.layerY;if(t>this.trackLabelWidth&&i<this.headerHeight){var n=prompt("Enter time")||"0:0:0",r=n.split(":"),o=0,s=0,a=0;r.length>0&&(o=parseInt(r[r.length-1])),r.length>1&&(s=parseInt(r[r.length-2])),r.length>2&&(a=parseInt(r[r.length-3])),this.time=this.totalTime=60*60*a+60*s+o}else t>this.trackLabelWidth&&0==this.selectedKeys.length&&i>this.headerHeight&&i<this.canvasHeight-this.timeScrollHeight&&this.addKeyAt(t,i)},Timeline.prototype.addKeyAt=function(e,t){var i=this.getTrackAt({x:e,y:t});if(0!=i.length){i=i[0];var n={time:this.xToTime(e),value:this.getPropertyValue(i),easing:Timeline.Easing.Linear.EaseNone,track:i};if(0==i.keys.length)i.keys.push(n);else if(n.time<i.keys[0].time)n.value=i.keys[0].value,i.keys.unshift(n);else if(n.time>i.keys[i.keys.length-1].time)n.value=i.keys[i.keys.length-1].value,i.keys.push(n);else for(var r=1;r<i.keys.length;r++)if(i.keys[r].time>n.time){var o=(i.keys[r].time-n.time)/(i.keys[r].time-i.keys[r-1].time),s=i.keys[r].value-i.keys[r-1].value;n.easing=i.keys[r-1].easing,n.value=i.keys[r-1].value+s*n.easing(o),i.keys.splice(r,0,n);break}this.selectedKeys=[n],this.rebuildSelectedTracks()}},Timeline.prototype.getTrackAt=function(e,t){var i=[],n=this.tracksScrollY*(this.displayedTracks.length*this.trackLabelHeight-this.canvas.height+this.headerHeight),r=clickedTrackNumber2=Math.floor((e.y-this.headerHeight+n)/this.trackLabelHeight);if(t&&(clickedTrackNumber2=Math.floor((t.y-this.headerHeight+n)/this.trackLabelHeight),r>clickedTrackNumber2)){var o=clickedTrackNumber2;clickedTrackNumber2=r,r=o}for(var s=r;clickedTrackNumber2>=s;s++)s>=0&&s<this.displayedTracks.length&&"object"!=this.displayedTracks[s].type&&i.push(this.displayedTracks[s]);return i},Timeline.prototype.selectKeys=function(e,t,i){i||(this.selectedKeys=[]);var n=this.getTrackAt(e,t);if(0!=n.length){if(t&&t.x<e.x){var r=t;t=e,e=r}for(var o=0;o<n.length;o++)for(var s=n[o],a=0;a<s.keys.length;a++){var l=s.keys[a],h=this.timeToX(l.time),c=t?t.x:e.x;h>=e.x-.3*this.trackLabelHeight&&h<=c+.3*this.trackLabelHeight&&-1==this.selectedKeys.indexOf(l)&&this.selectedKeys.push(l)}}},Timeline.prototype.selectAnims=function(e){e||(e=[]),this.selectedAnims=e,this.initTracks()},Timeline.prototype.preUpdate=function(){this.updateGUI()},Timeline.prototype.getDisplayedTracks=function(){var e=[],t=this.anims_container;this.displayOnlySelected&&(t=this.selectedAnims);for(var i=0;i<t.length;i++)for(var n=t[i],r=0;r<n.tracks.length;r++){var o=n.tracks[r];("object"==o.type||"property"==o.type&&1==o.enabled)&&e.push(o)}return e},Timeline.prototype.updateGUI=function(){this.canvas||this.initGUI(this.parameters),this.canvas.width=window.innerWidth,this.canvas.height=this.canvasHeight;var e=this.canvas.width,t=this.canvas.height;this.displayedTracks=this.getDisplayedTracks(),this.tracksScrollHeight=this.canvas.height-this.headerHeight-this.timeScrollHeight;var i=this.displayedTracks.length*this.trackLabelHeight,n=this.tracksScrollHeight/i;this.tracksScrollThumbHeight=Math.min(Math.max(20,this.tracksScrollHeight*n),this.tracksScrollHeight),this.timeScrollWidth=this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth;var r=this.findAnimationEnd(),o=this.xToTime(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth)-this.xToTime(0),s=Math.max(0,Math.min(o/r,1));this.timeScrollThumbWidth=s*this.timeScrollWidth,this.timeScrollThumbPos+this.timeScrollThumbWidth>this.timeScrollWidth&&(this.timeScrollThumbPos=Math.max(0,this.timeScrollWidth-this.timeScrollThumbWidth)),this.c.clearRect(0,0,e,t);var a=0,l=0;this.c.fillStyle=this.colorTimelineLabel;for(var h=this.timeToX(0),c=a;h<this.canvas.width;){h=this.timeToX(c),this.drawLine(h,0,h,.3*this.headerHeight,this.colorTimelineTick);var u=Math.floor(c/60),d=c%60,p=u+":"+(10>d?"0":"")+d;h-l>30&&(this.c.fillText(p,h-6,.8*this.headerHeight),l=h),c+=1}this.drawLine(this.timeToX(this.time),0,this.timeToX(this.time),t,this.colorTimeTicker),this.drawRect(0,0,this.trackLabelWidth,this.canvasHeight,this.colorBackground),this.drawRect(0*this.headerHeight- -4,5,this.headerHeight-8,this.headerHeight-8,this.colorButtonBackground),this.drawRect(1*this.headerHeight-0,5,this.headerHeight-8,this.headerHeight-8,this.colorButtonBackground),this.drawRect(2*this.headerHeight-4,5,this.headerHeight-8,this.headerHeight-8,this.colorButtonBackground),this.drawRect(3*this.headerHeight-8,5,this.headerHeight-8,this.headerHeight-8,this.colorButtonBackground),this.c.strokeStyle=this.colorButtonStroke,this.c.beginPath(),this.c.moveTo(10.5,10),this.c.lineTo(this.headerHeight-8,this.headerHeight/2+1.5),this.c.lineTo(10.5,this.headerHeight-8),this.c.lineTo(10.5,10),this.c.stroke(),this.c.strokeRect(this.headerHeight+5.5,10.5,this.headerHeight/6,this.headerHeight-8-11),this.c.strokeRect(this.headerHeight+5.5+this.headerHeight/6+2,10.5,this.headerHeight/6,this.headerHeight-8-11),this.c.strokeRect(2*this.headerHeight-4+5.5,10.5,this.headerHeight-8-11,this.headerHeight-8-11),this.c.beginPath(),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-9.5),this.c.lineTo(3*this.headerHeight-8+11.5,this.headerHeight-9.5),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-13.5),this.c.lineTo(3*this.headerHeight-8+13.5,this.headerHeight-13.5),this.c.moveTo(3*this.headerHeight-8+5.5,this.headerHeight-17.5),this.c.lineTo(3*this.headerHeight-8+15.5,this.headerHeight-17.5),this.c.stroke(),this.c.save(),this.c.beginPath(),this.c.moveTo(0,this.headerHeight+1),this.c.lineTo(this.canvas.width,this.headerHeight+1),this.c.lineTo(this.canvas.width,this.canvas.height-this.timeScrollHeight),this.c.lineTo(0,this.canvas.height-this.timeScrollHeight),this.c.clip();for(var f=0;f<this.displayedTracks.length;f++){var m=this.displayedTracks[f],g=this.headerHeight+this.trackLabelHeight*(f+1),v=this.tracksScrollY*(this.displayedTracks.length*this.trackLabelHeight-this.canvas.height+this.headerHeight);g-=v,g<this.headerHeight||this.drawTrack(m,g)}if(this.draggingSelectKeys){var y=this.mousePositionDown,_=this.mousePositionMove;this.c.strokeStyle=this.colorButtonStroke,this.c.fillStyle=this.colorTimelineLabel,this.c.globalAlpha=.3,this.drawRect(y.x,y.y,_.x-y.x,_.y-y.y),this.c.strokeRect(y.x,y.y,_.x-y.x,_.y-y.y)}this.c.restore(),this.drawLine(this.trackLabelWidth,0,this.trackLabelWidth,t,"#2c3133");for(var f=2;20>f;f++){var b=1-f*f/361;this.drawLine(7+b*(this.trackLabelWidth-10),t-this.timeScrollHeight+4,7+b*(this.trackLabelWidth-10),t-3,"#999999")}this.c.fillStyle=this.colorTimeScale,this.c.beginPath(),this.c.moveTo(7+(1-this.timeScale)*(this.trackLabelWidth-10),t-7),this.c.lineTo(11+(1-this.timeScale)*(this.trackLabelWidth-10),t-1),this.c.lineTo(3+(1-this.timeScale)*(this.trackLabelWidth-10),t-1),this.c.fill(),this.drawRect(this.canvas.width-this.tracksScrollWidth,this.headerHeight+1,this.tracksScrollWidth,this.tracksScrollHeight,this.colorScrollbar),this.tracksScrollThumbHeight<this.tracksScrollHeight&&this.drawRect(this.canvas.width-this.tracksScrollWidth,this.headerHeight+1+this.tracksScrollThumbPos,this.tracksScrollWidth,this.tracksScrollThumbHeight,this.colorScrollbarThumb),this.drawRect(this.trackLabelWidth,t-this.timeScrollHeight,e-this.trackLabelWidth-this.tracksScrollWidth,this.timeScrollHeight,this.colorScrollbar),this.timeScrollThumbWidth<this.timeScrollWidth&&this.drawRect(this.trackLabelWidth+1+this.timeScrollThumbPos,t-this.timeScrollHeight,this.timeScrollThumbWidth,this.timeScrollHeight,this.colorScrollbarThumb),this.drawLine(0,0,e,0,this.colorHeaderBorder),this.drawLine(0,this.headerHeight,e,this.headerHeight,this.colorHeaderBorder),this.drawLine(0,t-this.timeScrollHeight,this.trackLabelWidth,t-this.timeScrollHeight,this.colorHeaderBorder),this.drawLine(this.trackLabelWidth,t-this.timeScrollHeight-1,this.trackLabelWidth,t,this.colorHeaderBorder)},Timeline.prototype.timeToX=function(e){var t=this.findAnimationEnd(),i=this.xToTime(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth)-this.xToTime(20);return t>i&&(e-=(t-i)*this.timeScrollX),this.trackLabelWidth+e*200*this.timeScale+10},Timeline.prototype.xToTime=function(e){var t=this.findAnimationEnd(),i=(this.canvas.width-this.trackLabelWidth-this.tracksScrollWidth-20)/(200*this.timeScale),n=Math.max(0,(t-i)*this.timeScrollX);return(e-this.trackLabelWidth-10)/(200*this.timeScale)+n},Timeline.prototype.drawTrack=function(e,t){var i=5;if("object"==e.type?(this.drawRect(0,t-this.trackLabelHeight+1,this.trackLabelWidth,this.trackLabelHeight-1,"#FFFFFF"),this.c.fillStyle=this.colorObjectLabel):(i+=10,this.c.fillStyle=this.colorPropertyLabel),this.drawLine(0,t,this.canvas.width,t,this.colorTrackBottomLine),this.c.fillText(e.name,i,t-this.trackLabelHeight/4),"property"==e.type)for(var n=0;n<e.keys.length;n++){var r=e.keys[n],o=!1;this.selectedKeys.indexOf(r)>-1&&(o=!0);var s=0==n,a=n==e.keys.length-1,l=this.timeToX(r.time);l>=this.trackLabelWidth&&(this.drawRombus(l,t-.5*this.trackLabelHeight,.5*this.trackLabelHeight,.5*this.trackLabelHeight,"#999999",!0,!0,o?"#FF0000":"#666666"),this.drawRombus(l,t-.5*this.trackLabelHeight,.5*this.trackLabelHeight,.5*this.trackLabelHeight,"#DDDDDD",!s,!a))}},Timeline.prototype.drawLine=function(e,t,i,n,r){this.c.strokeStyle=r,this.c.beginPath(),this.c.moveTo(e+.5,t+.5),this.c.lineTo(i+.5,n+.5),this.c.stroke()},Timeline.prototype.drawRect=function(e,t,i,n,r){this.c.fillStyle=r,this.c.fillRect(e,t,i,n)},Timeline.prototype.drawCenteredRect=function(e,t,i,n,r){this.c.fillStyle=r,this.c.fillRect(e-i/2,t-n/2,i,n)},Timeline.prototype.drawRombus=function(e,t,i,n,r,o,s,a){this.c.fillStyle=r,a&&(this.c.lineWidth=2,this.c.strokeStyle=a,this.c.beginPath(),this.c.moveTo(e,t-n/2),this.c.lineTo(e+i/2,t),this.c.lineTo(e,t+n/2),this.c.lineTo(e-i/2,t),this.c.lineTo(e,t-n/2),this.c.stroke(),this.c.lineWidth=1),o&&(this.c.beginPath(),this.c.moveTo(e,t-n/2),this.c.lineTo(e-i/2,t),this.c.lineTo(e,t+n/2),this.c.fill()),s&&(this.c.beginPath(),this.c.moveTo(e,t-n/2),this.c.lineTo(e+i/2,t),this.c.lineTo(e,t+n/2),this.c.fill())},Timeline.prototype.initTrackKeys=function(e){e.keys=[];for(var t=0;t<e.anims.length;t++){var i=e.anims[t];if(i.delay>0){var n=0,r=i.easing;n=0==t?e.target[e.propertyName]:e.anims[t-1].endValue,e.keys.push({time:i.startTime,value:n,easing:r,track:e})}var r=Timeline.Easing.Linear.EaseNone;t<e.anims.length-1&&0==e.anims[t+1].delay&&(r=e.anims[t+1].easing),e.keys.push({time:i.endTime,value:i.endValue,easing:r,track:e})}},Timeline.prototype.initTracks=function(){for(var e=0;e<this.tracks.length;e++){var t=this.tracks[e];"object"!=t.type&&this.initTrackKeys(t)}},Timeline.prototype.buildInputDialog=function(){this.keyEditDialog=document.createElement("div"),this.keyEditDialog.id="keyEditDialog",this.keyEditDialog.style.cssText="position:absolute; padding:5px; background: #DDDDDD; font-family:arial; font-size:11px; left: 100px; top:100px; border: 1px solid #AAAAAA; border-radius: 5px;";var e="";for(var t in Timeline.Easing){var i=Timeline.Easing[t];for(var n in i)e+="<option>"+t+"."+n+"</option>"}var r="";r+='<label style="margin-right:10px">Value<input type="text" id="keyEditDialogValue"/></label>',r+='<label style="margin-right:10px">Easing<select id="keyEditDialogEasing">'+e+"</select></label>",r+='<input id="keyEditDialogOK" style="margin-left: 10px; margin-right:10px" type="button" value="OK"/>',r+='<input id="keyEditDialogCancel" style="margin-right:10px" type="button" value="Cancel"/>',r+='<a id="keyEditDialogDelete" style="margin-right:5px" href="#">[x]</a>',this.keyEditDialog.innerHTML=r,document.body.appendChild(this.keyEditDialog),this.keyEditDialogValue=document.getElementById("keyEditDialogValue"),this.keyEditDialogEasing=document.getElementById("keyEditDialogEasing"),this.keyEditDialogOK=document.getElementById("keyEditDialogOK"),this.keyEditDialogCancel=document.getElementById("keyEditDialogCancel"),this.keyEditDialogDelete=document.getElementById("keyEditDialogDelete");var o=this;this.keyEditDialogOK.addEventListener("click",function(){o.applyKeyEditDialog(),o.hideKeyEditDialog()},!1),this.keyEditDialogCancel.addEventListener("click",function(){o.hideKeyEditDialog()},!1),this.keyEditDialogDelete.addEventListener("click",function(){o.deleteSelectedKeys(),o.rebuildSelectedTracks(),o.hideKeyEditDialog()},!1),this.hideKeyEditDialog()},Timeline.prototype.applyKeyEditDialog=function(){var e=Number(this.keyEditDialogValue.value);if(!isNaN(e)){for(var t=this.keyEditDialogEasing.options[this.keyEditDialogEasing.selectedIndex],i=Timeline.easingMap[t.value],n=0;n<this.selectedKeys.length;n++)this.selectedKeys[n].easing=i,this.selectedKeys[n].value=e;this.rebuildSelectedTracks()}},Timeline.prototype.showKeyEditDialog=function(e,t){this.keyEditDialogValue.value=this.selectedKeys[0].value;for(var i=0;i<this.keyEditDialogEasing.options.length;i++){var n=this.keyEditDialogEasing.options[i],r=Timeline.easingMap[n.value];if(r==this.selectedKeys[0].easing){this.keyEditDialogEasing.selectedIndex=i;break}}this.keyEditDialog.style.left=Math.max(50,e-200)+"px",this.keyEditDialog.style.top=t-50+"px",this.keyEditDialog.style.display="block",this.keyEditDialogValue.focus()},Timeline.prototype.deleteSelectedKeys=function(){for(var e=0;e<this.selectedKeys.length;e++){var t=this.selectedKeys[e],i=t.track.keys.indexOf(t);t.track.keys.splice(i,1)}this.rebuildSelectedTracks()},Timeline.prototype.hideKeyEditDialog=function(){this.keyEditDialog.style.display="none"},Timeline.prototype.sortTrackKeys=function(e){e.keys.sort(function(e,t){return e.time-t.time});for(var t="",i=0;i<e.keys.length;i++)t+=e.keys[i].time+" "},Timeline.prototype.rebuildSelectedTracks=function(){for(var e=0;e<this.selectedKeys.length;e++)this.rebuildTrackAnimsFromKeys(this.selectedKeys[e].track);this.save(),this.onTrackRebuild()},Timeline.prototype.rebuildTrackAnimsFromKeys=function(e){for(var t=[],i=0;i<e.anims.length;i++){var n=this.anims.indexOf(e.anims[i]);t.push(e.anims[i]),this.anims.splice(n,1)}if(e.anims.splice(0,e.anims.length),0!=e.keys.length)for(var r=e.keys[0].time,o=e.keys[0].time,s=e.keys[0].value,a=Timeline.Easing.Linear.EaseNone,i=0;i<e.keys.length;i++){var l=e.keys[i],h={timeline:this,target:e.target,propertyName:e.propertyName,startValue:s,endValue:l.value,delay:r,startTime:o,endTime:l.time,easing:a,container:e.container};e.anims.push(h),this.anims.push(h),r=0,o=l.time,s=l.value,a=l.easing}},Timeline.prototype.export=function(){for(var e="",t=0;t<this.tracks.length;t++){var i=this.tracks[t];if("object"!=i.type&&0!=i.anims.length){e+='anim("'+i.parent.name+'",'+i.parent.name+")";for(var n=0;n<i.anims.length;n++){var r=i.anims[n];e+=".to(",r.delay&&(e+=r.delay+","),e+='{"'+r.propertyName+'"'+":"+r.endValue+"}",e+=","+(r.endTime-r.startTime),r.easing!=Timeline.Easing.Linear.EaseNone&&(e+=", Timeline.Easing."+Timeline.easingFunctionToString(r.easing)),e+=")"}e+=";\n"}}prompt("Copy this:",e)},Timeline.prototype.getKeysDataJSON=function(){for(var e={},t=0;t<this.tracks.length;t++){var i=this.tracks[t];if("property"==i.type){for(var n=[],r=0;r<i.keys.length;r++)n.push({time:i.keys[r].time,value:i.keys[r].value,easing:Timeline.easingFunctionToString(i.keys[r].easing)});e[i.id]=n}}return e},Timeline.prototype.loadKeysDataFromJSON=function(e){for(var t=0;t<this.tracks.length;t++){var i=this.tracks[t];if(e[i.id]&&"property"==i.type){var n=e[i.id];i.keys=[];for(var r=0;r<n.length;r++)i.keys.push({time:n[r].time,value:n[r].value,easing:Timeline.stringToEasingFunction(n[r].easing),track:i});this.rebuildTrackAnimsFromKeys(i)}}return!0},Timeline.prototype.save=function(){var e=this.getKeysDataJSON();localStorage["timeline.js.settings.canvasHeight"]=this.canvasHeight,localStorage["timeline.js.settings.timeScale"]=this.timeScale,localStorage["timeline.js.data."+this.name]=JSON.stringify(e),this.onGuiSave()},Timeline.prototype.load=function(){localStorage["timeline.js.settings.canvasHeight"]&&(this.canvasHeight=localStorage["timeline.js.settings.canvasHeight"]),localStorage["timeline.js.settings.timeScale"]&&(this.timeScale=localStorage["timeline.js.settings.timeScale"]);var e=localStorage["timeline.js.data."+this.name];if(e){var t=JSON.parse(e);this.loadKeysDataFromJSON(t)}},define("timeline-gui",["timeline"],function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/AppTimeline",["require","Underscore","Backbone","timeline","timeline-gui"],function(t){var n,r,o,s;return o=t("Underscore"),r=t("Backbone"),t("timeline"),t("timeline-gui"),n=function(t){function n(){return this.update=e(this.update,this),this.resize=e(this.resize,this),this.remove=e(this.remove,this),this.onNodeRemove=e(this.onNodeRemove,this),this.selectAnims=e(this.selectAnims,this),this.initialize=e(this.initialize,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.initialize=function(e){var t,i=this;return n.__super__.initialize.apply(this,arguments),localStorage["timeline.js.settings.canvasHeight"]=this.$el.innerHeight(),this.$el.html(""),t=this,this.timeline=new Timeline({element:this.el,displayOnlySelected:!0,colorBackground:"#313638",colorButtonBackground:"#313638",colorButtonStroke:"#aeb7bb",colorScrollbar:"#313638",colorScrollbarThumb:"#656c6f",colorTimelineLabel:"#999",colorTimelineTick:"#656c6f",colorTimeScale:"#666",colorHeaderBorder:"#313638",colorTimeTicker:"#f00",colorTrackBottomLine:"#555",colorPropertyLabel:"#999",onGuiSave:function(){return t.trigger("OnUIResize")},setPropertyValue:function(e,t){return e.target[e.propertyName].setValue(t)},applyPropertyValue:function(e,t){return e.target[e.propertyName].setValue(e.startValue+(e.endValue-e.startValue)*t)},getPropertyValue:function(e){var t;return t=e.target[e.propertyName].attributes.value,"array"!==$.type(t)?t:t[0]},onTrackRebuild:function(){return i.trigger("trackRebuild")},onStop:function(){return i.trigger("stopSound")},onPlay:function(e){return i.trigger("startSound",e)}}),Timeline.globalInstance=this.timeline,this.timeline.loop(-1),this.time=0,e.ui&&(this.ui=e.ui,this.ui.on("render",this.update),this.ui.on("selectAnims",this.selectAnims),this.ui.on("timelineResize",this.resize)),this.trigger("OnUIResize")},n.prototype.selectAnims=function(e){return this.timeline?this.timeline.selectAnims(e):void 0},n.prototype.onNodeRemove=function(){return this.selectAnims([])},n.prototype.remove=function(){return this.undelegateEvents(),this.ui&&(this.ui.off("render",this.update),this.ui.off("selectAnims",this.selectAnims),this.ui.off("timelineResize",this.resize),delete this.ui),this.timeline.destroy(),delete this.timeline,this.time=null},n.prototype.resize=function(e){return this.timeline?(this.timeline.canvasHeight=e,this.timeline.tracksScrollY=0,this.timeline.tracksScrollThumbPos=0,this.timeline.save()):void 0},n.prototype.update=function(){var e,t;return t=Date.now(),this.timeline&&(e=t-this.time,this.timeline.update(e/1e3)),this.time=t},n}(r.View)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/utils/UrlHandler",["require","Backbone"],function(t){var n,r,o;return n=t("Backbone"),r=function(t){function n(){return this.onPlayExample=e(this.onPlayExample,this),this.onExample=e(this.onExample,this),this.onPlay=e(this.onPlay,this),this.onDefault=e(this.onDefault,this),o=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.routes={"":"onDefault",play:"onPlay","example/:file":"onExample","play/example/:file":"onPlayExample"},n.prototype.onDefault=function(){return this.trigger("SetDisplayModeCommand",!1)},n.prototype.onPlay=function(){return this.trigger("SetDisplayModeCommand",!0)},n.prototype.onExample=function(e,t){var i;return null==t&&(t=!1),i=this,this.trigger("SetDisplayModeCommand",t),this.trigger("ClearWorkspace"),$.ajax({url:"examples/"+e,dataType:"text",success:function(e){return i.trigger("LoadJSON",e)}})},n.prototype.onPlayExample=function(e){return this.onExample(e,!0)},n}(n.Router)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/utils/CodeExporter",["require","Underscore","Backbone"],function(t){var i,n,r;return r=t("Underscore"),i=t("Backbone"),n=function(){function t(){this.nodeToCode=e(this.nodeToCode,this),this.toCode=e(this.toCode,this)}return t.prototype.toCode=function(e){var t,i,n,r,o,s,a,l,h;for(n="//\n",n+="// code exported from ThreeNodes.js (github.com/idflood/ThreeNodes.js)\n",n+="//\n\n",n+="require.config({paths: {jQuery: 'loaders/jquery-loader',Underscore: 'loaders/Underscore-loader',Backbone: 'loaders/backbone-loader'}});",n+="require(['threenodes/App', 'libs/jquery-1.6.4.min', 'libs/Underscore-min', 'libs/backbone'], function(App) {",n+="\n\n",n+="\n",n+="var app = new App();\n",n+="var nodes = app.nodes;\n\n",n+="//\n",n+="// nodes\n",n+="//\n",l=e.nodes,r=0,s=l.length;s>r;r++)i=l[r],n+=this.nodeToCode(i);for(n+="\n",n+="//\n",n+="// connections\n",n+="//\n\n",h=e.connections,o=0,a=h.length;a>o;o++)t=h[o],n+=this.connectionToCode(t);return n+="\n\n",n+="// set player mode\n",n+="app.setDisplayMode('SetDisplayModeCommand', true);\n",n+="});"},t.prototype.nodeToCode=function(e){var t,i,n;return t=function(e){var t,i,n,r,o,s;n="{\n";for(i in e){for(n+="		"+("'"+i+"' : [\n"),s=e[i],r=0,o=s.length;o>r;r++)t=s[r],n+="			"+("{time: "+t.time+", value: "+t.value+", easing: '"+t.easing+"'},\n");n+="		],\n"}return n+="	}"},i=function(e){var t,i,n,r,o;for(i="{'in': [\n",o=e["in"],n=0,r=o.length;r>n;n++)t=o[n],i+=t.val?"		{name: '"+t.name+"', val: "+t.val+"},\n":"		{name: '"+t.name+"'},\n";return i+="	]}"},n="\n// node: "+e.name+"\n",n+="var node_"+e.nid+"_data = {\n",n+="	"+("nid: "+e.nid+",\n"),n+="	"+("name: '"+e.name+"',\n"),n+="	"+("type: '"+e.type+"',\n"),n+="	"+("x: "+e.x+",\n"),n+="	"+("y: "+e.y+",\n"),n+="	"+("fields: "+i(e.fields)+",\n"),n+="	"+("anim: "+t(e.anim)+"\n"),n+="};\n",n+="var node_"+e.nid+" = nodes.createNode(node_"+e.nid+"_data);\n"},t.prototype.connectionToCode=function(e){var t;return t="var connection_"+e.id+"_data = {\n",t+="	"+("id: "+e.id+",\n"),t+="	"+("from_node: "+e.from_node+", from: '"+e.from+"',\n"),t+="	"+("to_node: "+e.to_node+", to: '"+e.to+"'\n"),t+="};\n",t+="var connection_"+e.id+" = nodes.createConnectionFromObject(connection_"+e.id+"_data);\n"},t}()})}.call(this);var BlobBuilder=BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||function(e){var t=function(e){return Object.prototype.toString.call(e).match(/^\[object\s(.*)\]$/)[1]},i=function(){this.data=[]},n=function(e,t,i){this.data=e,this.size=e.length,this.type=t,this.encoding=i},r=i.prototype,o=n.prototype,s=e.FileReaderSync,a=function(e){this.code=this[this.name=e]},l="NOT_FOUND_ERR SECURITY_ERR ABORT_ERR NOT_READABLE_ERR ENCODING_ERR NO_MODIFICATION_ALLOWED_ERR INVALID_STATE_ERR SYNTAX_ERR".split(" "),h=l.length,c=e.URL||e.webkitURL||e,u=(c.createObjectURL,c.revokeObjectURL,c),d=e.btoa,p=e.atob,f=!1,m=function(e){f=!e},g=e.ArrayBuffer,v=e.Uint8Array;for(i.fake=o.fake=!0;h--;)a.prototype[l[h]]=h+1;try{v&&m.apply(0,new v(1))}catch(y){}return c.createObjectURL||(u=e.URL={}),u.createObjectURL=function(e){var t,i=e.type;return null===i&&(i="application/octet-stream"),e instanceof n?(t="data:"+i,"base64"===e.encoding?t+";base64,"+e.data:"URI"===e.encoding?t+","+decodeURIComponent(e.data):d?t+";base64,"+d(e.data):t+","+encodeURIComponent(e.data)):real_create_object_url?real_create_object_url.call(c,e):void 0},u.revokeObjectURL=function(e){"data:"!==e.substring(0,5)&&real_revoke_object_url&&real_revoke_object_url.call(c,e)},r.append=function(e){var i=this.data;if(v&&e instanceof g)if(f)i.push(String.fromCharCode.apply(String,new v(e)));else for(var r="",o=new v(e),l=0,h=o.length;h>l;l++)r+=String.fromCharCode(o[l]);else if("Blob"===t(e)||"File"===t(e)){if(!s)throw new a("NOT_READABLE_ERR");var c=new s;i.push(c.readAsBinaryString(e))}else e instanceof n?"base64"===e.encoding&&p?i.push(p(e.data)):"URI"===e.encoding?i.push(decodeURIComponent(e.data)):"raw"===e.encoding&&i.push(e.data):("string"!=typeof e&&(e+=""),i.push(unescape(encodeURIComponent(e))))},r.getBlob=function(e){return arguments.length||(e=null),new n(this.data.join(""),e,"raw")},r.toString=function(){return"[object BlobBuilder]"},o.slice=function(e,t,i){var r=arguments.length;return 3>r&&(i=null),new n(this.data.slice(e,r>1?t:this.data.length),i,this.encoding)},o.toString=function(){return"[object Blob]"},i}(self);define("libs/BlobBuilder.min",function(){});var saveAs=saveAs||navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=e.URL||e.webkitURL||e,r=t.createElementNS("http://www.w3.org/1999/xhtml","a"),o=!e.externalHost&&"download"in r,s=function(i){var n=t.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)},a=e.webkitRequestFileSystem,l=e.requestFileSystem||a||e.mozRequestFileSystem,h=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},c="application/octet-stream",u=0,d=[],p=function(){for(var e=d.length;e--;){var t=d[e];"string"==typeof t?n.revokeObjectURL(t):t.remove()}d.length=0},f=function(e,t,i){t=[].concat(t);for(var n=t.length;n--;){var r=e["on"+t[n]];if("function"==typeof r)try{r.call(e,i||e)}catch(o){h(o)}}},m=function(t,n){var h,p,m,g=this,v=t.type,y=!1,_=function(){var e=i().createObjectURL(t);return d.push(e),e},b=function(){f(g,"writestart progress write writeend".split(" "))},E=function(){(y||!h)&&(h=_(t)),p?p.location.href=h:window.open(h,"_blank"),g.readyState=g.DONE,b()},x=function(e){return function(){return g.readyState!==g.DONE?e.apply(this,arguments):void 0}},T={create:!0,exclusive:!1};return g.readyState=g.INIT,n||(n="download"),o?(h=_(t),r.href=h,r.download=n,s(r),g.readyState=g.DONE,b(),void 0):(e.chrome&&v&&v!==c&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,c),y=!0),a&&"download"!==n&&(n+=".download"),(v===c||a)&&(p=e),l?(u+=t.size,l(e.TEMPORARY,u,x(function(e){e.root.getDirectory("saved",T,x(function(e){var i=function(){e.getFile(n,T,x(function(e){e.createWriter(x(function(i){i.onwriteend=function(t){p.location.href=e.toURL(),d.push(e),g.readyState=g.DONE,f(g,"writeend",t)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&E()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=g["on"+e]}),i.write(t),g.abort=function(){i.abort(),g.readyState=g.DONE},g.readyState=g.WRITING}),E)}),E)};e.getFile(n,{create:!1},x(function(e){e.remove(),i()}),x(function(e){e.code===e.NOT_FOUND_ERR?i():E()}))}),E)}),E),void 0):(E(),void 0))},g=m.prototype,v=function(e,t){return new m(e,t)};return g.abort=function(){var e=this;e.readyState=e.DONE,f(e,"abort")},g.readyState=g.INIT=0,g.WRITING=1,g.DONE=2,g.error=g.onwritestart=g.onprogress=g.onwrite=g.onabort=g.onerror=g.onwriteend=null,e.addEventListener("unload",p,!1),v}(self);"undefined"!=typeof module&&(module.exports=saveAs),define("libs/FileSaver.min",function(){}),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var i,n,r,o,s,a=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,i=0;o>i;i+=1)s[i]=str(i,l)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,i=0;o>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,l),r&&s.push(quote(n)+(gap?": ":":")+r));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(r=str(n,l),r&&s.push(quote(n)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;
"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,r=e[t];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("libs/json2",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/utils/FileHandler",["require","Underscore","Backbone","cs!threenodes/utils/Utils","cs!threenodes/utils/CodeExporter","libs/BlobBuilder.min","libs/FileSaver.min","libs/json2"],function(t){var n,r,o,s,a;return a=t("Underscore"),n=t("Backbone"),s=t("cs!threenodes/utils/Utils"),r=t("cs!threenodes/utils/CodeExporter"),t("libs/BlobBuilder.min"),t("libs/FileSaver.min"),t("libs/json2"),o=function(t){function o(t,i){this.nodes=t,this.group_definitions=i,this.loadLocalFile=e(this.loadLocalFile,this),this.loadFromJsonData=e(this.loadFromJsonData,this),this.getLocalJson=e(this.getLocalJson,this),this.exportCode=e(this.exportCode,this),this.saveLocalFile=e(this.saveLocalFile,this),a.extend(o.prototype,n.Events)}return i(o,t),o.prototype.saveLocalFile=function(){var e,t,i;return e=new BlobBuilder,i=this.getLocalJson(),e.append(i),t=saveAs(e.getBlob("text/plain;charset=utf-8"),"nodes.json")},o.prototype.exportCode=function(){var e,t,i,n,o;return n=this.getLocalJson(!1),t=new r,o=t.toCode(n),e=new BlobBuilder,e.append(o),i=saveAs(e.getBlob("text/plain;charset=utf-8"),"nodes.js")},o.prototype.getLocalJson=function(e){var t;return null==e&&(e=!0),t={uid:this.nodes.indexer.getUID(!1),nodes:jQuery.map(this.nodes.models,function(e){return e.toJSON()}),connections:jQuery.map(this.nodes.connections.models,function(e){return e.toJSON()}),groups:jQuery.map(this.group_definitions.models,function(e){return e.toJSON()})},e?JSON.stringify(t):t},o.prototype.loadFromJsonData=function(e){var t,i,n,r,o,s,a,l,h,c,u,d,p,f,m,g,v=this;if(s=JSON.parse(e),s.groups)for(f=s.groups,l=0,u=f.length;u>l;l++)o=f[l],this.group_definitions.create(o);for(m=s.nodes,h=0,d=m.length;d>h;h++)a=m[h],"Group"!==a.type?this.nodes.createNode(a):(i=this.group_definitions.getByGid(a.definition_id),i?(a.definition=i,r=this.nodes.createGroup(a)):console.log("can't find the GroupDefinition: "+a.definition_id));for(g=s.connections,c=0,p=g.length;p>c;c++)t=g[c],this.nodes.createConnectionFromObject(t);return this.nodes.indexer.uid=s.uid,n=function(e,t){return setTimeout(t,e)},n(1,function(){return v.nodes.renderAllConnections()})},o.prototype.loadLocalFile=function(e){var t,i,n;return this.trigger("ClearWorkspace"),t=e.target.files[0],i=new FileReader,n=this,i.onload=function(e){var t;return t=e.target.result,n.loadFromJsonData(t)},i.readAsText(t,"UTF-8")},o}(n.Events)})}.call(this);var JSON;JSON||(JSON={}),function(){function str(e,t){var i,n,r,o,s,a=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(o=l.length,i=0;o>i;i+=1)s[i]=str(i,l)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+a+"]":"["+s.join(",")+"]",gap=a,r}if(rep&&"object"==typeof rep)for(o=rep.length,i=0;o>i;i+=1)"string"==typeof rep[i]&&(n=rep[i],r=str(n,l),r&&s.push(quote(n)+(gap?": ":":")+r));else for(n in l)Object.prototype.hasOwnProperty.call(l,n)&&(r=str(n,l),r&&s.push(quote(n)+(gap?": ":":")+r));return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+a+"}":"{"+s.join(",")+"}",gap=a,r}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return 10>e?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,i){var n;if(gap="",indent="","number"==typeof i)for(n=0;i>n;n+=1)indent+=" ";else"string"==typeof i&&(indent=i);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var i,n,r=e[t];if(r&&"object"==typeof r)for(i in r)Object.prototype.hasOwnProperty.call(r,i)&&(n=walk(r,i),void 0!==n?r[i]=n:delete r[i]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,i=function(){};i.prototype.addEventListener=function(e,t){return this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]),this._listeners[e].push(t),!0},i.prototype.removeEventListener=function(e,t){if(!(this._listeners&&e in this._listeners))return!1;var i=this._listeners[e],n=r.arrIndexOf(i,t);return-1!==n?(i.length>1?this._listeners[e]=i.slice(0,n).concat(i.slice(n+1)):delete this._listeners[e],!0):!1},i.prototype.dispatchEvent=function(e){var t=e.type,i=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,i),this._listeners&&t in this._listeners)for(var n=0;n<this._listeners[t].length;n++)this._listeners[t][n].apply(this,i)};var n=function(e,t){if(this.type=e,"undefined"!=typeof t)for(var i in t)t.hasOwnProperty(i)&&(this[i]=t[i])};n.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var i=this[t];"function"==typeof i&&(i="[function]"),e.push(t+"="+i)}return"SimpleEvent("+e.join(", ")+")"};var r={},o=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","_"];r.random_string=function(e,t){t=t||o.length;var i,n=[];for(i=0;e>i;i++)n.push(o[Math.floor(Math.random()*t)]);return n.join("")},r.random_number=function(e){return Math.floor(Math.random()*e)},r.random_number_string=function(e){for(var t=""+r.random_number(e),i=(""+(e-1)).length;t.length<i;)t="0"+t;return t},r.attachMessage=function(e){r.attachEvent("message",e)},r.attachEvent=function(i,n){"undefined"!=typeof t.addEventListener?t.addEventListener(i,n,!1):(e.attachEvent("on"+i,n),t.attachEvent("on"+i,n))},r.detachMessage=function(e){r.detachEvent("message",e)},r.detachEvent=function(i,n){"undefined"!=typeof t.addEventListener?t.removeEventListener(i,n,!1):(e.detachEvent("on"+i,n),t.detachEvent("on"+i,n))},r.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},r.objectExtend=function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e};var s={"User-Agent":"",Accept:"","Accept-Language":"","Content-Type":"T"};navigator&&(-1!=navigator.userAgent.indexOf("Chrome")||-1!=navigator.userAgent.indexOf("Safari"))&&delete s["User-Agent"],r.createXDR=function(e,t,i,n){var o={status:null,responseText:"",readyState:1},s=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+r.random_string(8);var a=function(){if(s){l=s.onerror=s.ontimeout=s.onprogress=s.onload=null;try{s.abort()}catch(e){}s=n=null}},l=s.ontimeout=s.onerror=function(){o.status=500,o.readyState=4,n(o),a()};s.onload=function(){o.status=200,o.readyState=4,o.responseText=s.responseText,n(o),a()},s.onprogress=function(){o.status=200,o.readyState=3,o.responseText=s.responseText,n(o)};try{s.open(e,t),s.send(i)}catch(h){l()}return function(e){n&&(n(o,null,e),a())}},r.createXHR=function(e,i,n,o){var a;if(t.ActiveXObject){i+=(-1===i.indexOf("?")?"?":"&")+"t="+ +new Date;try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(l){}}a||(a=new XMLHttpRequest),a.open(e,i,!0);for(var h in s)try{a.setRequestHeader(h,s[h])}catch(l){delete s[h]}"withCredentials"in a&&(a.withCredentials="true");var c=function(){if(a){try{a.onreadystatechange=null}catch(e){a.onreadystatechange=function(){}}try{a.abort()}catch(t){}r.detachEvent("unload",c)}o=a=null};return a.onreadystatechange=function(e){a&&o&&(o(a,e),a&&4===a.readyState&&c())},a.send(n),r.attachEvent("unload",c),function(e){o&&(o(a,null,e),c())}};var a="_jp";r.polluteGlobalNamespace=function(){a in t||(t[a]={})},r.createIframe=function(t,i){var n,o=e.createElement("iframe"),s=function(){clearTimeout(n);try{o.onload=null}catch(e){}o.onerror=null},a=function(){o&&(s(),o.parentNode.removeChild(o),o.src="about:blank",o=null,r.detachEvent("unload",a))},l=function(e){o&&(a(),i(e))};return o.src=t,o.style.display="none",o.style.position="absolute",o.onerror=function(){l("onerror")},o.onload=function(){clearTimeout(n),n=setTimeout(function(){l("onload timeout")},2e3)},e.body.appendChild(o),n=setTimeout(function(){l("timeout")},5e3),r.attachEvent("unload",a),{iframe:o,cleanup:a,loaded:s}},r.createHtmlfile=function(e,i){var n,o,s=new ActiveXObject("htmlfile"),l=function(){clearTimeout(n)},h=function(){if(s){l(),r.detachEvent("unload",h);try{o.src="about:blank"}catch(e){}o.parentNode.removeChild(o),o=s=null,CollectGarbage()}},c=function(e){s&&(h(),i(e))};s.open(),s.write('<html><script>document.domain="'+document.domain+'";'+"</script></html>"),s.close(),s.parentWindow[a]=t[a];var u=s.createElement("div");return s.body.appendChild(u),o=s.createElement("iframe"),u.appendChild(o),o.src=e,n=setTimeout(function(){c("timeout")},5e3),r.attachEvent("unload",h),{iframe:o,cleanup:h,loaded:l}},r.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},r.userSetStatus=function(e){return 1e3===e||e>=3e3&&4999>=e},r.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},r.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},r.amendUrl=function(t){var i=e.location;return 0===t.indexOf("//")&&(t=i.protocol+t),0===t.indexOf("/")&&(t=i.protocol+"//"+i.host+t),t},r.arrIndexOf=function(e,t){for(var i=0;i<e.length;i++)if(e[i]===t)return i;return-1},r.delay=function(e,t){"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var l=function(e,t,i){var n=this;switch(n._options={devel:!1,debug:!1,chunking:void 0},i&&r.objectExtend(n._options,i),n._base_url=r.amendUrl(e),n._server=n._options.server||r.random_number_string(1e3),n._connid=r.random_string(8),n._trans_url=n._base_url+"/"+n._server+"/"+n._connid,n._protocols=["websocket","xhr-streaming","iframe-eventsource","iframe-htmlfile","xhr-polling","iframe-xhr-polling","jsonp-polling"],typeof t){case"undefined":break;case"string":n._protocols=[t];break;default:n._protocols=t}n.protocol=null,n.readyState=l.CONNECTING,n._didClose()};l.prototype=new i,l.version="0.0.4",l.CONNECTING=0,l.OPEN=1,l.CLOSING=2,l.CLOSED=3,l.prototype._debug=function(){this._options.debug&&r.log.apply(r,arguments)},l.prototype._dispatchOpen=function(){var e=this;e.readyState===l.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=l.OPEN,e.dispatchEvent(new n("open"))):e._didClose(1006,"Server lost session")},l.prototype._dispatchMessage=function(e){var t=this;t.readyState===l.OPEN&&t.dispatchEvent(new n("message",{data:e}))},l.prototype._didClose=function(e,t){var i=this;if(i.readyState!==l.CONNECTING&&i.readyState!==l.OPEN&&i.readyState!==l.CLOSING)throw new Error("INVALID_STATE_ERR");i._transport&&i._transport.doCleanup(),i._transport=null,i._transport_tref&&(clearTimeout(i._transport_tref),i._transport_tref=null);var o=new n("close",{status:e,reason:t});if(!r.userSetStatus(e)&&i.readyState===l.CONNECTING){if(i._try_next_protocol(o))return i._transport_tref=setTimeout(function(){i.readyState===l.CONNECTING&&i._didClose(2007,"Transport timeouted")},5001),void 0;o=new n("close",{status:2e3,reason:"All transports failed",last_event:o})}i.readyState=l.CLOSED,setTimeout(function(){i.dispatchEvent(o)},0)},l.prototype._didMessage=function(e){var t=this,i=e.slice(0,1);switch(i){case"o":t._dispatchOpen();break;case"a":for(var n=JSON.parse(e.slice(1)||"[]"),r=0;r<n.length;r++)t._dispatchMessage(n[r]);break;case"m":var n=JSON.parse(e.slice(1)||"null");t._dispatchMessage(n);break;case"c":var n=JSON.parse(e.slice(1)||"[]");t._didClose(n[0],n[1]);break;case"h":}},l.prototype._try_next_protocol=function(e){var t=this;for(t.protocol&&(t._debug("Closed transport:",t.protocol,""+e),t.protocol=null);;){var i=t.protocol=t._protocols.shift();if(!i)return!1;if(l[i]&&l[i].need_chunking===!0&&void 0===t._options.chunking)return t._protocols.unshift(i),t.protocol="chunking-test",t._options.chunking=!1,S(t._base_url,function(e){t._options.chunking=e,t._try_next_protocol()},t._options),!0;if(l[i]&&(l[i].need_chunking!==!0||t._options.chunking===!0)&&l[i].enabled(t._options))return t._debug("Opening transport:",i),t._transport=new l[i](t,t._trans_url,t._base_url),!0;t._debug("Skipping transport:",i)}},l.prototype.close=function(e,t){var i=this;if(e&&!r.userSetStatus(e))throw new Error("INVALID_ACCESS_ERR");return i.readyState!==l.CONNECTING&&i.readyState!==l.OPEN?!1:(i.readyState=l.CLOSING,i._didClose(e||1e3,t||"Normal closure"),!0)},l.prototype.send=function(e){var t=this;if(t.readyState===l.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===l.OPEN&&t._transport.doSend(JSON.stringify(e)),!0};var h=l.websocket=function(e,t){var i=this,n=t+"/websocket";n="https"===n.slice(0,5)?"wss"+n.slice(5):"ws"+n.slice(4),i.ri=e,i.url=n;var o=window.WebSocket||window.MozWebSocket;i.ws=new o(i.url),i.ws.onmessage=function(e){i.ri._didMessage(e.data)},i.ws.onclose=function(){i.ri._didMessage(r.closeFrame(1006,"WebSocket connection broken"))}};h.prototype.doSend=function(e){this.ws.send(e)},h.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),e.ri=e.ws=null)},h.enabled=function(){return!!window.WebSocket||!!window.MozWebSocket};var c=function(){};c.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},c.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),"undefined"==typeof t.send_stop&&t.send_schedule()},c.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(){e.send_stop=void 0,e.send_schedule()}),e.send_buffer=[]}},c.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var u=function(t,i,n){var o=this;if(!("_send_form"in o)){var s=o._send_form=e.createElement("form"),a=o._send_area=e.createElement("textarea");a.name="d",s.style.display="none",s.style.position="absolute",s.method="POST",s.enctype="application/x-www-form-urlencoded",s.acceptCharset="UTF-8",s.appendChild(a),e.body.appendChild(s)}var s=o._send_form,a=o._send_area,l="a"+r.random_string(8);s.target=l,s.action=t+"/jsonp_send?i="+l;var h;try{h=e.createElement('<iframe name="'+l+'">')}catch(c){h=e.createElement("iframe"),h.name=l}h.id=l,s.appendChild(h),h.style.display="none",a.value=i,s.submit();var u=function(){!h.onerror||(h.onreadystatechange=h.onerror=h.onload=null,setTimeout(function(){h.parentNode.removeChild(h),h=null},500),a.value=null,n())};return h.onerror=h.onload=u,h.onreadystatechange=function(){"complete"==h.readyState&&u()},u},d=function(e,t,i){var n=function(e,t,n){(4===e.readyState||n)&&i(e.status,n)};return r.createXHR("POST",e+"/xhr_send",t,n)},p=function(e,t,i){var n=function(e,t,n){(4===e.readyState||n)&&i(e.status,n)},o=window.XDomainRequest?r.createXDR:r.createXHR;return o("POST",e+"/xhr_send",t,n)},f=function(t,i){var n,o,s=e.createElement("script"),a=function(e){o&&(o.parentNode.removeChild(o),o=null),s&&(clearTimeout(n),s.parentNode.removeChild(s),s.onreadystatechange=s.onerror=s.onload=s.onclick=null,s=null,i(e),i=null)};if(s.id="a"+r.random_string(8),s.src=t,s.type="text/javascript",s.charset="UTF-8",s.onerror=function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},s.onload=function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},s.onreadystatechange=function(){if(/loaded|closed/.test(s.readyState)){if(s&&s.htmlFor&&s.onclick)try{s.onclick()}catch(e){}s&&a(r.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof s.async)if("object"==typeof e.attachEvent){try{s.htmlFor=s.id,s.event="onclick"}catch(l){}s.async=!0}else"function"==typeof e.attachEvent&&(o=e.createElement("script"),o.text="try{var a = document.getElementById('"+s.id+"'); if(a)a.onerror();}catch(x){};",s.async=o.async=!1);else s.async=!0;n=setTimeout(function(){a(r.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var h=e.getElementsByTagName("head")[0];return h.insertBefore(s,h.firstChild),o&&h.insertBefore(o,h.firstChild),a},m=l["jsonp-polling"]=function(e,t){r.polluteGlobalNamespace();var i=this;i.ri=e,i.trans_url=t,i.send_constructor(u),i._schedule_recv()};m.prototype=new c,m.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=g(e.trans_url+"/jsonp",f,t)},m.enabled=function(){return!0},m.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var g=function(e,i,n){var o="a"+r.random_string(6),s=e+"?c="+escape(a+"."+o),l=function(e){delete t[a][o],n(e)},h=i(s,l);t[a][o]=h;var c=function(){t[a][o]&&t[a][o](r.closeFrame(1e3,"JSONP user aborted read"))};return c},v=l["xhr-streaming"]=function(e,t){var i=this;i.ri=e,i.trans_url=t,i.send_constructor(p),i.poll=new F(e,I,t+"/xhr_streaming",{cors:!0})};v.prototype=new c,v.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)},v.enabled=function(e){return e.cookie!==!0&&window.XDomainRequest?!0:window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?!0:!1},v.need_chunking=!0;var y=l["xhr-polling"]=function(e,t){var i=this;i.ri=e,i.trans_url=t,i.send_constructor(p),i.poll=new F(e,I,t+"/xhr",{cors:!0})};y.prototype=new c,y.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)},y.enabled=v.enabled;var _=function(){};_.prototype.i_constructor=function(e,t,i){var n=this;n.ri=e,n.origin=r.getOrigin(i),n.base_url=i,n.trans_url=t;var o=i+"/iframe.html";n.ri._options.devel&&(o+="?t="+ +new Date),n.window_id=r.random_string(8),o+="#"+n.window_id,n.iframeObj=r.createIframe(o,function(e){n.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),n.onmessage_cb=r.bind(n.onmessage,n),r.attachMessage(n.onmessage_cb)},_.prototype.doCleanup=function(){var e=this;if(e.iframeObj){r.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},_.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var i=e.data.slice(0,8),n=e.data.slice(8,9),r=e.data.slice(9);if(i!==t.window_id)return;switch(n){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([l.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(r)}}},_.prototype.postMessage=function(e,t){var i=this;i.iframeObj.iframe.contentWindow.postMessage(i.window_id+e+(t||""),i.origin)},_.prototype.doSend=function(e){this.postMessage("m",e)},_.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var b,E=function(e,i){parent!==t?parent.postMessage(b+e+(i||""),"*"):r.log("Can't postMessage, no parent window.",e,i)},x=function(){};x.prototype._didClose=function(e,t){E("t",r.closeFrame(e,t))},x.prototype._didMessage=function(e){E("t",e)},x.prototype._doSend=function(e){this._transport.doSend(e)},x.prototype._doCleanup=function(){this._transport.doCleanup()},l.bootstrap_iframe=function(){var t;b=e.location.hash.slice(1);var i=function(e){if(e.source===parent){var i=e.data.slice(0,8),n=e.data.slice(8,9),o=e.data.slice(9);if(i!==b)return;switch(n){case"s":var s=JSON.parse(o),a=s[0],h=s[1],c=s[2],u=s[3];a!==l.version&&r.log('Incompatibile SockJS! Main site uses: "'+a+'", the iframe:'+' "'+l.version+'".'),t=new x,t._transport=new x[h](t,c,u);break;case"m":t._doSend(o);break;case"c":t._doCleanup(),t=null}}};r.attachMessage(i),E("s")};var T=function(e,t,i){var n=new I(e+"/chunking_test",{cors:i}),o=0;n.onmessage=function(e){var t=e.responsetext.split("h\n").length;3===e.readystate&&t>0&&6>t&&(o=t,n.abort())},n.onclose=function(){n=n.onmessage=n.onclose=null,r.log("Chunking test: "+(o?"passed":"failed")+" ("+o+" chunk received)"),t(!!o)}},w=x["w-iframe-chunking-test"]=function(e,t,i){T(i,function(t){e._didMessage("m"+t),e._didClose()},!1)};w.prototype.doCleanup=function(){};var R=l.chunkingTest=function(e,i,n){if(e=r.amendUrl(e),!(t.XDomainRequest||t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest)){if(_.enabled()){var o=new _;o.protocol="w-iframe-chunking-test";var s=function(e){o&&(i("mtrue"===e),o.doCleanup(),o=null)},a={_options:n||{},_didClose:s,_didMessage:s};return o.i_constructor(a,"",e),void 0}return setTimeout(function(){i(!1)},0),void 0}T(e,i,!0)},S=function(){var e,t=0;return function(i,n){var r=(new Date).getTime();r-t>1e4?R(i,function(i){e=i,t=(new Date).getTime(),n(e)}):setTimeout(function(){n(e)},0)}}(),C=l["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};C.prototype=new _,C.enabled=function(){return"EventSource"in window&&_.enabled()},C.need_chunking=!0;var H=x["w-iframe-eventsource"]=function(e,t){var i=this;i.ri=e,i.trans_url=t,i.send_constructor(d),i.poll=new F(e,D,t+"/eventsource")};H.prototype=new c,H.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var M=l["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};M.prototype=new _,M.enabled=function(){return window.XMLHttpRequest&&_.enabled()};var k=x["w-iframe-xhr-polling"]=function(e,t){var i=this;i.trans_url=t,i.send_constructor(d),i.poll=new F(e,I,t+"/xhr",{cors:!1})};k.prototype=new c,k.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var A=l["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};A.prototype=new _,A.enabled=function(e){return z(),e.cookie!==!1&&_.enabled()},A.need_chunking=!0;var P=x["w-iframe-htmlfile"]=function(e,t){var i=this;i.trans_url=t,i.send_constructor(d),i.poll=new F(e,L,t+"/htmlfile")};P.prototype=new c,P.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var F=function(e,t,i,n){var r=this;r.ri=e,r.Receiver=t,r.recv_url=i,r.opts=n,r._scheduleRecv()};F.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.opts),i=0;t.onmessage=function(t){i+=1,e.ri._didMessage(t.data)},t.onclose=function(i){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===i.reason?e.ri._didClose(1006,"Polling error ("+i.reason+")"):e._scheduleRecv())}},F.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var D=function(e){var t=this,i=new EventSource(e);i.onmessage=function(e){t.dispatchEvent(new n("message",{data:unescape(e.data)}))},t.es_close=i.onerror=function(e,o){var s=o?"user":2!==i.readyState?"network":"permanent";t.es_close=i.onmessage=i.onerror=null,i.close(),i=null,r.delay(200,function(){t.dispatchEvent(new n("close",{reason:s}))})}};D.prototype=new i,D.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var N,z=function(){if(void 0===N)if("ActiveXObject"in window)try{N=!!new ActiveXObject("htmlfile")}catch(e){}else N=!1;return N},L=function(e){var i=this;r.polluteGlobalNamespace(),i.id="a"+r.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(a+"."+i.id);var o,s=z()?r.createHtmlfile:r.createIframe;t[a][i.id]={start:function(){o.loaded()},message:function(e){i.dispatchEvent(new n("message",{data:e}))},stop:function(){i.iframe_close({},"network")}},i.iframe_close=function(e,r){o.cleanup(),i.iframe_close=o=null,delete t[a][i.id],i.dispatchEvent(new n("close",{reason:r}))},o=s(e,function(){i.iframe_close({},"permanent")})};L.prototype=new i,L.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var I=function(e,i){var o=this,s=0,a=function(e,t,i){if(3===e.readyState||4===e.readyState){try{var r=e.responseText,a=e.status}catch(l){}if(r&&200===a)for(;;){var h=r.slice(s),c=h.indexOf("\n");if(-1===c)break;s+=c+1;var u=h.slice(0,c);o.dispatchEvent(new n("message",{data:u,readystate:e.readyState,responsetext:r}))}}if(4===e.readyState||i){var d=i?"user":200===e.status?"network":"permanent";o.xhr_close=null,o.dispatchEvent(new n("close",{reason:d}))}},l=i.cors&&t.XDomainRequest?r.createXDR:r.createXHR;o.xhr_close=l("POST",e,null,a)};return I.prototype=new i,I.prototype.abort=function(){var e=this;e.xhr_close&&e.xhr_close(!0)},l}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),define("libs/sockjs-latest.min",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/utils/AppWebsocket",["require","Underscore","Backbone","libs/sockjs-latest.min"],function(t){var i,n,r;return r=t("Underscore"),n=t("Backbone"),t("libs/sockjs-latest.min"),i=function(){function t(t){var i,n,r,o;if(null==t&&(t=!1),this.onWebsocketMessage=e(this.onWebsocketMessage,this),t){o=!1,o=window.MozWebSocket?window.MozWebSocket:WebSocket,console.log("init websocket."),n=this;try{r=new o("ws://localhost:8080/p5websocket"),r.onmessage=function(e){return n.onWebsocketMessage(e)},r.onerror=function(){return console.log("socket close")}}catch(s){i=s,console.log("no websockets!"),console.log(i)}}}return t.prototype.onWebsocketMessage=function(e){var t;return t=e.data},t}()})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/models/GroupDefinition",["require","Underscore","Backbone","cs!threenodes/utils/Utils"],function(t){var n,r,o,s,a;return s=t("Underscore"),n=t("Backbone"),o=t("cs!threenodes/utils/Utils"),r=function(t){function n(){return this.fromSelectedNodes=e(this.fromSelectedNodes,this),this.initialize=e(this.initialize,this),this.getUID=e(this.getUID,this),this.sync=e(this.sync,this),a=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.defaults={nodes:[],connections:[],name:"Group",gid:-1},n.prototype.sync=function(){},n.prototype.getUID=function(){return this.internal_uid+=1,this.internal_uid},n.prototype.initialize=function(e){var t;return n.__super__.initialize.apply(this,arguments),this.internal_uid=0,t=e.indexer,-1===this.get("gid")&&this.set("gid",t.getUID()),e.fromSelectedNodes&&e.fromSelectedNodes!==!1?this.fromSelectedNodes(e.fromSelectedNodes):void 0},n.prototype.fromSelectedNodes=function(e){var t,i,n,r,o,s,a,l,h,c,u,d,p,f,m;for(s=[],l=0,u=e.length;u>l;l++)for(a=e[l],f=a.fields.models,h=0,d=f.length;d>h;h++)for(n=f[h],m=n.connections,c=0,p=m.length;p>c;c++)i=m[c],r=e.indexOf(i.from_field.node),o=e.indexOf(i.to_field.node),-1!==r&&-1!==o&&(t=s.indexOf(i),-1===t&&s.push(i));return this.attributes.nodes=jQuery.map(e,function(e){return e.toJSON()}),this.attributes.connections=jQuery.map(s,function(e){return e.toJSON()})},n.prototype.toJSON=function(){var e;return e={gid:this.get("gid"),name:this.get("name"),connections:this.get("connections"),nodes:this.get("nodes")}},n.prototype.toCode=function(){var e;return e=""},n}(n.Model)})}.call(this),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/collections/GroupDefinitions",["require","Underscore","Backbone","cs!threenodes/utils/Indexer","cs!threenodes/models/GroupDefinition"],function(t){var n,r,o,s,a,l;return a=t("Underscore"),n=t("Backbone"),s=t("cs!threenodes/utils/Indexer"),r=t("cs!threenodes/models/GroupDefinition"),o=function(t){function n(){return this.removeAll=e(this.removeAll,this),this.groupSelectedNodes=e(this.groupSelectedNodes,this),this.create=e(this.create,this),this.render=e(this.render,this),this.getByGid=e(this.getByGid,this),this.removeAll=e(this.removeAll,this),this.initialize=e(this.initialize,this),l=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.prototype.model=r,n.prototype.initialize=function(){var e=this;return this.indexer=new s,this.bind("group:removed",function(t){return e.remove(t)})},n.prototype.removeAll=function(){var e;return e=this.models.concat(),a.invoke(e,"remove"),this.reset([]),this.indexer.reset()},n.prototype.getByGid=function(e){return this.find(function(t){return t.get("gid")===e})},n.prototype.render=function(){return this.each(function(e){return e.render()})},n.prototype.create=function(e,t){return t||(t={}),t.indexer=this.indexer,(e=this._prepareModel(e,t))?(this.add(e,t),e):!1},n.prototype.groupSelectedNodes=function(e){var t,i,n,o,s,a,l,h,c,u,d,p,f,m,g,v,y,_,b,E,x,T,w,R;for(null==e&&(e=!1),e||(e=this.getSelectedNodes()),i=this.getNodesAveragePosition(e),s=i.x,a=i.y,u=new r({fromSelectedNodes:e,indexer:this.indexer}),this.add(u),l=[],h=[],g=0,b=e.length;b>g;g++)for(m=e[g],w=m.fields.models,v=0,E=w.length;E>v;v++)for(c=w[v],R=c.connections,y=0,x=R.length;x>y;y++)n=R[y],d=e.indexOf(n.from_field.node),p=e.indexOf(n.to_field.node),(-1===d||-1===p)&&(t=l.indexOf(n),-1===t&&(l.push(n),o=n.toJSON(),o.to_subfield=-1===d,h.push(o)));for(_=0,T=e.length;T>_;_++)m=e[_],m.remove();return f={type:"Group",definition:u,x:s,y:a},this.trigger("definition:created",f,h),u},n.prototype.getSelectedNodes=function(){var e,t;return t=[],e=$(".node.ui-selected").not(".node .node"),e.each(function(){var e;return e=$(this).data("object"),t.push(e)}),t},n.prototype.getNodesAveragePosition=function(e){var t,i,n,r,o,s,a,l,h,c;
if(s=0,a=0,r=0,o=0,t=$(".node.ui-selected"),t.length<1&&0===e.length)return!1;for(h=0,c=e.length;c>h;h++)l=e[h],s=Math.min(s,l.get("x")),r=Math.max(r,l.get("x")),a=Math.min(a,l.get("y")),o=Math.max(o,l.get("y"));return i=(s+r)/2,n=(a+o)/2,{x:i,y:n}},n.prototype.removeAll=function(){return this.remove(this.models)},n}(n.Collection)})}.call(this),define("text!templates/definition.tmpl.html",[],function(){return"<div class='definition definition-<%= get(\"name\") %>'>\n  <div class='head'><span><%= get(\"name\") %></span></div>\n  <div class='options'>\n    <a href='#' class='edit'>edit</a>\n    <a href='#' class='remove'>remove</a>\n  </div>\n</div>"}),define("text!templates/confirm_group_delete.tmpl.html",[],function(){return'<div id="confirm-groupdefinition-delete" title="This will remove any existing group node using this group definition">\n  <p class="found-items"></p>\n  <p>Are you sure?</p>\n</div>\n'}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}},t={}.hasOwnProperty,i=function(e,i){function n(){this.constructor=e}for(var r in i)t.call(i,r)&&(e[r]=i[r]);return n.prototype=i.prototype,e.prototype=new n,e.__super__=i.prototype,e};define("cs!threenodes/views/GroupDefinitionView",["require","Underscore","Backbone","text!templates/definition.tmpl.html","text!templates/confirm_group_delete.tmpl.html","jquery.ui"],function(t){var n,r,o,s,a,l;return o=t("Underscore"),n=t("Backbone"),l=t("text!templates/definition.tmpl.html"),a=t("text!templates/confirm_group_delete.tmpl.html"),t("jquery.ui"),r=function(t){function n(){return this.createConfirmModal=e(this.createConfirmModal,this),s=n.__super__.constructor.apply(this,arguments)}return i(n,t),n.template=l,n.prototype.initialize=function(){var e=this;return this.$el.draggable({revert:"valid",opacity:.7,helper:"clone",revertDuration:0,scroll:!1,containment:"document"}),this.$el.data("model",this.model),this.model.bind("remove",function(){return e.remove()}),$(".edit",this.$el).click(function(t){return t.preventDefault(),e.trigger("edit",e.model)}),$(".remove",this.$el).click(function(t){return t.preventDefault(),e.createConfirmModal()})},n.prototype.createConfirmModal=function(){var e,t;return this.$confirm&&this.$confirm.dialog("destroy"),$("#confirm-groupdefinition-delete").remove(),t=this,e=o.template(a,{}),this.$confirm=$(e).appendTo("body"),this.$confirm.dialog({resizable:!1,height:120,modal:!0,buttons:{Delete:function(){return t.model.destroy(),t.$confirm.dialog("close")},Cancel:function(){return t.$confirm.dialog("close")}}})},n}(n.View)})}.call(this),THREE.CopyShader={uniforms:{tDiffuse:{type:"t",value:null},opacity:{type:"f",value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")},define("CopyShader",function(){}),THREE.EffectComposer=function(e,t){if(this.renderer=e,void 0===t){var i=window.innerWidth||1,n=window.innerHeight||1,r={minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,format:THREE.RGBFormat,stencilBuffer:!1};t=new THREE.WebGLRenderTarget(i,n,r)}this.renderTarget1=t,this.renderTarget2=t.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.passes=[],void 0===THREE.CopyShader&&console.error("THREE.EffectComposer relies on THREE.CopyShader"),this.copyPass=new THREE.ShaderPass(THREE.CopyShader)},THREE.EffectComposer.prototype={swapBuffers:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e},addPass:function(e){this.passes.push(e)},insertPass:function(e,t){this.passes.splice(t,0,e)},render:function(e){this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2;var t,i,n=!1,r=this.passes.length;for(i=0;r>i;i++)if(t=this.passes[i],t.enabled){if(t.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),t.needsSwap){if(n){var o=this.renderer.context;o.stencilFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),o.stencilFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}t instanceof THREE.MaskPass?n=!0:t instanceof THREE.ClearMaskPass&&(n=!1)}},reset:function(e){void 0===e&&(e=this.renderTarget1.clone(),e.width=window.innerWidth,e.height=window.innerHeight),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2},setSize:function(e,t){var i=this.renderTarget1.clone();i.width=e,i.height=t,this.reset(i)}},THREE.EffectComposer.camera=new THREE.OrthographicCamera(-1,1,1,-1,0,1),THREE.EffectComposer.quad=new THREE.Mesh(new THREE.PlaneGeometry(2,2),null),THREE.EffectComposer.scene=new THREE.Scene,THREE.EffectComposer.scene.add(THREE.EffectComposer.quad),define("EffectComposer",["Three","CopyShader"],function(){}),THREE.MaskPass=function(e,t){this.scene=e,this.camera=t,this.enabled=!0,this.clear=!0,this.needsSwap=!1,this.inverse=!1},THREE.MaskPass.prototype={render:function(e,t,i){var n=e.context;n.colorMask(!1,!1,!1,!1),n.depthMask(!1);var r,o;this.inverse?(r=0,o=1):(r=1,o=0),n.enable(n.STENCIL_TEST),n.stencilOp(n.REPLACE,n.REPLACE,n.REPLACE),n.stencilFunc(n.ALWAYS,r,4294967295),n.clearStencil(o),e.render(this.scene,this.camera,i,this.clear),e.render(this.scene,this.camera,t,this.clear),n.colorMask(!0,!0,!0,!0),n.depthMask(!0),n.stencilFunc(n.EQUAL,1,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP)}},THREE.ClearMaskPass=function(){this.enabled=!0},THREE.ClearMaskPass.prototype={render:function(e){var t=e.context;t.disable(t.STENCIL_TEST)}},define("MaskPass",function(){}),THREE.RenderPass=function(e,t,i,n,r){this.scene=e,this.camera=t,this.overrideMaterial=i,this.clearColor=n,this.clearAlpha=void 0!==r?r:1,this.oldClearColor=new THREE.Color,this.oldClearAlpha=1,this.enabled=!0,this.clear=!0,this.needsSwap=!1},THREE.RenderPass.prototype={render:function(e,t,i){this.scene.overrideMaterial=this.overrideMaterial,this.clearColor&&(this.oldClearColor.copy(e.getClearColor()),this.oldClearAlpha=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),e.render(this.scene,this.camera,i,this.clear),this.clearColor&&e.setClearColor(this.oldClearColor,this.oldClearAlpha),this.scene.overrideMaterial=null}},define("RenderPass",function(){}),THREE.ShaderPass=function(e,t){this.textureID=void 0!==t?t:"tDiffuse",this.uniforms=THREE.UniformsUtils.clone(e.uniforms),this.material=new THREE.ShaderMaterial({uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader}),this.renderToScreen=!1,this.enabled=!0,this.needsSwap=!0,this.clear=!1},THREE.ShaderPass.prototype={render:function(e,t,i){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=i),THREE.EffectComposer.quad.material=this.material,this.renderToScreen?e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera):e.render(THREE.EffectComposer.scene,THREE.EffectComposer.camera,t,this.clear)}},define("ShaderPass",function(){}),function(e){var t,i=e.Uint8Array,n=e.HTMLCanvasElement,r=/\s*;\s*base64\s*(?:;|$)/i,o=function(e){for(var n,r,o,s=e.length,a=new i(0|3*(s/4)),l=0,h=0,c=[0,0],u=0,d=0;s--;)r=e.charCodeAt(l++),n=t[r-43],255!==n&&n!==o&&(c[1]=c[0],c[0]=r,d=d<<6|n,u++,4===u&&(a[h++]=d>>>16,61!==c[1]&&(a[h++]=d>>>8),61!==c[0]&&(a[h++]=d),u=0));return a};i&&(t=new i([62,-1,-1,-1,63,52,53,54,55,56,57,58,59,60,61,-1,-1,-1,0,-1,-1,-1,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,-1,-1,-1,-1,-1,-1,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51])),n&&!n.prototype.toBlob&&(n.prototype.toBlob=function(e,t){if(t||(t="image/png"),this.mozGetAsFile)return e(this.mozGetAsFile("canvas",t)),void 0;var n,s=Array.prototype.slice.call(arguments,1),a=this.toDataURL.apply(this,s),l=a.indexOf(","),h=a.substring(l+1),c=r.test(a.substring(0,l));Blob.fake?(n=new Blob,n.encoding=c?"base64":"URI",n.data=h,n.size=h.length):i&&(n=c?new Blob([o(h)],{type:t}):new Blob([decodeURIComponent(h)],{type:t})),e(n)})}(self),define("libs/canvas-toBlob.min",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/utils/WebglBase",["require","Underscore","Backbone","Three","EffectComposer","MaskPass","RenderPass","ShaderPass","CopyShader","libs/BlobBuilder.min","libs/FileSaver.min","libs/canvas-toBlob.min"],function(t){var i,n,r,o;return o=t("Underscore"),i=t("Backbone"),n=t("Three"),t("EffectComposer"),t("MaskPass"),t("RenderPass"),t("ShaderPass"),t("CopyShader"),t("libs/BlobBuilder.min"),t("libs/FileSaver.min"),t("libs/canvas-toBlob.min"),namespace("ThreeNodes",{Webgl:{}}),r=function(){function t(){this.exportImage=e(this.exportImage,this),console.log("webgl init..."),this.current_scene=new n.Scene,this.current_camera=new n.PerspectiveCamera(75,800/600,1,1e4),this.current_renderer=!1,window.WebGLRenderingContext&&(this.current_renderer=new n.WebGLRenderer({clearColor:0,preserveDrawingBuffer:!0})),this.current_renderer.autoClear=!1,this.effectScreen=new n.ShaderPass(n.CopyShader),this.effectScreen.renderToScreen=!0,this.renderModel=new n.RenderPass(this.current_scene,this.current_camera),this.composer=new n.EffectComposer(this.current_renderer),ThreeNodes.Webgl.current_renderer=this.current_renderer,ThreeNodes.Webgl.current_scene=this.current_scene,ThreeNodes.Webgl.current_camera=this.current_camera,ThreeNodes.Webgl.composer=this.composer,ThreeNodes.Webgl.renderModel=this.renderModel,ThreeNodes.Webgl.effectScreen=this.effectScreen}return t.prototype.exportImage=function(e){var t,i;return t=this.current_renderer.domElement,i=function(t){return saveAs(t,e)},t.toBlob(i,"image/png")},t}()})}.call(this),function(){var e;e=function(e,t){var i,n,r,o,s,a,l,h;if(r="undefined"!=typeof exports&&null!==exports?exports:window,e.length>0)for(l=e.split("."),s=0,a=l.length;a>s;s++)n=l[s],r=r[n]||(r[n]={});h=[];for(i in t)o=t[i],h.push(r[i]=o);return h},e("",{namespace:e})}.call(this),define("libs/namespace",function(){}),function(){var e=function(e,t){return function(){return e.apply(t,arguments)}};define("cs!threenodes/App",["require","Underscore","Backbone","cs!threenodes/views/UI","cs!threenodes/views/Workspace","cs!threenodes/views/AppTimeline","cs!threenodes/utils/UrlHandler","cs!threenodes/utils/FileHandler","cs!threenodes/utils/AppWebsocket","cs!threenodes/nodes/collections/Nodes","cs!threenodes/collections/GroupDefinitions","cs!threenodes/views/GroupDefinitionView","cs!threenodes/utils/WebglBase","jquery","libs/namespace"],function(t){var i,n,r,o,s,a,l,h,c,u,d,p,f;return f=t("Underscore"),o=t("Backbone"),c=t("cs!threenodes/views/UI"),p=t("cs!threenodes/views/Workspace"),n=t("cs!threenodes/views/AppTimeline"),u=t("cs!threenodes/utils/UrlHandler"),s=t("cs!threenodes/utils/FileHandler"),r=t("cs!threenodes/utils/AppWebsocket"),h=t("cs!threenodes/nodes/collections/Nodes"),l=t("cs!threenodes/collections/GroupDefinitions"),a=t("cs!threenodes/views/GroupDefinitionView"),d=t("cs!threenodes/utils/WebglBase"),t("jquery"),t("libs/namespace"),i=function(){function t(t){this.clearWorkspace=e(this.clearWorkspace,this),this.setDisplayMode=e(this.setDisplayMode,this),this.initTimeline=e(this.initTimeline,this),this.initUI=e(this.initUI,this),this.setWorkspaceFromDefinition=e(this.setWorkspaceFromDefinition,this),this.createWorkspace=e(this.createWorkspace,this);var i,n,c=this;return i={test:!1,player_mode:!1},this.settings=$.extend(i,t),ThreeNodes.renderer={mouseX:0,mouseY:0},n=!1,this.url_handler=new u,this.group_definitions=new l([]),this.nodes=new h([],{settings:i}),this.socket=new r(n),this.webgl=new d,this.file_handler=new s(this.nodes,this.group_definitions),this.group_definitions.bind("definition:created",this.nodes.createGroup),this.group_definitions.bind("remove",this.nodes.removeGroupsByDefinition),this.settings.test===!1&&this.group_definitions.bind("add",function(e){var t,i,n,r;return i=a.template,n=f.template(i,e),t=$(n).appendTo("#library"),r=new a({model:e,el:t}),r.bind("edit",c.setWorkspaceFromDefinition),r.render()}),this.file_handler.on("ClearWorkspace",function(){return c.clearWorkspace()}),this.url_handler.on("ClearWorkspace",function(){return c.clearWorkspace()}),this.url_handler.on("LoadJSON",this.file_handler.loadFromJsonData),this.initUI(),this.initTimeline(),this.createWorkspace(),this.workspace.render(this.nodes),o.history.start({pushState:!1}),!0}return t.prototype.createWorkspace=function(){return this.workspace&&this.workspace.destroy(),this.workspace=new p({el:jQuery("<div class='nodes-container'></div>").appendTo("#container"),settings:this.settings})},t.prototype.setWorkspaceFromDefinition=function(e){return this.createWorkspace(),this.edit_node&&(console.log("remove edit node"),this.edit_node.remove(),delete this.edit_node),"global"===e?(this.workspace.render(this.nodes),this.ui.breadcrumb.reset()):(this.edit_node=this.nodes.createGroup({type:"Group",definition:e,x:-9999}),this.workspace.render(this.edit_node.nodes),this.ui.breadcrumb.set([e]))},t.prototype.initUI=function(){return this.settings.test===!1?(this.ui=new c({el:$("body"),settings:this.settings}),this.ui.on("render",this.nodes.render),this.ui.on("renderConnections",this.nodes.renderAllConnections),this.ui.menubar.on("RemoveSelectedNodes",this.nodes.removeSelectedNodes),this.ui.menubar.on("ClearWorkspace",this.clearWorkspace),this.ui.menubar.on("SaveFile",this.file_handler.saveLocalFile),this.ui.menubar.on("ExportCode",this.file_handler.exportCode),this.ui.menubar.on("LoadJSON",this.file_handler.loadFromJsonData),this.ui.menubar.on("LoadFile",this.file_handler.loadLocalFile),this.ui.menubar.on("ExportImage",this.webgl.exportImage),this.ui.menubar.on("GroupSelectedNodes",this.group_definitions.groupSelectedNodes),this.nodes.on("nodeslist:rebuild",this.ui.onNodeListRebuild),this.url_handler.on("SetDisplayModeCommand",this.ui.setDisplayMode),this.ui.breadcrumb.on("click",this.setWorkspaceFromDefinition)):$("body").addClass("test-mode"),this},t.prototype.initTimeline=function(){return $("#timeline-container, #keyEditDialog").remove(),this.timelineView&&(this.nodes.off("remove",this.timelineView.onNodeRemove),this.timelineView.remove(),this.ui&&this.timelineView.off("TimelineCreated",this.ui.onUiWindowResize)),this.timelineView=new n({el:$("#timeline"),ui:this.ui}),this.nodes.bindTimelineEvents(this.timelineView),this.nodes.on("remove",this.timelineView.onNodeRemove),this.ui&&this.ui.onUiWindowResize(),this},t.prototype.setDisplayMode=function(e){return null==e&&(e=!1),this.ui?this.ui.setDisplayMode(e):void 0},t.prototype.clearWorkspace=function(){return this.nodes.clearWorkspace(),this.group_definitions.removeAll(),this.ui&&this.ui.clearWorkspace(),this.initTimeline()},t}()})}.call(this),require(["cs!node-types","cs!threenodes/App"],function(e,t){return new t}),define("boot",function(){});